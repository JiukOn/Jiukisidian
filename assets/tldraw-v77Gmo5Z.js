var hE=Object.defineProperty;var pE=(n,e,t)=>e in n?hE(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var v=(n,e,t)=>pE(n,typeof e!="symbol"?e+"":e,t);import{c as sn,g as ki,R as Qe,r as _,j as d,a as fE,w as gE,p as mE,b as dp,d as yE,D as SE,e as xE,T as bE,C as wE,f as vE,I as PE,G as IE,S as CE,h as _E,P as Xc,i as EE,k as df,l as uf,m as hf,n as TE,o as kE,q as jE,s as ME,t as AE,u as DE,v as OE,O as RE,x as LE,y as FE,z as $E,A as zE,B as NE,E as BE,F as am,H as UE,J as pf,K as ff,L as gf,M as mf,N as HE,Q as KE,U as qE,V as GE,W as WE,X as YE,Y as VE,Z as XE}from"./vendor-PevXGRgz.js";const ed="__TLDRAW_LIBRARY_VERSIONS__";function ZE(){if(globalThis[ed])return globalThis[ed];const n={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,ed,{value:n,writable:!1,configurable:!1,enumerable:!1}),n}function Ss(n,e,t){if(!n||!e||!t)throw new Error("Missing name/version/module system in built version of tldraw library");const r=ZE();if(r.versions.push({name:n,version:e,modules:t}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,cm(r)},100)}catch{cm(r)}}function cm(n){if(!n.versions.length||n.didWarn)return;const e=n.versions.sort((a,c)=>lm(a.version,c.version)),t=e[e.length-1].version,r=new Set,s=new Map;for(const a of e){if(s.has(a.name)){r.delete(a.name),td(s,a.name,new Set).add(a.version);continue}a.version===t?r.add(a.name):(r.delete(a.name),td(s,a.name,new Set).add(a.version))}if(s.size>0){const a=[`${jr("[tldraw]",["bold","bgRed","textWhite"])} ${jr("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${jr(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,c=>`  • ✅ ${jr(c,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(s,([c,l])=>{const u=Array.from(l).sort(lm).map(h=>jr(`v${h}`,h===t?["textGreen"]:["textRed"]));return`  • ❌ ${jr(c,["bold"])} (${u.join(", ")})`})];console.log(a.join(`
`)),n.didWarn=!0;return}const i=new Map;for(const a of e)td(i,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const o=new Map;for(const[a,c]of i)c.modules.length>1&&o.set(a,c);if(o.size>0){const a=[`${jr("[tldraw]",["bold","bgRed","textWhite"])} ${jr("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(o,([c,l])=>{const u=l.modules.map((h,p)=>h==="esm"?`      ${p+1}. ES Modules`:`      ${p+1}. CommonJS`).join(`
`);return`  • ❌ ${jr(c,["bold"])} v${l.version}: 
${u}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),n.didWarn=!0;return}}function lm(n,e){const t=n.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!r?n.localeCompare(e):t[1]!==r[1]?Number(t[1])-Number(r[1]):t[2]!==r[2]?Number(t[2])-Number(r[2]):t[3]!==r[3]?Number(t[3])-Number(r[3]):t[4]&&r[4]?t[4].localeCompare(r[4]):t[4]?1:r[4]?-1:0}const JE={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function jr(n,e=[]){return`\x1B[${e.map(t=>JE[t]).join(";")}m${n}\x1B[m`}function td(n,e,t){return n.has(e)?n.get(e):(n.set(e,t),t)}var nd,dm;function QE(){if(dm)return nd;dm=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,i=/^0b[01]+$/i,o=/^0o[0-7]+$/i,a=parseInt,c=typeof sn=="object"&&sn&&sn.Object===Object&&sn,l=typeof self=="object"&&self&&self.Object===Object&&self,u=c||l||Function("return this")(),h=Object.prototype,p=h.toString,f=Math.max,g=Math.min,m=function(){return u.Date.now()};function x(E,T,C){var j,k,R,A,D,O,$=0,B=!1,G=!1,Y=!0;if(typeof E!="function")throw new TypeError(n);T=I(T)||0,S(C)&&(B=!!C.leading,G="maxWait"in C,R=G?f(I(C.maxWait)||0,T):R,Y="trailing"in C?!!C.trailing:Y);function ne(me){var Me=j,Re=k;return j=k=void 0,$=me,A=E.apply(Re,Me),A}function de(me){return $=me,D=setTimeout(ce,T),B?ne(me):A}function ae(me){var Me=me-O,Re=me-$,Te=T-Me;return G?g(Te,R-Re):Te}function Oe(me){var Me=me-O,Re=me-$;return O===void 0||Me>=T||Me<0||G&&Re>=R}function ce(){var me=m();if(Oe(me))return Ne(me);D=setTimeout(ce,ae(me))}function Ne(me){return D=void 0,Y&&j?ne(me):(j=k=void 0,A)}function re(){D!==void 0&&clearTimeout(D),$=0,j=O=k=D=void 0}function pt(){return D===void 0?A:Ne(m())}function Ie(){var me=m(),Me=Oe(me);if(j=arguments,k=this,O=me,Me){if(D===void 0)return de(O);if(G)return D=setTimeout(ce,T),ne(O)}return D===void 0&&(D=setTimeout(ce,T)),A}return Ie.cancel=re,Ie.flush=pt,Ie}function b(E,T,C){var j=!0,k=!0;if(typeof E!="function")throw new TypeError(n);return S(C)&&(j="leading"in C?!!C.leading:j,k="trailing"in C?!!C.trailing:k),x(E,T,{leading:j,maxWait:T,trailing:k})}function S(E){var T=typeof E;return!!E&&(T=="object"||T=="function")}function P(E){return!!E&&typeof E=="object"}function w(E){return typeof E=="symbol"||P(E)&&p.call(E)==t}function I(E){if(typeof E=="number")return E;if(w(E))return e;if(S(E)){var T=typeof E.valueOf=="function"?E.valueOf():E;E=S(T)?T+"":T}if(typeof E!="string")return E===0?E:+E;E=E.replace(r,"");var C=i.test(E);return C||o.test(E)?a(E.slice(2),C?2:8):s.test(E)?e:+E}return nd=b,nd}var eT=QE();const Ub=ki(eT);var rd,um;function tT(){if(um)return rd;um=1;var n=200,e="__lodash_hash_undefined__",t=1/0,r="[object Function]",s="[object GeneratorFunction]",i=/[\\^$.*+?()[\]{}|]/g,o=/^\[object .+?Constructor\]$/,a=typeof sn=="object"&&sn&&sn.Object===Object&&sn,c=typeof self=="object"&&self&&self.Object===Object&&self,l=a||c||Function("return this")();function u(U,X){var he=U?U.length:0;return!!he&&p(U,X,0)>-1}function h(U,X,he,Ge){for(var Ir=U.length,Tn=he+-1;++Tn<Ir;)if(X(U[Tn],Tn,U))return Tn;return-1}function p(U,X,he){if(X!==X)return h(U,f,he);for(var Ge=he-1,Ir=U.length;++Ge<Ir;)if(U[Ge]===X)return Ge;return-1}function f(U){return U!==U}function g(U,X){return U.has(X)}function m(U,X){return U==null?void 0:U[X]}function x(U){var X=!1;if(U!=null&&typeof U.toString!="function")try{X=!!(U+"")}catch{}return X}function b(U){var X=-1,he=Array(U.size);return U.forEach(function(Ge){he[++X]=Ge}),he}var S=Array.prototype,P=Function.prototype,w=Object.prototype,I=l["__core-js_shared__"],E=(function(){var U=/[^.]+$/.exec(I&&I.keys&&I.keys.IE_PROTO||"");return U?"Symbol(src)_1."+U:""})(),T=P.toString,C=w.hasOwnProperty,j=w.toString,k=RegExp("^"+T.call(C).replace(i,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),R=S.splice,A=qi(l,"Map"),D=qi(l,"Set"),O=qi(Object,"create");function $(U){var X=-1,he=U?U.length:0;for(this.clear();++X<he;){var Ge=U[X];this.set(Ge[0],Ge[1])}}function B(){this.__data__=O?O(null):{}}function G(U){return this.has(U)&&delete this.__data__[U]}function Y(U){var X=this.__data__;if(O){var he=X[U];return he===e?void 0:he}return C.call(X,U)?X[U]:void 0}function ne(U){var X=this.__data__;return O?X[U]!==void 0:C.call(X,U)}function de(U,X){var he=this.__data__;return he[U]=O&&X===void 0?e:X,this}$.prototype.clear=B,$.prototype.delete=G,$.prototype.get=Y,$.prototype.has=ne,$.prototype.set=de;function ae(U){var X=-1,he=U?U.length:0;for(this.clear();++X<he;){var Ge=U[X];this.set(Ge[0],Ge[1])}}function Oe(){this.__data__=[]}function ce(U){var X=this.__data__,he=et(X,U);if(he<0)return!1;var Ge=X.length-1;return he==Ge?X.pop():R.call(X,he,1),!0}function Ne(U){var X=this.__data__,he=et(X,U);return he<0?void 0:X[he][1]}function re(U){return et(this.__data__,U)>-1}function pt(U,X){var he=this.__data__,Ge=et(he,U);return Ge<0?he.push([U,X]):he[Ge][1]=X,this}ae.prototype.clear=Oe,ae.prototype.delete=ce,ae.prototype.get=Ne,ae.prototype.has=re,ae.prototype.set=pt;function Ie(U){var X=-1,he=U?U.length:0;for(this.clear();++X<he;){var Ge=U[X];this.set(Ge[0],Ge[1])}}function me(){this.__data__={hash:new $,map:new(A||ae),string:new $}}function Me(U){return Js(this,U).delete(U)}function Re(U){return Js(this,U).get(U)}function Te(U){return Js(this,U).has(U)}function jt(U,X){return Js(this,U).set(U,X),this}Ie.prototype.clear=me,Ie.prototype.delete=Me,Ie.prototype.get=Re,Ie.prototype.has=Te,Ie.prototype.set=jt;function st(U){var X=-1,he=U?U.length:0;for(this.__data__=new Ie;++X<he;)this.add(U[X])}function xt(U){return this.__data__.set(U,e),this}function qe(U){return this.__data__.has(U)}st.prototype.add=st.prototype.push=xt,st.prototype.has=qe;function et(U,X){for(var he=U.length;he--;)if(Wl(U[he][0],X))return he;return-1}function pn(U){if(!ei(U)||Kl(U))return!1;var X=Qs(U)||x(U)?k:o;return X.test(ql(U))}function Zr(U,X,he){var Ge=-1,Ir=u,Tn=U.length,Gi=!0,Cr=[],_r=Cr;if(Tn>=n){var tr=Ki(U);if(tr)return b(tr);Gi=!1,Ir=g,_r=new st}else _r=Cr;e:for(;++Ge<Tn;){var Er=U[Ge],Cs=Er;if(Er=Er!==0?Er:0,Gi&&Cs===Cs){for(var ca=_r.length;ca--;)if(_r[ca]===Cs)continue e;Cr.push(Er)}else Ir(_r,Cs,he)||(_r!==Cr&&_r.push(Cs),Cr.push(Er))}return Cr}var Ki=D&&1/b(new D([,-0]))[1]==t?function(U){return new D(U)}:aa;function Js(U,X){var he=U.__data__;return Hl(X)?he[typeof X=="string"?"string":"hash"]:he.map}function qi(U,X){var he=m(U,X);return pn(he)?he:void 0}function Hl(U){var X=typeof U;return X=="string"||X=="number"||X=="symbol"||X=="boolean"?U!=="__proto__":U===null}function Kl(U){return!!E&&E in U}function ql(U){if(U!=null){try{return T.call(U)}catch{}try{return U+""}catch{}}return""}function Gl(U){return U&&U.length?Zr(U):[]}function Wl(U,X){return U===X||U!==U&&X!==X}function Qs(U){var X=ei(U)?j.call(U):"";return X==r||X==s}function ei(U){var X=typeof U;return!!U&&(X=="object"||X=="function")}function aa(){}return rd=Gl,rd}var nT=tT();const rT=ki(nT),fo={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},sT=fo.Good;class Hb{constructor(){v(this,"startTime",0);v(this,"name","");v(this,"frames",0);v(this,"started",!1);v(this,"frame",null);v(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),r=t>55?fo.Good:t>30?fo.Mid:fo.Poor,s=r===fo.Mid?"black":"white",i=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${i} %c${t}%c fps`,`color: white; background: ${sT};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${s};`,"font-weight: normal")}isStarted(){return this.started}}function yf(n,e){const t=[];e:for(const r of n){for(const s of t)if(e?e(r,s):r===s)continue e;t.push(r)}return t}function fe(n){return n.filter(e=>e!=null)}function Pt(n){return n[n.length-1]}function iT(n,e){let t,r=1/0;for(const s of n){const i=e(s);i<r&&(t=s,r=i)}return t}function oT(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function Kb(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const Oo=()=>{},hs={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function mt(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const De=Kb((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),tn=Kb((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function Sf(){let n,e;const t=new Promise((r,s)=>{n=r,e=s});return Object.assign(t,{resolve:n,reject:e})}function up(n){return new Promise(e=>setTimeout(e,n))}function on(...n){if(n.length===2){const[e,t]=n;t.addInitializer(function(){De(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const s=e.bind(this),i=Reflect.defineProperty(this,t.name,{value:s,writable:!0,configurable:!0});De(i,"Cannot bind a non-configurable class method.")})}else{const[e,t,r]=n;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const s=r.value.bind(this);return Object.defineProperty(this,t,{value:s,configurable:!0,writable:!0}),s}}}}class pr{constructor(){v(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function Zc(n,e){let t;const r=(...s)=>(t||(t={},t.promise=new Promise((i,o)=>{t.resolve=i,t.reject=o})),clearTimeout(t.timeout),t.latestArgs=s,t.timeout=setTimeout(()=>{const i=t;t=void 0;try{i.resolve(n(...i.latestArgs))}catch(o){i.reject(o)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const hm=new WeakMap;function xf(n,e){if(typeof n!="object"||n===null)return;let t=hm.get(n);t||(t={tags:{},extras:{}},hm.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function fr(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Ro=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class Kn{static async dataUrlToArrayBuffer(e){return fr(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,r)=>{if(e){const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i=>r(i),s.onabort=i=>r(i),s.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,r)=>{if(e){const s=new FileReader;s.onload=()=>t(s.result),s.onerror=i=>r(i),s.onabort=i=>r(i),s.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function hp(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function pm(n){const e=new DataView(n);let t=0;for(let r=0;r<e.byteLength;r++)t=(t<<5)-t+e.getUint8(r),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const fm=globalThis.crypto,aT="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",cT=128;let Ms,li;function lT(n){!Ms||Ms.length<n?(Ms=new Uint8Array(n*cT),fm.getRandomValues(Ms),li=0):li+n>Ms.length&&(fm.getRandomValues(Ms),li=0),li+=n}function dT(n=21){lT(n-=0);let e="";for(let t=li-n;t<li;t++)e+=aT[Ms[t]&63];return e}let uT=dT;function Fe(n){return uT(n)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function hT(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(i,o,a,c,l=1024){if(!o)return-1;o=new RegExp(o,"g");const u=o.source.length,h=new TextDecoder,p=i.length;if(typeof c>"u"&&(c=p),a>=p||c<=0||a>=c)return-1;i=i.subarray(a,c);let f=-1,g=0,m=0,x="";e:for(;g<i.length;){const b=g+l,S=i.subarray(g,b),P=h.decode(S,{stream:!0}),w=x+P;let I,E=-1;for(;(I=o.exec(w))!==null;){E=I.index-x.length,f=m+E;break e}g=b,m+=P.length;const T=E>-1?E+u:P.length-u;x=P.slice(T)}return f>=0&&(f+=a>=0?a:p+a),f}const s=r(e,"IDAT",12);return s>=12?r(e,"acTL",8,s)>=8:!1}const pT=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function gm(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function fT(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function gT(n){const e=new Uint8Array(n);let t,r,s=0,i=0;if(!fT(n))return!1;for(t=e[10]&128,r=e[10]&7,s+=6,s+=7,s+=t?3*Math.pow(2,r+1):0;i<2&&s<e.length;)switch(e[s]){case 44:i+=1,t=e[s+9]&128,r=e[s+9]&7,s+=10,s+=t?3*Math.pow(2,r+1):0,s+=gm(e,s+1)+1;break;case 33:s+=2,s+=gm(e,s);break;case 59:s=e.length;break;default:s=e.length;break}return i>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let pp=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(pp=new Int32Array(pp));const mT=(n,e)=>{let t=-1;for(let r=0;r<n.length;r++)t=pp[(t^n[r])&255]^t>>>8;return t^-1},mm=4,ym=4;class or{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!or.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const s=t,i=e.getInt32(t);t+=4;const o=or.getChunkType(e,t);if(o==="IDAT"&&r[o]){t+=i+mm+ym;continue}if(o==="IEND")break;r[o]={start:s,dataOffset:t+4,size:i},t+=i+mm+ym}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return or.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let s=46,i=0;const o=or.findChunk(e,"pHYs");o&&(s=o.start,i=o.size);const a=or.findChunk(e,"IDAT");a&&(s=a.start,i=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,112),l.setUint8(5,72),l.setUint8(6,89),l.setUint8(7,115);const u=2835.5;l.setInt32(8,u*t),l.setInt32(12,u*t),l.setInt8(16,1);const h=new Uint8Array(c.slice(4,17));l.setInt32(17,mT(h));const p=e.buffer.slice(0,s),f=e.buffer.slice(s+i);return new Blob([p,c,f],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function yT(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function ST(n){const e=new Uint8Array(n);return!yT(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const qb=Object.freeze(["image/svg+xml"]),Gb=Object.freeze(["image/jpeg","image/png","image/webp"]),Wb=Object.freeze(["image/gif","image/apng","image/avif"]),Jc=Object.freeze([...Gb,...qb,...Wb]),bf=Object.freeze(["video/mp4","video/webm","video/quicktime"]),xT=[...Jc,...bf].join(",");class yn{static loadVideo(e){return new Promise((t,r)=>{const s=document.createElement("video");s.onloadeddata=()=>t(s),s.onerror=i=>{console.error(i),r(new Error("Could not load video"))},s.crossOrigin="anonymous",s.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const r=Sf();let s=!1;const i=()=>{if(!s)if(e.readyState>=e.HAVE_METADATA)s=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const c=a.getContext("2d");if(!c)throw new Error("Could not get 2d context");c.drawImage(e,0,0),r.resolve(a.toDataURL())}},o=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",i),e.addEventListener("loadeddata",i),e.addEventListener("canplay",i),e.addEventListener("seeked",i),e.addEventListener("error",o),e.addEventListener("stalled",o),i();try{return await r}finally{e.removeEventListener("loadedmetadata",i),e.removeEventListener("loadeddata",i),e.removeEventListener("canplay",i),e.removeEventListener("seeked",i),e.removeEventListener("error",o),e.removeEventListener("stalled",o)}}static loadImage(e){return new Promise((t,r)=>{const s=Ro();s.onload=()=>t(s),s.onerror=i=>{console.error(i),r(new Error("Could not load image"))},s.crossOrigin="anonymous",s.referrerPolicy="strict-origin-when-cross-origin",s.src=e})}static async getVideoSize(e){return yn.usingObjectURL(e,async t=>{const r=await yn.loadVideo(t);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const t=await yn.usingObjectURL(e,yn.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(or.isPng(r,0)){const s=or.findChunk(r,"pHYs");if(s){const i=or.parsePhys(r,s.dataOffset);if(i.unit===0&&i.ppux===i.ppuy){const o=Math.max(i.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/o),h:Math.round(t.naturalHeight/o)}}}}}}catch(r){return console.error(r),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?gT(await e.arrayBuffer()):e.type==="image/avif"?pT(await e.arrayBuffer()):e.type==="image/webp"?ST(await e.arrayBuffer()):e.type==="image/apng"?hT(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return Wb.includes(e||"")}static isStaticImageType(e){return Gb.includes(e||"")}static isVectorImageType(e){return qb.includes(e||"")}static isImageType(e){return Jc.includes(e)}static async usingObjectURL(e,t){const r=URL.createObjectURL(e);try{return await t(r)}finally{URL.revokeObjectURL(r)}}}function _e(n,e,t){return n+(e-n)*t}function Jn(n=""){let e=0,t=0,r=0,s=0;function i(){const o=e^e<<11;return e=t,t=r,r=s,s^=(s>>>19^o^o>>>8)>>>0,s/4294967296*2}for(let o=0;o<n.length+64;o++)e^=n.charCodeAt(o)|0,i();return i}function vi(n,e,t,r=!1){const[s,i]=e,[o,a]=t,c=o+(n-s)/(i-s)*(a-o);return r?o<a?Math.max(Math.min(c,a),o):Math.max(Math.min(c,o),a):c}function Wn(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Ft(n,e){if(Wn(n,e))return n[e]}function Sm(n){return Object.keys(n)}function nt(n){return Object.values(n)}function cn(n){return Object.entries(n)}function wf(n){return Object.fromEntries(n)}function Co(n,e){const t={};let r=!1;for(const[s,i]of cn(n))e(s,i)?t[s]=i:r=!0;return r?t:n}function Go(n,e){const t={};for(const[r,s]of cn(n)){const i=e(r,s);t[r]=i}return t}function Yb(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const s of t)if(!r.has(s)||!Object.is(n[s],e[s]))return!1;return!0}function bT(n){const e=wT(n.chars),t=vT(e,n.firstPositive,n.mostPositive,n.mostNegative),r=n.jitterRange??Math.floor(Math.pow(e.length,3)/5),s=PT(r,e.length);return{chars:n.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:t.firstPositive,mostPositive:t.mostPositive,firstNegative:t.firstNegative,mostNegative:t.mostNegative,jitterRange:r,paddingDict:s}}function wT(n){const e={},t={},r=n.length;for(let s=0;s<r;s++){const i=n[s];e[s]=i,t[i]=s}return{byCode:e,byChar:t,length:r}}function vT(n,e,t,r){const s=n.byChar[e],i=n.byChar[t],o=n.byChar[r];if(s===void 0||i===void 0||o===void 0)throw new Error("invalid charSet");if(i-s<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(s-o<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:n.byCode[s],mostPositive:n.byCode[i],firstNegative:n.byCode[s-1],mostNegative:n.byCode[o]}}function PT(n,e){const t={};for(let r=0;r<100&&(t[r]=Math.pow(e,r),!(t[r]>n));r++);return t}var sd=null;function vf(){return sd||(sd=bT({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function ls(n,e,t){const r=t.byChar[n],s=t.byChar[e];return Math.abs(r-s)}function Pf(n,e){const t=n[0];if(t>e.mostPositive||t<e.mostNegative)throw new Error("invalid firstChar on key");return t===e.mostPositive?ls(t,e.firstPositive,e)+1+xc(n.slice(1),"positive",e):t===e.mostNegative?ls(t,e.firstNegative,e)+1+xc(n.slice(1),"negative",e):t>=e.firstPositive?ls(t,e.firstPositive,e)+2:ls(t,e.firstNegative,e)+2}function xc(n,e,t){const r=n[0];if(r>t.mostPositive||r<t.mostNegative)throw new Error("invalid firstChar on key");return r===t.mostPositive&&e==="positive"?ls(r,t.mostNegative,t)+1+xc(n.slice(1),e,t):r===t.mostNegative&&e==="negative"?ls(r,t.mostPositive,t)+1+xc(n.slice(1),e,t):e==="positive"?ls(r,t.mostNegative,t)+2:ls(r,t.mostPositive,t)+2}function Qc(n,e,t,r,s){const i=Math.max(n.length,e.length);return t==="start"?[n.padStart(i,r),e.padStart(i,r)]:[n.padEnd(i,r),e.padEnd(i,r)]}function IT(n,e,t){let[r,s]=Qc(n,e,"end",t.first),i=fp(r,s,t);i===1&&(r=r.padEnd(r.length+1,t.first),i=t.length);const o=Zb(Math.floor(i/2),t);return If(r,o,t)}function fp(n,e,t){const[r,s]=Qc(n,e,"end",t.first).sort(),i=Vb(s,r,t);return CT(i,t)}function If(n,e,t){const r=t.length,[s,i]=Qc(n,e,"start",t.first),o=[];let a=0;for(let c=s.length-1;c>=0;c--){const l=t.byChar[s[c]],u=t.byChar[i[c]],h=l+u+a;a=Math.floor(h/r);const p=h%r;o.unshift(t.byCode[p])}return a>0&&o.unshift(t.byCode[a]),o.join("")}function Vb(n,e,t){const r=t.length,[s,i]=Qc(n,e,"start",t.first),o=[];let a=0;for(let c=s.length-1;c>=0;c--){let l=t.byChar[s[c]];const u=t.byChar[i[c]]+a;l<u?(a=1,l+=r):a=0;const h=l-u;o.unshift(t.byCode[h])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;o.length>1&&o[0]===t.byCode[0];)o.shift();return o.join("")}function Xb(n,e){return If(n,e.byCode[1],e)}function gp(n,e){return Vb(n,e.byCode[1],e)}function Zb(n,e){if(n===0)return e.byCode[0];let t="";const r=e.length;for(;n>0;)t=e.byCode[n%r]+t,n=Math.floor(n/r);return t}function CT(n,e){let t=0;const r=n.length,s=e.length;for(let i=0;i<r;i++)t+=e.byChar[n[i]]*Math.pow(s,r-i-1);return t}function _T(n){return n.firstPositive+n.byCode[0]}function ET(n,e){return Pf(n,e)===n.length}function xm(n,e){bc(n,e)}function bc(n,e){const t=ew(n,e),r=Pf(t,e);if(r>n.length)throw new Error("invalid order key length: "+n);return n.slice(0,r)}function Jb(n,e){if(!ET(n,e))throw new Error("invalid integer length: "+n)}function Qb(n,e){Jb(n,e);const[t,r]=tw(n,e);if(r.split("").some(o=>o!==e.byCode[e.length-1])){const o=Xb(r,e);return t+o}const i=kT(t,e);return nw(i,"lower",e)}function TT(n,e){Jb(n,e);const[t,r]=tw(n,e);if(r.split("").some(o=>o!==e.byCode[0])){const o=gp(r,e);return t+o}const i=jT(t,e);return nw(i,"upper",e)}function ew(n,e){let t=0;if(n[0]===e.mostPositive)for(;n[t]===e.mostPositive;)t=t+1;if(n[0]===e.mostNegative)for(;n[t]===e.mostNegative;)t=t+1;return n.slice(0,t+1)}function tw(n,e){const t=ew(n,e),r=n.slice(t.length);return[t,r]}function kT(n,e){const t=n>=e.firstPositive,r=Xb(n,e),s=n[n.length-1]===e.mostPositive,i=r[r.length-1]===e.mostPositive;return t&&i?r+e.mostNegative:!t&&s?n.slice(0,n.length-1):r}function jT(n,e){const t=n>=e.firstPositive,r=n[n.length-1]===e.mostNegative;if(t&&r){const s=n.slice(0,n.length-1);return gp(s,e)}return!t&&r?n+e.mostPositive:gp(n,e)}function nw(n,e,t){const r=Pf(n,t),s=e==="upper"?t.byCode[t.length-1]:t.byCode[0];return n+s.repeat(r-n.length)}function rw(n,e){const t=Zb(Math.floor(Math.random()*e.jitterRange),e);return If(n,t,e)}function MT(n,e,t){const r=n.padEnd(n.length+e,t.first);return rw(r,t)}function AT(n,e,t){const r=bc(n,t),s=Qb(r,t);let i=0;if(e!==null){const a=fp(n,e,t);a<t.jitterRange+1&&(i=Math.max(i,bm(a,t)))}const o=fp(n,s,t);return o<t.jitterRange+1&&(i=Math.max(i,bm(o,t))),i}function bm(n,e){const t=e.jitterRange-n,r=Object.entries(e.paddingDict).find(([s,i])=>i>t);return r?parseInt(r[0]):0}function DT(n,e,t=vf()){if(n!==null&&xm(n,t),e!==null&&xm(e,t),n===null&&e===null)return _T(t);if(n===null){const r=bc(e,t);return TT(r,t)}if(e===null){const r=bc(n,t);return Qb(r,t)}if(n>=e)throw new Error(n+" >= "+e);return IT(n,e,t)}function sw(n,e,t=vf()){const r=DT(n,e,t),s=AT(r,e,t);return s?MT(r,s,t):rw(r,t)}function iw(n,e,t,r=vf()){return OT(n,e,t,r,sw,iw)}function OT(n,e,t,r,s,i){if(t===0)return[];if(t===1)return[s(n,e,r)];if(e==null){let c=s(n,e,r);const l=[c];for(let u=0;u<t-1;u++)c=s(c,e,r),l.push(c);return l}if(n==null){let c=s(n,e,r);const l=[c];for(let u=0;u<t-1;u++)c=s(n,c,r),l.push(c);return l.reverse(),l}const o=Math.floor(t/2),a=s(n,e,r);return[...i(n,a,o,r),a,...i(a,e,t-o-1,r)]}const ji=iw,ow="a0";function RT(n){try{sw(n,null)}catch{throw new Error("invalid index: "+n)}}function Pi(n,e,t){return ji(n??null,e??null,t)}function id(n,e){return ji(n??null,null,e)}function Lo(n,e){return ji(n??null,e??null,1)[0]}function ar(n=null){return ji(n,null,1)[0]}function LT(n=null){return ji(null,n,1)[0]}function Fo(n,e="a1"){return[e,...ji(e,null,n)]}function Rt(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function FT(n,e){return n.id>e.id?1:-1}function Cf(n){try{return localStorage.getItem(n)}catch{return null}}function _f(n,e){try{localStorage.setItem(n,e)}catch{}}function $T(){try{localStorage.clear()}catch{}}function aw(n){try{return sessionStorage.getItem(n)}catch{return null}}function Ef(n,e){try{sessionStorage.setItem(n,e)}catch{}}function cw(n){try{sessionStorage.removeItem(n)}catch{}}function zT(){try{sessionStorage.clear()}catch{}}const di=[],NT=60,Ha=Math.ceil(1e3/NT);let Zi,od=0,mp=0;const BT=()=>{const n=di.splice(0,di.length);for(const e of n)e()};function lw(){if(Zi)return;const n=Date.now(),e=n-mp;if(od+e<Ha){Zi=requestAnimationFrame(()=>{Zi=void 0,lw()});return}Zi=requestAnimationFrame(()=>{Zi=void 0,mp=n,od=Math.min(od+e-Ha,Ha*10),BT()})}let wm=!1;function dw(n){return di.includes(n)||(di.push(n),wm||(wm=!0,mp=Date.now()-Ha-1),lw()),()=>{const e=di.indexOf(n);e>-1&&di.splice(e,1)}}class UT{constructor(){v(this,"timeouts",new Map);v(this,"intervals",new Map);v(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,r,...s){const i=window.setTimeout(t,r,s),o=this.timeouts.get(e)??[];return this.timeouts.set(e,[...o,i]),i}setInterval(e,t,r,...s){const i=window.setInterval(t,r,s),o=this.intervals.get(e)??[];return this.intervals.set(e,[...o,i]),i}requestAnimationFrame(e,t){const r=window.requestAnimationFrame(t),s=this.rafs.get(e)??[];return this.rafs.set(e,[...s,r]),r}dispose(e){var t,r,s;(t=this.timeouts.get(e))==null||t.forEach(i=>clearTimeout(i)),(r=this.intervals.get(e))==null||r.forEach(i=>clearInterval(i)),(s=this.rafs.get(e))==null||s.forEach(i=>cancelAnimationFrame(i)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,r,...s)=>this.setTimeout(e,t,r,s),setInterval:(t,r,...s)=>this.setInterval(e,t,r,s),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const pe=(n,e)=>{try{return new URL(n,e)}catch{return}};function HT(n){return n!==void 0}function KT(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const uw=KT(),Ve=uw[0];uw[1];const qT=Object.getPrototypeOf(Ve({}));Ss("@tldraw/utils","3.5.0","esm");var vm={},Ji,Pm;function Bt(){if(Pm)return Ji;Pm=1;var n=function(e){return e&&e.Math===Math&&e};return Ji=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof sn=="object"&&sn)||n(typeof Ji=="object"&&Ji)||(function(){return this})()||Function("return this")(),Ji}var ad={},cd,Im;function Ut(){return Im||(Im=1,cd=function(n){try{return!!n()}catch{return!0}}),cd}var ld,Cm;function Kr(){if(Cm)return ld;Cm=1;var n=Ut();return ld=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),ld}var dd,_m;function el(){if(_m)return dd;_m=1;var n=Ut();return dd=!n(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),dd}var ud,Em;function qr(){if(Em)return ud;Em=1;var n=el(),e=Function.prototype.call;return ud=n?e.bind(e):function(){return e.apply(e,arguments)},ud}var hd={},Tm;function GT(){if(Tm)return hd;Tm=1;var n={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!n.call({1:2},1);return hd.f=t?function(s){var i=e(this,s);return!!i&&i.enumerable}:n,hd}var pd,km;function Tf(){return km||(km=1,pd=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}}),pd}var fd,jm;function St(){if(jm)return fd;jm=1;var n=el(),e=Function.prototype,t=e.call,r=n&&e.bind.bind(t,t);return fd=n?r:function(s){return function(){return t.apply(s,arguments)}},fd}var gd,Mm;function Mi(){if(Mm)return gd;Mm=1;var n=St(),e=n({}.toString),t=n("".slice);return gd=function(r){return t(e(r),8,-1)},gd}var md,Am;function WT(){if(Am)return md;Am=1;var n=St(),e=Ut(),t=Mi(),r=Object,s=n("".split);return md=e(function(){return!r("z").propertyIsEnumerable(0)})?function(i){return t(i)==="String"?s(i,""):r(i)}:r,md}var yd,Dm;function hw(){return Dm||(Dm=1,yd=function(n){return n==null}),yd}var Sd,Om;function Ai(){if(Om)return Sd;Om=1;var n=hw(),e=TypeError;return Sd=function(t){if(n(t))throw new e("Can't call method on "+t);return t},Sd}var xd,Rm;function tl(){if(Rm)return xd;Rm=1;var n=WT(),e=Ai();return xd=function(t){return n(e(t))},xd}var bd,Lm;function qt(){if(Lm)return bd;Lm=1;var n=typeof document=="object"&&document.all;return bd=typeof n>"u"&&n!==void 0?function(e){return typeof e=="function"||e===n}:function(e){return typeof e=="function"},bd}var wd,Fm;function Gr(){if(Fm)return wd;Fm=1;var n=qt();return wd=function(e){return typeof e=="object"?e!==null:n(e)},wd}var vd,$m;function nl(){if($m)return vd;$m=1;var n=Bt(),e=qt(),t=function(r){return e(r)?r:void 0};return vd=function(r,s){return arguments.length<2?t(n[r]):n[r]&&n[r][s]},vd}var Pd,zm;function pw(){if(zm)return Pd;zm=1;var n=St();return Pd=n({}.isPrototypeOf),Pd}var Id,Nm;function YT(){if(Nm)return Id;Nm=1;var n=Bt(),e=n.navigator,t=e&&e.userAgent;return Id=t?String(t):"",Id}var Cd,Bm;function VT(){if(Bm)return Cd;Bm=1;var n=Bt(),e=YT(),t=n.process,r=n.Deno,s=t&&t.versions||r&&r.version,i=s&&s.v8,o,a;return i&&(o=i.split("."),a=o[0]>0&&o[0]<4?1:+(o[0]+o[1])),!a&&e&&(o=e.match(/Edge\/(\d+)/),(!o||o[1]>=74)&&(o=e.match(/Chrome\/(\d+)/),o&&(a=+o[1]))),Cd=a,Cd}var _d,Um;function fw(){if(Um)return _d;Um=1;var n=VT(),e=Ut(),t=Bt(),r=t.String;return _d=!!Object.getOwnPropertySymbols&&!e(function(){var s=Symbol("symbol detection");return!r(s)||!(Object(s)instanceof Symbol)||!Symbol.sham&&n&&n<41}),_d}var Ed,Hm;function gw(){if(Hm)return Ed;Hm=1;var n=fw();return Ed=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Ed}var Td,Km;function mw(){if(Km)return Td;Km=1;var n=nl(),e=qt(),t=pw(),r=gw(),s=Object;return Td=r?function(i){return typeof i=="symbol"}:function(i){var o=n("Symbol");return e(o)&&t(o.prototype,s(i))},Td}var kd,qm;function XT(){if(qm)return kd;qm=1;var n=String;return kd=function(e){try{return n(e)}catch{return"Object"}},kd}var jd,Gm;function kf(){if(Gm)return jd;Gm=1;var n=qt(),e=XT(),t=TypeError;return jd=function(r){if(n(r))return r;throw new t(e(r)+" is not a function")},jd}var Md,Wm;function jf(){if(Wm)return Md;Wm=1;var n=kf(),e=hw();return Md=function(t,r){var s=t[r];return e(s)?void 0:n(s)},Md}var Ad,Ym;function ZT(){if(Ym)return Ad;Ym=1;var n=qr(),e=qt(),t=Gr(),r=TypeError;return Ad=function(s,i){var o,a;if(i==="string"&&e(o=s.toString)&&!t(a=n(o,s))||e(o=s.valueOf)&&!t(a=n(o,s))||i!=="string"&&e(o=s.toString)&&!t(a=n(o,s)))return a;throw new r("Can't convert object to primitive value")},Ad}var Dd={exports:{}},Od,Vm;function yw(){return Vm||(Vm=1,Od=!1),Od}var Rd,Xm;function Mf(){if(Xm)return Rd;Xm=1;var n=Bt(),e=Object.defineProperty;return Rd=function(t,r){try{e(n,t,{value:r,configurable:!0,writable:!0})}catch{n[t]=r}return r},Rd}var Zm;function Af(){if(Zm)return Dd.exports;Zm=1;var n=yw(),e=Bt(),t=Mf(),r="__core-js_shared__",s=Dd.exports=e[r]||t(r,{});return(s.versions||(s.versions=[])).push({version:"3.48.0",mode:n?"pure":"global",copyright:"© 2013–2025 Denis Pushkarev (zloirock.ru), 2025–2026 CoreJS Company (core-js.io). All rights reserved.",license:"https://github.com/zloirock/core-js/blob/v3.48.0/LICENSE",source:"https://github.com/zloirock/core-js"}),Dd.exports}var Ld,Jm;function Df(){if(Jm)return Ld;Jm=1;var n=Af();return Ld=function(e,t){return n[e]||(n[e]=t||{})},Ld}var Fd,Qm;function Wo(){if(Qm)return Fd;Qm=1;var n=Ai(),e=Object;return Fd=function(t){return e(n(t))},Fd}var $d,ey;function xs(){if(ey)return $d;ey=1;var n=St(),e=Wo(),t=n({}.hasOwnProperty);return $d=Object.hasOwn||function(s,i){return t(e(s),i)},$d}var zd,ty;function Sw(){if(ty)return zd;ty=1;var n=St(),e=0,t=Math.random(),r=n(1.1.toString);return zd=function(s){return"Symbol("+(s===void 0?"":s)+")_"+r(++e+t,36)},zd}var Nd,ny;function Wr(){if(ny)return Nd;ny=1;var n=Bt(),e=Df(),t=xs(),r=Sw(),s=fw(),i=gw(),o=n.Symbol,a=e("wks"),c=i?o.for||o:o&&o.withoutSetter||r;return Nd=function(l){return t(a,l)||(a[l]=s&&t(o,l)?o[l]:c("Symbol."+l)),a[l]},Nd}var Bd,ry;function JT(){if(ry)return Bd;ry=1;var n=qr(),e=Gr(),t=mw(),r=jf(),s=ZT(),i=Wr(),o=TypeError,a=i("toPrimitive");return Bd=function(c,l){if(!e(c)||t(c))return c;var u=r(c,a),h;if(u){if(l===void 0&&(l="default"),h=n(u,c,l),!e(h)||t(h))return h;throw new o("Can't convert object to primitive value")}return l===void 0&&(l="number"),s(c,l)},Bd}var Ud,sy;function xw(){if(sy)return Ud;sy=1;var n=JT(),e=mw();return Ud=function(t){var r=n(t,"string");return e(r)?r:r+""},Ud}var Hd,iy;function bw(){if(iy)return Hd;iy=1;var n=Bt(),e=Gr(),t=n.document,r=e(t)&&e(t.createElement);return Hd=function(s){return r?t.createElement(s):{}},Hd}var Kd,oy;function ww(){if(oy)return Kd;oy=1;var n=Kr(),e=Ut(),t=bw();return Kd=!n&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),Kd}var ay;function vw(){if(ay)return ad;ay=1;var n=Kr(),e=qr(),t=GT(),r=Tf(),s=tl(),i=xw(),o=xs(),a=ww(),c=Object.getOwnPropertyDescriptor;return ad.f=n?c:function(u,h){if(u=s(u),h=i(h),a)try{return c(u,h)}catch{}if(o(u,h))return r(!e(t.f,u,h),u[h])},ad}var qd={},Gd,cy;function Pw(){if(cy)return Gd;cy=1;var n=Kr(),e=Ut();return Gd=n&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),Gd}var Wd,ly;function Ws(){if(ly)return Wd;ly=1;var n=Gr(),e=String,t=TypeError;return Wd=function(r){if(n(r))return r;throw new t(e(r)+" is not an object")},Wd}var dy;function Di(){if(dy)return qd;dy=1;var n=Kr(),e=ww(),t=Pw(),r=Ws(),s=xw(),i=TypeError,o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,c="enumerable",l="configurable",u="writable";return qd.f=n?t?function(p,f,g){if(r(p),f=s(f),r(g),typeof p=="function"&&f==="prototype"&&"value"in g&&u in g&&!g[u]){var m=a(p,f);m&&m[u]&&(p[f]=g.value,g={configurable:l in g?g[l]:m[l],enumerable:c in g?g[c]:m[c],writable:!1})}return o(p,f,g)}:o:function(p,f,g){if(r(p),f=s(f),r(g),e)try{return o(p,f,g)}catch{}if("get"in g||"set"in g)throw new i("Accessors not supported");return"value"in g&&(p[f]=g.value),p},qd}var Yd,uy;function Of(){if(uy)return Yd;uy=1;var n=Kr(),e=Di(),t=Tf();return Yd=n?function(r,s,i){return e.f(r,s,t(1,i))}:function(r,s,i){return r[s]=i,r},Yd}var Vd={exports:{}},Xd,hy;function QT(){if(hy)return Xd;hy=1;var n=Kr(),e=xs(),t=Function.prototype,r=n&&Object.getOwnPropertyDescriptor,s=e(t,"name"),i=s&&(function(){}).name==="something",o=s&&(!n||n&&r(t,"name").configurable);return Xd={EXISTS:s,PROPER:i,CONFIGURABLE:o},Xd}var Zd,py;function Iw(){if(py)return Zd;py=1;var n=St(),e=qt(),t=Af(),r=n(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(s){return r(s)}),Zd=t.inspectSource,Zd}var Jd,fy;function ek(){if(fy)return Jd;fy=1;var n=Bt(),e=qt(),t=n.WeakMap;return Jd=e(t)&&/native code/.test(String(t)),Jd}var Qd,gy;function Cw(){if(gy)return Qd;gy=1;var n=Df(),e=Sw(),t=n("keys");return Qd=function(r){return t[r]||(t[r]=e(r))},Qd}var eu,my;function Rf(){return my||(my=1,eu={}),eu}var tu,yy;function _w(){if(yy)return tu;yy=1;var n=ek(),e=Bt(),t=Gr(),r=Of(),s=xs(),i=Af(),o=Cw(),a=Rf(),c="Object already initialized",l=e.TypeError,u=e.WeakMap,h,p,f,g=function(S){return f(S)?p(S):h(S,{})},m=function(S){return function(P){var w;if(!t(P)||(w=p(P)).type!==S)throw new l("Incompatible receiver, "+S+" required");return w}};if(n||i.state){var x=i.state||(i.state=new u);x.get=x.get,x.has=x.has,x.set=x.set,h=function(S,P){if(x.has(S))throw new l(c);return P.facade=S,x.set(S,P),P},p=function(S){return x.get(S)||{}},f=function(S){return x.has(S)}}else{var b=o("state");a[b]=!0,h=function(S,P){if(s(S,b))throw new l(c);return P.facade=S,r(S,b,P),P},p=function(S){return s(S,b)?S[b]:{}},f=function(S){return s(S,b)}}return tu={set:h,get:p,has:f,enforce:g,getterFor:m},tu}var Sy;function tk(){if(Sy)return Vd.exports;Sy=1;var n=St(),e=Ut(),t=qt(),r=xs(),s=Kr(),i=QT().CONFIGURABLE,o=Iw(),a=_w(),c=a.enforce,l=a.get,u=String,h=Object.defineProperty,p=n("".slice),f=n("".replace),g=n([].join),m=s&&!e(function(){return h(function(){},"length",{value:8}).length!==8}),x=String(String).split("String"),b=Vd.exports=function(S,P,w){p(u(P),0,7)==="Symbol("&&(P="["+f(u(P),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),w&&w.getter&&(P="get "+P),w&&w.setter&&(P="set "+P),(!r(S,"name")||i&&S.name!==P)&&(s?h(S,"name",{value:P,configurable:!0}):S.name=P),m&&w&&r(w,"arity")&&S.length!==w.arity&&h(S,"length",{value:w.arity});try{w&&r(w,"constructor")&&w.constructor?s&&h(S,"prototype",{writable:!1}):S.prototype&&(S.prototype=void 0)}catch{}var I=c(S);return r(I,"source")||(I.source=g(x,typeof P=="string"?P:"")),S};return Function.prototype.toString=b(function(){return t(this)&&l(this).source||o(this)},"toString"),Vd.exports}var nu,xy;function Ew(){if(xy)return nu;xy=1;var n=qt(),e=Di(),t=tk(),r=Mf();return nu=function(s,i,o,a){a||(a={});var c=a.enumerable,l=a.name!==void 0?a.name:i;if(n(o)&&t(o,l,a),a.global)c?s[i]=o:r(i,o);else{try{a.unsafe?s[i]&&(c=!0):delete s[i]}catch{}c?s[i]=o:e.f(s,i,{value:o,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return s},nu}var ru={},su,by;function nk(){if(by)return su;by=1;var n=Math.ceil,e=Math.floor;return su=Math.trunc||function(r){var s=+r;return(s>0?e:n)(s)},su}var iu,wy;function Ys(){if(wy)return iu;wy=1;var n=nk();return iu=function(e){var t=+e;return t!==t||t===0?0:n(t)},iu}var ou,vy;function rk(){if(vy)return ou;vy=1;var n=Ys(),e=Math.max,t=Math.min;return ou=function(r,s){var i=n(r);return i<0?e(i+s,0):t(i,s)},ou}var au,Py;function Tw(){if(Py)return au;Py=1;var n=Ys(),e=Math.min;return au=function(t){var r=n(t);return r>0?e(r,9007199254740991):0},au}var cu,Iy;function Yo(){if(Iy)return cu;Iy=1;var n=Tw();return cu=function(e){return n(e.length)},cu}var lu,Cy;function sk(){if(Cy)return lu;Cy=1;var n=tl(),e=rk(),t=Yo(),r=function(s){return function(i,o,a){var c=n(i),l=t(c);if(l===0)return!s&&-1;var u=e(a,l),h;if(s&&o!==o){for(;l>u;)if(h=c[u++],h!==h)return!0}else for(;l>u;u++)if((s||u in c)&&c[u]===o)return s||u||0;return!s&&-1}};return lu={includes:r(!0),indexOf:r(!1)},lu}var du,_y;function kw(){if(_y)return du;_y=1;var n=St(),e=xs(),t=tl(),r=sk().indexOf,s=Rf(),i=n([].push);return du=function(o,a){var c=t(o),l=0,u=[],h;for(h in c)!e(s,h)&&e(c,h)&&i(u,h);for(;a.length>l;)e(c,h=a[l++])&&(~r(u,h)||i(u,h));return u},du}var uu,Ey;function Lf(){return Ey||(Ey=1,uu=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),uu}var Ty;function ik(){if(Ty)return ru;Ty=1;var n=kw(),e=Lf(),t=e.concat("length","prototype");return ru.f=Object.getOwnPropertyNames||function(s){return n(s,t)},ru}var hu={},ky;function ok(){return ky||(ky=1,hu.f=Object.getOwnPropertySymbols),hu}var pu,jy;function ak(){if(jy)return pu;jy=1;var n=nl(),e=St(),t=ik(),r=ok(),s=Ws(),i=e([].concat);return pu=n("Reflect","ownKeys")||function(a){var c=t.f(s(a)),l=r.f;return l?i(c,l(a)):c},pu}var fu,My;function ck(){if(My)return fu;My=1;var n=xs(),e=ak(),t=vw(),r=Di();return fu=function(s,i,o){for(var a=e(i),c=r.f,l=t.f,u=0;u<a.length;u++){var h=a[u];!n(s,h)&&!(o&&n(o,h))&&c(s,h,l(i,h))}},fu}var gu,Ay;function lk(){if(Ay)return gu;Ay=1;var n=Ut(),e=qt(),t=/#|\.prototype\./,r=function(c,l){var u=i[s(c)];return u===a?!0:u===o?!1:e(l)?n(l):!!l},s=r.normalize=function(c){return String(c).replace(t,".").toLowerCase()},i=r.data={},o=r.NATIVE="N",a=r.POLYFILL="P";return gu=r,gu}var mu,Dy;function Oi(){if(Dy)return mu;Dy=1;var n=Bt(),e=vw().f,t=Of(),r=Ew(),s=Mf(),i=ck(),o=lk();return mu=function(a,c){var l=a.target,u=a.global,h=a.stat,p,f,g,m,x,b;if(u?f=n:h?f=n[l]||s(l,{}):f=n[l]&&n[l].prototype,f)for(g in c){if(x=c[g],a.dontCallGetSet?(b=e(f,g),m=b&&b.value):m=f[g],p=o(u?g:l+(h?".":"#")+g,a.forced),!p&&m!==void 0){if(typeof x==typeof m)continue;i(x,m)}(a.sham||m&&m.sham)&&t(x,"sham",!0),r(f,g,x,a)}},mu}var yu={},Su,Oy;function dk(){if(Oy)return Su;Oy=1;var n=kw(),e=Lf();return Su=Object.keys||function(r){return n(r,e)},Su}var Ry;function uk(){if(Ry)return yu;Ry=1;var n=Kr(),e=Pw(),t=Di(),r=Ws(),s=tl(),i=dk();return yu.f=n&&!e?Object.defineProperties:function(a,c){r(a);for(var l=s(c),u=i(c),h=u.length,p=0,f;h>p;)t.f(a,f=u[p++],l[f]);return a},yu}var xu,Ly;function hk(){if(Ly)return xu;Ly=1;var n=nl();return xu=n("document","documentElement"),xu}var bu,Fy;function jw(){if(Fy)return bu;Fy=1;var n=Ws(),e=uk(),t=Lf(),r=Rf(),s=hk(),i=bw(),o=Cw(),a=">",c="<",l="prototype",u="script",h=o("IE_PROTO"),p=function(){},f=function(S){return c+u+a+S+c+"/"+u+a},g=function(S){S.write(f("")),S.close();var P=S.parentWindow.Object;return S=null,P},m=function(){var S=i("iframe"),P="java"+u+":",w;return S.style.display="none",s.appendChild(S),S.src=String(P),w=S.contentWindow.document,w.open(),w.write(f("document.F=Object")),w.close(),w.F},x,b=function(){try{x=new ActiveXObject("htmlfile")}catch{}b=typeof document<"u"?document.domain&&x?g(x):m():g(x);for(var S=t.length;S--;)delete b[l][t[S]];return b()};return r[h]=!0,bu=Object.create||function(P,w){var I;return P!==null?(p[l]=n(P),I=new p,p[l]=null,I[h]=P):I=b(),w===void 0?I:e.f(I,w)},bu}var wu,$y;function Ff(){if($y)return wu;$y=1;var n=Wr(),e=jw(),t=Di().f,r=n("unscopables"),s=Array.prototype;return s[r]===void 0&&t(s,r,{configurable:!0,value:e(null)}),wu=function(i){s[r][i]=!0},wu}var zy;function pk(){if(zy)return vm;zy=1;var n=Oi(),e=Wo(),t=Yo(),r=Ys(),s=Ff();return n({target:"Array",proto:!0},{at:function(o){var a=e(this),c=t(a),l=r(o),u=l>=0?l:c+l;return u<0||u>=c?void 0:a[u]}}),s("at"),vm}var vu,Ny;function Vo(){if(Ny)return vu;Ny=1;var n=Bt(),e=St();return vu=function(t,r){return e(n[t].prototype[r])},vu}var Pu,By;function fk(){if(By)return Pu;By=1,pk();var n=Vo();return Pu=n("Array","at"),Pu}var Iu,Uy;function gk(){if(Uy)return Iu;Uy=1;var n=fk();return Iu=n,Iu}gk();var Hy={},Cu,Ky;function Mw(){if(Ky)return Cu;Ky=1;var n=Mi();return Cu=Array.isArray||function(t){return n(t)==="Array"},Cu}var _u,qy;function mk(){if(qy)return _u;qy=1;var n=TypeError,e=9007199254740991;return _u=function(t){if(t>e)throw n("Maximum allowed index exceeded");return t},_u}var Eu,Gy;function yk(){if(Gy)return Eu;Gy=1;var n=Mi(),e=St();return Eu=function(t){if(n(t)==="Function")return e(t)},Eu}var Tu,Wy;function Sk(){if(Wy)return Tu;Wy=1;var n=yk(),e=kf(),t=el(),r=n(n.bind);return Tu=function(s,i){return e(s),i===void 0?s:t?r(s,i):function(){return s.apply(i,arguments)}},Tu}var ku,Yy;function xk(){if(Yy)return ku;Yy=1;var n=Kr(),e=Di(),t=Tf();return ku=function(r,s,i){n?e.f(r,s,t(0,i)):r[s]=i},ku}var ju,Vy;function Aw(){if(Vy)return ju;Vy=1;var n=Mw(),e=Yo(),t=mk(),r=Sk(),s=xk(),i=function(o,a,c,l,u,h,p,f){for(var g=u,m=0,x=p?r(p,f):!1,b,S;m<l;)m in c&&(b=x?x(c[m],m,a):c[m],h>0&&n(b)?(S=e(b),g=i(o,a,b,S,g,h-1)-1):(t(g+1),s(o,g,b)),g++),m++;return g};return ju=i,ju}var Mu,Xy;function bk(){if(Xy)return Mu;Xy=1;var n=Wr(),e=n("toStringTag"),t={};return t[e]="z",Mu=String(t)==="[object z]",Mu}var Au,Zy;function Dw(){if(Zy)return Au;Zy=1;var n=bk(),e=qt(),t=Mi(),r=Wr(),s=r("toStringTag"),i=Object,o=t((function(){return arguments})())==="Arguments",a=function(c,l){try{return c[l]}catch{}};return Au=n?t:function(c){var l,u,h;return c===void 0?"Undefined":c===null?"Null":typeof(u=a(l=i(c),s))=="string"?u:o?t(l):(h=t(l))==="Object"&&e(l.callee)?"Arguments":h},Au}var Du,Jy;function wk(){if(Jy)return Du;Jy=1;var n=St(),e=Ut(),t=qt(),r=Dw(),s=nl(),i=Iw(),o=function(){},a=s("Reflect","construct"),c=/^\s*(?:class|function)\b/,l=n(c.exec),u=!c.test(o),h=function(g){if(!t(g))return!1;try{return a(o,[],g),!0}catch{return!1}},p=function(g){if(!t(g))return!1;switch(r(g)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return u||!!l(c,i(g))}catch{return!0}};return p.sham=!0,Du=!a||e(function(){var f;return h(h.call)||!h(Object)||!h(function(){f=!0})||f})?p:h,Du}var Ou,Qy;function vk(){if(Qy)return Ou;Qy=1;var n=Mw(),e=wk(),t=Gr(),r=Wr(),s=r("species"),i=Array;return Ou=function(o){var a;return n(o)&&(a=o.constructor,e(a)&&(a===i||n(a.prototype))?a=void 0:t(a)&&(a=a[s],a===null&&(a=void 0))),a===void 0?i:a},Ou}var Ru,eS;function Ow(){if(eS)return Ru;eS=1;var n=vk();return Ru=function(e,t){return new(n(e))(t===0?0:t)},Ru}var tS;function Pk(){if(tS)return Hy;tS=1;var n=Oi(),e=Aw(),t=kf(),r=Wo(),s=Yo(),i=Ow();return n({target:"Array",proto:!0},{flatMap:function(a){var c=r(this),l=s(c),u;return t(a),u=i(c,0),e(u,c,c,l,0,1,a,arguments.length>1?arguments[1]:void 0),u}}),Hy}var nS={},rS;function Ik(){if(rS)return nS;rS=1;var n=Ff();return n("flatMap"),nS}var Lu,sS;function Ck(){if(sS)return Lu;sS=1,Pk(),Ik();var n=Vo();return Lu=n("Array","flatMap"),Lu}var Fu,iS;function _k(){if(iS)return Fu;iS=1;var n=Ck();return Fu=n,Fu}_k();var oS={},aS;function Ek(){if(aS)return oS;aS=1;var n=Oi(),e=Aw(),t=Wo(),r=Yo(),s=Ys(),i=Ow();return n({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,c=t(this),l=r(c),u=i(c,0);return e(u,c,c,l,0,a===void 0?1:s(a)),u}}),oS}var cS={},lS;function Tk(){if(lS)return cS;lS=1;var n=Ff();return n("flat"),cS}var $u,dS;function kk(){if(dS)return $u;dS=1,Ek(),Tk();var n=Vo();return $u=n("Array","flat"),$u}var zu,uS;function jk(){if(uS)return zu;uS=1;var n=kk();return zu=n,zu}jk();var hS={},Nu,pS;function Xo(){if(pS)return Nu;pS=1;var n=Dw(),e=String;return Nu=function(t){if(n(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},Nu}var fS;function Mk(){if(fS)return hS;fS=1;var n=Oi(),e=St(),t=Ai(),r=Ys(),s=Xo(),i=Ut(),o=e("".charAt),a=i(function(){return"𠮷".at(-2)!=="\uD842"});return n({target:"String",proto:!0,forced:a},{at:function(l){var u=s(t(this)),h=u.length,p=r(l),f=p>=0?p:h+p;return f<0||f>=h?void 0:o(u,f)}}),hS}var Bu,gS;function Ak(){if(gS)return Bu;gS=1,Mk();var n=Vo();return Bu=n("String","at"),Bu}var Uu,mS;function Dk(){if(mS)return Uu;mS=1;var n=Ak();return Uu=n,Uu}Dk();var yS={},Hu,SS;function Rw(){if(SS)return Hu;SS=1;var n=Ws();return Hu=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},Hu}var Ku,xS;function Ok(){if(xS)return Ku;xS=1;var n=Ut(),e=Bt(),t=e.RegExp,r=n(function(){var o=t("a","y");return o.lastIndex=2,o.exec("abcd")!==null}),s=r||n(function(){return!t("a","y").sticky}),i=r||n(function(){var o=t("^r","gy");return o.lastIndex=2,o.exec("str")!==null});return Ku={BROKEN_CARET:i,MISSED_STICKY:s,UNSUPPORTED_Y:r},Ku}var qu,bS;function Rk(){if(bS)return qu;bS=1;var n=Ut(),e=Bt(),t=e.RegExp;return qu=n(function(){var r=t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),qu}var Gu,wS;function Lk(){if(wS)return Gu;wS=1;var n=Ut(),e=Bt(),t=e.RegExp;return Gu=n(function(){var r=t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),Gu}var Wu,vS;function $f(){if(vS)return Wu;vS=1;var n=qr(),e=St(),t=Xo(),r=Rw(),s=Ok(),i=Df(),o=jw(),a=_w().get,c=Rk(),l=Lk(),u=i("native-string-replace",String.prototype.replace),h=RegExp.prototype.exec,p=h,f=e("".charAt),g=e("".indexOf),m=e("".replace),x=e("".slice),b=(function(){var I=/a/,E=/b*/g;return n(h,I,"a"),n(h,E,"a"),I.lastIndex!==0||E.lastIndex!==0})(),S=s.BROKEN_CARET,P=/()??/.exec("")[1]!==void 0,w=b||P||S||c||l;return w&&(p=function(E){var T=this,C=a(T),j=t(E),k=C.raw,R,A,D,O,$,B,G;if(k)return k.lastIndex=T.lastIndex,R=n(p,k,j),T.lastIndex=k.lastIndex,R;var Y=C.groups,ne=S&&T.sticky,de=n(r,T),ae=T.source,Oe=0,ce=j;if(ne&&(de=m(de,"y",""),g(de,"g")===-1&&(de+="g"),ce=x(j,T.lastIndex),T.lastIndex>0&&(!T.multiline||T.multiline&&f(j,T.lastIndex-1)!==`
`)&&(ae="(?: "+ae+")",ce=" "+ce,Oe++),A=new RegExp("^(?:"+ae+")",de)),P&&(A=new RegExp("^"+ae+"$(?!\\s)",de)),b&&(D=T.lastIndex),O=n(h,ne?A:T,ce),ne?O?(O.input=x(O.input,Oe),O[0]=x(O[0],Oe),O.index=T.lastIndex,T.lastIndex+=O[0].length):T.lastIndex=0:b&&O&&(T.lastIndex=T.global?O.index+O[0].length:D),P&&O&&O.length>1&&n(u,O[0],A,function(){for($=1;$<arguments.length-2;$++)arguments[$]===void 0&&(O[$]=void 0)}),O&&Y)for(O.groups=B=o(null),$=0;$<Y.length;$++)G=Y[$],B[G[0]]=O[G[1]];return O}),Wu=p,Wu}var PS;function Lw(){if(PS)return yS;PS=1;var n=Oi(),e=$f();return n({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),yS}var IS={},Yu,CS;function Fk(){if(CS)return Yu;CS=1;var n=el(),e=Function.prototype,t=e.apply,r=e.call;return Yu=typeof Reflect=="object"&&Reflect.apply||(n?r.bind(t):function(){return r.apply(t,arguments)}),Yu}var Vu,_S;function $k(){if(_S)return Vu;_S=1,Lw();var n=qr(),e=Ew(),t=$f(),r=Ut(),s=Wr(),i=Of(),o=s("species"),a=RegExp.prototype;return Vu=function(c,l,u,h){var p=s(c),f=!r(function(){var b={};return b[p]=function(){return 7},""[c](b)!==7}),g=f&&!r(function(){var b=!1,S=/a/;if(c==="split"){var P={};P[o]=function(){return S},S={constructor:P,flags:""},S[p]=/./[p]}return S.exec=function(){return b=!0,null},S[p](""),!b});if(!f||!g||u){var m=/./[p],x=l(p,""[c],function(b,S,P,w,I){var E=S.exec;return E===t||E===a.exec?f&&!I?{done:!0,value:n(m,S,P,w)}:{done:!0,value:n(b,P,S,w)}:{done:!1}});e(String.prototype,c,x[0]),e(a,p,x[1])}h&&i(a[p],"sham",!0)},Vu}var Xu,ES;function zk(){if(ES)return Xu;ES=1;var n=St(),e=Ys(),t=Xo(),r=Ai(),s=n("".charAt),i=n("".charCodeAt),o=n("".slice),a=function(c){return function(l,u){var h=t(r(l)),p=e(u),f=h.length,g,m;return p<0||p>=f?c?"":void 0:(g=i(h,p),g<55296||g>56319||p+1===f||(m=i(h,p+1))<56320||m>57343?c?s(h,p):g:c?o(h,p,p+2):(g-55296<<10)+(m-56320)+65536)}};return Xu={codeAt:a(!1),charAt:a(!0)},Xu}var Zu,TS;function Nk(){if(TS)return Zu;TS=1;var n=zk().charAt;return Zu=function(e,t,r){return t+(r?n(e,t).length:1)},Zu}var Ju,kS;function Fw(){if(kS)return Ju;kS=1;var n=St(),e=Wo(),t=Math.floor,r=n("".charAt),s=n("".replace),i=n("".slice),o=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return Ju=function(c,l,u,h,p,f){var g=u+c.length,m=h.length,x=a;return p!==void 0&&(p=e(p),x=o),s(f,x,function(b,S){var P;switch(r(S,0)){case"$":return"$";case"&":return c;case"`":return i(l,0,u);case"'":return i(l,g);case"<":P=p[i(S,1,-1)];break;default:var w=+S;if(w===0)return b;if(w>m){var I=t(w/10);return I===0?b:I<=m?h[I-1]===void 0?r(S,1):h[I-1]+r(S,1):b}P=h[w-1]}return P===void 0?"":P})},Ju}var Qu,jS;function Bk(){if(jS)return Qu;jS=1;var n=Bt(),e=Ut(),t=n.RegExp,r=!e(function(){var s=!0;try{t(".","d")}catch{s=!1}var i={},o="",a=s?"dgimsy":"gimsy",c=function(p,f){Object.defineProperty(i,p,{get:function(){return o+=f,!0}})},l={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};s&&(l.hasIndices="d");for(var u in l)c(u,l[u]);var h=Object.getOwnPropertyDescriptor(t.prototype,"flags").get.call(i);return h!==a||o!==a});return Qu={correct:r},Qu}var eh,MS;function $w(){if(MS)return eh;MS=1;var n=qr(),e=xs(),t=pw(),r=Bk(),s=Rw(),i=RegExp.prototype;return eh=r.correct?function(o){return o.flags}:function(o){return!r.correct&&t(i,o)&&!e(o,"flags")?n(s,o):o.flags},eh}var th,AS;function Uk(){if(AS)return th;AS=1;var n=qr(),e=Ws(),t=qt(),r=Mi(),s=$f(),i=TypeError;return th=function(o,a){var c=o.exec;if(t(c)){var l=n(c,o,a);return l!==null&&e(l),l}if(r(o)==="RegExp")return n(s,o,a);throw new i("RegExp#exec called on incompatible receiver")},th}var DS;function Hk(){if(DS)return IS;DS=1;var n=Fk(),e=qr(),t=St(),r=$k(),s=Ut(),i=Ws(),o=qt(),a=Gr(),c=Ys(),l=Tw(),u=Xo(),h=Ai(),p=Nk(),f=jf(),g=Fw(),m=$w(),x=Uk(),b=Wr(),S=b("replace"),P=Math.max,w=Math.min,I=t([].concat),E=t([].push),T=t("".indexOf),C=t("".slice),j=function(D){return D===void 0?D:String(D)},k=(function(){return"a".replace(/./,"$0")==="$0"})(),R=(function(){return/./[S]?/./[S]("a","$0")==="":!1})(),A=!s(function(){var D=/./;return D.exec=function(){var O=[];return O.groups={a:"7"},O},"".replace(D,"$<a>")!=="7"});return r("replace",function(D,O,$){var B=R?"$":"$0";return[function(Y,ne){var de=h(this),ae=a(Y)?f(Y,S):void 0;return ae?e(ae,Y,de,ne):e(O,u(de),Y,ne)},function(G,Y){var ne=i(this),de=u(G);if(typeof Y=="string"&&T(Y,B)===-1&&T(Y,"$<")===-1){var ae=$(O,ne,de,Y);if(ae.done)return ae.value}var Oe=o(Y);Oe||(Y=u(Y));var ce=u(m(ne)),Ne=T(ce,"g")!==-1,re;Ne&&(re=T(ce,"u")!==-1,ne.lastIndex=0);for(var pt=[],Ie;Ie=x(ne,de),!(Ie===null||(E(pt,Ie),!Ne));){var me=u(Ie[0]);me===""&&(ne.lastIndex=p(de,l(ne.lastIndex),re))}for(var Me="",Re=0,Te=0;Te<pt.length;Te++){Ie=pt[Te];for(var jt=u(Ie[0]),st=P(w(c(Ie.index),de.length),0),xt=[],qe,et=1;et<Ie.length;et++)E(xt,j(Ie[et]));var pn=Ie.groups;if(Oe){var Zr=I([jt],xt,st,de);pn!==void 0&&E(Zr,pn),qe=u(n(Y,void 0,Zr))}else qe=g(jt,de,st,xt,pn,Y);st>=Re&&(Me+=C(de,Re,st)+qe,Re=st+jt.length)}return Me+C(de,Re)}]},!A||!k||R),IS}var OS={},nh,RS;function Kk(){if(RS)return nh;RS=1;var n=Gr(),e=Mi(),t=Wr(),r=t("match");return nh=function(s){var i;return n(s)&&((i=s[r])!==void 0?!!i:e(s)==="RegExp")},nh}var LS;function qk(){if(LS)return OS;LS=1;var n=Oi(),e=qr(),t=St(),r=Ai(),s=qt(),i=Gr(),o=Kk(),a=Xo(),c=jf(),l=$w(),u=Fw(),h=Wr(),p=yw(),f=h("replace"),g=TypeError,m=t("".indexOf),x=t("".replace),b=t("".slice),S=Math.max;return n({target:"String",proto:!0},{replaceAll:function(w,I){var E=r(this),T,C,j,k,R,A,D,O,$,B,G=0,Y="";if(i(w)){if(T=o(w),T&&(C=a(r(l(w))),!~m(C,"g")))throw new g("`.replaceAll` does not allow non-global regexes");if(j=c(w,f),j)return e(j,w,E,I);if(p&&T)return x(a(E),w,I)}for(k=a(E),R=a(w),A=s(I),A||(I=a(I)),D=R.length,O=S(1,D),$=m(k,R);$!==-1;)B=A?a(I(R,$,k)):u(R,k,$,[],void 0,I),Y+=b(k,G,$)+B,G=$+D,$=$+O>k.length?-1:m(k,R,$+O);return G<k.length&&(Y+=b(k,G)),Y}}),OS}var rh,FS;function Gk(){if(FS)return rh;FS=1,Lw(),Hk(),qk();var n=Vo();return rh=n("String","replaceAll"),rh}var sh,$S;function Wk(){if($S)return sh;$S=1;var n=Gk();return sh=n,sh}Wk();function zw(n){return n&&typeof n=="object"&&"parents"in n}function Nw(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}function wc(n,e){if(n.children.remove(e)&&n.children.isEmpty&&zw(n))for(let t=0,r=n.parents.length;t<r;t++)wc(n.parents[t],n)}function zf(n,e){if(n.children.add(e)&&zw(n))for(let t=0,r=n.parents.length;t<r;t++)zf(n.parents[t],n)}function Bw(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function bs(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const zr=bs("empty_array",()=>Object.freeze([])),zS=8;class vc{constructor(){v(this,"arraySize",0);v(this,"array",Array(zS));v(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<zS?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const xn=Symbol.for("com.tldraw.state/RESET_VALUE");class Uw{constructor(e){v(this,"index",0);v(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===xn){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:s}=this;for(let i=0;i<r;i++){const o=(t-1+r-i)%r,a=s[o];if(!a)return xn;const[c,l]=a;if(i===0&&e>=l)return[];if(c<=e&&e<l){const u=i+1,h=new Array(u);for(let p=0;p<u;p++)h[p]=s[(o+p)%r][2];return h}}return xn}}class Yk{constructor(e,t){v(this,"offset",0);v(this,"maybeRemoved");this.below=e,this.child=t}}const Ze=bs("capture",()=>({stack:null}));function ga(n){const e=Ze.stack;Ze.stack=null;try{return n()}finally{Ze.stack=e}}function Hw(n){Ze.stack=new Yk(Ze.stack,n),n.parentSet.clear()}function Kw(){const n=Ze.stack;if(Ze.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||wc(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||wc(t,n.child)}}function Pc(n){if(Ze.stack){if(Ze.stack.child.parentSet.has(n))return;if(Ze.stack.child.parentSet.add(n),Ze.stack.child.isActivelyListening&&zf(n,Ze.stack.child),Ze.stack.offset<Ze.stack.child.parents.length){const t=Ze.stack.child.parents[Ze.stack.offset];t!==n&&(Ze.stack.maybeRemoved?Ze.stack.maybeRemoved.push(t):Ze.stack.maybeRemoved=[t])}Ze.stack.child.parents[Ze.stack.offset]=n,Ze.stack.child.parentEpochs[Ze.stack.offset]=n.lastChangedEpoch,Ze.stack.offset++}}const ds=-1;class Vk{constructor(e,t,r){v(this,"_isActivelyListening",!1);v(this,"lastTraversedEpoch",ds);v(this,"lastReactedEpoch",ds);v(this,"_scheduleCount",0);v(this,"parentSet",new vc);v(this,"parentEpochs",[]);v(this,"parents",[]);v(this,"_scheduleEffect");v(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==Qt()){if(this.parents.length&&!Nw(this)){this.lastReactedEpoch=Qt();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)zf(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)wc(this.parents[e],this)}execute(){try{Hw(this);const e=Qt(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{Kw()}}}const Ri=bs("EffectScheduler",()=>Vk);function ur(n,e,t){const r=new Ri(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function Xk(n,e,t){const r=new Ri(n,e,t);return{scheduler:r,start:s=>{const i=(s==null?void 0:s.force)??!1;r.attach(),i?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class Zk{constructor(e){v(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(Ae.globalIsReacting)for(const e of this.initialAtomValues.keys())Gw(e);else this.isRoot?qw(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){Ae.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}}const Ae=bs("transactions",()=>({globalEpoch:ds+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:ds+1}));function Jk(){return Ae.reactionEpoch}function Qt(){return Ae.globalEpoch}function Qk(){return Ae.globalIsReacting}function Nf(n,e){e.lastTraversedEpoch!==Ae.globalEpoch&&(e.lastTraversedEpoch=Ae.globalEpoch,e instanceof Ri?n.add(e):e.children.visit(t=>Nf(n,t)))}function qw(n){var t;if(Ae.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=Ae.currentTransaction;try{Ae.currentTransaction=null,Ae.globalIsReacting=!0,Ae.reactionEpoch=Ae.globalEpoch;const r=new Set;for(const i of n)i.children.visit(o=>Nf(r,o));for(const i of r)i.maybeScheduleEffect();let s=0;for(;(t=Ae.cleanupReactors)!=null&&t.size;){if(s++>1e3)throw new Error("Reaction update depth limit exceeded");const i=Ae.cleanupReactors;Ae.cleanupReactors=null;for(const o of i)o.maybeScheduleEffect()}}finally{Ae.cleanupReactors=null,Ae.globalIsReacting=!1,Ae.currentTransaction=e}}function ej(n,e){Ae.currentTransaction?Ae.currentTransaction.initialAtomValues.has(n)||Ae.currentTransaction.initialAtomValues.set(n,e):Ae.globalIsReacting?Gw(n):qw([n])}function Gw(n){const e=Ae.cleanupReactors??(Ae.cleanupReactors=new Set);n.children.visit(t=>Nf(e,t))}function tj(){Ae.globalEpoch++}function nj(n){const e=new Zk(Ae.currentTransaction);Ae.currentTransaction=e;try{let t,r=!1;try{t=n(()=>r=!0)}catch(s){throw e.abort(),s}return r?e.abort():e.commit(),t}finally{Ae.currentTransaction=Ae.currentTransaction.parent}}function hr(n){return Ae.currentTransaction?n():nj(n)}class rj{constructor(e,t,r){v(this,"isEqual");v(this,"computeDiff");v(this,"lastChangedEpoch",Qt());v(this,"children",new vc);v(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new Uw(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return Pc(this),this.current}set(e,t){var s,i;if(((s=this.isEqual)==null?void 0:s.call(this,this.current,e))??Bw(this.current,e))return this.current;tj(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,Qt(),t??((i=this.computeDiff)==null?void 0:i.call(this,this.current,e,this.lastChangedEpoch,Qt()))??xn),this.lastChangedEpoch=Qt();const r=this.current;return this.current=e,ej(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return Pc(this),e>=this.lastChangedEpoch?zr:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??xn}}const sj=bs("Atom",()=>rj);function ht(n,e,t){return new sj(n,e,t)}let NS=!1;function ij(){NS||(NS=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const go=Symbol.for("com.tldraw.state/UNINITIALIZED");function Os(n){return n===go}const yp=bs("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function mo(n,e){return new yp(n,e)}class oj{constructor(e,t,r){v(this,"lastChangedEpoch",ds);v(this,"lastTraversedEpoch",ds);v(this,"lastCheckedEpoch",ds);v(this,"parentSet",new vc);v(this,"parents",[]);v(this,"parentEpochs",[]);v(this,"children",new vc);v(this,"historyBuffer");v(this,"state",go);v(this,"error",null);v(this,"computeDiff");v(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new Uw(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??Bw}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var s;const t=this.lastChangedEpoch===ds,r=Qt();if(!t&&(this.lastCheckedEpoch===r||this.isActivelyListening&&Qk()&&this.lastTraversedEpoch<Jk()||!Nw(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{Hw(this);const i=this.derive(this.state,this.lastCheckedEpoch),o=i instanceof yp?i.value:i,a=this.state===go;if(a||!this.isEqual(o,this.state)){if(this.historyBuffer&&!a){const c=i instanceof yp?i.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,Qt(),c??((s=this.computeDiff)==null?void 0:s.call(this,this.state,o,this.lastCheckedEpoch,Qt()))??xn)}this.lastChangedEpoch=Qt(),this.state=o}return this.error=null,this.lastCheckedEpoch=Qt(),this.state}catch(i){if(this.state!==go&&(this.state=go,this.lastChangedEpoch=Qt()),this.lastCheckedEpoch=Qt(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:i},!e)throw i;return this.state}finally{Kw()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Pc(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),Pc(this),e>=this.lastChangedEpoch?zr:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??xn}}const rl=bs("Computed",()=>oj);function aj(n={},e,t,r){const s=r.value,i=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let o=this[i];return o||(o=new rl(t,s.bind(this),n),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r.value[Ww]=!0,r}function cj(n={},e,t,r){const s=r.get,i=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let o=this[i];return o||(o=new rl(t,s.bind(this),n),Object.defineProperty(this,i,{enumerable:!1,configurable:!1,writable:!1,value:o})),o.get()},r}function lj(n,e,t){De(t.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(t.name)),s=function(){let i=this[r];return i||(i=new rl(String(t.name),e.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()};return s[Ww]=!0,s}function BS(n={},e){if(e.length===2){const[t,r]=e;return lj(n,t,r)}else{const[t,r,s]=e;return s.get?(ij(),cj(n,t,r,s)):aj(n,t,r,s)}}const Ww="@@__isComputedMethod__@@";function K(){if(arguments.length===1){const n=arguments[0];return(...e)=>BS(n,e)}else return typeof arguments[0]=="string"?new rl(arguments[0],arguments[1],arguments[2]):BS(void 0,arguments)}const Yw=1,dj=bs("apiVersion",()=>Yw);if(dj!==Yw)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");Ss("@tldraw/state","3.5.0","esm");function sl(n,e){const t=Qe.useRef(e);t.current=e;const[r,s,i]=Qe.useMemo(()=>{let o=null;const a=u=>(o=u,()=>{o=null}),c=new Ri(`useStateTracking(${n})`,()=>{var u;return(u=t.current)==null?void 0:u.call(t)},{scheduleEffect(){o==null||o()}});return[c,a,()=>c.scheduleCount]},[n]);return Qe.useSyncExternalStore(s,i,i),Qe.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const US={apply(n,e,t){return sl(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},uj=Symbol.for("react.memo"),hj=Symbol.for("react.forward_ref");function Et(n){let e=null;const t=n.$$typeof;return t===uj&&(n=n.type,e=n.compare),t===hj?_.memo(_.forwardRef(new Proxy(n.render,US))):_.memo(new Proxy(n,US),e)}function Vw(n,e,t){return _.useState(()=>{const r=typeof e=="function"?e():e;return ht(`useAtom(${n})`,r,t)})[0]}function pj(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return _.useMemo(()=>K(`useComputed(${n})`,e,t),r)}function ps(n,e,t=zr){_.useEffect(()=>{const r=new Ri(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function N(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=_.useRef(!0);r.current=!0;const s=_.useMemo(()=>n.length===1?n[0]:K(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:i,getSnapshot:o}=_.useMemo(()=>({subscribe:a=>ur(`useValue(${t})`,()=>{s.get(),a()}),getSnapshot:()=>s.get()}),[s]);return _.useSyncExternalStore(i,o,o)}finally{r.current=!1}}Ss("@tldraw/state-react","3.5.0","esm");class Ka{constructor(e){v(this,"nextValue");v(this,"diff");this.previousValue=e}get(){var r,s,i,o;const e=((s=(r=this.diff)==null?void 0:r.removed)==null?void 0:s.size)??0,t=((o=(i=this.diff)==null?void 0:i.added)==null?void 0:o.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((s=this.diff).added??(s.added=new Set),this.diff.added.add(e))}add(e){var s,i,o;const t=this.previousValue.has(e);if(t)return((i=(s=this.diff)==null?void 0:s.removed)==null?void 0:i.has(e))?this._add(e,t):void 0;(o=this.nextValue)!=null&&o.has(e)||this._add(e,t)}_remove(e,t){var r,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(s=this.diff.added)==null||s.delete(e)}remove(e){var s,i,o,a;const t=this.previousValue.has(e);if(!t)return((i=(s=this.diff)==null?void 0:s.added)==null?void 0:i.has(e))?this._remove(e,t):void 0;(a=(o=this.diff)==null?void 0:o.removed)!=null&&a.has(e)||this._remove(e,t)}}class il{constructor(e,t){v(this,"createDefaultProperties");v(this,"validator");v(this,"ephemeralKeys");v(this,"ephemeralKeySet");v(this,"scope");this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:s=>s},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[s,i]of cn(t.ephemeralKeys))i&&r.add(s);this.ephemeralKeySet=r}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,s]of Object.entries(e))s!==void 0&&(t[r]=s);return t.typeName=this.typeName,t}clone(e){return{...Ve(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??Fe())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new il(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function br(n,e){return new il(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Ic(){return{added:{},updated:{},removed:{}}}function Sp(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,r]of Object.values(n.updated))e.updated[t.id]=[r,t];return e}function Xw(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function Bf(n){const e={added:{},removed:{},updated:{}};return _o(e,n),e}function _o(n,e){for(const t of e){for(const[r,s]of cn(t.added))if(n.removed[r]){const i=n.removed[r];delete n.removed[r],i!==s&&(n.updated[r]=[i,s])}else n.added[r]=s;for(const[r,[s,i]]of cn(t.updated)){if(n.added[r]){n.added[r]=i,delete n.updated[r],delete n.removed[r];continue}if(n.updated[r]){n.updated[r]=[n.updated[r][0],i],delete n.removed[r];continue}n.updated[r]=t.updated[r],delete n.removed[r]}for(const[r,s]of cn(t.removed))n.added[r]?delete n.added[r]:n.updated[r]?(n.removed[r]=n.updated[r][0],delete n.updated[r]):n.removed[r]=s}}var yo={exports:{}};yo.exports;var HS;function fj(){return HS||(HS=1,(function(n,e){var t=200,r="__lodash_hash_undefined__",s=1,i=2,o=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",h="[object Date]",p="[object Error]",f="[object Function]",g="[object GeneratorFunction]",m="[object Map]",x="[object Number]",b="[object Null]",S="[object Object]",P="[object Promise]",w="[object Proxy]",I="[object RegExp]",E="[object Set]",T="[object String]",C="[object Symbol]",j="[object Undefined]",k="[object WeakMap]",R="[object ArrayBuffer]",A="[object DataView]",D="[object Float32Array]",O="[object Float64Array]",$="[object Int8Array]",B="[object Int16Array]",G="[object Int32Array]",Y="[object Uint8Array]",ne="[object Uint8ClampedArray]",de="[object Uint16Array]",ae="[object Uint32Array]",Oe=/[\\^$.*+?()[\]{}|]/g,ce=/^\[object .+?Constructor\]$/,Ne=/^(?:0|[1-9]\d*)$/,re={};re[D]=re[O]=re[$]=re[B]=re[G]=re[Y]=re[ne]=re[de]=re[ae]=!0,re[a]=re[c]=re[R]=re[u]=re[A]=re[h]=re[p]=re[f]=re[m]=re[x]=re[S]=re[I]=re[E]=re[T]=re[k]=!1;var pt=typeof sn=="object"&&sn&&sn.Object===Object&&sn,Ie=typeof self=="object"&&self&&self.Object===Object&&self,me=pt||Ie||Function("return this")(),Me=e&&!e.nodeType&&e,Re=Me&&!0&&n&&!n.nodeType&&n,Te=Re&&Re.exports===Me,jt=Te&&pt.process,st=(function(){try{return jt&&jt.binding&&jt.binding("util")}catch{}})(),xt=st&&st.isTypedArray;function qe(M,L){for(var q=-1,ee=M==null?0:M.length,We=0,ye=[];++q<ee;){var it=M[q];L(it,q,M)&&(ye[We++]=it)}return ye}function et(M,L){for(var q=-1,ee=L.length,We=M.length;++q<ee;)M[We+q]=L[q];return M}function pn(M,L){for(var q=-1,ee=M==null?0:M.length;++q<ee;)if(L(M[q],q,M))return!0;return!1}function Zr(M,L){for(var q=-1,ee=Array(M);++q<M;)ee[q]=L(q);return ee}function Ki(M){return function(L){return M(L)}}function Js(M,L){return M.has(L)}function qi(M,L){return M==null?void 0:M[L]}function Hl(M){var L=-1,q=Array(M.size);return M.forEach(function(ee,We){q[++L]=[We,ee]}),q}function Kl(M,L){return function(q){return M(L(q))}}function ql(M){var L=-1,q=Array(M.size);return M.forEach(function(ee){q[++L]=ee}),q}var Gl=Array.prototype,Wl=Function.prototype,Qs=Object.prototype,ei=me["__core-js_shared__"],aa=Wl.toString,U=Qs.hasOwnProperty,X=(function(){var M=/[^.]+$/.exec(ei&&ei.keys&&ei.keys.IE_PROTO||"");return M?"Symbol(src)_1."+M:""})(),he=Qs.toString,Ge=RegExp("^"+aa.call(U).replace(Oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ir=Te?me.Buffer:void 0,Tn=me.Symbol,Gi=me.Uint8Array,Cr=Qs.propertyIsEnumerable,_r=Gl.splice,tr=Tn?Tn.toStringTag:void 0,Er=Object.getOwnPropertySymbols,Cs=Ir?Ir.isBuffer:void 0,ca=Kl(Object.keys,Object),Yl=ti(me,"DataView"),Wi=ti(me,"Map"),Vl=ti(me,"Promise"),Xl=ti(me,"Set"),Zl=ti(me,"WeakMap"),Yi=ti(Object,"create"),S2=Ts(Yl),x2=Ts(Wi),b2=Ts(Vl),w2=Ts(Xl),v2=Ts(Zl),Xg=Tn?Tn.prototype:void 0,Jl=Xg?Xg.valueOf:void 0;function _s(M){var L=-1,q=M==null?0:M.length;for(this.clear();++L<q;){var ee=M[L];this.set(ee[0],ee[1])}}function P2(){this.__data__=Yi?Yi(null):{},this.size=0}function I2(M){var L=this.has(M)&&delete this.__data__[M];return this.size-=L?1:0,L}function C2(M){var L=this.__data__;if(Yi){var q=L[M];return q===r?void 0:q}return U.call(L,M)?L[M]:void 0}function _2(M){var L=this.__data__;return Yi?L[M]!==void 0:U.call(L,M)}function E2(M,L){var q=this.__data__;return this.size+=this.has(M)?0:1,q[M]=Yi&&L===void 0?r:L,this}_s.prototype.clear=P2,_s.prototype.delete=I2,_s.prototype.get=C2,_s.prototype.has=_2,_s.prototype.set=E2;function Tr(M){var L=-1,q=M==null?0:M.length;for(this.clear();++L<q;){var ee=M[L];this.set(ee[0],ee[1])}}function T2(){this.__data__=[],this.size=0}function k2(M){var L=this.__data__,q=da(L,M);if(q<0)return!1;var ee=L.length-1;return q==ee?L.pop():_r.call(L,q,1),--this.size,!0}function j2(M){var L=this.__data__,q=da(L,M);return q<0?void 0:L[q][1]}function M2(M){return da(this.__data__,M)>-1}function A2(M,L){var q=this.__data__,ee=da(q,M);return ee<0?(++this.size,q.push([M,L])):q[ee][1]=L,this}Tr.prototype.clear=T2,Tr.prototype.delete=k2,Tr.prototype.get=j2,Tr.prototype.has=M2,Tr.prototype.set=A2;function Es(M){var L=-1,q=M==null?0:M.length;for(this.clear();++L<q;){var ee=M[L];this.set(ee[0],ee[1])}}function D2(){this.size=0,this.__data__={hash:new _s,map:new(Wi||Tr),string:new _s}}function O2(M){var L=ua(this,M).delete(M);return this.size-=L?1:0,L}function R2(M){return ua(this,M).get(M)}function L2(M){return ua(this,M).has(M)}function F2(M,L){var q=ua(this,M),ee=q.size;return q.set(M,L),this.size+=q.size==ee?0:1,this}Es.prototype.clear=D2,Es.prototype.delete=O2,Es.prototype.get=R2,Es.prototype.has=L2,Es.prototype.set=F2;function la(M){var L=-1,q=M==null?0:M.length;for(this.__data__=new Es;++L<q;)this.add(M[L])}function $2(M){return this.__data__.set(M,r),this}function z2(M){return this.__data__.has(M)}la.prototype.add=la.prototype.push=$2,la.prototype.has=z2;function Jr(M){var L=this.__data__=new Tr(M);this.size=L.size}function N2(){this.__data__=new Tr,this.size=0}function B2(M){var L=this.__data__,q=L.delete(M);return this.size=L.size,q}function U2(M){return this.__data__.get(M)}function H2(M){return this.__data__.has(M)}function K2(M,L){var q=this.__data__;if(q instanceof Tr){var ee=q.__data__;if(!Wi||ee.length<t-1)return ee.push([M,L]),this.size=++q.size,this;q=this.__data__=new Es(ee)}return q.set(M,L),this.size=q.size,this}Jr.prototype.clear=N2,Jr.prototype.delete=B2,Jr.prototype.get=U2,Jr.prototype.has=H2,Jr.prototype.set=K2;function q2(M,L){var q=ha(M),ee=!q&&oE(M),We=!q&&!ee&&Ql(M),ye=!q&&!ee&&!We&&im(M),it=q||ee||We||ye,gt=it?Zr(M.length,String):[],bt=gt.length;for(var tt in M)U.call(M,tt)&&!(it&&(tt=="length"||We&&(tt=="offset"||tt=="parent")||ye&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||tE(tt,bt)))&&gt.push(tt);return gt}function da(M,L){for(var q=M.length;q--;)if(tm(M[q][0],L))return q;return-1}function G2(M,L,q){var ee=L(M);return ha(M)?ee:et(ee,q(M))}function Vi(M){return M==null?M===void 0?j:b:tr&&tr in Object(M)?Q2(M):iE(M)}function Zg(M){return Xi(M)&&Vi(M)==a}function Jg(M,L,q,ee,We){return M===L?!0:M==null||L==null||!Xi(M)&&!Xi(L)?M!==M&&L!==L:W2(M,L,q,ee,Jg,We)}function W2(M,L,q,ee,We,ye){var it=ha(M),gt=ha(L),bt=it?c:Qr(M),tt=gt?c:Qr(L);bt=bt==a?S:bt,tt=tt==a?S:tt;var fn=bt==S,Nn=tt==S,Mt=bt==tt;if(Mt&&Ql(M)){if(!Ql(L))return!1;it=!0,fn=!1}if(Mt&&!fn)return ye||(ye=new Jr),it||im(M)?Qg(M,L,q,ee,We,ye):Z2(M,L,bt,q,ee,We,ye);if(!(q&s)){var kn=fn&&U.call(M,"__wrapped__"),jn=Nn&&U.call(L,"__wrapped__");if(kn||jn){var es=kn?M.value():M,kr=jn?L.value():L;return ye||(ye=new Jr),We(es,kr,q,ee,ye)}}return Mt?(ye||(ye=new Jr),J2(M,L,q,ee,We,ye)):!1}function Y2(M){if(!sm(M)||rE(M))return!1;var L=nm(M)?Ge:ce;return L.test(Ts(M))}function V2(M){return Xi(M)&&rm(M.length)&&!!re[Vi(M)]}function X2(M){if(!sE(M))return ca(M);var L=[];for(var q in Object(M))U.call(M,q)&&q!="constructor"&&L.push(q);return L}function Qg(M,L,q,ee,We,ye){var it=q&s,gt=M.length,bt=L.length;if(gt!=bt&&!(it&&bt>gt))return!1;var tt=ye.get(M);if(tt&&ye.get(L))return tt==L;var fn=-1,Nn=!0,Mt=q&i?new la:void 0;for(ye.set(M,L),ye.set(L,M);++fn<gt;){var kn=M[fn],jn=L[fn];if(ee)var es=it?ee(jn,kn,fn,L,M,ye):ee(kn,jn,fn,M,L,ye);if(es!==void 0){if(es)continue;Nn=!1;break}if(Mt){if(!pn(L,function(kr,ks){if(!Js(Mt,ks)&&(kn===kr||We(kn,kr,q,ee,ye)))return Mt.push(ks)})){Nn=!1;break}}else if(!(kn===jn||We(kn,jn,q,ee,ye))){Nn=!1;break}}return ye.delete(M),ye.delete(L),Nn}function Z2(M,L,q,ee,We,ye,it){switch(q){case A:if(M.byteLength!=L.byteLength||M.byteOffset!=L.byteOffset)return!1;M=M.buffer,L=L.buffer;case R:return!(M.byteLength!=L.byteLength||!ye(new Gi(M),new Gi(L)));case u:case h:case x:return tm(+M,+L);case p:return M.name==L.name&&M.message==L.message;case I:case T:return M==L+"";case m:var gt=Hl;case E:var bt=ee&s;if(gt||(gt=ql),M.size!=L.size&&!bt)return!1;var tt=it.get(M);if(tt)return tt==L;ee|=i,it.set(M,L);var fn=Qg(gt(M),gt(L),ee,We,ye,it);return it.delete(M),fn;case C:if(Jl)return Jl.call(M)==Jl.call(L)}return!1}function J2(M,L,q,ee,We,ye){var it=q&s,gt=em(M),bt=gt.length,tt=em(L),fn=tt.length;if(bt!=fn&&!it)return!1;for(var Nn=bt;Nn--;){var Mt=gt[Nn];if(!(it?Mt in L:U.call(L,Mt)))return!1}var kn=ye.get(M);if(kn&&ye.get(L))return kn==L;var jn=!0;ye.set(M,L),ye.set(L,M);for(var es=it;++Nn<bt;){Mt=gt[Nn];var kr=M[Mt],ks=L[Mt];if(ee)var om=it?ee(ks,kr,Mt,L,M,ye):ee(kr,ks,Mt,M,L,ye);if(!(om===void 0?kr===ks||We(kr,ks,q,ee,ye):om)){jn=!1;break}es||(es=Mt=="constructor")}if(jn&&!es){var pa=M.constructor,fa=L.constructor;pa!=fa&&"constructor"in M&&"constructor"in L&&!(typeof pa=="function"&&pa instanceof pa&&typeof fa=="function"&&fa instanceof fa)&&(jn=!1)}return ye.delete(M),ye.delete(L),jn}function em(M){return G2(M,lE,eE)}function ua(M,L){var q=M.__data__;return nE(L)?q[typeof L=="string"?"string":"hash"]:q.map}function ti(M,L){var q=qi(M,L);return Y2(q)?q:void 0}function Q2(M){var L=U.call(M,tr),q=M[tr];try{M[tr]=void 0;var ee=!0}catch{}var We=he.call(M);return ee&&(L?M[tr]=q:delete M[tr]),We}var eE=Er?function(M){return M==null?[]:(M=Object(M),qe(Er(M),function(L){return Cr.call(M,L)}))}:dE,Qr=Vi;(Yl&&Qr(new Yl(new ArrayBuffer(1)))!=A||Wi&&Qr(new Wi)!=m||Vl&&Qr(Vl.resolve())!=P||Xl&&Qr(new Xl)!=E||Zl&&Qr(new Zl)!=k)&&(Qr=function(M){var L=Vi(M),q=L==S?M.constructor:void 0,ee=q?Ts(q):"";if(ee)switch(ee){case S2:return A;case x2:return m;case b2:return P;case w2:return E;case v2:return k}return L});function tE(M,L){return L=L??o,!!L&&(typeof M=="number"||Ne.test(M))&&M>-1&&M%1==0&&M<L}function nE(M){var L=typeof M;return L=="string"||L=="number"||L=="symbol"||L=="boolean"?M!=="__proto__":M===null}function rE(M){return!!X&&X in M}function sE(M){var L=M&&M.constructor,q=typeof L=="function"&&L.prototype||Qs;return M===q}function iE(M){return he.call(M)}function Ts(M){if(M!=null){try{return aa.call(M)}catch{}try{return M+""}catch{}}return""}function tm(M,L){return M===L||M!==M&&L!==L}var oE=Zg((function(){return arguments})())?Zg:function(M){return Xi(M)&&U.call(M,"callee")&&!Cr.call(M,"callee")},ha=Array.isArray;function aE(M){return M!=null&&rm(M.length)&&!nm(M)}var Ql=Cs||uE;function cE(M,L){return Jg(M,L)}function nm(M){if(!sm(M))return!1;var L=Vi(M);return L==f||L==g||L==l||L==w}function rm(M){return typeof M=="number"&&M>-1&&M%1==0&&M<=o}function sm(M){var L=typeof M;return M!=null&&(L=="object"||L=="function")}function Xi(M){return M!=null&&typeof M=="object"}var im=xt?Ki(xt):V2;function lE(M){return aE(M)?q2(M):X2(M)}function dE(){return[]}function uE(){return!1}n.exports=cE})(yo,yo.exports)),yo.exports}var gj=fj();const Zw=ki(gj);function mj(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const s of e)t.every(i=>i.has(s))&&r.add(s);return r}function yj(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function KS(n,e){for(const[t,r]of Object.entries(n)){const s=r,i=e[t];if("eq"in s&&i!==s.eq||"neq"in s&&i===s.neq||"gt"in s&&(typeof i!="number"||i<=s.gt))return!1}return!0}function qS(n,e,t){const r=Object.fromEntries(Object.keys(t).map(s=>[s,new Set]));for(const[s,i]of Object.entries(t))if("eq"in i){const a=n.index(e,s).get().get(i.eq);if(a)for(const c of a)r[s].add(c)}else if("neq"in i){const o=n.index(e,s);for(const[a,c]of o.get())if(a!==i.neq)for(const l of c)r[s].add(l)}else if("gt"in i){const o=n.index(e,s);for(const[a,c]of o.get())if(a>i.gt)for(const l of c)r[s].add(l)}return mj(Object.values(r))}class Sj{constructor(e,t){v(this,"indexCache",new Map);v(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=K("filterHistory:"+e,(r,s)=>{if(Os(r))return this.history.get();const i=this.history.getDiffSince(s);if(i===xn)return this.history.get();const o={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const u of i){for(const h of nt(u.added))if(h.typeName===e)if(o.removed[h.id]){const p=o.removed[h.id];delete o.removed[h.id],c--,p!==h&&(o.updated[h.id]=[p,h],l++)}else o.added[h.id]=h,a++;for(const[h,p]of nt(u.updated))p.typeName===e&&(o.added[p.id]?o.added[p.id]=p:o.updated[p.id]?o.updated[p.id]=[o.updated[p.id][0],p]:(o.updated[p.id]=[h,p],l++));for(const h of nt(u.removed))h.typeName===e&&(o.added[h.id]?(delete o.added[h.id],a--):o.updated[h.id]?(o.removed[h.id]=o.updated[h.id][0],delete o.updated[h.id],l--,c++):(o.removed[h.id]=h,c++))}return a||c||l?mo(this.history.get(),o):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const s=this.__uncached_createIndex(e,t);return this.indexCache.set(r,s),s}__uncached_createIndex(e,t){const r=this.filterHistory(e),s=()=>{r.get();const i=new Map;for(const o of nt(this.atoms.get())){const a=o.get();if(a.typeName===e){const c=a[t];i.has(c)||i.set(c,new Set),i.get(c).add(a.id)}}return i};return K("index:"+e+":"+t,(i,o)=>{if(Os(i))return s();const a=r.getDiffSince(o);if(a===xn)return s();const c=new Map,l=(f,g)=>{let m=c.get(f);m||(m=new Ka(i.get(f)??new Set)),m.add(g),c.set(f,m)},u=(f,g)=>{let m=c.get(f);m||(m=new Ka(i.get(f)??new Set)),m.remove(g),c.set(f,m)};for(const f of a){for(const g of nt(f.added))if(g.typeName===e){const m=g[t];l(m,g.id)}for(const[g,m]of nt(f.updated))if(m.typeName===e){const x=g[t],b=m[t];x!==b&&(u(x,m.id),l(b,m.id))}for(const g of nt(f.removed))if(g.typeName===e){const m=g[t];u(m,g.id)}}let h,p;for(const[f,g]of c){const m=g.get();m&&(h||(h=new Map(i)),p||(p=new Map),m.value.size===0?h.delete(f):h.set(f,m.value),p.set(f,m.diff))}return h&&p?mo(h,p):i},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const s=this.ids(e,t,r);return K(r,()=>{var i;for(const o of s.get())return(i=this.atoms.get()[o])==null?void 0:i.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const s=this.ids(e,t,"ids:"+r);return K(r,()=>[...s.get()].map(i=>{const o=this.atoms.get()[i];if(!o)throw new Error("no atom found for record id: "+i);return o.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const s=this.filterHistory(e),i=()=>{s.get();const c=t();return Object.keys(c).length===0?new Set(nt(this.atoms.get()).flatMap(l=>{const u=l.get();return u.typeName===e?u.id:[]})):qS(this,e,c)},o=c=>{const l=i(),u=yj(c,l);return u?mo(l,u):c},a=K("ids_query:"+r,t,{isEqual:Zw});return K("query:"+r,(c,l)=>{const u=a.get();if(Os(c))return i();if(l<a.lastChangedEpoch)return o(c);const h=s.getDiffSince(l);if(h===xn)return o(c);const p=new Ka(c);for(const g of h){for(const m of nt(g.added))m.typeName===e&&KS(u,m)&&p.add(m.id);for(const[m,x]of nt(g.updated))x.typeName===e&&(KS(u,x)?p.add(x.id):p.remove(x.id));for(const m of nt(g.removed))m.typeName===e&&p.remove(m.id)}const f=p.get();return f?mo(f.value,f.diff):c},{historyLength:50})}exec(e,t){const r=qS(this,e,t);if(r.size===0)return zr;const s=this.atoms.get();return[...r].map(i=>s[i].get())}}class xj{constructor(e){v(this,"_beforeCreateHandlers",{});v(this,"_afterCreateHandlers",{});v(this,"_beforeChangeHandlers",{});v(this,"_afterChangeHandlers",{});v(this,"_beforeDeleteHandlers",{});v(this,"_afterDeleteHandlers",{});v(this,"_operationCompleteHandlers",[]);v(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let s=e;for(const i of r)s=i(s,t);return s}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const s of r)s(e,t)}handleBeforeChange(e,t,r){if(!this._isEnabled)return t;const s=this._beforeChangeHandlers[t.typeName];if(s){let i=t;for(const o of s)i=o(e,i,r);return i}return t}handleAfterChange(e,t,r){if(!this._isEnabled)return;const s=this._afterChangeHandlers[t.typeName];if(s)for(const i of s)i(e,t,r)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const s of r)if(s(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const s of r)s(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[r,s]of Object.entries(e))s!=null&&s.beforeCreate&&t.push(this.registerBeforeCreateHandler(r,s.beforeCreate)),s!=null&&s.afterCreate&&t.push(this.registerAfterCreateHandler(r,s.afterCreate)),s!=null&&s.beforeChange&&t.push(this.registerBeforeChangeHandler(r,s.beforeChange)),s!=null&&s.afterChange&&t.push(this.registerAfterChangeHandler(r,s.afterChange)),s!=null&&s.beforeDelete&&t.push(this.registerBeforeDeleteHandler(r,s.beforeDelete)),s!=null&&s.afterDelete&&t.push(this.registerAfterDeleteHandler(r,s.afterDelete));return()=>{for(const r of t)r()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>js(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>js(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>js(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>js(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>js(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>js(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>js(this._operationCompleteHandlers,e)}}function js(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class Uf{constructor(e){v(this,"id");v(this,"atoms",ht("store_atoms",{}));v(this,"history",ht("history",0,{historyLength:1e3}));v(this,"query",new Sj(this.atoms,this.history));v(this,"listeners",new Set);v(this,"historyAccumulator",new wj);v(this,"historyReactor");v(this,"schema");v(this,"props");v(this,"scopedTypes");v(this,"sideEffects",new xj(this));v(this,"isMergingRemoteChanges",!1);v(this,"_integrityChecker");v(this,"_isPossiblyCorrupted",!1);v(this,"pendingAfterEvents",null);v(this,"_isInAtomicOp",!1);const{initialData:t,schema:r,id:s}=e;this.id=s??Fe(),this.schema=r,this.props=e.props,t&&this.atoms.set(wf(cn(t).map(([i,o])=>[i,ht("atom:"+i,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=Xk("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:i=>this.cancelHistoryReactor=dw(i)}),this.scopedTypes={document:new Set(nt(this.schema.types).filter(i=>i.scope==="document").map(i=>i.typeName)),session:new Set(nt(this.schema.types).filter(i=>i.scope==="session").map(i=>i.typeName)),presence:new Set(nt(this.schema.types).filter(i=>i.scope==="presence").map(i=>i.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let s=null,i=null,o=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(i??(i=this.filterChangesByScope(t,"document")),!i)continue;a({changes:i,source:r})}else if(c.scope==="session"){if(s??(s=this.filterChangesByScope(t,"session")),!s)continue;a({changes:s,source:r})}else{if(o??(o=this.filterChangesByScope(t,"presence")),!o)continue;a({changes:o,source:r})}else a({changes:t,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const r={added:Co(e.added,(s,i)=>this.scopedTypes[t].has(i.typeName)),updated:Co(e.updated,(s,i)=>this.scopedTypes[t].has(i[1].typeName)),removed:Co(e.removed,(s,i)=>this.scopedTypes[t].has(i.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const r={},s={},i=this.atoms.__unsafe__getWithoutCapture();let o=null,a,c=!1;const l=this.isMergingRemoteChanges?"remote":"user";for(let u=0,h=e.length;u<h;u++){a=e[u];const p=(o??i)[a.id];if(p){const f=p.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(f,a,l),this.schema.validateRecord(this,a,t??"updateRecord",f)===f)continue;p.set(a),c=!0;const m=p.__unsafe__getWithoutCapture();r[a.id]=[f,m],this.addDiffForAfterEvent(f,m)}else a=this.sideEffects.handleBeforeCreate(a,l),c=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),s[a.id]=a,this.addDiffForAfterEvent(null,a),o||(o={...i}),o[a.id]=ht("atom:"+a.id,a)}o&&this.atoms.set(o),c&&this.updateHistory({added:s,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const i of e){const o=this.atoms.__unsafe__getWithoutCapture()[i];o&&this.sideEffects.handleBeforeDelete(o.get(),r)===!1&&t.add(i)}let s;this.atoms.update(i=>{let o;for(const a of e){if(t.has(a)||!(a in i))continue;o||(o={...i}),s||(s={}),delete o[a];const c=i[a].get();s[a]=c,this.addDiffForAfterEvent(c,null)}return o??i}),s&&this.updateHistory({added:{},updated:{},removed:s})})}get(e){var t;return(t=this.atoms.get()[e])==null?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()}serialize(e="document"){const t={};for(const[r,s]of cn(this.atoms.get())){const i=s.get();(e==="all"||this.scopedTypes[e].has(i.typeName))&&(t[r]=i)}return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return nt(this.atoms.get()).map(e=>e.get())}clear(){this.remove(Sm(this.atoms.get()))}update(e,t){const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,t){this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,hr(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],r=this.historyAccumulator.addInterceptor(s=>t.push(s.changes));try{return hr(e),Bf(t)}finally{r()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const s=nt(e.added);for(const[o,a]of nt(e.updated)){const c=this.schema.getType(a.typeName);if(r&&c.ephemeralKeySet.size){const l=this.get(a.id);if(!l){s.push(a);continue}let u=null;for(const[h,p]of Object.entries(a))c.ephemeralKeySet.has(h)||Object.is(p,Ft(l,h))||(u||(u={...l}),u[h]=p);u&&s.push(u)}else s.push(a)}const i=Sm(e.removed);s.length&&this.put(s),i.length&&this.remove(i)},t)}createComputedCache(e,t,r){const s=new pr;return{get:i=>{const o=this.atoms.get()[i];if(o)return s.get(o,()=>{const a=r?K(o.name+":equals",()=>o.get(),{isEqual:r}):o;return K(e+":"+i,()=>t(a.get()))}).get()}}}createSelectedComputedCache(e,t,r){const s=new pr;return{get:i=>{const o=this.atoms.get()[i];if(o)return s.get(o,()=>{const a=K(e+":"+i+":selector",()=>t(o.get()));return K(e+":"+i,()=>r(a.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(De(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&De(e.id===t.id),!e&&!t))return;const r=(e||t).id,s=this.pendingAfterEvents.get(r);s?s.after=t:this.pendingAfterEvents.set(r,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:s,after:i}of r.values())s&&i?this.sideEffects.handleAfterChange(s,i,t):s&&!i?this.sideEffects.handleAfterDelete(s,t):!s&&i&&this.sideEffects.handleAfterCreate(i,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return hr(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0;try{const s=e();return this.flushAtomicCallbacks(),s}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function bj(n){if(n.length===0)return[];const e=[];let t=[n[0]],r;for(let s=1,i=n.length;s<i;s++)r=n[s],t[0].source!==r.source&&(e.push(t),t=[]),t.push(r);return e.push(t),e.map(s=>({source:s[0].source,changes:Bf(s.map(i=>i.changes))}))}class wj{constructor(){v(this,"_history",[]);v(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=bj(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function vj(n,e,t){const r=new pr;return{get(s,i){return r.get(s,()=>(s instanceof Uf?s:s.store).createComputedCache(n,c=>e(s,c),t)).get(i)}}}function Pj(n){const e=[];for(let t=n.length-1;t>=0;t--){const r=n[t];if("id"in r)e.unshift(r);else{const s=r.dependsOn,i=e[0];i&&(e[0]={...i,dependsOn:s.concat(i.dependsOn??[])})}}return e}function yi({sequence:n,sequenceId:e,retroactive:t=!0}){const r={sequenceId:e,retroactive:t,sequence:Pj(n)};return Jw(r),r}function dn(n,e){return Object.fromEntries(cn(e).map(([t,r])=>[t,`${n}/${r}`]))}function Cn(n){const e=n.sequenceId;return yi({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:r=>{var s,i;return r.typeName===n.recordType&&(((s=t.filter)==null?void 0:s.call(t,r))??!0)&&(((i=n.filter)==null?void 0:i.call(n,r))??!0)}}:t)})}function Ij(n){const e=new Map(n.map(i=>[i.id,i])),t=new Set,r=[];function s(i){De(!t.has(i.id),`Circular dependency in migrations: ${i.id}`),t.add(i.id);const{version:o,sequenceId:a}=Cc(i.id),c=e.get(`${a}/${o-1}`);if(c&&s(c),i.dependsOn)for(const l of i.dependsOn){const u=e.get(l);u&&s(u)}e.delete(i.id),r.push(i)}for(const i of e.values())s(i);return r}function Cc(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function GS(n,e){e&&De(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),De(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function Jw(n){if(De(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),De(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;GS(n.sequence[0].id,n.sequenceId);let e=Cc(n.sequence[0].id).version;De(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const r=n.sequence[t].id;GS(r,n.sequenceId);const s=Cc(r).version;De(s===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=s}}var ss=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(ss||{});function Cj(n){if(n.schemaVersion>2||n.schemaVersion<1)return hs.err("Bad schema version");if(n.schemaVersion===2)return hs.ok(n);const e={schemaVersion:2,sequences:{"com.tldraw.store":n.storeVersion}};for(const[t,r]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=r.version,"subTypeKey"in r)for(const[s,i]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${t}.${s}`]=i;return hs.ok(e)}class Hf{constructor(e,t){v(this,"migrations",{});v(this,"sortedMigrations");var s;this.types=e,this.options=t;for(const i of t.migrations??[])De(!this.migrations[i.sequenceId],`Duplicate migration sequenceId ${i.sequenceId}`),Jw(i),this.migrations[i.sequenceId]=i;const r=Object.values(this.migrations).flatMap(i=>i.sequence);this.sortedMigrations=Ij(r);for(const i of this.sortedMigrations)if((s=i.dependsOn)!=null&&s.length)for(const o of i.dependsOn){const a=r.find(c=>c.id===o);De(a,`Migration '${i.id}' depends on missing migration '${o}'`)}}static create(e,t){return new Hf(e,t??{})}validateRecord(e,t,r,s){try{const i=Ft(this.types,t.typeName);if(!i)throw new Error(`Missing definition for record type ${t.typeName}`);return i.validate(t,s??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:s,error:i});throw i}}getMigrationsSince(e){const t=Cj(e);if(!t.ok)return t;const r=t.value,s=new Set(Object.keys(r.sequences).filter(o=>this.migrations[o]));for(const o in this.migrations)r.sequences[o]===void 0&&this.migrations[o].retroactive&&s.add(o);if(s.size===0)return hs.ok([]);const i=new Set;for(const o of s){const a=r.sequences[o];if(typeof a!="number"&&this.migrations[o].retroactive||a===0){for(const u of this.migrations[o].sequence)i.add(u.id);continue}const c=`${o}/${a}`,l=this.migrations[o].sequence.findIndex(u=>u.id===c);if(l===-1)return hs.err("Incompatible schema?");for(const u of this.migrations[o].sequence.slice(l+1))i.add(u.id)}return hs.ok(this.sortedMigrations.filter(({id:o})=>i.has(o)))}migratePersistedRecord(e,t,r="up"){const s=this.getMigrationsSince(t);if(!s.ok)return console.error("Error migrating record",s.error),{type:"error",reason:ss.MigrationError};let i=s.value;if(i.length===0)return{type:"success",value:e};if(i.some(o=>o.scope==="store"))return{type:"error",reason:r==="down"?ss.TargetVersionTooOld:ss.TargetVersionTooNew};if(r==="down"){if(!i.every(o=>o.down))return{type:"error",reason:ss.TargetVersionTooOld};i=i.slice().reverse()}e=Ve(e);try{for(const o of i){if(o.scope==="store")throw new Error;if(!(o.filter?o.filter(e):!0))continue;const c=o[r](e);c&&(e=Ve(c))}}catch(o){return console.error("Error migrating record",o),{type:"error",reason:ss.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:ss.MigrationError};const s=r.value;if(s.length===0)return{type:"success",value:t};t=Ve(t);try{for(const i of s)if(i.scope==="record")for(const[o,a]of Object.entries(t)){if(!(i.filter?i.filter(a):!0))continue;const l=i.up(a);l&&(t[o]=Ve(l))}else if(i.scope==="store"){const o=i.up(t);o&&(t=Ve(o))}else mt(i)}catch(i){return console.error("Error migrating store",i),{type:"error",reason:ss.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?Cc(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Ft(this.types,e);return De(t,"record type does not exists"),t}}Ss("@tldraw/store","3.5.0","esm");function _j(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class Ee extends Error{constructor(t,r=[]){const s=_j(r),i=t.split(`
`).map((o,a)=>a===0?o:`  ${o}`).join(`
`);super(r?`At ${s}: ${i}`:i);v(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function ln(n,e){try{return e()}catch(t){throw t instanceof Ee?new Ee(t.rawMessage,[n,...t.path]):new Ee(t.toString(),[n])}}function ms(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:mt(e)}}class Gt{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return Aj(this)}optional(){return e0(this)}refine(e){return new Gt(t=>e(this.validate(t)),(t,r)=>{const s=this.validateUsingKnownGoodVersion(t,r);return Object.is(t,s)?t:e(s)})}check(e,t){return typeof e=="string"?this.refine(r=>(ln(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class Ej extends Gt{constructor(e){super(t=>{const r=WS.validate(t);for(let s=0;s<r.length;s++)ln(s,()=>e.validate(r[s]));return r},(t,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const s=WS.validate(r);let i=t.length!==s.length;for(let o=0;o<s.length;o++){const a=s[o];if(o>=t.length){i=!0,ln(o,()=>e.validate(a));continue}if(Object.is(t[o],a))continue;const c=ln(o,()=>e.validateUsingKnownGoodVersion(t[o],a));Object.is(c,t[o])||(i=!0)}return i?r:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Ee("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Ee("Expected an array with length greater than 1")})}}class _c extends Gt{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new Ee(`Expected object, got ${ms(r)}`);for(const[s,i]of Object.entries(e))ln(s,()=>{i.validate(Ft(r,s))});if(!t){for(const s of Object.keys(r))if(!Wn(e,s))throw new Ee("Unexpected property",[s])}return r},(r,s)=>{if(typeof s!="object"||s===null)throw new Ee(`Expected object, got ${ms(s)}`);let i=!1;for(const[o,a]of Object.entries(e)){const c=Ft(r,o),l=Ft(s,o);if(Object.is(c,l))continue;const u=ln(o,()=>{const h=a;return h.validateUsingKnownGoodVersion?h.validateUsingKnownGoodVersion(c,l):h.validate(l)});Object.is(u,c)||(i=!0)}if(!t){for(const o of Object.keys(s))if(!Wn(e,o))throw new Ee("Unexpected property",[o])}for(const o of Object.keys(r))if(!Wn(s,o)){i=!0;break}return i?s:r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new _c(this.config,!0)}extend(e){return new _c({...this.config,...e})}}class ol extends Gt{constructor(e,t,r,s){super(i=>{this.expectObject(i);const{matchingSchema:o,variant:a}=this.getMatchingSchemaAndVariant(i);return o===void 0?this.unknownValueValidation(i,a):ln(`(${e} = ${a})`,()=>o.validate(i))},(i,o)=>{this.expectObject(o),this.expectObject(i);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(o);return a===void 0?this.unknownValueValidation(o,c):Ft(i,e)!==Ft(o,e)?ln(`(${e} = ${c})`,()=>a.validate(o)):ln(`(${e} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(i,o):a.validate(o))}),this.key=e,this.config=t,this.unknownValueValidation=r,this.useNumberKeys=s}expectObject(e){if(typeof e!="object"||e===null)throw new Ee(`Expected an object, got ${ms(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Ft(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new Ee(`Expected a string for key "${this.key}", got ${ms(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new Ee(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Wn(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new ol(this.key,this.config,e,this.useNumberKeys)}}class Tj extends Gt{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new Ee(`Expected object, got ${ms(r)}`);for(const[s,i]of Object.entries(r))ln(s,()=>{e.validate(s),t.validate(i)});return r},(r,s)=>{if(typeof s!="object"||s===null)throw new Ee(`Expected object, got ${ms(s)}`);let i=!1;for(const[o,a]of Object.entries(s)){if(!Wn(r,o)){i=!0,ln(o,()=>{e.validate(o),t.validate(a)});continue}const c=Ft(r,o),l=a;if(Object.is(c,l))continue;const u=ln(o,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(c,l):t.validate(l));Object.is(u,c)||(i=!0)}for(const o of Object.keys(r))if(!Wn(s,o)){i=!0;break}return i?s:r}),this.keyValidator=e,this.valueValidator=t}}function Kf(n){return new Gt(e=>{if(typeof e!==n)throw new Ee(`Expected ${n}, got ${ms(e)}`);return e})}const kj=new Gt(n=>n),ge=Kf("string"),ue=Kf("number").check(n=>{if(Number.isNaN(n))throw new Ee("Expected a number, got NaN");if(!Number.isFinite(n))throw new Ee(`Expected a finite number, got ${n}`)}),Ec=ue.check(n=>{if(n<0)throw new Ee(`Expected a positive number, got ${n}`)}),dt=ue.check(n=>{if(n<=0)throw new Ee(`Expected a non-zero positive number, got ${n}`)}),Qw=ue.check(n=>{if(!Number.isInteger(n))throw new Ee(`Expected an integer, got ${n}`)}),qa=Qw.check(n=>{if(n<0)throw new Ee(`Expected a positive integer, got ${n}`)}),jj=Qw.check(n=>{if(n<=0)throw new Ee(`Expected a non-zero positive integer, got ${n}`)}),be=Kf("boolean");function Nt(n){return new Gt(e=>{if(e!==n)throw new Ee(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const WS=new Gt(n=>{if(!Array.isArray(n))throw new Ee(`Expected an array, got ${ms(n)}`);return n});function Ct(n){return new Ej(n)}function ve(n){return new _c(n)}function xp(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===qT)}function bp(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(bp):xp(n)?Object.values(n).every(bp):!1}const _t=new Gt(n=>{if(bp(n))return n;throw new Ee(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let r=0;r<e.length;r++){if(r>=n.length){t=!0,_t.validate(e[r]);continue}const s=n[r],i=e[r];if(Object.is(s,i))continue;const o=_t.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(t=!0)}return t?e:n}else if(xp(n)&&xp(e)){let t=!1;for(const r of Object.keys(e)){if(!Wn(n,r)){t=!0,_t.validate(e[r]);continue}const s=n[r],i=e[r];if(Object.is(s,i))continue;const o=_t.validateUsingKnownGoodVersion(s,i);Object.is(o,s)||(t=!0)}for(const r of Object.keys(n))if(!Wn(e,r)){t=!0;break}return t?e:n}else return _t.validate(e)});function Tc(n,e){return new Tj(n,e)}function qf(n,e){return new ol(n,e,(t,r)=>{throw new Ee(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!1)}function Mj(n,e){return new ol(n,e,(t,r)=>{throw new Ee(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!0)}function wr(n,e){return new Gt(t=>ln(n,()=>e.validate(t)),(t,r)=>ln(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,r):e.validate(r)))}function al(n){return new Gt(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new Ee(`Expected ${t}, got ${e}`)}return e})}function e0(n){return new Gt(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function Aj(n){return new Gt(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function cl(...n){return al(new Set(n))}function Gf(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new Ee(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new Ee(`Expected a valid url, got ${JSON.stringify(n)}`)}}const Dj=new Set(["http:","https:","mailto:"]),vn=ge.check(n=>{if(n==="")return;const e=Gf(n);if(!Dj.has(e.protocol.toLowerCase()))throw new Ee(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),Oj=new Set(["http:","https:","data:","asset:"]),$s=ge.check(n=>{if(n==="")return;const e=Gf(n);if(!Oj.has(e.protocol.toLowerCase()))throw new Ee(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});ge.check(n=>{if(n==="")return;if(!Gf(n).protocol.toLowerCase().match(/^https?:$/))throw new Ee(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const Wf=ge.refine(n=>{try{return RT(n),n}catch{throw new Ee(`Expected an index key, got ${JSON.stringify(n)}`)}});Ss("@tldraw/validate","3.5.0","esm");function bn(n){return ge.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const ll=bn("asset");function Yf(n,e){return ve({id:ll,typeName:Nt("asset"),type:Nt(n),props:e,meta:_t})}const zs=ve({x:ue,y:ue,z:ue.optional()}),Eo=ve({x:ue,y:ue,w:ue,h:ue}),t0=ue.check(n=>{if(n<0||n>1)throw new Ee("Opacity must be between 0 and 1")}),Rj=ge.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),An=bn("shape");function Lj(n,e,t){return ve({id:An,typeName:Nt("shape"),x:ue,y:ue,rotation:ue,index:Wf,parentId:Rj,type:Nt(n),isLocked:be,opacity:t0,props:e?ve(e):_t,meta:t?ve(t):_t})}const Fj=bn("binding");function $j(n,e,t){return ve({id:Fj,typeName:Nt("binding"),type:Nt(n),fromId:An,toId:An,props:e?ve(e):_t,meta:t?ve(t):_t})}dn("com.tldraw.binding",{});Cn({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function Rs(n){return`binding:${Fe()}`}function zj(n){return br("binding",{scope:"document",validator:wr("binding",qf("type",Go(n,(e,{props:t,meta:r})=>$j(e,t,r))))}).withDefaultProperties(()=>({meta:{}}))}class Tt{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:s=kj}=t;return new Tt(e,r,s)}static defineEnum(e,t){const{defaultValue:r,values:s}=t;return new Nj(e,r,s)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class Nj extends Tt{constructor(e,t,r){super(e,t,cl(...r)),this.values=r}}const ma=dn("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),Bj=Cn({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:ma.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:ma.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:ma.AddMeta,up:n=>{n.meta={}}},{id:ma.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function ui(n){return n?n.typeName==="shape":!1}function en(n){return n?n.startsWith("shape:"):!1}function ze(n){return`shape:${n??Fe()}`}function n0(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof Tt){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function Qn(n,e){return Go(e,(t,r)=>`com.tldraw.shape.${n}/${r}`)}function Uj(n){return br("shape",{scope:"document",validator:wr("shape",qf("type",Go(n,(e,{props:t,meta:r})=>Lj(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function YS(n,e){const t=[];for(const[r,{migrations:s}]of Object.entries(e)){const i=`com.tldraw.${n}.${r}`;s?"sequenceId"in s?(De(i===s.sequenceId,`sequenceId mismatch for ${r} ${il} migrations. Expected '${i}', got '${s.sequenceId}'`),t.push(s)):"sequence"in s?t.push(yi({sequenceId:i,retroactive:!1,sequence:s.sequence.map(o=>"id"in o?r0(n,r,o):o)})):t.push(yi({sequenceId:i,retroactive:!1,sequence:Object.keys(s.migrators).map(o=>Number(o)).sort((o,a)=>o-a).map(o=>({id:`${i}/${o}`,scope:"record",filter:a=>a.typeName===n&&a.type===r,up:a=>{const c=s.migrators[o].up(a);if(c)return c},down:a=>{const c=s.migrators[o].down(a);if(c)return c}}))})):t.push(yi({sequenceId:i,retroactive:!1,sequence:[]}))}return t}function r0(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:r=>r.typeName===n&&r.type===e,up:r=>{const s=t.up(r.props);s&&(r.props=s)},down:typeof t.down=="function"?r=>{const s=t.down(r.props);s&&(r.props=s)}:void 0}}const s0=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],kc={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Yr(n){return n.isDarkMode?kc.darkMode:kc.lightMode}const Pn=Tt.defineEnum("tldraw:color",{defaultValue:"black",values:s0}),Vf=Tt.defineEnum("tldraw:labelColor",{defaultValue:"black",values:s0}),Ns=Tt.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Bs=Tt.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),gr=Tt.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),i0={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},mr=Tt.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),o0=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],jc=Tt.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:o0}),Mc=Tt.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:o0}),a0={labelColor:Vf,color:Pn,fill:Bs,dash:Ns,size:mr,arrowheadStart:jc,arrowheadEnd:Mc,font:gr,start:zs,end:zs,bend:ue,text:ge,labelPosition:ue,scale:dt},oi=Qn("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function ya(n){return r0("shape","arrow",n)}const c0=yi({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[ya({id:oi.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),ya({id:oi.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),ya({id:oi.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:oi.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:r,end:s}=t.props;if(r.type==="binding"){const i=Rs(),o={typeName:"binding",id:i,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[i]=o,t.props.start={x:0,y:0}}else delete t.props.start.type;if(s.type==="binding"){const i=Rs(),o={typeName:"binding",id:i,type:"arrow",fromId:t.id,toId:s.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:s.normalizedAnchor,isExact:s.isExact,isPrecise:s.isPrecise}};n[i]=o,t.props.end={x:0,y:0}}else delete t.props.end.type}}},ya({id:oi.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),l0={terminal:cl("start","end"),normalizedAnchor:zs,isExact:be,isPrecise:be},d0={sequence:[{dependsOn:[oi.ExtractBindings]}]},Hj=wr("camera",ve({typeName:Nt("camera"),id:bn("camera"),x:ue,y:ue,z:ue,meta:_t})),Kj=dn("com.tldraw.camera",{AddMeta:1}),qj=Cn({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:Kj.AddMeta,up:n=>{n.meta={}}}]}),cr=br("camera",{validator:Hj,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Gj=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),u0=al(Gj),Wj=ve({type:u0,rotation:ue}),Yj=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),Vj=al(Yj),Xj=new Set(["starting","paused","active","stopping"]),h0=ve({id:ge,points:Ct(zs),size:Ec,color:Vj,opacity:ue,state:al(Xj),delay:ue,shrink:ue,taper:be}),$o=bn("page"),Zj=wr("page",ve({typeName:Nt("page"),id:$o,name:ge,index:Wf,meta:_t})),Jj=dn("com.tldraw.page",{AddMeta:1}),Qj=Cn({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:Jj.AddMeta,up:n=>{n.meta={}}}]}),In=br("page",{validator:Zj,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Zt(n){return In.isId(n)}const eM={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function p0(n){return n?Co(n,e=>eM[e]):null}bn("instance");function tM(n){const e={};for(const[r,s]of n)e[r]=e0(s);const t=wr("instance",ve({typeName:Nt("instance"),id:bn("instance"),currentPageId:$o,followingUserId:ge.nullable(),brush:Eo.nullable(),opacityForNextShape:t0,stylesForNextShape:ve(e),cursor:Wj,scribbles:Ct(h0),isFocusMode:be,isDebugMode:be,isToolLocked:be,exportBackground:be,screenBounds:Eo,insets:Ct(be),zoomBrush:Eo.nullable(),isPenMode:be,isGridMode:be,chatMessage:ge,isChatting:be,highlightedUserIds:Ct(ge),isFocused:be,devicePixelRatio:ue,isCoarsePointer:be,isHoveringCanvas:be.nullable(),openMenus:Ct(ge),isChangingStyle:be,isReadonly:be,meta:_t,duplicateProps:ve({shapeIds:Ct(bn("shape")),offset:ve({x:ue,y:ue})}).nullable()}));return br("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const Ye=dn("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),nM=Cn({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:Ye.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:Ye.RemoveDialog,up:({dialog:n,...e})=>e},{id:Ye.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:Ye.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:Ye.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:Ye.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:Ye.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:Ye.AddZoom,up:n=>({...n,zoomBrush:null})},{id:Ye.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:Ye.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:Ye.RemoveUserId,up:({userId:n,...e})=>e},{id:Ye.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:Ye.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:Ye.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:Ye.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:Ye.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:Ye.AddMeta,up:n=>({...n,meta:{}})},{id:Ye.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:Ye.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:Ye.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:Ye.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:Ye.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:Ye.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:Ye.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:Ye.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),Kt="instance:instance",rM=wr("instance_page_state",ve({typeName:Nt("instance_page_state"),id:bn("instance_page_state"),pageId:$o,selectedShapeIds:Ct(An),hintingShapeIds:Ct(An),erasingShapeIds:Ct(An),hoveredShapeId:An.nullable(),editingShapeId:An.nullable(),croppingShapeId:An.nullable(),focusedGroupId:An.nullable(),meta:_t})),Qi=dn("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),sM=Cn({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Qi.AddCroppingId,up(n){n.croppingShapeId=null}},{id:Qi.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:Qi.AddMeta,up:n=>{n.meta={}}},{id:Qi.RenameProperties,up:n=>{},down:n=>{}},{id:Qi.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),qn=br("instance_page_state",{validator:rM,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),iM=wr("pointer",ve({typeName:Nt("pointer"),id:bn("pointer"),x:ue,y:ue,lastActivityTimestamp:ue,meta:_t})),oM=dn("com.tldraw.pointer",{AddMeta:1}),aM=Cn({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:oM.AddMeta,up:n=>{n.meta={}}}]}),Xf=br("pointer",{validator:iM,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Ac=Xf.createId("pointer"),cM=wr("instance_presence",ve({typeName:Nt("instance_presence"),id:bn("instance_presence"),userId:ge,userName:ge,lastActivityTimestamp:ue,followingUserId:ge.nullable(),cursor:ve({x:ue,y:ue,type:u0,rotation:ue}),color:ge,camera:ve({x:ue,y:ue,z:ue}),screenBounds:Eo,selectedShapeIds:Ct(bn("shape")),currentPageId:bn("page"),brush:Eo.nullable(),scribbles:Ct(h0),chatMessage:ge,meta:_t})),eo=dn("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),lM=Cn({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:eo.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:eo.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:eo.AddChatMessage,up:n=>{n.chatMessage=""}},{id:eo.AddMeta,up:n=>{n.meta={}}},{id:eo.RenameSelectedShapeIds,up:n=>{}}]}),dM=br("instance_presence",{validator:cM,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),uM=wr("document",ve({typeName:Nt("document"),id:Nt("document:document"),gridSize:ue,name:ge,meta:_t})),VS=dn("com.tldraw.document",{AddName:1,AddMeta:2}),hM=Cn({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:VS.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:VS.AddMeta,up:n=>{n.meta={}}}]}),Zf=br("document",{validator:uM,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),wp=Zf.createId("document");function pM(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function XS(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}function fM({error:n,phase:e,record:t,recordBefore:r}){throw xf(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?XS(Ve(r)):void 0,recordAfter:XS(Ve(t))}}),n}function gM(){return[In.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function mM(n){const e=n.query.ids("page"),t=n.query.records("instance_page_state"),r=()=>{if(!n.has(wp))return n.put([Zf.create({id:wp,name:n.props.defaultName})]),r();if(!n.has(Ac))return n.put([Xf.create({id:Ac})]),r();const s=e.get();if(s.size===0)return n.put(gM()),r();const i=()=>[...s].map(u=>n.get(u)).sort(pM)[0].id,o=n.get(Kt);if(o){if(!s.has(o.currentPageId))return n.put([{...o,currentPageId:i()}]),r()}else return n.put([n.schema.types.instance.create({id:Kt,currentPageId:i(),exportBackground:!0})]),r();const a=new Set,c=new Set;for(const u of s){const h=qn.createId(u);n.get(h)||a.add(h);const f=cr.createId(u);n.has(f)||c.add(f)}a.size>0&&n.put([...a].map(u=>qn.create({id:u,pageId:qn.parseId(u)}))),c.size>0&&n.put([...c].map(u=>cr.create({id:u})));const l=t.get();for(const u of l){if(!s.has(u.pageId)){n.remove([u.id]);continue}if(u.croppingShapeId&&!n.has(u.croppingShapeId))return n.put([{...u,croppingShapeId:null}]),r();if(u.focusedGroupId&&!n.has(u.focusedGroupId))return n.put([{...u,focusedGroupId:null}]),r();if(u.hoveredShapeId&&!n.has(u.hoveredShapeId))return n.put([{...u,hoveredShapeId:null}]),r();const h=u.selectedShapeIds.filter(g=>n.has(g));if(h.length!==u.selectedShapeIds.length)return n.put([{...u,selectedShapeIds:h}]),r();const p=u.hintingShapeIds.filter(g=>n.has(g));if(p.length!==u.hintingShapeIds.length)return n.put([{...u,hintingShapeIds:p}]),r();const f=u.erasingShapeIds.filter(g=>n.has(g));if(f.length!==u.erasingShapeIds.length)return n.put([{...u,erasingShapeIds:f}]),r()}};return r}const yM=Yf("bookmark",ve({title:ge,description:ge,image:ge,favicon:ge,src:$s.nullable()})),ZS=dn("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),SM=Cn({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:ZS.MakeUrlsValid,up:n=>{$s.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:ZS.AddFavicon,up:n=>{$s.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),xM=Yf("image",ve({w:ue,h:ue,name:ge,isAnimated:be,mimeType:ge.nullable(),src:$s.nullable(),fileSize:dt.optional()})),to=dn("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),bM=Cn({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:to.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:to.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:to.MakeUrlsValid,up:n=>{$s.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:to.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:to.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),wM=Yf("video",ve({w:ue,h:ue,name:ge,isAnimated:be,mimeType:ge.nullable(),src:$s.nullable(),fileSize:ue.optional()})),no=dn("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),vM=Cn({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:no.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:no.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:no.MakeUrlsValid,up:n=>{$s.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:no.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:no.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),PM=wr("asset",qf("type",{image:xM,video:wM,bookmark:yM})),IM=dn("com.tldraw.asset",{AddMeta:1}),CM=Cn({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:IM.AddMeta,up:n=>{n.meta={}}}]}),os=br("asset",{validator:PM,scope:"document"}).withDefaultProperties(()=>({meta:{}})),f0={w:dt,h:dt,assetId:ll.nullable(),url:vn},JS=Qn("bookmark",{NullAssetId:1,MakeUrlsValid:2}),g0={sequence:[{id:JS.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:JS.MakeUrlsValid,up:n=>{vn.isValid(n.url)||(n.url="")},down:n=>{}}]},m0=ve({type:cl("free","straight"),points:Ct(zs)}),y0={color:Pn,fill:Bs,dash:Ns,size:mr,segments:Ct(m0),isComplete:be,isClosed:be,isPen:be,scale:dt},QS=Qn("draw",{AddInPen:1,AddScale:2}),S0={sequence:[{id:QS.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:QS.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},_M=/(^\/r\/[^/]+\/?$)/,EM=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(_M))return n}},{hostnames:["figma.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:n=>{const e=pe(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[s,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${i},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,s,i]=t;return`https://codepen.io/${s}/pen/${i}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,s]=t;return`https://scratch.mit.edu/projects/${s}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:n=>{const e=pe(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:n=>{const e=pe(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:n=>{const e=pe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{hostnames:["replit.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hash.match(/#room=/))return n}},{hostnames:["observablehq.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],x0={w:dt,h:dt,url:ge},Sa=Qn("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),b0={sequence:[{id:Sa.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let r;for(const s of EM)if(s.hostnames.includes(t))try{r=s.fromEmbedUrl(e)}catch(i){console.warn(i)}n.tmpOldUrl=n.url,n.url=r??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:Sa.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:Sa.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:Sa.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},w0={w:dt,h:dt,name:ge},v0={sequence:[]},Dc=Tt.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Oc=Tt.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Gn=Tt.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),P0={geo:Gn,labelColor:Vf,color:Pn,fill:Bs,dash:Ns,size:mr,font:gr,align:Dc,verticalAlign:Oc,url:vn,w:dt,h:dt,growY:Ec,text:ge,scale:dt},Mr=Qn("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),I0={sequence:[{id:Mr.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Mr.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:Mr.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Mr.AddCheckBox,up:n=>{},down:"retired"},{id:Mr.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Mr.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:Mr.AddCloud,up:n=>{},down:"retired"},{id:Mr.MakeUrlsValid,up:n=>{vn.isValid(n.url)||(n.url="")},down:n=>{}},{id:Mr.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},C0={},_0={sequence:[]},E0={color:Pn,size:mr,segments:Ct(m0),isComplete:be,isPen:be,scale:dt},TM=Qn("highlight",{AddScale:1}),T0={sequence:[{id:TM.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},kM=ve({topLeft:zs,bottomRight:zs}),k0={w:dt,h:dt,playing:be,url:vn,assetId:ll.nullable(),crop:kM.nullable(),flipX:be,flipY:be},xa=Qn("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),j0={sequence:[{id:xa.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:xa.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:xa.MakeUrlsValid,up:n=>{vn.isValid(n.url)||(n.url="")},down:n=>{}},{id:xa.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},Rc=Tt.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),jM=ve({id:ge,index:Wf,x:ue,y:ue}),M0={color:Pn,dash:Ns,size:mr,spline:Rc,points:Tc(ge,jM),scale:dt},ro=Qn("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),A0={sequence:[{id:ro.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:ro.RemoveExtraHandleProps,up:n=>{n.handles=wf(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,r])=>({index:t,...r})).sort(Rt);n.handles=Object.fromEntries(e.map((t,r)=>{const s=r===0?"start":r===e.length-1?"end":`handle:${t.index}`;return[s,{id:s,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:ro.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:r,y:s}])=>({x:r,y:s,index:t})).sort(Rt);n.points=e.map(({x:t,y:r})=>({x:t,y:r})),delete n.handles},down:n=>{const e=Fo(n.points.length);n.handles=Object.fromEntries(n.points.map((t,r)=>[e[r],{x:t.x,y:t.y}])),delete n.points}},{id:ro.PointIndexIds,up:n=>{const e=Fo(n.points.length);n.points=Object.fromEntries(n.points.map((t,r)=>{const s=e[r];return[s,{id:s,index:s,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(Rt);n.points=e.map(({x:t,y:r})=>({x:t,y:r}))}},{id:ro.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},D0={color:Pn,labelColor:Vf,size:mr,font:gr,fontSizeAdjustment:Ec,align:Dc,verticalAlign:Oc,growY:Ec,url:vn,text:ge,scale:dt},ts=Qn("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),O0={sequence:[{id:ts.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:ts.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ts.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:ts.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:ts.MakeUrlsValid,up:n=>{vn.isValid(n.url)||(n.url="")},down:n=>{}},{id:ts.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:ts.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}},{id:ts.AddLabelColor,up:n=>{n.labelColor="black"},down:n=>{delete n.labelColor}}]},vp=Tt.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),R0={color:Pn,size:mr,font:gr,textAlign:vp,w:dt,text:ge,scale:dt,autoSize:be},ex=Qn("text",{RemoveJustify:1,AddTextAlign:2}),L0={sequence:[{id:ex.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ex.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},F0={w:dt,h:dt,time:ue,playing:be,url:vn,assetId:ll.nullable()},tx=Qn("video",{AddUrlProp:1,MakeUrlsValid:2}),$0={sequence:[{id:tx.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:tx.MakeUrlsValid,up:n=>{vn.isValid(n.url)||(n.url="")},down:n=>{}}]},ba=dn("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),MM=yi({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:ba.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of cn(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:ba.AddInstancePresenceType,scope:"store",up(n){}},{id:ba.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of cn(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:ba.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of cn(n))t.typeName.match("user_document")&&delete n[e]}}]}),AM={arrow:{migrations:c0,props:a0},bookmark:{migrations:g0,props:f0},draw:{migrations:S0,props:y0},embed:{migrations:b0,props:x0},frame:{migrations:v0,props:w0},geo:{migrations:I0,props:P0},group:{migrations:_0,props:C0},highlight:{migrations:T0,props:E0},image:{migrations:j0,props:k0},line:{migrations:A0,props:M0},note:{migrations:O0,props:D0},text:{migrations:L0,props:R0},video:{migrations:$0,props:F0}},DM={arrow:{migrations:d0,props:l0}};function OM({shapes:n=AM,bindings:e=DM,migrations:t}={}){const r=new Map;for(const a of nt(n))for(const c of n0(a.props??{}).keys()){if(r.has(c.id)&&r.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);r.set(c.id,c)}const s=Uj(n),i=zj(e),o=tM(r);return Hf.create({asset:os,binding:i,camera:cr,document:Zf,instance:o,instance_page_state:qn,page:In,instance_presence:dM,pointer:Xf,shape:s},{migrations:[MM,CM,qj,hM,nM,sM,Qj,lM,aM,Bj,SM,bM,vM,...YS("shape",n),...YS("binding",e),...t??[]],onValidationFailure:fM,createIntegrityChecker:mM})}const zo=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"עברית"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ku",label:"کوردی"},{locale:"ne",label:"नेपाली"},{locale:"hi-in",label:"हिन्दी"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"my",label:"မြန်မာစာ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function RM(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return LM(n)}function LM(n){for(const e of n){const t=FM(e);if(t)return t}return"en"}const nx={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function FM(n){const e=zo.find(s=>s.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(s=>s.toLowerCase());if(r){const s=zo.find(i=>i.locale===t);if(s)return s.locale}return t in nx?nx[t]:null}Ss("@tldraw/tlschema","3.5.0","esm");var ih={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var rx;function $M(){return rx||(rx=1,(function(n){(function(){var e={}.hasOwnProperty;function t(){for(var i="",o=0;o<arguments.length;o++){var a=arguments[o];a&&(i=s(i,r(a)))}return i}function r(i){if(typeof i=="string"||typeof i=="number")return i;if(typeof i!="object")return"";if(Array.isArray(i))return t.apply(null,i);if(i.toString!==Object.prototype.toString&&!i.toString.toString().includes("[native code]"))return i.toString();var o="";for(var a in i)e.call(i,a)&&i[a]&&(o=s(o,a));return o}function s(i,o){return o?i?i+" "+o:i+o:i}n.exports?(t.default=t,n.exports=t):window.classNames=t})()})(ih)),ih.exports}var zM=$M();const se=ki(zM),z0="3.5.0",sx={major:"2024-09-13T14:36:29.063Z",minor:"2024-11-26T11:43:05.889Z"},NM={error:null};class Jf extends _.Component{constructor(){super(...arguments);v(this,"state",NM)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,s;(s=(r=this.props).onError)==null||s.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return d.jsx(r,{error:t})}return this.props.children}}function No({children:n,fallback:e,...t}){return e===null?n:d.jsx(Jf,{fallback:e,...t,children:n})}function Qf(n,e){return dl(`${n}_${e}`)}function Li(n){return dl(`${_.useId()}${n??""}`)}function Yn(n){const e=tn(_.useContext(N0));return dl(`${e}_${n}`)}function dl(n){return n.replace(/:/g,"_")}const N0=_.createContext(null);function BM({children:n}){const e=Li();return d.jsx(N0.Provider,{value:e,children:n})}const eg=_.createContext(null);function z(){const n=Qe.useContext(eg);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function ws(){return Qe.useContext(eg)}function tg({editor:n,children:e}){return d.jsx(eg.Provider,{value:n,children:d.jsx(BM,{children:e})})}function UM(){return d.jsx("div",{className:"tl-background"})}function Fi(n,e,t,r,s,i){_.useLayoutEffect(()=>{const o=n.current;if(!o||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),s!==void 0&&(a+=` rotate(${s}rad)`),i&&(a+=` translate(${i.x}px, ${i.y}px)`),o.style.transform=a})}const yt={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class y{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,s=Math.sin(e),i=Math.cos(e);return this.x=t*i-r*s,this.y=t*s+r*i,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,s=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(r*o-s*i),this.y=e.y+(r*i+s*o),this}clone(){const{x:e,y:t,z:r}=this;return new y(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=y.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return y.Dpr(this,e)}cpr(e){return y.Cpr(this,e)}len2(){return y.Len2(this)}len(){return y.Len(this)}pry(e){return y.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return y.Uni(this)}tan(e){return y.Tan(this,e)}dist(e){return y.Dist(this,e)}distanceToLineSegment(e,t){return y.DistanceToLineSegment(e,t,this)}slope(e){return y.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return y.Angle(this,e)}toAngle(){return y.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return y.Equals(this,e)}equalsXY(e,t){return y.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return y.ToFixed(this)}toString(){return y.ToString(y.ToFixed(this))}toJson(){return y.ToJson(this)}toArray(){return y.ToArray(this)}static Add(e,t){return new y(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new y(e.x+t,e.y+r)}static Sub(e,t){return new y(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new y(e.x-t,e.y-r)}static AddScalar(e,t){return new y(e.x+t,e.y+t)}static SubScalar(e,t){return new y(e.x-t,e.y-t)}static Div(e,t){return new y(e.x/t,e.y/t)}static Mul(e,t){return new y(e.x*t,e.y*t)}static DivV(e,t){return new y(e.x/t.x,e.y/t.y)}static MulV(e,t){return new y(e.x*t.x,e.y*t.y)}static Neg(e){return new y(-e.x,-e.y)}static Per(e){return new y(e.y,-e.x)}static Abs(e){return new y(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,r){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<r**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new y(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return y.Dpr(e,t)/y.Len(t)}static Uni(e){return y.Div(e,y.Len(e))}static Tan(e,t){return y.Uni(y.Sub(e,t))}static Min(e,t){return new y(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new y(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new y(e,t,r)}static FromArray(e){return new y(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),s=Math.cos(t);return new y(e.x*s-e.y*r,e.x*r+e.y*s)}static RotWith(e,t,r){const s=e.x-t.x,i=e.y-t.y,o=Math.sin(r),a=Math.cos(r);return new y(t.x+(s*a-i*o),t.y+(s*o+i*a))}static NearestPointOnLineThroughPoint(e,t,r){return y.Mul(t,y.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,s=!0){if(y.Equals(e,r)||y.Equals(t,r))return y.From(r);const i=y.Tan(t,e),o=y.Add(e,y.Mul(i,y.Sub(r,e).pry(i)));if(s){if(o.x<Math.min(e.x,t.x))return y.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return y.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return y.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return y.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,r){return y.Dist(r,y.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,s=!0){return y.Dist(r,y.NearestPointOnLineSegment(e,t,r,s))}static Snap(e,t=1){return new y(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof y?e:y.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return y.Sub(t,e).mul(r).add(e)}static Med(e,t){return new y((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=y.Len(e);return new y(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return y.Sub(e,r).mul(t).add(r)}static ToFixed(e){return new y(Lr(e.x),Lr(e.y))}static ToInt(e){return new y(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,r){return y.Add(e,y.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new y(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:s}=e;return{x:t,y:r,z:s}}static Average(e){const t=e.length,r=new y(0,0);if(t===0)return r;for(let s=0;s<t;s++)r.add(e[s]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new y(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new y(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const s=[];for(let i=0;i<r;i++){const o=yt.easeInQuad(i/(r-1)),a=y.Lrp(e,t,o);a.z=Math.min(1,.5+Math.abs(.5-HM(o))*.65),s.push(a)}return s}static SnapToGrid(e,t=8){return new y(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const HM=n=>n<.5?2*n*n:-1+(4-2*n)*n;function ke(n){return`${F(n.x)},${F(n.y)} `}function nn(n,e){return`${F((n.x+e.x)/2)},${F((n.y+e.y)/2)} `}const je=Math.PI,Ke=je/2,Le=je*2,KM=Math.sin;function wt(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function wa(n,e=1e10){return n?Math.round(n*e)/e:0}function fs(n,e,t=1e-6){return Math.abs(n-e)<=t}function B0(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return je*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function Ls(n){return n=n%Le,n<0?n=n+Le:n===0&&(n=0),n}function Zo(n,e){return n=Ls(n),e=Ls(e),n>e&&(e+=Le),e-n}function U0(n,e){return Le-Zo(n,e)}function Ga(n,e){const t=(e-n)%Le;return 2*t%Le-t}function Pp(n){return(Le+n)%Le}function Lc(n,e){const t=Le/e;let r=Math.floor((Pp(n)+t/2)/t)*t%Le;return r<je&&(r+=Le),r>je&&(r-=Le),r}function H0(n,e){return n===e||fs(n%(Math.PI/2)-e%(Math.PI/2),0)}function qM(n){return n*je/180}function GM(n){return n*180/je}function Us(n,e,t){return new y(n.x,n.y).add(y.FromAngle(t,e))}function oh(n,e,t){const r=n/2,s=e/2,i=[];let o=1/0,a=-1/0,c=1/0,l=-1/0;for(let g=0;g<t;g++){const m=Le/t,x=-Ke+g*m,b=r+r*Math.cos(x),S=s+s*Math.sin(x);b<o&&(o=b),S<c&&(c=S),b>a&&(a=b),S>l&&(l=S),i.push(new y(b,S))}const u=a-o,h=l-c,p=n-u,f=e-h;if(p!==0||f!==0)for(let g=0;g<i.length;g++){const m=i[g];m.x=(m.x-o)/u*n,m.y=(m.y-c)/h*e}return i}function so(n,e,t,r){return n<r&&t<e}function Bn(n,e,t,r){const s=Math.max(n,t),i=Math.min(e,r);return s<=i?[s,i]:null}function ix(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function wn(n,e){let t=0,r,s;for(let i=0;i<e.length;i++){if(r=e[i],r.x===n.x&&r.y===n.y||(s=e[(i+1)%e.length],y.Dist(n,r)+y.Dist(n,s)===y.Dist(r,s)))return!0;r.y<=n.y?s.y>n.y&&ix(r,s,n)>0&&(t+=1):s.y<=n.y&&ix(r,s,n)<0&&(t-=1)}return t!==0}function F(n){return Math.round(n*1e4)/1e4}function Lr(n){return Math.round(n*100)/100}const ox=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function as(n,e,t){return t<0?Zo(n,e):U0(n,e)}function Ip(n,e,t,r){let s;if(Math.abs(n)>je){s=Ga(e,r);const i=Ga(r,t);return Math.abs(s)<Math.abs(i)?s/n:(n-i)/n}else{s=Ga(e,r);const i=s/n;return Math.sign(s)!==Math.sign(n)?Math.abs(i)>.5?1:0:i}}function WM(n,e,t,r){const s=2*((e-n)%Le)%Le-(e-n)%Le;return r?(Le-Math.abs(s))*(t?1:-1):s}function ng(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),s=((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,i=((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r;return!Number.isFinite(s)||!Number.isFinite(i)?null:new y(s,i)}function YM(n,e,t,r,s){if(t===null)return[y.From(n),y.From(e)];const i=[],o=y.Angle(t,n),a=y.Angle(t,e),c=Zo(o,a);for(let l=0;l<s;l++){const u=l/(s-1),h=o+c*u,p=Us(t,r,h);i.push(p)}return i}const ah=({brush:n,color:e,opacity:t,className:r})=>{const s=_.useRef(null);Fi(s,n.x,n.y);const i=F(Math.max(1,n.w)),o=F(Math.max(1,n.h));return d.jsx("svg",{className:"tl-overlays__item",ref:s,children:e?d.jsxs("g",{className:"tl-brush",opacity:t,children:[d.jsx("rect",{width:i,height:o,fill:e,opacity:.75}),d.jsx("rect",{width:i,height:o,fill:"none",stroke:e,opacity:.1})]}):d.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:i,height:o})})},Be={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(Be.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),Be.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),Be.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),Be.isFirefox=/firefox/i.test(navigator.userAgent),Be.isAndroid=/android/i.test(navigator.userAgent),Be.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const ax={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},ch={duration:0,easing:yt.easeInOutCubic},cx={CAMERA_MOVE:-10},VM=["top","right","bottom","left"],lx=0,rg=2,va=1,dx=5,XM=128;var lh={};const ZM={},K0=Xt("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),ct={logPreventDefaults:Xt("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Xt("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Xt("logElementRemoves",{defaults:{all:!1}}),debugSvg:Xt("debugSvg",{defaults:{all:!1}}),showFps:Xt("showFps",{defaults:{all:!1}}),measurePerformance:Xt("measurePerformance",{defaults:{all:!1}}),throwToBlob:Xt("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Xt("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Xt("debugCursors",{defaults:{all:!1}}),forceSrgb:Xt("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Xt("debugGeometry",{defaults:{all:!1}}),hideShapes:Xt("hideShapes",{defaults:{all:!1}}),editOnType:Xt("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;ur("element removal logging",()=>{ct.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Xt(n,{defaults:e,shouldStoreForSession:t=!0}){return JM({name:n,defaults:e,shouldStoreForSession:t})}function JM(n){const e=eA(n),t=n.shouldStoreForSession?QM(n.name):null,r=ht(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&ur(`debug:${n.name}`,()=>{const s=r.get();s===e?cw(`tldraw_debug:${n.name}`):Ef(`tldraw_debug:${n.name}`,JSON.stringify(s))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,s=>s.toUpperCase())}`,{get(){return r.get()},set(s){r.set(s)},configurable:!0})),Object.assign(r,n)}function QM(n){try{return JSON.parse(aw(`tldraw_debug:${n}`)??"null")}catch{return null}}function dh(n){try{return n()}catch{return null}}function eA(n){switch(dh(()=>lh.TLDRAW_ENV)??dh(()=>lh.VERCEL_PUBLIC_TLDRAW_ENV)??dh(()=>lh.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function Fc(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return Fc(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function xe(n){n.preventDefault(),ct.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Jo(n,e){if(n.setPointerCapture(e.pointerId),ct.logPointerCaptures.get()){const t=K0.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function Qo(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),ct.logPointerCaptures.get())){const t=K0.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const ut=n=>n.stopPropagation(),At=(n,e,t)=>{n&&n.style.setProperty(e,t)},Lt=n=>Be.isDarwin?n.metaKey:n.ctrlKey||n.metaKey;function Sn(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,metaKey:n.metaKey,accelKey:Lt(n),pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function sg(){const n=z();return _.useMemo(function(){let r,s;function i(m){if(!m.isKilled){if(m.button===rg){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Sn(m)});return}m.button!==0&&m.button!==1&&m.button!==5||(Jo(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Sn(m)}))}}function o(m){m.isKilled||m.clientX===r&&m.clientY===s||(r=m.clientX,s=m.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Sn(m)}))}function a(m){m.isKilled||m.button!==0&&m.button!==1&&m.button!==2&&m.button!==5||(r=m.clientX,s=m.clientY,Qo(m.currentTarget,m),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Sn(m)}))}function c(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!0:null})}function l(m){if(m.isKilled||n.getInstanceState().isPenMode&&m.pointerType!=="pen")return;const x=m.pointerType==="mouse"||m.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:x?!1:null})}function u(m){m.isKilled=!0,xe(m)}function h(m){m.isKilled=!0,m.target instanceof HTMLElement&&m.target.tagName!=="A"&&m.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&m.target.className.includes("tl-text-content"))&&xe(m)}function p(m){xe(m)}async function f(m){var b,S;if(xe(m),ut(m),!((S=(b=m.dataTransfer)==null?void 0:b.files)!=null&&S.length))return;const x=Array.from(m.dataTransfer.files);await n.putExternalContent({type:"files",files:x,point:n.screenToPage({x:m.clientX,y:m.clientY}),ignoreParent:!1})}function g(m){ut(m)}return{onPointerDown:i,onPointerMove:o,onPointerUp:a,onPointerEnter:c,onPointerLeave:l,onDragOver:p,onDrop:f,onTouchStart:u,onTouchEnd:h,onClick:g}},[n])}function tA(){const n=z();_.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=o=>{const a=o.pointerType!=="mouse";e!==a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),s=Be.isFirefox&&!Be.isAndroid&&!Be.isIos,i=()=>{const o=s?!1:r.matches;e===o&&(e=o,n.updateInstanceState({isCoarsePointer:o}))};return r&&(r.addEventListener("change",i),i()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),r&&r.removeEventListener("change",i)}},[n])}const q0=_.createContext(null);function G0({container:n,children:e}){return d.jsx(q0.Provider,{value:n,children:e})}function ft(){return tn(_.useContext(q0),"useContainer used outside of <Tldraw />")}function nA(){const n=z(),e=ft(),t=N("isFocused",()=>n.getIsFocused(),[n]);_.useEffect(()=>{if(!e)return;function r(s){if(s.isSpecialRedispatchedEvent)return;xe(s),ut(s);const i=e.querySelector(".tl-canvas");if(!i)return;const o=new DragEvent(s.type,s);o.isSpecialRedispatchedEvent=!0,i.dispatchEvent(o)}return e.addEventListener("dragover",r),e.addEventListener("drop",r),()=>{e.removeEventListener("dragover",r),e.removeEventListener("drop",r)}},[e]),_.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const s=()=>{r!=null&&r();const i=`(resolution: ${window.devicePixelRatio}dppx)`,o=matchMedia(i),a=c=>{c.type==="change"&&s()};o.addEventListener?o.addEventListener("change",s):o.addListener&&o.addListener(a),r=()=>{o.removeEventListener?o.removeEventListener("change",s):o.removeListener&&o.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return s(),()=>{r==null||r()}},[n]),_.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!Pa(n)&&xe(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){xe(a);return}break}case"Tab":{if(Pa(n))return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&xe(a),n.menus.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(Pa(n))return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Lt(a)};n.dispatch(c)},s=a=>{if(a.isKilled||(a.isKilled=!0,Pa(n))||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:Lt(a)};n.dispatch(c)};function i(a){var c,l;if(e.contains(a.target)){const u=a.touches[0].pageX,h=a.touches[0].radiusX||0;(u-h<10||u+h>n.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((l=a.target)==null||l.click()),xe(a))}}const o=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&xe(a)};return e.addEventListener("touchstart",i,{passive:!1}),e.addEventListener("wheel",o,{passive:!1}),document.addEventListener("gesturestart",xe),document.addEventListener("gesturechange",xe),document.addEventListener("gestureend",xe),e.addEventListener("keydown",r),e.addEventListener("keyup",s),()=>{e.removeEventListener("touchstart",i),e.removeEventListener("wheel",o),document.removeEventListener("gesturestart",xe),document.removeEventListener("gesturechange",xe),document.removeEventListener("gestureend",xe),e.removeEventListener("keydown",r),e.removeEventListener("keyup",s)}},[n,e,t])}const rA=["input","select","button","textarea"];function Pa(n){const{activeElement:e}=document;return n.menus.hasOpenMenus()||e&&(e.getAttribute("contenteditable")||rA.indexOf(e.tagName.toLowerCase())>-1)}const sA=["textarea","input"];function iA(n){const e=z();_.useEffect(()=>{const t=n.current;if(!t)return;const r=s=>{var i;if(s instanceof PointerEvent&&s.pointerType==="pen"){s.isKilled=!0;const{target:o}=s;if(sA.includes((i=o.tagName)==null?void 0:i.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;xe(s)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}const ux=10,oA=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function W0(n){let{deltaY:e,deltaX:t}=n,r=0;return n.ctrlKey||n.altKey||n.metaKey?r=(Math.abs(e)>ux?ux*Math.sign(e):e)/100:n.shiftKey&&!oA&&(t=e,e=0),{x:-t,y:-e,z:-r}}const aA=fE([gE,mE]);let ni;const cA=n=>ni===void 0?(ni=n,!1):n-ni>120&&n-ni<160?(ni=n,!0):(ni=n,!1);function lA(n){const e=z(),t=_.useMemo(()=>{let r="not sure";const s=({event:m})=>{if(!e.getInstanceState().isFocused||(r="not sure",cA(Date.now())))return;const x=e.getEditingShapeId();if(x){const P=e.getShape(x);if(P&&e.getShapeUtil(P).canScroll(P)){const I=e.getShapePageBounds(x);if(I!=null&&I.containsPoint(e.inputs.currentPagePoint))return}}xe(m),ut(m);const b=W0(m);if(b.x===0&&b.y===0)return;const S={type:"wheel",name:"wheel",delta:b,point:new y(m.clientX,m.clientY),shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey,metaKey:m.metaKey,accelKey:Lt(m)};e.dispatch(S)};let i=1,o=1,a=1,c=0;const l=new y,u=new y,h=m=>{const x=n.current;r="not sure";const{event:b,origin:S,da:P}=m;b instanceof WheelEvent||(b.target===x||x!=null&&x.contains(b.target))&&(u.x=S[0],u.y=S[1],l.x=S[0],l.y=S[1],i=P[0],o=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:S[0],y:S[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Lt(b)}))},p=m=>{if(m&&(r="zooming"),r==="zooming")return;const x=Math.abs(c-i),b=y.Dist(l,u);switch(r){case"not sure":{x>24?r="zooming":b>16&&(r="panning");break}case"panning":{x>64&&(r="zooming");break}}};return{onWheel:s,onPinchStart:h,onPinchEnd:m=>{const x=n.current,{event:b,origin:S,offset:P}=m;if(b instanceof WheelEvent||!(b.target===x||x!=null&&x.contains(b.target)))return;const w=P[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:S[0],y:S[1],z:w},delta:{x:S[0],y:S[1]},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Lt(b)})})},onPinch:m=>{const x=n.current,{event:b,origin:S,offset:P,da:w}=m;if(b instanceof WheelEvent||!(b.target===x||x!=null&&x.contains(b.target)))return;const I=m.type==="gesturechange"||m.type==="gestureend";c=w[0];const E=S[0]-u.x,T=S[1]-u.y;switch(u.x=S[0],u.y=S[1],p(I),r){case"zooming":{a=P[0],e.dispatch({type:"pinch",name:"pinch",point:{x:S[0],y:S[1],z:a},delta:{x:E,y:T},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Lt(b)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:S[0],y:S[1],z:o},delta:{x:E,y:T},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:Lt(b)});break}}}}},[e,n]);aA(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const r=e.getBaseZoom(),s=e.getCameraOptions().zoomSteps,i=s[0]*r,o=s[s.length-1]*r;return{from:e.getZoomLevel(),max:o,min:i}}}})}function uh(n,e,t){const r=n.getShape(e),s=n.getShapeHandles(r);return{shape:r,handle:s.find(i=>i.id===t)}}function dA(n,e){const t=z();return _.useMemo(()=>{const r=c=>{if(c.isKilled)return;const l=Fc(c.currentTarget);Jo(l,c);const{shape:u,handle:h}=uh(t,n,e);h&&t.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_down",...Sn(c)})};let s,i;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===s&&c.clientY===i)return;s=c.clientX,i=c.clientY;const{shape:l,handle:u}=uh(t,n,e);u&&t.dispatch({type:"pointer",target:"handle",handle:u,shape:l,name:"pointer_move",...Sn(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=Fc(c.currentTarget);Qo(l,c);const{shape:u,handle:h}=uh(t,n,e);h&&t.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_up",...Sn(c)})}}},[t,n,e])}function uA(n){const e=z();_.useLayoutEffect(()=>{const t=Ub(()=>{n.current&&e.updateViewportScreenBounds(n.current)},200,{trailing:!0}),r=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const s=new ResizeObserver(a=>{a[0].contentRect&&t()}),i=n.current;let o=null;return i&&(s.observe(i),o=hA(i),o.addEventListener("scroll",t)),()=>{clearInterval(r),window.removeEventListener("resize",t),s.disconnect(),o==null||o.removeEventListener("scroll",t),t.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const hA=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};class V{constructor(e=0,t=0,r=0,s=0){v(this,"x",0);v(this,"y",0);v(this,"w",0);v(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=s}get point(){return new y(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new y(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new y(this.minX,this.minY),new y(this.maxX,this.minY),new y(this.maxX,this.maxY),new y(this.minX,this.maxY)]}get cornersAndCenter(){return[new y(this.minX,this.minY),new y(this.maxX,this.minY),new y(this.maxX,this.maxY),new y(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new y(this.w,this.h)}toFixed(){return this.x=wa(this.x),this.y=wa(this.y),this.w=wa(this.w),this.h=wa(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,s=0){return this.x=e,this.y=t,this.w=r,this.h=s,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),s=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=s-t,this.h=i-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:s}=this;return new V(e,t,r,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,s=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,s-t),this.height=Math.max(1,i-r)}collides(e){return V.Collides(this,e)}contains(e){return V.Contains(this,e)}includes(e){return V.Includes(this,e)}containsPoint(e,t=0){return V.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new y(this.minX,this.minY);case"top_right":return new y(this.maxX,this.minY);case"bottom_left":return new y(this.minX,this.maxY);case"bottom_right":return new y(this.maxX,this.maxY);case"top":return new y(this.midX,this.minY);case"right":return new y(this.maxX,this.midY);case"bottom":return new y(this.midX,this.maxY);case"left":return new y(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:s,minY:i,maxX:o,maxY:a}=this;let{minX:c,minY:l,maxX:u,maxY:h}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=t;break}case"right":case"top_right":case"bottom_right":{u+=t;break}}switch(e){case"top":case"top_left":case"top_right":{l+=r;break}case"bottom":case"bottom_left":case"bottom_right":{h+=r;break}}const p=(u-c)/(o-s),f=(h-l)/(a-i),g=p<0,m=f<0;if(g){const x=u;u=c,c=x}if(m){const x=h;h=l,l=x}this.minX=c,this.minY=l,this.width=Math.abs(u-c),this.height=Math.abs(h-l)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),s=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=s-t,this.height=i-r,this}static From(e){return new V(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new V(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new V;let t=1/0,r=1/0,s=-1/0,i=-1/0,o;for(let a=0,c=e.length;a<c;a++)o=e[a],t=Math.min(o.x,t),r=Math.min(o.y,r),s=Math.max(o.x,s),i=Math.max(o.y,i);return new V(t,r,s-t,i-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),s=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new V(r,s,i-r,o-s)}static ExpandBy(e,t){return new V(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return V.Collides(e,t)||V.Contains(e,t)}static ContainsPoint(e,t,r=0){return!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)}static Common(e){let t=1/0,r=1/0,s=-1/0,i=-1/0;for(let o=0;o<e.length;o++){const a=e[o];t=Math.min(t,a.minX),r=Math.min(r,a.minY),s=Math.max(s,a.maxX),i=Math.max(i,a.maxY)}return new V(t,r,s-t,i-r)}static Sides(e,t=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,t,r,s,i=!1){const{minX:o,minY:a,maxX:c,maxY:l}=e;let{minX:u,minY:h,maxX:p,maxY:f}=e;switch(t){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{p+=r;break}}switch(t){case"top":case"top_left":case"top_right":{h+=s;break}case"bottom":case"bottom_left":case"bottom_right":{f+=s;break}}const g=(p-u)/(c-o),m=(f-h)/(l-a),x=g<0,b=m<0;if(i){const P=(c-o)/(l-a),w=Math.abs(p-u),I=Math.abs(f-h),E=w*(m<0?1:-1)*(1/P),T=I*(g<0?1:-1)*P,C=P<w/I;switch(t){case"top_left":{C?h=f+E:u=p+T;break}case"top_right":{C?h=f+E:p=u-T;break}case"bottom_right":{C?f=h-E:p=u-T;break}case"bottom_left":{C?f=h-E:u=p+T;break}case"bottom":case"top":{const j=(u+p)/2,k=I*P;u=j-k/2,p=j+k/2;break}case"left":case"right":{const j=(h+f)/2,k=w/P;h=j-k/2,f=j+k/2;break}}}if(x){const P=p;p=u,u=P}if(b){const P=f;f=h,h=P}const S=new V(u,h,Math.abs(p-u),Math.abs(f-h));return{box:S,scaleX:+(S.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(S.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return V.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new V(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function pA(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function fA(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function gA(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}class W{constructor(e,t,r,s,i,o){v(this,"a",1);v(this,"b",0);v(this,"c",0);v(this,"d",1);v(this,"e",0);v(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=s,this.e=i,this.f=o}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:s,c:i,d:o,e:a,f:c}=this;return this.a=r*t.a+i*t.b,this.c=r*t.c+i*t.d,this.e=r*t.e+i*t.f+a,this.b=s*t.a+o*t.b,this.d=s*t.c+o*t.d,this.f=s*t.e+o*t.f+c,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(W.Rotate(e)):this.translate(t,r).multiply(W.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(W.Translate(e,t))}scale(e,t){return this.multiply(W.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:s,e:i,f:o}=this,a=e*s-t*r;return this.a=s/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(s*i-r*o)/-a,this.f=(t*i-e*o)/a,this}applyToPoint(e){return W.applyToPoint(this,e)}applyToPoints(e){return W.applyToPoints(this,e)}rotation(){return W.Rotation(this)}point(){return W.Point(this)}decomposed(){return W.Decompose(this)}toCssString(){return W.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return W.Decompose(this)}clone(){return new W(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new W(1,0,0,1,0,0)}static Translate(e,t){return new W(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return W.Identity();const s=Math.cos(e),i=Math.sin(e),o=new W(s,i,-i,s,0,0);return t===void 0?o:W.Compose(W.Translate(t,r),o,W.Translate(-t,-r))}static Scale(e,t,r,s){const i=new W(e,0,0,t,0,0);return r===void 0?i:W.Compose(W.Translate(r,s),i,W.Translate(-r,-s))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=W.Identity();for(let r=0,s=e.length;r<s;r++)t.multiply(e[r]);return t}static Point(e){return new y(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=Ke+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return Pp(t)}static Decompose(e){let t,r,s;if(e.a!==0||e.c!==0){const i=(e.a*e.a+e.c*e.c)**.5;t=i,r=(e.a*e.d-e.b*e.c)/i,s=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const i=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/i,r=i,s=Ke+Math.acos(e.b/i)*(e.d>0?-1:1)}else t=0,r=0,s=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:Pp(s)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${F(e.a)}, ${F(e.b)}, ${F(e.c)}, ${F(e.d)}, ${F(e.e)}, ${F(e.f)})`}static applyToPoint(e,t){return new y(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new y(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new V(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new W(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof W?e:W.From(e)}}class vs{constructor(e){v(this,"isFilled",!1);v(this,"isClosed",!0);v(this,"isLabel",!1);v(this,"debugColor");v(this,"ignore");v(this,"_vertices");v(this,"_bounds");v(this,"_area");v(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,r=!1){return this.isClosed&&(this.isFilled||r)&&wn(e,this.vertices)?!0:y.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&wn(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:r}=this;let s,i=1/0,o,a,c;for(let l=0;l<r.length;l++)a=r[l],c=y.NearestPointOnLineSegment(e,t,a,!0),o=y.Dist2(a,c),o<i&&(i=o,s=c);if(!s)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&wn(s,this.vertices)?-i:i}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){const{vertices:r}=this;let s,i=1/0,o,a,c;for(let l=0;l<r.length;l++)a=r[l],c=y.NearestPointOnLineSegment(e,t,a,!0),o=y.Dist2(a,c),o<i&&(i=o,s=c);if(!s)throw Error("nearest point not found");return s}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return V.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,s=e.length;r<s;r++){const i=e[r],o=e[(r+1)%s];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let s=1;s<r;s++)e+=`L${t[s].x},${t[s].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,r=e[0],s=0;for(let i=1;i<e.length;i++)t=e[i],s+=y.Dist2(r,t),r=t;return Math.sqrt(s)}}class Rn extends vs{constructor(t){super({...t,isClosed:!0,isFilled:!1});v(this,"children",[]);v(this,"ignoredChildren",[]);for(const r of t.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,s;const{children:i}=this;if(i.length===0)throw Error("no children");let o,a;for(const c of i)o=c.nearestPoint(t),a=y.Dist2(o,t),a<r&&(r=a,s=o);if(!s)throw Error("nearest point not found");return s}distanceToPoint(t,r=!1){return Math.min(...this.children.map((s,i)=>s.distanceToPoint(t,r||i>0)))}hitTestPoint(t,r,s){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestPoint(t,r,s))}hitTestLineSegment(t,r,s){return!!this.children.filter(i=>!i.isLabel).find(i=>i.hitTestLineSegment(t,r,s))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const s of this.children)t+=s.toSimpleSvgPath();const r=V.FromPoints(this.vertices).corners;for(let s=0,i=r.length;s<i;s++){const o=r[s],a=r[(s-1+i)%i],c=o.dist(a),l=r[(s+1)%i],u=o.dist(l),h=o.clone().lrp(a,4/c),p=o,f=o.clone().lrp(l,4/u);t+=`M${h.x},${h.y} L${p.x},${p.y} L${f.x},${f.y} `}return t}getLength(){return this.children.reduce((t,r)=>r.isLabel?t:t+r.length,0)}getSvgPathData(){return this.children.map((t,r)=>t.isLabel?"":t.getSvgPathData(r===0)).join(" ")}}function mA(n=!0){const[e,t]=_.useState(0),r=z();_.useEffect(()=>{if(!n)return;const s=()=>t(i=>i+1);return r.on("tick",s),()=>{r.off("tick",s)}},[r,n])}const yA=Et(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){const s=z();mA(r);const i=s.getZoomLevel(),o=s.getRenderingShapes(),{inputs:{currentPagePoint:a}}=s;return d.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(c=>{const l=s.getShape(c.id);if(l.type==="group")return null;const u=s.getShapeGeometry(l),h=s.getShapePageTransform(l),p=s.getPointInShapeSpace(l,a),f=u.nearestPoint(p),g=u.distanceToPoint(p,!0),m=Math.abs(g)*i,x=g<0,{vertices:b}=u;return d.jsxs("g",{transform:h.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&d.jsx("g",{stroke:u.debugColor??"red",opacity:"1",strokeWidth:2/i,fill:"none",children:d.jsx(Y0,{geometry:u})}),t&&b.map((S,P)=>d.jsx("circle",{cx:S.x,cy:S.y,r:2/i,fill:`hsl(${vi(P,[0,b.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/i},`v${P}`)),r&&m<150&&d.jsx("line",{x1:f.x,y1:f.y,x2:p.x,y2:p.y,opacity:1-m/150,stroke:x?"goldenrod":"dodgerblue",strokeWidth:2/i})]},c.id+"_outline")})})});function Y0({geometry:n}){return n instanceof Rn?d.jsx(d.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>d.jsx(Y0,{geometry:e},t))}):d.jsx("path",{d:n.toSimpleSvgPath()})}function V0(n){return rT(n)}function X0(){const n=z(),e=pj("userIds",()=>V0(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,r)=>{var s;return t.join(",")===((s=r.join)==null?void 0:s.call(r,","))}},[n]);return N(e)}function ul(n){const e=z();return N(`latestPresence:${n}`,()=>e.getCollaborators().find(r=>r.userId===n),[e,n])??null}const SA=Et(function(){return X0().map(t=>d.jsx(xA,{collaboratorId:t},t))}),xA=Et(function({collaboratorId:e}){const t=z(),r=ul(e),s=wA(t,r);if(!(r&&r.currentPageId===t.getCurrentPageId()))return null;switch(s){case"inactive":{const{followingUserId:i,highlightedUserIds:o}=t.getInstanceState();if(!(i===r.userId||o.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:i}=t.getInstanceState();if(r.followingUserId===t.user.getId()&&!(r.chatMessage||i.includes(r.userId)))return null;break}}return d.jsx(bA,{latestPresence:r})}),bA=Et(function({latestPresence:e}){const t=z(),{CollaboratorBrush:r,CollaboratorScribble:s,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:a}=Xe(),c=t.getZoomLevel(),l=t.getViewportPageBounds(),{userId:u,chatMessage:h,brush:p,scribbles:f,selectedShapeIds:g,userName:m,cursor:x,color:b}=e,S=!(x.x<l.minX-12/c||x.y<l.minY-16/c||x.x>l.maxX-12/c||x.y>l.maxY-16/c);return d.jsxs(d.Fragment,{children:[p&&r?d.jsx(r,{className:"tl-collaborator__brush",brush:p,color:b,opacity:.1},u+"_brush"):null,S&&i?d.jsx(i,{className:"tl-collaborator__cursor",point:x,color:b,zoom:c,name:m!=="New User"?m:null,chatMessage:h},u+"_cursor"):o?d.jsx(o,{className:"tl-collaborator__cursor-hint",point:x,color:b,zoom:c,viewport:l},u+"_cursor_hint"):null,s&&f.length?d.jsx(d.Fragment,{children:f.map(P=>d.jsx(s,{className:"tl-collaborator__scribble",scribble:P,color:b,zoom:c,opacity:P.color==="laser"?.5:.1},u+"_scribble_"+P.id))}):null,a&&g.filter(P=>!t.isShapeHidden(P)).map(P=>d.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:P,color:b,opacity:.5},u+"_"+P))]})});function hx(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function wA(n,e){const t=_.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,s]=_.useState(()=>hx(n,Date.now()-t.current));return _.useEffect(()=>{const i=n.timers.setInterval(()=>{s(hx(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(i)},[n]),e&&(t.current=e.lastActivityTimestamp),r}function vA(){const n=z(),e=N("is menu open",()=>n.menus.hasAnyOpenMenus(),[n]),[t,r]=_.useState(!1),s=e||t,i=sg(),o=_.useRef({isDown:!1,isDragging:!1,start:new y}),a=_.useCallback(u=>{u.button===0&&(r(!0),o.current={isDown:!0,isDragging:!1,start:new y(u.clientX,u.clientY)}),n.menus.clearOpenMenus()},[n]),c=_.useCallback(u=>{var h,p,f;if(o.current.isDown){if(o.current.isDragging){(h=i.onPointerMove)==null||h.call(i,u);return}if(y.Dist2(o.current.start,new y(u.clientX,u.clientY))>n.options.dragDistanceSquared){o.current={...o.current,isDown:!0,isDragging:!0};const{x:g,y:m}=o.current.start;(p=i.onPointerDown)==null||p.call(i,{...u,clientX:g,clientY:m,button:0}),(f=i.onPointerMove)==null||f.call(i,u)}}},[i,n]),l=_.useCallback(u=>{var h;(h=i.onPointerUp)==null||h.call(i,u),r(!1),o.current={isDown:!1,isDragging:!1,start:new y(u.clientX,u.clientY)}},[i]);return s&&d.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...i,onPointerDown:a,onPointerMove:c,onPointerUp:l})}const Z0=_.memo(function({id:e,shape:t,util:r,index:s,backgroundIndex:i,opacity:o}){const a=z(),{ShapeErrorFallback:c}=Xe(),l=_.useRef(null),u=_.useRef(null),h=_.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});ps("set shape stuff",()=>{const g=a.getShape(e);if(!g)return;const m=h.current,x=a.getShapeClipPath(e)??"none";x!==m.clipPath&&(At(l.current,"clip-path",x),At(u.current,"clip-path",x),m.clipPath=x);const b=a.getShapePageTransform(e),S=W.toCssString(b),P=a.getShapeGeometry(g).bounds;S!==m.transform&&(At(l.current,"transform",S),At(u.current,"transform",S),m.transform=S);const w=Math.max(P.width,1),I=Math.max(P.height,1);(w!==m.width||I!==m.height)&&(At(l.current,"width",w+"px"),At(l.current,"height",I+"px"),At(u.current,"width",w+"px"),At(u.current,"height",I+"px"),m.width=w,m.height=I)},[a]),ps("set opacity and z-index",()=>{const g=l.current,m=u.current;At(g,"opacity",o),At(m,"opacity",o),At(g,"z-index",s),At(m,"z-index",i)},[o,s,i]),ps("set display",()=>{if(!a.getShape(e))return;const x=a.getCulledShapes().has(e);x!==h.current.isCulled&&(At(l.current,"display",x?"none":"block"),At(u.current,"display",x?"none":"block"),h.current.isCulled=x)},[a]);const p=_.useCallback(g=>a.annotateError(g,{origin:"shape",willCrashApp:!1}),[a]);if(!t)return null;const f="fill"in t.props&&t.props.fill!=="none";return d.jsxs(d.Fragment,{children:[r.backgroundComponent&&d.jsx("div",{ref:u,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:d.jsx(No,{fallback:c,onError:p,children:d.jsx(Q0,{shape:t,util:r})})}),d.jsx("div",{ref:l,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":f,"data-shape-id":t.id,draggable:!1,children:d.jsx(No,{fallback:c,onError:p,children:d.jsx(J0,{shape:t,util:r})})})]})}),J0=_.memo(function({shape:e,util:t}){return sl("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),Q0=_.memo(function({shape:e,util:t}){return sl("InnerShape:"+e.type,()=>{var r;return(r=t.backgroundComponent)==null?void 0:r.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function PA({className:n}){const e=z(),{Background:t,SvgDefs:r,ShapeIndicators:s}=Xe(),i=_.useRef(null),o=_.useRef(null),a=_.useRef(null),c=ft();uA(i),nA(),tA(),lA(i),iA(i);const l=_.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});ps("position layers",function(){const{x:S,y:P,z:w}=e.getCamera();if(l.current.allowTextOutline&&Be.isSafari&&(c.style.setProperty("--tl-text-outline","none"),l.current.allowTextOutline=!1),l.current.allowTextOutline&&w<e.options.textShadowLod!==l.current.lodDisableTextOutline){const T=w<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",T?"none":"var(--tl-text-outline-reference)"),l.current.lodDisableTextOutline=T}const I=w>=1?vi(w,[1,8],[.125,.5],!0):vi(w,[.1,1],[-2,.125],!0),E=`scale(${F(w)}) translate(${F(S+I)}px,${F(P+I)}px)`;At(o.current,"transform",E),At(a.current,"transform",E)},[e,c]);const u=sg(),h=N("shapeSvgDefs",()=>{const b=new Map;for(const S of nt(e.shapeUtils)){if(!S)return;const P=S.getCanvasSvgDefs();for(const{key:w,component:I}of P)b.has(w)||b.set(w,d.jsx(I,{},w))}return[...b.values()]},[e]),p=N("debug_shapes",()=>ct.hideShapes.get(),[ct]),f=N("debug_svg",()=>ct.debugSvg.get(),[ct]),g=N("debug_geometry",()=>ct.debugGeometry.get(),[ct]),m=N("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),x=N("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return d.jsxs(d.Fragment,{children:[d.jsxs("div",{ref:i,draggable:!1,"data-iseditinganything":m,"data-isselectinganything":x,className:se("tl-canvas",n),"data-testid":"canvas",...u,children:[d.jsx("svg",{className:"tl-svg-context",children:d.jsxs("defs",{children:[h,d.jsx(FA,{}),d.jsx($A,{}),r&&d.jsx(r,{})]})}),t&&d.jsx("div",{className:"tl-background__wrapper",children:d.jsx(t,{})}),d.jsx(CA,{}),d.jsxs("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[d.jsx(UA,{}),d.jsx(BA,{}),p?null:f?d.jsx(DA,{}):d.jsx(RA,{})]}),d.jsx("div",{className:"tl-overlays",children:d.jsxs("div",{ref:a,className:"tl-html-layer",children:[g?d.jsx(yA,{}):null,d.jsx(jA,{}),d.jsx(EA,{}),d.jsx(_A,{}),d.jsx(TA,{}),s&&d.jsx(s,{}),d.jsx(LA,{}),d.jsx(kA,{}),d.jsx(NA,{}),d.jsx(SA,{})]})}),d.jsx(HA,{})]}),d.jsx(vA,{}),d.jsx(IA,{})]})}function IA(){const{InFrontOfTheCanvas:n}=Xe();return n?d.jsx(n,{}):null}function CA(){const n=z(),e=N("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:s}=N("camera",()=>n.getCamera(),[n]),i=N("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:o}=Xe();return o&&i?d.jsx(o,{x:t,y:r,z:s,size:e}):null}function _A(){const n=z(),e=N("scribbles",()=>n.getInstanceState().scribbles,[n]),t=N("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=Xe();return r&&e.length?e.map(s=>d.jsx(r,{className:"tl-user-scribble",scribble:s,zoom:t},s.id)):null}function EA(){const n=z(),e=N("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=Xe();return t&&e?d.jsx(t,{className:"tl-user-brush",brush:e}):null}function TA(){const n=z(),e=N("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=Xe();return t&&e?d.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function kA(){const n=z(),e=N("snapLines",()=>n.snaps.getIndicators(),[n]),t=N("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:r}=Xe();return r&&e.length>0?e.map(s=>d.jsx(r,{className:"tl-user-snapline",line:s,zoom:t},s.id)):null}function jA(){const n=z(),e=N("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:r}=n.getInstanceState();if(t||r)return!1;const s=n.getOnlySelectedShape();return!s||!n.getShapeHandles(s)?!1:s.id},[n]);return e?d.jsx(MA,{shapeId:e}):null}function MA({shapeId:n}){const e=z(),{Handles:t}=Xe(),r=N("zoomLevel",()=>e.getZoomLevel(),[e]),s=N("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=N("handles transform",()=>e.getShapePageTransform(n),[e,n]),o=N("handles",()=>{const c=e.getShapeHandles(n);if(!c)return null;const l=(s?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return c.filter(u=>u.type!=="virtual"||!c.some(h=>h!==u&&h.type==="vertex"&&y.Dist(u,h)<l)).sort(u=>u.type==="vertex"?1:-1)},[e,r,s,n]),a=N("isHidden",()=>e.isShapeHidden(n),[e,n]);return!t||!o||!i||a?null:d.jsx(t,{children:d.jsx("g",{transform:W.toCssString(i),children:o.map(c=>d.jsx(AA,{shapeId:n,handle:c,zoom:r,isCoarse:s},c.id))})})}function AA({shapeId:n,handle:e,zoom:t,isCoarse:r}){const s=dA(n,e.id),{Handle:i}=Xe();return i?d.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...s,children:d.jsx(i,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function DA(){const n=z();return N("rendering shapes",()=>n.getRenderingShapes(),[n]).map(t=>d.jsxs(_.Fragment,{children:[d.jsx(Z0,{...t}),d.jsx(zA,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function OA(){const n=z(),e=_.useRef(new Set);return ps("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(s=>e.current.has(s)))return;e.current=t;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[n]),null}function RA(){const n=z(),e=N("rendering shapes",()=>n.getRenderingShapes(),[n]);return d.jsxs(d.Fragment,{children:[e.map(t=>d.jsx(Z0,{...t},t.id+"_shape")),Be.isSafari&&d.jsx(OA,{})]})}function LA(){const n=z(),{ShapeIndicator:e}=Xe(),t=N("hinting shape ids",()=>yf(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(r=>d.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function FA(){return d.jsxs("g",{id:Yn("cursor"),children:[d.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[d.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),d.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),d.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[d.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),d.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),d.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[d.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),d.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function $A(){const n=Yn("cursor_hint");return d.jsx("path",{id:n,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function zA({id:n,mode:e}){const t=z(),[r,s]=_.useState(null),i=N("is in root",()=>{const o=t.getShape(n);return(o==null?void 0:o.parentId)===t.getCurrentPageId()},[t,n]);return _.useEffect(()=>{if(!i)return;let o=null;const a=ur("shape to svg",async()=>{const c=Math.random();o=c;const u=t.isShapeOfType(n,"frame")?0:10;let h=t.getShapePageBounds(n);if(!h)return;h=h.clone().expandBy(u);const p=await t.getSvgString([n],{padding:u,background:t.getInstanceState().exportBackground});if(o!==c||!p)return;const f=`data:image/svg+xml;utf8,${encodeURIComponent(p.svg)}`;s({src:f,bounds:h})});return()=>{o=null,a()}},[t,n,i]),!i||!r?null:e==="iframe"?d.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):d.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function NA(){const n=z(),e=N("selection rotation",()=>n.getSelectionRotation(),[n]),t=N("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=Xe();return!t||!r?null:d.jsx(r,{bounds:t,rotation:e})}function BA(){const n=z(),e=N("selection rotation",()=>n.getSelectionRotation(),[n]),t=N("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=Xe();return!t||!r?null:d.jsx(r,{bounds:t,rotation:e})}function UA(){const{OnTheCanvas:n}=Xe();return n?d.jsx(n,{}):null}function HA(){const n=z(),e=N("camera state",()=>n.getCameraState(),[n]);return d.jsx("div",{className:se("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function KA({className:n,zoom:e,point:t,color:r,viewport:s,opacity:i=1}){const o=_.useRef(null);Fi(o,wt(t.x,s.minX+5/e,s.maxX-5/e),wt(t.y,s.minY+5/e,s.maxY-5/e),1/e,y.Angle(s.center,t));const a=Yn("cursor_hint");return d.jsxs("svg",{ref:o,className:se("tl-overlays__item",n),children:[d.jsx("use",{href:`#${a}`,color:r,strokeWidth:3,stroke:"var(--color-background)"}),d.jsx("use",{href:`#${a}`,color:r,opacity:i})]})}const px=_.memo(function({className:e,zoom:t,point:r,color:s,name:i,chatMessage:o}){const a=_.useRef(null);Fi(a,r==null?void 0:r.x,r==null?void 0:r.y,1/t);const c=Yn("cursor");return r?d.jsxs("div",{ref:a,className:se("tl-overlays__item",e),children:[d.jsx("svg",{className:"tl-cursor",children:d.jsx("use",{href:`#${c}`,color:s})}),o?d.jsxs(d.Fragment,{children:[i&&d.jsx("div",{className:"tl-nametag-title",style:{color:s},children:i}),d.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:s},children:o})]}):i&&d.jsx("div",{className:"tl-nametag",style:{backgroundColor:s},children:i})]}):null});function qA({x:n,y:e,z:t,size:r}){const s=Li("grid"),i=z(),{gridSteps:o}=i.options;return d.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[d.jsx("defs",{children:o.map(({min:a,mid:c,step:l},u)=>{const h=l*r*t,p=.5+n*t,f=.5+e*t,g=p>0?p%h:h+p%h,m=f>0?f%h:h+f%h,x=t<c?vi(t,[a,c],[0,1]):1;return d.jsx("pattern",{id:Qf(s,`${l}`),width:h,height:h,patternUnits:"userSpaceOnUse",children:d.jsx("circle",{className:"tl-grid-dot",cx:g,cy:m,r:1,opacity:x})},u)})}),o.map(({step:a},c)=>d.jsx("rect",{width:"100%",height:"100%",fill:`url(#${s}_${a})`},c))]})}function GA({handle:n,isCoarse:e,className:t,zoom:r}){const s=z(),i=(e?s.options.coarseHandleRadius:s.options.handleRadius)/r;if(n.type==="clone"){const a=3/r,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,l=VM.indexOf(n.id);return d.jsxs("g",{className:se(`tl-handle tl-handle__${n.type}`,t),children:[d.jsx("circle",{className:"tl-handle__bg",r:i}),d.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*l})`})]})}const o=(n.type==="create"&&e?3:4)/Math.max(r,.25);return d.jsxs("g",{className:se(`tl-handle tl-handle__${n.type}`,t),children:[d.jsx("circle",{className:"tl-handle__bg",r:i}),d.jsx("circle",{className:"tl-handle__fg",r:o})]})}const WA=({children:n})=>d.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),YA=()=>{const{Spinner:n}=Xe();return d.jsx(Pg,{children:n?d.jsx(n,{}):null})};function ig(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],s=n[1];if(t===2)return`M${ke(r)}L${ke(s)}`;let i="";for(let o=2,a=t-1;o<a;o++)r=n[o],s=n[o+1],i+=nn(r,s);return e?`M${nn(n[0],n[1])}Q${ke(n[1])}${nn(n[1],n[2])}T${i}${nn(n[t-1],n[0])}${nn(n[0],n[1])}Z`:`M${ke(n[0])}Q${ke(n[1])}${nn(n[1],n[2])}${n.length>3?"T":""}${i}L${ke(n[t-1])}`}function fx({scribble:n,zoom:e,color:t,opacity:r,className:s}){return n.points.length?d.jsx("svg",{className:s&&se("tl-overlays__item",s),children:d.jsx("path",{className:"tl-scribble",d:ig(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null}function ev({bounds:n,rotation:e}){const t=_.useRef(null);return Fi(t,n.x,n.y,1,e),_.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=F(Math.max(1,n.width))+"px",r.style.height=F(Math.max(1,n.height))+"px")},[n.width,n.height]),d.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function VA({bounds:n,rotation:e}){const t=z(),r=_.useRef(null),s=N("only selected shape",()=>t.getOnlySelectedShape(),[t]),i=s?t.getShapeUtil(s).expandSelectionOutlinePx(s):0;return Fi(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-i,y:-i}),n=n.clone().expandBy(i).zeroFix(),d.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:d.jsx("rect",{className:se("tl-selection__fg__outline"),width:F(n.width),height:F(n.height)})})}const XA=()=>d.jsx("div",{className:"tl-shape-error-boundary"}),ZA=({shape:n,util:e})=>sl("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),JA=({editor:n,id:e})=>{const t=N("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:r}=Xe();return!t||t.isLocked?null:d.jsx(No,{fallback:r,onError:s=>n.annotateError(s,{origin:"react.shapeIndicator",willCrashApp:!1}),children:d.jsx(ZA,{shape:t,util:n.getShapeUtil(t)},t.id)})},gx=_.memo(function({shapeId:e,className:t,color:r,hidden:s,opacity:i}){const o=z(),a=_.useRef(null);return ps("indicator transform",()=>{const c=a.current;if(!c)return;const l=o.getShapePageTransform(e);l&&c.style.setProperty("transform",l.toCssString())},[o,e]),_.useLayoutEffect(()=>{const c=a.current;c&&c.style.setProperty("display",s?"none":"block")},[s]),d.jsx("svg",{ref:a,className:se("tl-overlays__item",t),children:d.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:i,children:d.jsx(JA,{editor:o,id:e})})})}),QA=()=>d.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),tv=_.memo(function(){const e=z(),t=_.useRef(new Set),r=N("should display selected ids",()=>{const o=t.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const l of c)a.add(l);if(e.isInAny("select.idle","select.editing_shape")){const l=e.getInstanceState();if(l.isHoveringCanvas&&!l.isCoarsePointer){const u=e.getHoveredShapeId();u&&a.add(u)}}}if(o.size!==a.size)return t.current=a,a;for(const c of a)if(!o.has(c))return t.current=a,a;return o},[e]),s=N("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:i}=Xe();return i?s.map(({id:o})=>d.jsx(i,{shapeId:o,hidden:!r.has(o)},o+"_indicator")):null});function eD({points:n,zoom:e}){const t=2.5/e,r=n.reduce((p,f)=>Math.min(p,f.x),1/0),s=n.reduce((p,f)=>Math.max(p,f.x),-1/0),i=n.reduce((p,f)=>Math.min(p,f.y),1/0),o=n.reduce((p,f)=>Math.max(p,f.y),-1/0),a=n.some(p=>p.x===r&&p.y===i);let c,l,u,h;return a?(c=r,l=i,u=s,h=o):(c=r,l=o,u=s,h=i),d.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[d.jsx("line",{x1:c,y1:l,x2:u,y2:h}),n.map((p,f)=>d.jsx("g",{transform:`translate(${p.x},${p.y})`,children:d.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},f))]})}function tD({gaps:n,direction:e,zoom:t}){const r=3.5/t;let s=[-1/0,1/0],i=null;const o=e==="horizontal";for(const c of n){if(i=Bn(s[0],s[1],o?c.startEdge[0].y:c.startEdge[0].x,o?c.startEdge[1].y:c.startEdge[1].x),i)s=i;else continue;if(i=Bn(s[0],s[1],o?c.endEdge[0].y:c.endEdge[0].x,o?c.endEdge[1].y:c.endEdge[1].x),i)s=i;else continue}if(s===null)return null;const a=(s[0]+s[1])/2;return d.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:c,endEdge:l},u)=>d.jsx(_.Fragment,{children:o?d.jsxs(d.Fragment,{children:[d.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),d.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),d.jsx("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),d.jsx("line",{x1:(c[0].x+l[0].x)/2,y1:a-r,x2:(c[0].x+l[0].x)/2,y2:a+r})]}):d.jsxs(d.Fragment,{children:[d.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),d.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),d.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),d.jsx("line",{x1:a-r,y1:(c[0].y+l[0].y)/2,x2:a+r,y2:(c[0].y+l[0].y)/2})]})},u))})}function nD({className:n,line:e,zoom:t}){return d.jsx("svg",{className:se("tl-overlays__item",n),children:e.type==="points"?d.jsx(eD,{...e,zoom:t}):e.type==="gaps"?d.jsx(tD,{...e,zoom:t}):null})}function og(){return d.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:d.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[d.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),d.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:d.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const rD=()=>null;function nv(n,e){const t=_.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}const sD=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:oT(n,e));function cs(n){return nv(n,sD)}const iD=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:Yb(n,e));function $i(n){return nv(n,iD)}const rv=_.createContext(null);function oD({overrides:n={},children:e}){const t=$i(n),r=_.useMemo(()=>({Background:UM,SvgDefs:rD,Brush:ah,ZoomBrush:ah,CollaboratorBrush:ah,Cursor:px,CollaboratorCursor:px,CollaboratorHint:KA,CollaboratorShapeIndicator:gx,Grid:qA,Scribble:fx,SnapIndicator:nD,Handles:WA,Handle:GA,CollaboratorScribble:fx,ErrorFallback:iv,ShapeErrorFallback:XA,ShapeIndicatorErrorFallback:QA,Spinner:og,SelectionBackground:ev,SelectionForeground:VA,ShapeIndicators:tv,ShapeIndicator:gx,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:PA,LoadingScreen:YA,...t}),[t]);return d.jsx(rv.Provider,{value:r,children:e})}function Xe(){const n=_.useContext(rv);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const hl={openWindow(n,e){window.open(n,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function sv(){hl.hardReset()}function aD(){hl.refreshPage()}const cD="https://github.com/tldraw/tldraw/issues/new",iv=({error:n,editor:e})=>{const t=_.useRef(null),[r,s]=_.useState(!1),[i,o]=_.useState(!1),[a,c]=_.useState(!1);let l=null;try{l=Xe().Canvas??null}catch{}const u=n instanceof Error?n.message:String(n),h=n instanceof Error?n.stack:null,p=N("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[f,g]=_.useState(null);_.useLayoutEffect(()=>{var I;p!==null&&g(p);let P=(I=t.current)==null?void 0:I.parentElement,w=!1;for(;P;){if(P.classList.contains("tl-theme__dark")||P.classList.contains("tl-theme__light")){w=!0;break}P=P.parentElement}if(w){g(null);return}typeof window<"u"&&"matchMedia"in window&&g(window.matchMedia("(prefers-color-scheme: dark)").matches)},[p]),_.useEffect(()=>{if(i){const P=e==null?void 0:e.timers.setTimeout(()=>{o(!1)},2e3);return()=>clearTimeout(P)}},[i,e]);const m=()=>{const P=document.createElement("textarea");P.value=h??u,document.body.appendChild(P),P.select(),document.execCommand("copy"),P.remove(),o(!0)},x=()=>{aD()},b=async()=>{sv()},S=new URL(cD);return S.searchParams.set("title",u),S.searchParams.set("labels","bug"),S.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${h??u}
\`\`\`

My browser: ${navigator.userAgent}`),d.jsxs("div",{ref:t,className:se("tl-container tl-error-boundary",f===null?"":f?"tl-theme__dark":"tl-theme__light"),children:[d.jsx("div",{className:"tl-error-boundary__overlay"}),e&&d.jsx(Jf,{onError:Oo,fallback:()=>null,children:d.jsx(tg,{editor:e,children:d.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:l?d.jsx(l,{}):null})})}),d.jsx("div",{className:se("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?d.jsxs(d.Fragment,{children:[d.jsx("h2",{children:"Are you sure?"}),d.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),d.jsxs("div",{className:"tl-error-boundary__content__actions",children:[d.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),d.jsx("button",{className:"tl-error-boundary__reset",onClick:b,children:"Reset data"})]})]}):d.jsxs(d.Fragment,{children:[d.jsx("h2",{children:"Something went wrong"}),d.jsx("p",{children:"Please refresh the page to continue."}),d.jsxs("p",{children:["If you keep seeing this screen, you can create a"," ",d.jsx("a",{href:S.toString(),children:"GitHub issue"})," or ask for help on"," ",d.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),r&&d.jsxs(d.Fragment,{children:["Message:",d.jsx("h4",{children:d.jsx("code",{children:u})}),"Stack trace:",d.jsxs("div",{className:"tl-error-boundary__content__error",children:[d.jsx("pre",{children:d.jsx("code",{children:h??u})}),d.jsx("button",{onClick:m,children:i?"Copied!":"Copy"})]})]}),d.jsxs("div",{className:"tl-error-boundary__content__actions",children:[d.jsx("button",{onClick:()=>s(!r),children:r?"Hide details":"Show details"}),d.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[d.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),d.jsx("button",{className:"tl-error-boundary__refresh",onClick:x,children:"Refresh Page"})]})]})]})})]})},ov="TLDRAW_USER_DATA_v3",av=ve({id:ge,name:ge.nullable().optional(),color:ge.nullable().optional(),locale:ge.nullable().optional(),animationSpeed:ue.nullable().optional(),edgeScrollSpeed:ue.nullable().optional(),colorScheme:cl("light","dark","system").optional(),isSnapMode:be.nullable().optional(),isWrapMode:be.nullable().optional(),isDynamicSizeMode:be.nullable().optional(),isPasteAtCursorMode:be.nullable().optional()}),Dr={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},ag=Math.max(...Object.values(Dr));function lD(n){n.version<Dr.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<Dr.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<Dr.MakeFieldsNullable,n.version<Dr.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<Dr.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<Dr.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<Dr.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<Dr.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=ag}const Cp=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function cv(){return Cp[Math.floor(Math.random()*Cp.length)]}function dD(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const sr=Object.freeze({name:"New User",locale:RM(),color:cv(),edgeScrollSpeed:1,animationSpeed:dD()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function hh(){return{id:Fe(),color:cv()}}function lv(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return hh();const e=Ve(n);lD(e);try{return av.validate(e.user)}catch{return hh()}}function uD(){const n=JSON.parse(Cf(ov)||"null")??null;return lv(n)}const pl=ht("globalUserData",null);function hD(){_f(ov,JSON.stringify({version:ag,user:pl.get()}))}function dv(n){av.validate(n),pl.set(n),hD(),pD()}const Si=typeof BroadcastChannel<"u"?new BroadcastChannel("tldraw-user-sync"):null;Si==null||Si.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===hv&&(e==null?void 0:e.origin)!==uv()&&pl.set(lv(e.data))});let ph=null;function uv(){return ph===null&&(ph=Fe()),ph}const hv="tldraw-user-preferences-change";function pD(){Si==null||Si.postMessage({type:hv,origin:uv(),data:{user:pv(),version:ag}})}function pv(){let n=pl.get();return n||(n=uD(),dv(n)),n}const fD=K("defaultLocalStorageUserPrefs",()=>pv());function fv(n={}){return{userPreferences:n.userPreferences??fD,setUserPreferences:n.setUserPreferences??dv}}var fh={exports:{}},mx;function gD(){return mx||(mx=1,(function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function i(c,l,u,h,p){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,h||c,p),g=t?t+l:l;return c._events[g]?c._events[g].fn?c._events[g]=[c._events[g],f]:c._events[g].push(f):(c._events[g]=f,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,h;if(this._eventsCount===0)return l;for(h in u=this._events)e.call(u,h)&&l.push(t?h.slice(1):h);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,h=this._events[u];if(!h)return[];if(h.fn)return[h.fn];for(var p=0,f=h.length,g=new Array(f);p<f;p++)g[p]=h[p].fn;return g},a.prototype.listenerCount=function(l){var u=t?t+l:l,h=this._events[u];return h?h.fn?1:h.length:0},a.prototype.emit=function(l,u,h,p,f,g){var m=t?t+l:l;if(!this._events[m])return!1;var x=this._events[m],b=arguments.length,S,P;if(x.fn){switch(x.once&&this.removeListener(l,x.fn,void 0,!0),b){case 1:return x.fn.call(x.context),!0;case 2:return x.fn.call(x.context,u),!0;case 3:return x.fn.call(x.context,u,h),!0;case 4:return x.fn.call(x.context,u,h,p),!0;case 5:return x.fn.call(x.context,u,h,p,f),!0;case 6:return x.fn.call(x.context,u,h,p,f,g),!0}for(P=1,S=new Array(b-1);P<b;P++)S[P-1]=arguments[P];x.fn.apply(x.context,S)}else{var w=x.length,I;for(P=0;P<w;P++)switch(x[P].once&&this.removeListener(l,x[P].fn,void 0,!0),b){case 1:x[P].fn.call(x[P].context);break;case 2:x[P].fn.call(x[P].context,u);break;case 3:x[P].fn.call(x[P].context,u,h);break;case 4:x[P].fn.call(x[P].context,u,h,p);break;default:if(!S)for(I=1,S=new Array(b-1);I<b;I++)S[I-1]=arguments[I];x[P].fn.apply(x[P].context,S)}}return!0},a.prototype.on=function(l,u,h){return i(this,l,u,h,!1)},a.prototype.once=function(l,u,h){return i(this,l,u,h,!0)},a.prototype.removeListener=function(l,u,h,p){var f=t?t+l:l;if(!this._events[f])return this;if(!u)return o(this,f),this;var g=this._events[f];if(g.fn)g.fn===u&&(!p||g.once)&&(!h||g.context===h)&&o(this,f);else{for(var m=0,x=[],b=g.length;m<b;m++)(g[m].fn!==u||p&&!g[m].once||h&&g[m].context!==h)&&x.push(g[m]);x.length?this._events[f]=x.length===1?x[0]:x:o(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a})(fh)),fh.exports}var mD=gD();const yD=ki(mD),xi="TLDRAW_TAB_ID_v2",Nr=globalThis.window;function SD(){return Nr?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Nr.navigator.platform)||Be.isDarwin&&"ontouchend"in document:!1}const $c=Nr?Nr[xi]??aw(xi)??"TLDRAW_INSTANCE_STATE_V1_"+Fe():"<error>";Nr&&(Nr[xi]=$c,SD()?Ef(xi,$c):cw(xi));Nr==null||Nr.addEventListener("beforeunload",()=>{Ef(xi,$c)});const gv={Initial:0},fl=Math.max(...Object.values(gv));function xD(n){n.version<gv.Initial,n.version=fl}const mv=ve({version:ue,currentPageId:$o.optional(),isFocusMode:be.optional(),exportBackground:be.optional(),isDebugMode:be.optional(),isToolLocked:be.optional(),isGridMode:be.optional(),pageStates:Ct(ve({pageId:$o,camera:ve({x:ue,y:ue,z:ue}).optional(),selectedShapeIds:Ct(An).optional(),focusedGroupId:An.nullable().optional()})).optional()});function bD(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==fl&&(n=Ve(n),xD(n));try{return mv.validate(n)}catch(e){return console.warn(e),null}}function cg(n){const e=n.query.ids("page");return K("sessionStateSnapshot",()=>{const t=n.get(Kt);if(!t)return null;const r=[...e.get()];return{version:fl,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(s=>{const i=n.get(qn.createId(s)),o=n.get(cr.createId(s));return{pageId:s,camera:{x:(o==null?void 0:o.x)??0,y:(o==null?void 0:o.y)??0,z:(o==null?void 0:o.z)??1},selectedShapeIds:(i==null?void 0:i.selectedShapeIds)??[],focusedGroupId:(i==null?void 0:i.focusedGroupId)??null}})}},{isEqual:Zw})}function _p(n,e,t){const r=bD(e);if(!r)return;const s=p0(n.get(Kt)),i=t!=null&&t.forceOverwrite?r:s,o=t!=null&&t.forceOverwrite?s:r,a=n.schema.types.instance.create({id:Kt,...s,currentPageId:r.currentPageId,isDebugMode:(i==null?void 0:i.isDebugMode)??(o==null?void 0:o.isDebugMode),isFocusMode:(i==null?void 0:i.isFocusMode)??(o==null?void 0:o.isFocusMode),isToolLocked:(i==null?void 0:i.isToolLocked)??(o==null?void 0:o.isToolLocked),isGridMode:(i==null?void 0:i.isGridMode)??(o==null?void 0:o.isGridMode),exportBackground:(i==null?void 0:i.exportBackground)??(o==null?void 0:o.exportBackground)});n.atomic(()=>{var c,l,u;for(const h of r.pageStates??[]){if(!n.has(h.pageId))continue;const p=cr.createId(h.pageId),f=qn.createId(h.pageId),g=n.get(p),m=n.get(f);n.put([cr.create({id:p,x:((c=h.camera)==null?void 0:c.x)??(g==null?void 0:g.x),y:((l=h.camera)==null?void 0:l.y)??(g==null?void 0:g.y),z:((u=h.camera)==null?void 0:u.z)??(g==null?void 0:g.z)}),qn.create({id:f,pageId:h.pageId,selectedShapeIds:h.selectedShapeIds??(m==null?void 0:m.selectedShapeIds),focusedGroupId:h.focusedGroupId??(m==null?void 0:m.focusedGroupId)})])}n.put([a]),n.ensureStoreIsUsable()})}function wD(n){var s;const e=[];for(const i of Object.values(n))(s=i.typeName)!=null&&s.match(/^(instance.*|pointer|camera)$/)&&e.push(i);const t=e.filter(i=>i.typeName==="instance"&&i.id!==Kt)[0];if(!t)return null;const r={version:fl,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(i=>i.typeName==="instance_page_state"&&i.instanceId===t.id).map(i=>{const o=n[i.cameraId]??{x:0,y:0,z:1};return{pageId:i.pageId,camera:{x:o.x,y:o.y,z:o.z},selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId}})};try{return mv.validate(r),r}catch{return null}}function yv(n,e,t){let r={};if("store"in e){const o=n.schema.migrateStoreSnapshot(e);if(o.type!=="success")throw new Error("Failed to migrate store snapshot: "+o.reason);r.document={schema:n.schema.serialize(),store:Co(o.value,(a,{typeName:c})=>n.scopedTypes.document.has(c))}}else r=e;const s=p0(n.get(Kt)),i=Sv.get(n,cg).get();n.atomic(()=>{r.document&&n.loadStoreSnapshot(r.document),s&&n.update(Kt,o=>({...o,...s})),i&&_p(n,i),r.session&&_p(n,r.session,{forceOverwrite:t==null?void 0:t.forceOverwriteSessionState})})}const Sv=new pr;function vD(n){const t=Sv.get(n,cg).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function xv(n){const e=[],t=new Set;for(const r of n){if(t.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function ys({children:n,className:e="",...t}){return d.jsx("svg",{...t,className:se("tl-svg-container",e),children:n})}function lg(n,e,t,r){const s=n.x-t.x,i=n.y-t.y,o=r.x-t.x,a=r.y-t.y,c=e.x-n.x,l=e.y-n.y,u=o*i-a*s,h=c*i-l*s,p=a*c-o*l;if(u===0||h===0||p===0)return null;if(p!==0){const f=u/p,g=h/p;if(0<=f&&f<=1&&0<=g&&g<=1)return y.AddXY(n,f*c,f*l)}return null}function ea(n,e,t,r){const s=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),i=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),o=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=i*i-4*s*o;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-i+c)/(2*s),u=(-i-c)/(2*s);if((l<0||l>1)&&(u<0||u>1))return null;const h=[];return 0<=l&&l<=1&&h.push(y.Lrp(n,e,l)),0<=u&&u<=1&&h.push(y.Lrp(n,e,u)),h.length===0?null:h}function PD(n,e,t){const r=[];let s;for(let i=0,o=t.length-1;i<o;i++)s=lg(n,e,t[i],t[i+1]),s&&r.push(s);return r.length===0?null:r}function dg(n,e,t){const r=[];let s;for(let i=1,o=t.length;i<o+1;i++)s=lg(n,e,t[i-1],t[i%t.length]),s&&r.push(s);return r.length===0?null:r}function ID(n,e,t,r){let s=t.x-n.x,i=t.y-n.y;const o=Math.sqrt(s*s+i*i),a=(o*o-r*r+e*e)/(2*o),c=Math.sqrt(e*e-a*a);return s/=o,i/=o,[new y(n.x+s*a-i*c,n.y+i*a+s*c),new y(n.x+s*a+i*c,n.y+i*a-s*c)]}function Ep(n,e,t){const r=[];let s,i,o;for(let a=0,c=t.length;a<c;a++)s=t[a],i=t[(a+1)%t.length],o=ea(s,i,n,e),o&&r.push(...o);return r.length===0?null:r}function yx(n,e,t){const r=[];let s,i,o;for(let a=1,c=t.length;a<c;a++)s=t[a-1],i=t[a],o=ea(s,i,n,e),o&&r.push(...o);return r.length===0?null:r}function Ia(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function ug(n,e,t,r){return Ia(n,t,r)!==Ia(e,t,r)&&Ia(n,e,t)!==Ia(n,e,r)}function Sx(n,e){const t=new Map;let r,s,i,o;for(let a=0,c=n.length;a<c;a++)if(r=n[a],wn(r,e)){const l=gh(r);t.has(l)||t.set(l,r)}for(let a=0,c=e.length;a<c;a++)if(r=e[a],wn(r,n)){const l=gh(r);t.has(l)||t.set(l,r)}for(let a=0,c=n.length;a<c;a++){r=n[a],s=n[(a+1)%n.length];for(let l=0,u=e.length;l<u;l++){i=e[l],o=e[(l+1)%e.length];const h=lg(r,s,i,o);if(h!==null){const p=gh(h);t.has(p)||t.set(p,h)}}}return t.size===0?null:CD([...t.values()])}function gh(n){return`${n.x},${n.y}`}function CD(n){const e=y.Average(n);return n.sort((t,r)=>y.Angle(e,t)-y.Angle(e,r))}function hg(n,e){let t,r,s,i;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let c=0,l=e.length;c<l;c++)if(s=e[c],i=e[(c+1)%l],ug(t,r,s,i))return!0}return!1}function _D(n,e){let t,r,s,i;for(let o=0,a=n.length;o<a;o++){t=n[o],r=n[(o+1)%a];for(let c=1,l=e.length;c<l;c++)if(s=e[c-1],i=e[c],ug(t,r,s,i))return!0}return!1}class Fr extends vs{constructor(t){super({...t,isClosed:!1,isFilled:!1});v(this,"start");v(this,"end");v(this,"d");v(this,"u");v(this,"ul");const{start:r,end:s}=t;this.start=r,this.end=s,this.d=r.clone().sub(s),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:s,d:i,u:o,ul:a}=this;if(i.len()===0||a===0)return r;const c=y.Sub(t,r).dpr(o)/a,l=r.x+o.x*c;if(l<Math.min(r.x,s.x))return r.x<s.x?r:s;if(l>Math.max(r.x,s.x))return r.x>s.x?r:s;const u=r.y+o.y*c;return u<Math.min(r.y,s.y)?r.y<s.y?r:s:u>Math.max(r.y,s.y)?r.y>s.y?r:s:new y(l,u)}hitTestLineSegment(t,r,s=0){return ug(t,r,this.start,this.end)||this.distanceToLineSegment(t,r)<=s}getSvgPathData(t=!0){const{start:r,end:s}=this;return`${t?`M${r.toFixed()}`:""} L${s.toFixed()}`}}class zi extends vs{constructor(t){super({isClosed:!1,isFilled:!1,...t});v(this,"points");v(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,s=t.length-1;r<s;r++){const i=t[r],o=t[r+1];this._segments.push(new Fr({start:i,end:o}))}this.isClosed&&this._segments.push(new Fr({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let s=this.points[0],i=1/0,o,a;for(let c=0;c<r.length;c++)o=r[c].nearestPoint(t),a=y.Dist2(o,t),a<i&&(s=o,i=a);if(!s)throw Error("nearest point not found");return s}hitTestLineSegment(t,r,s=0){const{segments:i}=this;for(let o=0,a=i.length;o<a;o++)if(i[o].hitTestLineSegment(t,r,s))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((r,s,i)=>i===0?`M ${s.x} ${s.y}`:`${r} L ${s.x} ${s.y}`,"")}}class at extends zi{constructor(e){super({...e}),this.isClosed=!0}}class yr extends at{constructor(t){const{x:r=0,y:s=0,width:i,height:o}=t;super({...t,points:[new y(r,s),new y(r+i,s),new y(r+i,s+o),new y(r,s+o)]});v(this,"x");v(this,"y");v(this,"w");v(this,"h");this.x=r,this.y=s,this.w=i,this.h=o}getBounds(){return new V(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:r,w:s,h:i}=this;return`M${t},${r} h${s} v${i} h-${s}z`}}class Vn{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}v(Vn,"props"),v(Vn,"migrations"),v(Vn,"type");function Hn(n,e,t={}){const{closed:r=!1,snap:s=1,start:i="outset",end:o="outset",lengthRatio:a=2,style:c="dashed",forceSolid:l=!1}=t;let u=0,h=0,p=1,f=0,g=0;if(l)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(c){case"dashed":{p=1,u=Math.min(e*a,n/4);break}case"dotted":{p=100,u=e/p;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(i==="outset"?(n+=u/2,g+=u/2):i==="skip"&&(n-=u,g-=u),o==="outset"?n+=u/2:o==="skip"&&(n-=u)),h=Math.floor(n/u/(2*p)),h-=h%s,h<3&&c==="dashed"?n/e<4?(u=n,h=1,f=0):(u=n*(1/3),f=n*(1/3)):(u=n/h/(2*p),r?(g=u/2,f=(n-h*u)/h):f=(n-h*u)/Math.max(1,h-1)),{strokeDasharray:[u,f].join(" "),strokeDashoffset:g.toString()}}function xx({bounds:n,className:e}){const t=z(),r=N("zoom level",()=>t.getZoomLevel(),[t]);return d.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((s,i)=>{const{strokeDasharray:o,strokeDashoffset:a}=Hn(s[0].dist(s[1]),1/r,{style:"dashed",lengthRatio:4});return d.jsx("line",{x1:s[0].x,y1:s[0].y,x2:s[1].x,y2:s[1].y,strokeDasharray:o,strokeDashoffset:a},i)})})}class Wa extends Vn{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new yr({width:1,height:1,isFilled:!1}):new Rn({children:t.map(r=>{const s=this.editor.getShape(r),i=this.editor.getShapeGeometry(r),o=this.editor.getShapeLocalTransform(s).applyToPoints(i.vertices);return i.isClosed?new at({points:o,isFilled:!0}):new zi({points:o})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),s=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),i=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(i||s))return null;const o=this.editor.getShapeGeometry(e).bounds;return d.jsx(ys,{children:d.jsx(xx,{className:"tl-group",bounds:o})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return d.jsx(xx,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}v(Wa,"type","group"),v(Wa,"props",C0),v(Wa,"migrations",_0);const bv=[Wa],ED=new Set(bv.map(n=>n.type));function wv(n){const e=[...bv],t=new Set;for(const r of n){if(ED.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function vv(n,e){const t=new Map;return async function(s){const i=t.get(s);if(i)return i;const o=(async()=>{try{const a=await fr(s,e);return De(a.ok),await n(a)}catch(a){return console.error(a),null}})();return t.set(s,o),o}}const gl=vv(async n=>await Kn.blobToDataUrl(await n.blob())),TD=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,kD=/@font-face\s*{([^}]+)}/gi,Pv=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,jD=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function MD(n){return Array.from(n.matchAll(TD),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function Iv(n,e){return Array.from(n.matchAll(kD),t=>{const r=t[1],s=Array.from(r.matchAll(Pv),o=>{var c;const a=o[1]||o[2]||o[3];return{original:a,resolved:((c=pe(a,e))==null?void 0:c.href)??null}}),i=new Set(Array.from(r.matchAll(jD),o=>(o[1]||o[2]||o[3]).toLowerCase()));return{fontFace:r,urls:s,fontFamilies:i}})}function AD(n){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,r=new Set;for(;;){const s=e.exec(n);if(!s)break;const i=s[1]||s[2]||s[3];if(r.add(i.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(n))break;e.lastIndex=t.lastIndex}return r}function Cv(n){return!(n.startsWith("-")||n.startsWith("animation")||n.startsWith("transition")||n==="cursor"||n==="pointer-events"||n==="user-select"||n==="touch-action")}function DD(n,e){return{imports:MD(n),fontFaces:Iv(n,e)}}function OD(n){return Array.from(n.matchAll(Pv),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const RD=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function _v(n){return RD.has(n)}var LD=Object.create,Ev=Object.defineProperty,FD=Object.getOwnPropertyDescriptor,$D=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),Tv=n=>{throw TypeError(n)},kv=(n,e,t)=>e in n?Ev(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,zD=n=>[,,,LD(null)],jv=["class","method","getter","setter","accessor","field","value","get","set"],Mv=n=>n!==void 0&&typeof n!="function"?Tv("Function expected"):n,ND=(n,e,t,r,s)=>({kind:jv[n],name:e,metadata:r,addInitializer:i=>t._?Tv("Already initialized"):s.push(Mv(i||null))}),BD=(n,e)=>kv(e,$D("metadata"),n[3]),UD=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},HD=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=jv[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,FD(s,t)),b=r.length-1;b>=0;b--)c=ND(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,Mv(o)&&(x[g]=o);return x&&Ev(s,t,x),s},Ca=(n,e,t)=>kv(n,typeof e!="symbol"?e+"":e,t),Av,ml;Av=[on];class pg{constructor(){UD(ml,5,this),Ca(this,"fontFacesPromise",null),Ca(this,"foundFontNames",new Set),Ca(this,"fontFacesToEmbed",new Set),Ca(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){De(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=KD()}onFontFamilyValue(e){De(this.fontFacesPromise,"FontEmbedder not started");const t=AD(e);for(const r of t){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(s=>{const i=s.filter(o=>o.fontFamilies.has(r));for(const o of i)if(!this.fontFacesToEmbed.has(o)){this.fontFacesToEmbed.add(o);for(const a of o.urls)!a.resolved||a.embedded||(a.embedded=gl(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let r=`@font-face {${t.fontFace}}`;for(const s of t.urls){if(!s.embedded)continue;const i=await s.embedded;i&&(r=r.replace(s.original,i))}e+=r}return e}}ml=zD();HD(ml,1,"onFontFamilyValue",Av,pg);BD(ml,pg);async function KD(){const n=[];for(const e of document.styleSheets){let t;try{t=e.cssRules}catch{}if(t)for(const r of e.cssRules)r instanceof CSSFontFaceRule?n.push(Iv(r.cssText,e.href??document.baseURI)):r instanceof CSSImportRule&&n.push(Tp(r.href));else e.href&&n.push(Tp(e.href))}return fe(await Promise.all(n)).flat()}const Tp=vv(async n=>{const e=DD(await n.text(),n.url),t=await Promise.all(e.imports.map(({url:r})=>Tp(new URL(r,n.url).href)));return[...e.fontFaces,...fe(t).flat()]});function Dv(n){if(n.shadowRoot)return n.shadowRoot.childNodes;if(YD(n)){const e=n.assignedNodes();if(e!=null&&e.length)return e}return n.childNodes}function*kp(n){for(const e of Dv(n))qD(e)&&(yield e)}function yl(n){var e;return((e=n.ownerDocument)==null?void 0:e.defaultView)??globalThis}function qD(n){return n instanceof yl(n).Element}function GD(n){return n instanceof yl(n).ShadowRoot}function WD(n){return"getRootNode"in n&&GD(n.getRootNode())}function YD(n){return WD(n)&&n instanceof yl(n).HTMLSlotElement}function VD(n){return n.style}function fg(n,e){return yl(n).getComputedStyle(n,e)}const Fs={};class XD{constructor(e){v(this,"styles",new Map);v(this,"fonts",new pg);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(kp(e));for(;t.length;){const r=t.pop();t.push(...kp(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:r=!0}){var a;const s=t?eO(e.tagName.toLowerCase()):Fs,i=r?((a=this.styles.get(e.parentElement))==null?void 0:a.self)??Fs:Fs,o={self:ZD(e,{defaultStyles:s,parentStyles:i}),before:bx(e,"::before"),after:bx(e,"::after")};this.styles.set(e,o)}fetchResources(){const e=[];for(const t of this.styles.values())for(const r of nt(t))if(r)for(const[s,i]of Object.entries(r)){if(!i)continue;s==="font-family"&&this.fonts.onFontFamilyValue(i);const o=OD(i);o.length!==0&&e.push(...o.map(async({url:a,original:c})=>{const l=await gl(a)??"data:";r[s]=i.replace(c,`url("${l}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(r,s)=>{if(e.has(r))return;e.add(r);const i=r.shadowRoot;if(i){const o=document.createElement("div");this.styles.set(o,this.styles.get(r)),o.setAttribute("data-tl-custom-element",r.tagName),(s??r.parentElement).appendChild(o);for(const a of i.childNodes)a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0));r.remove()}else if(s){if(r.tagName.toLowerCase()==="style")return;const o=r.cloneNode(!1);this.styles.set(o,this.styles.get(r)),s.appendChild(o);for(const a of Dv(r))a instanceof Element?t(a,o):o.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())t(r,null)}embedStyles(){let e="";for(const[t,r]of this.styles){if(r.after||r.before){const i=`pseudo-${Fe()}`;t.classList.add(i),r.before&&(e+=`.${i}::before {${wx(r.before)}}
`),r.after&&(e+=`.${i}::after {${wx(r.after)}}
`)}const s=VD(t);for(const[i,o]of Object.entries(r.self))o&&s.setProperty(i,o);s.fontKerning==="auto"&&(s.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){QD()}}function ZD(n,{defaultStyles:e,parentStyles:t}){return n.computedStyleMap?Ov(n.computedStyleMap(),{defaultStyles:e,parentStyles:t}):gg(fg(n),{defaultStyles:e,parentStyles:t})}function bx(n,e){const t=fg(n,e),r=t.getPropertyValue("content");if(!(r===""||r==="none"))return gg(t,{defaultStyles:Fs,parentStyles:Fs})}function Ov(n,{defaultStyles:e,parentStyles:t}){const r={};for(const s of n.keys()){if(!Cv(s))continue;const i=n.get(s).toString();e[s]!==i&&(t[s]===i&&_v(s)||(r[s]=i))}return r}function gg(n,{defaultStyles:e,parentStyles:t}){const r={};for(const s of n){if(!Cv(s))continue;const i=n.getPropertyValue(s);e[s]!==i&&(t[s]===i&&_v(s)||(r[s]=i))}return r}function wx(n){let e="";for(const[t,r]of Object.entries(n))e+=`${t}: ${r};`;return e}let bi;const vx={};function JD(){if(!bi){const n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n);const e=tn(n.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(r),e.body.appendChild(t),bi={iframe:n,foreignObject:r,document:e}}return bi}function QD(){bi&&(document.body.removeChild(bi.iframe),bi=void 0)}const Px={defaultStyles:Fs,parentStyles:Fs};function eO(n){let e=vx[n];if(!e){const{foreignObject:t,document:r}=JD(),s=r.createElement(n);t.appendChild(s),e=s.computedStyleMap?Ov(s.computedStyleMap(),Px):gg(fg(s),Px),t.removeChild(s),vx[n]=e}return e}function tO(n,e){Array.from(n.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function Ix(n,e){return n.replaceWith(e),e}async function To(n,e){const t=document.createElement("img");e&&tO(e,t),t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function nO(n){try{const e=n.toDataURL();return await To(e,n)}catch{return await To(null,n)}}async function rO(n){try{const e=await yn.getVideoFrameAsDataUrl(n);return To(e,n)}catch(e){console.error("Could not get video frame",e)}if(n.poster){const e=await gl(n.poster);return To(e,n)}return To(null,n)}async function Rv(n){if(n instanceof HTMLCanvasElement)return Ix(n,await nO(n));if(n instanceof HTMLVideoElement)return Ix(n,await rO(n));if(n instanceof HTMLImageElement){const e=n.currentSrc||n.src,t=await gl(e);n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}else n instanceof HTMLInputElement?n.setAttribute("value",n.value):n instanceof HTMLTextAreaElement&&(n.textContent=n.value);await Promise.all(Array.from(kp(n),e=>Rv(e)))}function Sl(n){const e=_.useRef();return _.useLayoutEffect(()=>{e.current=n}),_.useDebugValue(n),_.useCallback((...t)=>{const r=e.current;return De(r,"fn does not exist"),r(...t)},[])}const mg=_.createContext(null);function sO({context:n,editor:e,children:t}){const r=e.options.exportProvider;return d.jsx(tg,{editor:e,children:d.jsx(G0,{container:e.getContainer(),children:d.jsx(mg.Provider,{value:n,children:d.jsx(r,{children:t})})})})}function ta(){return _.useContext(mg)}function iO(){const n=_.useContext(mg),[e]=_.useState(Sf);return _.useEffect(()=>(n==null||n.waitUntil(e),()=>{e.resolve()}),[e,n]),Sl(()=>{e.resolve()})}var oO=Object.create,Lv=Object.defineProperty,aO=Object.getOwnPropertyDescriptor,cO=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),Fv=n=>{throw TypeError(n)},$v=(n,e,t)=>e in n?Lv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lO=n=>[,,,oO(null)],zv=["class","method","getter","setter","accessor","field","value","get","set"],Nv=n=>n!==void 0&&typeof n!="function"?Fv("Function expected"):n,dO=(n,e,t,r,s)=>({kind:zv[n],name:e,metadata:r,addInitializer:i=>t._?Fv("Already initialized"):s.push(Nv(i||null))}),uO=(n,e)=>$v(e,cO("metadata"),n[3]),hO=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},pO=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=zv[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,aO(s,t)),b=r.length-1;b>=0;b--)c=dO(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,Nv(o)&&(x[g]=o);return x&&Lv(s,t,x),s},Cx=(n,e,t)=>$v(n,typeof e!="symbol"?e+"":e,t),Bv,xl;Bv=[on];class yg{constructor(e){this.maxDelayTimeMs=e,hO(xl,5,this),Cx(this,"isResolved",!1),Cx(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error whilst waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await up(0)}async resolve(){const e=up(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}xl=lO();pO(xl,1,"waitUntil",Bv,yg);uO(xl,yg);function fO(n,e,t={}){var b,S;if(!window.document)throw Error("No document");const{scale:r=1,background:s=!1,padding:i=n.options.defaultSvgPadding,preserveAspectRatio:o}=t,a=t.darkMode??n.user.getIsDarkMode(),c=n.getShapeAndDescendantIds(e),l=n.getUnorderedRenderingShapes(!1).filter(({id:P})=>c.has(P));let u=null;if(t.bounds)u=t.bounds;else for(const{id:P}of l){const w=n.getShapeMaskedPageBounds(P);w&&(u?u.union(w):u=w.clone())}if(!u)return;const h=e.length===1&&n.isShapeOfType(n.getShape(e[0]),"frame")?e[0]:null;h||u.expandBy(i);const p=u.width*r,f=u.height*r;try{(S=(b=document.body).focus)==null||S.call(b)}catch{}const g=new yg(n.options.maxExportDelayMs),m=Sf();return g.waitUntil(m),{jsx:d.jsx(gO,{editor:n,preserveAspectRatio:o,scale:r,bbox:u,background:s,singleFrameShapeId:h,isDarkMode:a,renderingShapes:l,onMount:m.resolve,waitUntil:g.waitUntil}),width:p,height:f,exportDelay:g}}function gO({editor:n,preserveAspectRatio:e,scale:t,bbox:r,background:s,singleFrameShapeId:i,isDarkMode:o,renderingShapes:a,onMount:c,waitUntil:l}){const u=Li(),h=Yr({isDarkMode:o}),[p,f]=_.useState({}),g=Sl(P=>{Wn(p,P.key)||l((async()=>{const w=await P.getElement();w&&dp.flushSync(()=>f(I=>({...I,[P.key]:w})))})())}),m=_.useMemo(()=>({isDarkMode:o,waitUntil:l,addExportDef:g}),[o,l,g]),[x,b]=_.useState(null),S=_.useRef(!1);return _.useLayoutEffect(()=>{if(S.current)throw new Error("SvgExport should only render once - do not use with react strict mode");S.current=!0,(async()=>{const P={},w=a.map(async({id:E,opacity:T,index:C,backgroundIndex:j})=>{var D,O;if(E===i)return[];const k=n.getShape(E);if(n.isShapeOfType(k,"group"))return[];const R=[],A=n.getShapeUtil(k);if(A.toSvg||A.toBackgroundSvg){const[$,B]=await Promise.all([(D=A.toSvg)==null?void 0:D.call(A,k,m),(O=A.toBackgroundSvg)==null?void 0:O.call(A,k,m)]),G=n.getShapePageTransform(k);let Y=G.toCssString();"scale"in k.props&&k.props.scale!==1&&(Y=`${Y} scale(${k.props.scale}, ${k.props.scale})`);const ne=n.getShapeMask(k.id),de=ne?W.From(W.Inverse(G)).applyToPoints(ne):null,ae=Qf(u,k.id);de&&(P[ae]=d.jsx("clipPath",{id:ae,children:d.jsx("path",{d:`M${de.map(({x:Oe,y:ce})=>`${Oe},${ce}`).join("L")}Z`})})),$&&R.push({zIndex:C,element:d.jsx("g",{transform:Y,opacity:T,clipPath:ne?`url(#${ae})`:void 0,children:$},`fg_${k.id}`)}),B&&R.push({zIndex:j,element:d.jsx("g",{transform:Y,opacity:T,clipPath:ne?`url(#${ae})`:void 0,children:B},`bg_${k.id}`)})}else R.push({zIndex:C,element:d.jsx(_x,{shape:k,util:A,component:J0,className:"tl-shape",bbox:r,opacity:T},`fg_${k.id}`)}),A.backgroundComponent&&R.push({zIndex:j,element:d.jsx(_x,{shape:k,util:A,component:Q0,className:"tl-shape tl-shape-background",bbox:r,opacity:T},`bg_${k.id}`)});return R}),I=(await Promise.all(w)).flat();dp.flushSync(()=>{b(I.sort((E,T)=>E.zIndex-T.zIndex).map(({element:E})=>E)),f(E=>({...E,...P}))})})()},[r,n,m,u,a,i]),_.useEffect(()=>{x!==null&&c()},[c,x]),d.jsx(sO,{editor:n,context:m,children:d.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:r.width*t,height:r.height*t,viewBox:`${r.minX} ${r.minY} ${r.width} ${r.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:s?i?h.solid:h.background:"transparent"},"data-color-mode":o?"dark":"light",className:`tl-container tl-theme__force-sRGB ${o?"tl-theme__dark":"tl-theme__light"}`,children:[d.jsx("defs",{children:Object.entries(p).map(([P,w])=>d.jsx(_.Fragment,{children:w},P))}),x]})})}function _x({shape:n,util:e,className:t,component:r,bbox:s,opacity:i}){const o=z(),a=W.Translate(-s.minX,-s.minY).multiply(o.getShapePageTransform(n.id)),c=o.getShapeGeometry(n.id).bounds,l=Math.max(c.width,1),u=Math.max(c.height,1);return d.jsx(Jf,{fallback:()=>null,children:d.jsx("foreignObject",{x:s.minX,y:s.minY,width:s.w,height:s.h,className:"tl-shape-foreign-object",children:d.jsx("div",{className:t,"data-shape-type":n.type,style:{clipPath:o.getShapeClipPath(n.id),transform:a.toCssString(),width:l,height:u,opacity:i},children:d.jsx(r,{shape:n,util:e})})})})}let mO=1;async function yO(n,e,t={}){const r=fO(n,e,t);if(!r)return;const s=n.getContainer(),i=document.createElement("div");i.className="tldraw-svg-export",i.inert=!0,i.tabIndex=-1,Object.assign(i.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),s.appendChild(i);const o=yE.createRoot(i,{identifierPrefix:`export_${mO++}_`});try{dp.flushSync(()=>{o.render(r.jsx)}),await r.exportDelay.resolve();const a=i.firstElementChild;return De(a instanceof SVGSVGElement,"Expected an SVG element"),await SO(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{o.unmount(),s.removeChild(i)},0)}}async function SO(n){const e=[...n.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const t=new XD(n);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(i=>Rv(i)));for(const i of e)t.readRootElementStyles(i);await t.fetchResources();const r=await t.getFontFaceCss();t.unwrapCustomElements();const s=t.embedStyles();if(r||s){const i=document.createElementNS("http://www.w3.org/2000/svg","style");i.textContent=`${r}
${s}`,n.prepend(i)}}finally{t.dispose()}}const Un={menus:ht("open menus",[]),getOpenMenus(n){return n?this.menus.get().filter(e=>e.endsWith("-"+n)):this.menus.get()},addOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)||(r.add(t),this.menus.set([...r]))},deleteOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)&&(r.delete(t),this.menus.set([...r]))},clearOpenMenus(n){this.menus.set(n?this.menus.get().filter(e=>!e.endsWith("-"+n)):[])},_hiddenMenus:[],hideOpenMenus(n){if(this._hiddenMenus=[...this.getOpenMenus(n)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,n)},showOpenMenus(n){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,n);this._hiddenMenus=[]}},isMenuOpen(n,e){return this.getOpenMenus(e).includes(n)},hasOpenMenus(n){return this.getOpenMenus(n).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(n){return{getOpenMenus:()=>this.getOpenMenus(n),addOpenMenu:e=>this.addOpenMenu(e,n),deleteOpenMenu:e=>this.deleteOpenMenu(e,n),clearOpenMenus:()=>this.clearOpenMenus(n),isMenuOpen:e=>this.isMenuOpen(e,n),hasOpenMenus:()=>this.hasOpenMenus(n),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},jp=new UT,xO={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:_.Fragment};function Ex(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw mt(n)}}class bO{constructor(e){v(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,s]of this){if(!Ex(s,e.get(r)))return!1;t.add(r)}for(const[r,s]of e)if(!t.has(r)&&!Ex(s,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Mp extends bO{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:mt(r,"type")}}}function wO(n,e,t){return fr(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}const vO="https://cdn.tldraw.com";function us(){return`${vO}/${z0}`}function PO(n){switch(n.type){case"shapes":return`s${n.shapeIds.map(t=>mh(t.slice(6))).join(".")}`;case"page":return"p"+mh(In.parseId(n.pageId));case"viewport":{const{bounds:e,pageId:t}=n;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(r+="."+mh(In.parseId(t))),r}default:mt(n)}}function IO(n){switch(n[0]){case"s":return{type:"shapes",shapeIds:n.slice(1).split(".").filter(Boolean).map(r=>ze(decodeURIComponent(r)))};case"p":return{type:"page",pageId:In.createId(decodeURIComponent(n.slice(1)))};case"v":{const[t,r,s,i,o]=n.slice(1).split(".");return{type:"viewport",bounds:new V(Number(t),Number(r),Number(s),Number(i)),pageId:o?In.createId(decodeURIComponent(o)):void 0}}default:throw Error("Invalid deep link string")}}function mh(n){return encodeURIComponent(n).replace(/\./g,"%2E")}function CO(n,e){var s;let t=n;const r=new Set(e);for(;r.has(t);)t=(s=/^.*(\d+)$/.exec(t))!=null&&s[1]?t.replace(/(\d+)(?=\D?)$/,i=>(+i+1).toString()):`${t} 1`;return t}function _a(n,e,t,r){if(t.length===0)return[];const s=new Map;for(const o of fe(t.map(a=>n.getShape(a)))){const{parentId:a}=o;s.has(a)||s.set(a,{children:fe(n.getSortedChildIdsForParent(a).map(c=>n.getShape(c))),moving:new Set}),s.get(a).moving.add(o)}const i=[];switch(e){case"toBack":{s.forEach(({moving:o,children:a})=>_O(o,a,i));break}case"toFront":{s.forEach(({moving:o,children:a})=>EO(o,a,i));break}case"forward":{s.forEach(({moving:o,children:a})=>TO(n,o,a,i,r));break}case"backward":{s.forEach(({moving:o,children:a})=>kO(n,o,a,i,r));break}}return i}function _O(n,e,t){const r=e.length;if(n.size===r)return;let s,i;for(let o=0;o<r;o++){const a=e[o];if(n.has(a))s=a.index,n.delete(a);else{i=a.index;break}}if(n.size!==0){const o=Pi(s,i,n.size);t.push(...Array.from(n.values()).sort(Rt).map((a,c)=>({...a,index:o[c]})))}}function EO(n,e,t){const r=e.length;if(n.size===r)return;let s,i;for(let o=r-1;o>-1;o--){const a=e[o];if(n.has(a))i=a.index,n.delete(a);else{s=a.index;break}}if(n.size!==0){const o=Pi(s,i,n.size);t.push(...Array.from(n.values()).sort(Rt).map((a,c)=>({...a,index:o[c]})))}}function Tx(n,e){const t=n.getShapeGeometry(e),r=n.getShapePageTransform(e);return!t||!r?null:r.applyToPoints(t.vertices)}function Uv(n,e){const t=Array.from(e).map(s=>{const i=Tx(n,s);return i?{shape:s,vertices:i}:null}).filter(Boolean);return s=>{const i=Tx(n,s);return i?t.some(o=>hg(o.vertices,i)):!1}}function TO(n,e,t,r,s){var c;const i=Uv(n,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let l=0;l<o;l++){const u=e.has(t[l]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(u||!(s!=null&&s.considerAllShapes)&&!i(t[l]))continue;const{selectIndex:h}=a;Pi(t[l].index,(c=t[l+1])==null?void 0:c.index,l-h).forEach((p,f)=>{const g=t[h+f];e.has(g)&&r.push({...g,index:p})}),a={name:"skipping"};break}}}}function kO(n,e,t,r,s){var c;const i=Uv(n,e),o=t.length;if(e.size===o)return;let a={name:"skipping"};for(let l=o-1;l>-1;l--){const u=e.has(t[l]);switch(a.name){case"skipping":{if(!u)continue;a={name:"selecting",selectIndex:l};break}case"selecting":{if(u||!(s!=null&&s.considerAllShapes)&&!i(t[l]))continue;Pi((c=t[l-1])==null?void 0:c.index,t[l].index,a.selectIndex-l).forEach((h,p)=>{const f=t[l+p+1];e.has(f)&&r.push({...f,index:h})}),a={name:"skipping"};break}}}}function Hv({editor:n,ids:e}){const t=fe(e.map(o=>n.getShape(o))),r=n.getShapesSharedRotation(e),s=n.getShapesRotatedPageBounds(e);if(!s)return null;const i=s.center.clone().rotWith(s.point,r);return{pageCenter:i,initialCursorAngle:i.angle(n.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:t.map(o=>({shape:o,initialPagePoint:n.getShapePageTransform(o.id).point()}))}}function Ya({delta:n,editor:e,snapshot:t,stage:r,centerOverride:s}){const{pageCenter:i,shapeSnapshots:o}=t;e.updateShapes(o.map(({shape:c,initialPagePoint:l})=>{const u=en(c.parentId)?e.getShapePageTransform(c.parentId):W.Identity(),h=y.RotWith(l,s??i,n),p=W.applyToPoint(W.Inverse(u),h),f=Ls(c.rotation+n);return{id:c.id,type:c.type,x:p.x,y:p.y,rotation:f}}));const a=[];o.forEach(({shape:c})=>{var p,f,g;const l=e.getShape(c.id);if(!l)return;const u=e.getShapeUtil(c);if(r==="start"||r==="one-off"){const m=(p=u.onRotateStart)==null?void 0:p.call(u,c);m&&a.push(m)}const h=(f=u.onRotate)==null?void 0:f.call(u,c,l);if(h&&a.push(h),r==="end"||r==="one-off"){const m=(g=u.onRotateEnd)==null?void 0:g.call(u,c,l);m&&a.push(m)}}),a.length>0&&e.updateShapes(a)}const jO=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),r=e.query.records("binding");function s(){const i=r.get(),o=new Map;for(const a of i){const{fromId:c,toId:l}=a,u=o.get(c);u?u.push(a):o.set(c,[a]);const h=o.get(l);h?h.push(a):o.set(l,[a])}return o}return K("arrowBindingsIndex",(i,o)=>{if(Os(i))return s();const a=i,c=t.getDiffSince(o);if(c===xn)return s();let l;function u(f){l??(l=new Map(a));const g=l.get(f.fromId),m=g==null?void 0:g.filter(S=>S.id!==f.id);m!=null&&m.length?l.set(f.fromId,m):l.delete(f.fromId);const x=l.get(f.toId),b=x==null?void 0:x.filter(S=>S.id!==f.id);b!=null&&b.length?l.set(f.toId,b):l.delete(f.toId)}function h(f){l??(l=new Map(a));let g=l.get(f);return g?g===a.get(f)&&(g=g.slice(0),l.set(f,g)):(g=[],l.set(f,g)),g}function p(f){h(f.fromId).push(f),h(f.toId).push(f)}for(const f of c){for(const g of nt(f.added))p(g);for(const[g,m]of nt(f.updated))u(g),p(m);for(const g of nt(f.removed))u(g)}return l??a})};function MO(n,e,t){const r=n.getShapeMaskedPageBounds(e);return r===void 0?!0:!t.includes(r)}const AO=n=>{function e(t){const r=t.getCurrentPageShapeIds(),s=t.getViewportPageBounds(),i=new Set;return r.forEach(o=>{MO(t,o,s)&&i.add(o)}),i}return K("getCulledShapes",t=>{if(Os(t))return e(n);const r=e(n);if(t.size!==r.size)return r;for(const s of t)if(!r.has(s))return r;return t})},DO=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function r(){const s={},i=e.get(),o=Array(i.size);return i.forEach(a=>o.push(n.get(a))),o.sort(Rt),o.forEach(a=>{s[a.parentId]||(s[a.parentId]=[]),s[a.parentId].push(a.id)}),s}return K("parentsToChildrenWithIndexes",(s,i)=>{if(Os(s))return r();const o=t.getDiffSince(i);if(o===xn)return r();if(o.length===0)return s;let a=null;const c=h=>{a||(a={...s}),a[h]?a[h]===s[h]&&(a[h]=[...a[h]]):a[h]=[]},l=new Set;let u;for(let h=0,p=o.length;h<p;h++){u=o[h];for(const f of Object.values(u.added))ui(f)&&(c(f.parentId),a[f.parentId].push(f.id),l.add(a[f.parentId]));for(const[f,g]of Object.values(u.updated))if(ui(g)&&ui(f)){if(f.parentId!==g.parentId)c(f.parentId),c(g.parentId),a[f.parentId].splice(a[f.parentId].indexOf(g.id),1),a[g.parentId].push(g.id),l.add(a[g.parentId]);else if(f.index!==g.index){c(g.parentId);const m=a[g.parentId].indexOf(g.id);a[g.parentId][m]=g.id,l.add(a[g.parentId])}}for(const f of Object.values(u.removed))ui(f)&&(c(f.parentId),a[f.parentId].splice(a[f.parentId].indexOf(f.id),1))}for(const h of l){const p=fe(h.map(f=>n.get(f)));p.sort(Rt),h.splice(0,h.length,...p.map(f=>f.id))}return a??s})},yh=(n,e,t)=>{for(;!Zt(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},OO=(n,e)=>{const t=n.query.ids("shape");let r=null;function s(){const i=e();return r=i,new Set([...t.get()].filter(o=>yh(n,i,n.get(o))))}return K("_shapeIdsInCurrentPage",(i,o)=>{if(Os(i))return s();const a=e();if(a!==r)return s();const c=n.history.getDiffSince(o);if(c===xn)return s();const l=new Ka(i);for(const h of c){for(const p of Object.values(h.added))ui(p)&&yh(n,a,p)&&l.add(p.id);for(const[p,f]of Object.values(h.updated))ui(f)&&(yh(n,a,f)?l.add(f.id):l.remove(f.id));for(const p of Object.keys(h.removed))en(p)&&l.remove(p)}const u=l.get();return u?mo(u.value,u.diff):i})};var RO=Object.create,Kv=Object.defineProperty,LO=Object.getOwnPropertyDescriptor,FO=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),qv=n=>{throw TypeError(n)},Gv=(n,e,t)=>e in n?Kv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$O=n=>[,,,RO(null)],Wv=["class","method","getter","setter","accessor","field","value","get","set"],Yv=n=>n!==void 0&&typeof n!="function"?qv("Function expected"):n,zO=(n,e,t,r,s)=>({kind:Wv[n],name:e,metadata:r,addInitializer:i=>t._?qv("Already initialized"):s.push(Yv(i||null))}),NO=(n,e)=>Gv(e,FO("metadata"),n[3]),BO=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},Vv=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=Wv[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,LO(s,t)),b=r.length-1;b>=0;b--)c=zO(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,Yv(o)&&(x[g]=o);return x&&Kv(s,t,x),s},ri=(n,e,t)=>Gv(n,typeof e!="symbol"?e+"":e,t),Xv,Zv,na;const UO=40;Zv=[on],Xv=[on];class bl{constructor(e){this.editor=e,BO(na,5,this),ri(this,"_clickId",""),ri(this,"_clickTimeout"),ri(this,"_clickScreenPoint"),ri(this,"_previousScreenPoint"),ri(this,"_clickState","idle"),ri(this,"lastPointerInfo",{})}_getClickTimeout(e,t=Fe()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=y.From(e.point),this._previousScreenPoint&&y.Dist2(this._previousScreenPoint,this._clickScreenPoint)>UO**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=y.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&y.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}na=$O();Vv(na,1,"_getClickTimeout",Zv,bl);Vv(na,1,"cancelDoubleClickTimeout",Xv,bl);NO(na,bl);class HO{constructor(e){v(this,"_isEdgeScrolling",!1);v(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const s=t.options.edgeScrollEaseDuration>0?yt.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*s,y:r.y*s})}}getEdgeProximityFactors(e,t,r,s,i){const{editor:o}=this,a=o.options.edgeScrollDistance,c=r?o.options.coarsePointerWidth:0,l=e-c,u=e+c,h=s?0:a,p=i?t:t-a;return l<h?Math.min(1,(h-l)/a):u>p?-Math.min(1,(u-p)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:r}}}=e,s=e.getViewportScreenBounds(),{isCoarsePointer:i,insets:[o,a,c,l]}=e.getInstanceState(),u=this.getEdgeProximityFactors(t,s.w,i,l,a),h=this.getEdgeProximityFactors(r,s.h,i,o,c);return{x:u,y:h}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=t.getViewportScreenBounds(),s=r.w<1e3?.612:1,i=r.h<1e3?.612:1,o=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,c=a*e.x*s/o,l=a*e.y*i/o,{x:u,y:h,z:p}=t.getCamera();t.setCamera(new y(u+c,h+l,p))}}class KO{constructor(e,t){v(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(s,i)=>{s.isFocused!==i.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;t!==r&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function io(n){return GO}class qO{constructor(){v(this,"length",0);v(this,"head",null);v(this,"tail",this)}push(e){return new Sg(e,this)}toArray(){return zr}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const GO=new qO;class Sg{constructor(e,t){v(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new Sg(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class WO{constructor(e){v(this,"store");v(this,"dispose");v(this,"state","recording");v(this,"pendingDiff",new VO);v(this,"stacks",ht("HistoryManager.stacks",{undos:io(),redos:io()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));v(this,"annotateError");v(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??Oo,this.dispose=this.store.addHistoryInterceptor((t,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:s})=>({undos:s,redos:io()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:mt(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const r=this.state;r!=="paused"&&(t!=null&&t.history)&&(this.state=YO[t.history]);try{if(this._isInBatch)return hr(e),this;this._isInBatch=!0;try{hr(e)}catch(s){throw this.annotateError(s),s}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:t=void 0}){var s;const r=this.state;this.state="paused";try{let{undos:i,redos:o}=this.stacks.get();const a=this.pendingDiff.clear(),c=Xw(a),l=Sp(a);e&&!c&&(o=o.push({type:"diff",diff:a}));let u=!1;if(c)for(;((s=i.head)==null?void 0:s.type)==="stop";){const h=i.head;if(i=i.tail,e&&(o=o.push(h)),h.id===t){u=!0;break}}if(!u)e:for(;i.head;){const h=i.head;switch(i=i.tail,e&&(o=o.push(h)),h.type){case"diff":_o(l,[Sp(h.diff)]);break;case"stop":if(!t)break e;if(h.id===t){u=!0;break e}break;default:mt(h)}}if(!u&&t)return this;this.store.applyDiff(l,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:i,redos:o})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:s}=this.stacks.get();if(s.length===0)return this;for(;((t=s.head)==null?void 0:t.type)==="stop";)r=r.push(s.head),s=s.tail;const i=Ic();for(;s.head;){const o=s.head;if(r=r.push(o),s=s.tail,o.type==="diff")_o(i,[o.diff]);else break}this.store.applyDiff(i,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:s})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var i;let t=this.stacks.get().undos;const r=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&r.push(t.head.diff),t=t.tail;if(!t.head||((i=t.head)==null?void 0:i.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const s=Ic();return _o(s,r.reverse()),this.stacks.update(({redos:o})=>({undos:t.push({type:"diff",diff:s}),redos:o})),this}_mark(e){hr(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:io(),redos:io()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const YO={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class VO{constructor(){v(this,"diff",Ic());v(this,"isEmptyAtom",ht("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=Ic(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){_o(this.diff,[e]),this.isEmptyAtom.set(Xw(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class XO{constructor(e){v(this,"scribbleItems",new Map);v(this,"state","paused");this.editor=e}addScribble(e,t=Fe()){const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,r,s=.5){const i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);const{prev:o}=i,a={x:t,y:r,z:s};return(!o||y.Dist(o,a)>=1)&&(i.next=a),i}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:c,prev:l}=t;c&&c!==l&&(t.prev=c,t.scribble.points.push(c)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:s,prev:i,next:o,scribble:a}=t;switch(a.state){case"active":{o&&o!==i?(t.prev=o,a.points.push(o),r===0&&a.points.length>8&&a.points.shift()):s===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&s===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var ZO=Object.create,Jv=Object.defineProperty,JO=Object.getOwnPropertyDescriptor,QO=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),Qv=n=>{throw TypeError(n)},e1=(n,e,t)=>e in n?Jv(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,e3=n=>[,,,ZO(null)],t1=["class","method","getter","setter","accessor","field","value","get","set"],n1=n=>n!==void 0&&typeof n!="function"?Qv("Function expected"):n,t3=(n,e,t,r,s)=>({kind:t1[n],name:e,metadata:r,addInitializer:i=>t._?Qv("Already initialized"):s.push(n1(i||null))}),n3=(n,e)=>e1(e,QO("metadata"),n[3]),r3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},wl=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=t1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,JO(s,t)),b=r.length-1;b>=0;b--)c=t3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,n1(o)&&(x[g]=o);return x&&Jv(s,t,x),s},s3=(n,e,t)=>e1(n,e+"",t),r1,s1,i1,o1,Vs;const le=n=>Math.round(n*10**8)/10**8;function Or(n,e,t,r,s){const i=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&le(a.length)===le(t)&&Bn(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));if(i.length===0)return[];const o=new Set;return i.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!o.has(c)){o.add(c);const l=Or(n,c,t,r,Bn(a.breadthIntersection[0],a.breadthIntersection[1],s[0],s[1]));i.push(...l)}}),i}function i3(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const s=n[r];if(s.direction===t.direction&&t.gaps.every(i=>s.gaps.some(o=>le(i.startEdge[0].x)===le(o.startEdge[0].x)&&le(i.startEdge[0].y)===le(o.startEdge[0].y)&&le(i.startEdge[1].x)===le(o.startEdge[1].x)&&le(i.startEdge[1].y)===le(o.startEdge[1].y))&&s.gaps.some(o=>le(i.endEdge[0].x)===le(o.endEdge[0].x)&&le(i.endEdge[0].y)===le(o.endEdge[0].y)&&le(i.endEdge[1].x)===le(o.endEdge[1].x)&&le(i.endEdge[1].y)===le(o.endEdge[1].y)))){n.splice(e,1);break}}}}o1=[K],i1=[K],s1=[K],r1=[K];class Ni{constructor(e){this.manager=e,r3(Vs,5,this),s3(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);if(!r)return;const i=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!r||!i))return i.map((o,a)=>{const{x:c,y:l}=W.applyToPoint(r,o);return{x:c,y:l,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),r=[];for(const s of t){const i=e.get(s);i&&r.push(...i)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:tn(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let r,s;const i=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)s=i[c],r.pageBounds.maxX<s.pageBounds.minX&&so(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)&&e.push({startNode:r,endNode:s,startEdge:[new y(r.pageBounds.maxX,r.pageBounds.minY),new y(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new y(s.pageBounds.minX,s.pageBounds.minY),new y(s.pageBounds.minX,s.pageBounds.maxY)],length:s.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Bn(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)})}const o=i.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<o.length;a++){r=o[a];for(let c=a+1;c<o.length;c++)s=o[c],r.pageBounds.maxY<s.pageBounds.minY&&so(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)&&t.push({startNode:r,endNode:s,startEdge:[new y(r.pageBounds.minX,r.pageBounds.maxY),new y(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new y(s.pageBounds.minX,s.pageBounds.minY),new y(s.pageBounds.maxX,s.pageBounds.minY)],length:s.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Bn(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:s}){var x,b;const i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(s),c=r.map(({x:S,y:P},w)=>({id:"selection:"+w,x:S+s.x,y:P+s.y})),l=o,u=[],h=[],p=new y(i,i);this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const f=new y(e==="x"?0:((x=u[0])==null?void 0:x.nudge)??0,e==="y"?0:((b=h[0])==null?void 0:b.nudge)??0);p.x=0,p.y=0,u.length=0,h.length=0,c.forEach(S=>{S.x+=f.x,S.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:h,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:h,minOffset:p});const g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:h}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:h});return this.manager.setIndicators([...m,...g]),{nudge:f}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:s,isResizingFromCenter:i}){var T,C;const o=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:l}=V.Resize(e,r,i?t.x*2:t.x,i?t.y*2:t.y,s);let u=r;c<0&&(u=fA(u)),l<0&&(u=pA(u)),i&&(a.center=e.center);const h=u==="top"||u==="bottom",p=u==="left"||u==="right",f=kx(u,a),g=this.getSnappablePoints(),m=[],x=[],b=new y(o,o);this.collectPointSnaps({minOffset:b,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:f});const S=new y(h?0:((T=m[0])==null?void 0:T.nudge)??0,p?0:((C=x[0])==null?void 0:C.nudge)??0);if(s&&gA(u)&&S.len()!==0){const j=m.length&&x.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":m.length?"x":"y",k=e.aspectRatio;j==="x"?(x.length=0,S.y=S.x/k,(u==="bottom_left"||u==="top_right")&&(S.y=-S.y)):(m.length=0,S.x=S.y*k,(u==="bottom_left"||u==="top_right")&&(S.x=-S.x))}const P=y.Add(t,S),{box:w}=V.Resize(e,r,i?P.x*2:P.x,i?P.y*2:P.y,s);i&&(w.center=e.center);const I=kx("any",w);m.length=0,x.length=0,b.x=0,b.y=0,this.collectPointSnaps({minOffset:b,nearestSnapsX:m,nearestSnapsY:x,otherNodeSnapPoints:g,selectionSnapPoints:I});const E=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:x});return this.manager.setIndicators([...E]),{nudge:S}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:s,nearestSnapsY:i}){for(const o of e)for(const a of t){const c=y.Sub(o,a),l=Math.abs(c.x),u=Math.abs(c.y);le(l)<=le(r.x)&&(le(l)<le(r.x)&&(s.length=0),s.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.x-o.x}),r.x=l),le(u)<=le(r.y)&&(le(u)<le(r.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:a},nudge:a.y-o.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:s}){const{horizontal:i,vertical:o}=this.getVisibleGaps();for(const a of i){if(!so(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&le(Math.abs(l))<=le(t.x)){le(Math.abs(l))<le(t.x)&&(r.length=0),t.x=Math.abs(l);const b={type:"gap_center",gap:a,nudge:l},S=r.find(({type:w})=>w==="gap_center"),P=S&&Bn(a.breadthIntersection[0],a.breadthIntersection[1],S.gap.breadthIntersection[0],S.gap.breadthIntersection[1]);S&&S.gap.length>a.length&&P?r[r.indexOf(S)]=b:(!S||!P)&&r.push(b)}const h=a.startNode.pageBounds.minX-a.length,p=e.maxX,f=h-p;le(Math.abs(f))<=le(t.x)&&(le(Math.abs(f))<le(t.x)&&(r.length=0),t.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const g=a.endNode.pageBounds.maxX+a.length,m=e.minX,x=g-m;le(Math.abs(x))<=le(t.x)&&(le(Math.abs(x))<le(t.x)&&(r.length=0),t.x=Math.abs(x),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:x}))}for(const a of o){if(!so(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&le(Math.abs(l))<=le(t.y)){le(Math.abs(l))<le(t.y)&&(s.length=0),t.y=Math.abs(l);const b={type:"gap_center",gap:a,nudge:l},S=s.find(({type:w})=>w==="gap_center"),P=S&&so(S.gap.breadthIntersection[0],S.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);S&&S.gap.length>a.length&&P?s[s.indexOf(S)]=b:(!S||!P)&&s.push(b);continue}const h=a.startNode.pageBounds.minY-a.length,p=e.maxY,f=h-p;le(Math.abs(f))<=le(t.y)&&(le(Math.abs(f))<le(t.y)&&(s.length=0),t.y=Math.abs(f),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const g=a.endNode.pageBounds.maxY+a.length,m=e.minY,x=g-m;le(Math.abs(x))<=le(t.y)&&(le(Math.abs(x))<le(t.y)&&(s.length=0),t.y=Math.abs(x),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:x}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},s={};if(e.length>0){for(const i of e)if(i.type==="points"){const o=le(i.points.otherPoint.x);r[o]||(r[o]=[]),r[o].push(i.points)}}if(t.length>0){for(const i of t)if(i.type==="points"){const o=le(i.points.otherPoint.y);s[o]||(s[o]=[]),s[o].push(i.points)}}return Object.values(r).concat(Object.values(s)).map(i=>({id:Fe(),type:"points",points:yf(i.map(o=>y.From(o.otherPoint)).concat(i.map(o=>y.From(o.thisPoint))),(o,a)=>o.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:s,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const c of t){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.width)/2,x=Bn(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Fe(),gaps:[...Or(i,h.id,m,"backward",x),{startEdge:u,endEdge:o.left},{startEdge:o.right,endEdge:g},...Or(i,p.id,m,"forward",x)]});break}case"gap_duplicate":{const m=Bn(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Fe(),gaps:c.protrusionDirection==="left"?[{startEdge:o.right,endEdge:u.map(x=>x.clone().addXY(-h.pageBounds.width,0))},{startEdge:u,endEdge:g},...Or(i,p.id,f,"forward",m)]:[...Or(i,h.id,f,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:o.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:h,endNode:p,length:f,endEdge:g}}=c;switch(c.type){case"gap_center":{const m=(f-e.height)/2,x=Bn(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Fe(),gaps:[...Or(s,h.id,m,"backward",x),{startEdge:u,endEdge:o.top},{startEdge:o.bottom,endEdge:g},...Or(s,c.gap.endNode.id,m,"forward",x)]});break}case"gap_duplicate":{const m=Bn(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Fe(),gaps:c.protrusionDirection==="top"?[{startEdge:o.bottom,endEdge:u.map(x=>x.clone().addXY(0,-h.pageBounds.height))},{startEdge:u,endEdge:g},...Or(s,p.id,f,"forward",m)]:[...Or(s,h.id,f,"backward",m),{startEdge:u,endEdge:g},{startEdge:g.map(x=>x.clone().addXY(0,p.pageBounds.height)),endEdge:o.top}]})}break}}return i3(a),a}}Vs=e3();wl(Vs,1,"getSnapPointsCache",o1,Ni);wl(Vs,1,"getSnappablePoints",i1,Ni);wl(Vs,1,"getSnappableGapNodes",s1,Ni);wl(Vs,1,"getVisibleGaps",r1,Ni);n3(Vs,Ni);function kx(n,e){const{minX:t,maxX:r,minY:s,maxY:i}=e,o=[];switch(n){case"top":case"left":case"top_left":case"any":o.push({id:"top_left",handle:"top_left",x:t,y:s})}switch(n){case"top":case"right":case"top_right":case"any":o.push({id:"top_right",handle:"top_right",x:r,y:s})}switch(n){case"bottom":case"right":case"bottom_right":case"any":o.push({id:"bottom_right",handle:"bottom_right",x:r,y:i})}switch(n){case"bottom":case"left":case"bottom_left":case"any":o.push({id:"bottom_left",handle:"bottom_left",x:t,y:i})}return o}var o3=Object.create,a1=Object.defineProperty,a3=Object.getOwnPropertyDescriptor,c3=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),c1=n=>{throw TypeError(n)},l1=(n,e,t)=>e in n?a1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,l3=n=>[,,,o3(null)],d1=["class","method","getter","setter","accessor","field","value","get","set"],u1=n=>n!==void 0&&typeof n!="function"?c1("Function expected"):n,d3=(n,e,t,r,s)=>({kind:d1[n],name:e,metadata:r,addInitializer:i=>t._?c1("Already initialized"):s.push(u1(i||null))}),u3=(n,e)=>l1(e,c3("metadata"),n[3]),h3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},p3=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=d1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,a3(s,t)),b=r.length-1;b>=0;b--)c=d3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,u1(o)&&(x[g]=o);return x&&a1(s,t,x),s},f3=(n,e,t)=>l1(n,e+"",t),h1,vl;const g3=()=>null,m3=()=>[];h1=[K];class xg{constructor(e){this.manager=e,h3(vl,5,this),f3(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const r=e.getShapeUtil(t).getHandleSnapGeometry(t),s=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):g3,i=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):m3;return{outline:r.outline===void 0?e.getShapeGeometry(t):r.outline,points:r.points??[],getSelfSnapOutline:s,getSelfSnapPoints:i}})}*iterateSnapPointsInPageSpace(e,t){var s,i;const r=(s=this.getSnapGeometryCache().get(e))==null?void 0:s.getSelfSnapPoints(t);if(r&&r.length){const o=tn(this.editor.getShapePageTransform(e));for(const a of r)yield o.applyToPoint(a)}for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(i=this.getSnapGeometryCache().get(o))==null?void 0:i.points;if(!a||!a.length)continue;const c=tn(this.editor.getShapePageTransform(o));for(const l of a)yield c.applyToPoint(l)}}*iterateSnapOutlines(e,t){var s,i;const r=(s=this.getSnapGeometryCache().get(e))==null?void 0:s.getSelfSnapOutline(t);r&&(yield{shapeId:e,outline:r});for(const o of this.manager.getSnappableShapes()){if(o===e)continue;const a=(i=this.getSnapGeometryCache().get(o))==null?void 0:i.outline;a&&(yield{shapeId:o,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r}){const s=this.manager.getSnapThreshold();let i=s,o=null;for(const l of this.iterateSnapPointsInPageSpace(e,t))y.DistMin(r,l,i)&&(i=y.Dist(r,l),o=l);if(o)return o;let a=s,c=null;for(const{shapeId:l,outline:u}of this.iterateSnapOutlines(e,t)){const h=tn(this.editor.getShapePageTransform(l)),p=this.editor.getPointInShapeSpace(l,r),f=u.nearestPoint(p),g=h.applyToPoint(f);y.DistMin(r,g,a)&&(a=y.Dist(r,g),c=g)}return c||null}snapHandle({currentShapeId:e,handle:t}){const s=tn(this.editor.getShapePageTransform(e)).applyToPoint(t),i=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:s});return i?(this.manager.setIndicators([{id:Fe(),type:"points",points:[i]}]),{nudge:y.Sub(i,s)}):null}}vl=l3();p3(vl,1,"getSnapGeometryCache",h1,xg);u3(vl,xg);var y3=Object.create,p1=Object.defineProperty,S3=Object.getOwnPropertyDescriptor,x3=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),f1=n=>{throw TypeError(n)},g1=(n,e,t)=>e in n?p1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,b3=n=>[,,,y3(null)],m1=["class","method","getter","setter","accessor","field","value","get","set"],y1=n=>n!==void 0&&typeof n!="function"?f1("Function expected"):n,w3=(n,e,t,r,s)=>({kind:m1[n],name:e,metadata:r,addInitializer:i=>t._?f1("Already initialized"):s.push(y1(i||null))}),v3=(n,e)=>g1(e,x3("metadata"),n[3]),P3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},bg=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=m1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,S3(s,t)),b=r.length-1;b>=0;b--)c=w3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,y1(o)&&(x[g]=o);return x&&p1(s,t,x),s},Sh=(n,e,t)=>g1(n,typeof e!="symbol"?e+"":e,t),S1,x1,b1,Bi;b1=[K],x1=[K],S1=[K];class ra{constructor(e){this.editor=e,P3(Bi,5,this),Sh(this,"shapeBounds"),Sh(this,"handles"),Sh(this,"_snapIndicators",ht("snapLines",void 0)),this.shapeBounds=new Ni(this),this.handles=new xg(this)}getIndicators(){return this._snapIndicators.get()??zr}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),s=new Set,i=o=>{if(en(o)){const c=e.getShape(o);c&&e.isShapeOfType(c,"frame")&&s.add(o)}const a=e.getSortedChildIdsForParent(o);for(const c of a){if(r.includes(c))continue;const l=e.getShape(c);if(!l||!e.getShapeUtil(l).canSnap(l))continue;const h=e.getShapePageBounds(c);if(h&&t.includes(h)){if(e.isShapeOfType(l,"group")){i(c);continue}s.add(c)}}};return i(this.getCurrentCommonAncestor()??e.getCurrentPageId()),s}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}Bi=b3();bg(Bi,1,"getSnapThreshold",b1,ra);bg(Bi,1,"getSnappableShapes",x1,ra);bg(Bi,1,"getCurrentCommonAncestor",S1,ra);v3(Bi,ra);const I3=/\r?\n|\r/g;function jx(n){return n.replace(I3,`
`).split(`
`).map(e=>e||" ").join(`
`)}const C3={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},_3=/\s/;class E3{constructor(e){v(this,"baseElm");this.editor=e;const t=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,t.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}measureText(e,t){var o;const r=(o=this.baseElm)==null?void 0:o.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),r.style.setProperty("padding",t.padding),r.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=jx(e);const s=r.scrollWidth,i=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:i.width,h:i.height,scrollWidth:s}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],s=e.getBoundingClientRect(),i=-s.left,o=-s.top,a=new Range,c=e.childNodes[0];let l=0,u=null,h=null,p=0,f=0,g=!1;for(const m of e.childNodes)if(m.nodeType===Node.TEXT_NODE)for(const x of m.textContent??""){a.setStart(c,l),a.setEnd(c,l+x.length);const b=a.getClientRects(),S=b[b.length-1],P=S.top+o,w=S.left+i,I=S.right+i,E=w<f,T=_3.test(x);if(T!==h||P!==p||!u){if(u){if(t&&P!==p){g=!0;break}r.push(u)}u={box:{x:w,y:P,w:S.width,h:S.height},text:x},f=w}else E&&(u.box.x=w),u.box.w=E?u.box.w+S.width:I-u.box.x,u.text+=x;x===`
`&&(f=0),h=T,p=P,l+=x.length}return u&&r.push(u),{spans:r,didTruncate:g}}measureTextSpans(e,t){var l;if(e==="")return[];const r=(l=this.baseElm)==null?void 0:l.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const s=Math.ceil(t.width-t.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${s}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${t.fontSize}px`),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),r.style.setProperty("text-align",C3[t.textAlign]);const i=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";i&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const o=jx(e);r.textContent=o;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:i});if(t.overflow==="truncate-ellipsis"&&c){r.textContent="…";const u=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${s-u}px`),r.textContent=o;const h=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,p=h[h.length-1];return h.push({text:"…",box:{x:Math.min(p.box.x+p.box.w,t.width-t.padding-u),y:p.box.y,w:u,h:p.box.h}}),h}return r.remove(),a}}var T3=Object.create,w1=Object.defineProperty,k3=Object.getOwnPropertyDescriptor,j3=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),v1=n=>{throw TypeError(n)},P1=(n,e,t)=>e in n?w1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,M3=n=>[,,,T3(null)],I1=["class","method","getter","setter","accessor","field","value","get","set"],C1=n=>n!==void 0&&typeof n!="function"?v1("Function expected"):n,A3=(n,e,t,r,s)=>({kind:I1[n],name:e,metadata:r,addInitializer:i=>t._?v1("Already initialized"):s.push(C1(i||null))}),D3=(n,e)=>P1(e,j3("metadata"),n[3]),O3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},_1=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=I1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,k3(s,t)),b=r.length-1;b>=0;b--)c=A3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,C1(o)&&(x[g]=o);return x&&w1(s,t,x),s},Ea=(n,e,t)=>P1(n,typeof e!="symbol"?e+"":e,t),E1,T1,sa;const Mx=dw;T1=[on],E1=[on];class Pl{constructor(e){this.editor=e,O3(sa,5,this),Ea(this,"cancelRaf"),Ea(this,"isPaused",!0),Ea(this,"now",0),Ea(this,"prevPoint",new y),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=Mx(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=Mx(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:s}}}=this;if(e===0)return;const i=y.Sub(r,t);this.prevPoint=r.clone();const o=i.len(),a=o?i.div(o):new y(0,0),c=s.clone().lrp(a.mul(o/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),s.equals(c)||(this.editor.inputs.pointerVelocity=c)}}sa=M3();_1(sa,1,"tick",T1,Pl);_1(sa,1,"dispose",E1,Pl);D3(sa,Pl);var R3=Object.create,k1=Object.defineProperty,L3=Object.getOwnPropertyDescriptor,F3=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),j1=n=>{throw TypeError(n)},M1=(n,e,t)=>e in n?k1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$3=n=>[,,,R3(null)],A1=["class","method","getter","setter","accessor","field","value","get","set"],D1=n=>n!==void 0&&typeof n!="function"?j1("Function expected"):n,z3=(n,e,t,r,s)=>({kind:A1[n],name:e,metadata:r,addInitializer:i=>t._?j1("Already initialized"):s.push(D1(i||null))}),N3=(n,e)=>M1(e,F3("metadata"),n[3]),B3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},Fn=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=A1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,L3(s,t)),b=r.length-1;b>=0;b--)c=z3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,D1(o)&&(x[g]=o);return x&&k1(s,t,x),s},Ax=(n,e,t)=>M1(n,typeof e!="symbol"?e+"":e,t),O1,R1,L1,F1,$1,z1,N1,B1,U1,H1,K1,q1,Wt;q1=[K],K1=[K],H1=[K],U1=[K],B1=[K],N1=[K],z1=[K],$1=[K],F1=[K],L1=[K],R1=[K],O1=[K];class un{constructor(e,t){if(this.user=e,this.inferDarkMode=t,B3(Wt,5,this),Ax(this,"systemColorScheme",ht("systemColorScheme","light")),Ax(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark");const s=i=>{i.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r==null||r.addEventListener("change",s),this.disposables.add(()=>r==null?void 0:r.removeEventListener("change",s))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??sr.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??sr.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??sr.name}getLocale(){return this.user.userPreferences.get().locale??sr.locale}getColor(){return this.user.userPreferences.get().color??sr.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??sr.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??sr.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??sr.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??sr.isPasteAtCursorMode}}Wt=$3();Fn(Wt,1,"getUserPreferences",q1,un);Fn(Wt,1,"getIsDarkMode",K1,un);Fn(Wt,1,"getEdgeScrollSpeed",H1,un);Fn(Wt,1,"getAnimationSpeed",U1,un);Fn(Wt,1,"getId",B1,un);Fn(Wt,1,"getName",N1,un);Fn(Wt,1,"getLocale",z1,un);Fn(Wt,1,"getColor",$1,un);Fn(Wt,1,"getIsSnapMode",F1,un);Fn(Wt,1,"getIsWrapMode",L1,un);Fn(Wt,1,"getIsDynamicResizeMode",R1,un);Fn(Wt,1,"getIsPasteAtCursorMode",O1,un);N3(Wt,un);const U3={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},H3=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class te{constructor(e,t){v(this,"performanceTracker");v(this,"id");v(this,"type");v(this,"shapeType");v(this,"initial");v(this,"children");v(this,"isLockable");v(this,"parent");v(this,"_path");v(this,"_current");v(this,"_isActive");v(this,"_currentToolIdMask",ht("curent tool id mask",void 0));this.editor=e;const{id:r,children:s,initial:i,isLockable:o}=this.constructor;this.id=r,this._isActive=ht("toolIsActive"+this.id,!1),this._current=ht("toolState"+this.id,void 0),this._path=K("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=t??{},this.parent?s&&i?(this.type="branch",this.initial=i,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",s&&i&&(this.initial=i,this.children=Object.fromEntries(s().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=o,this.performanceTracker=new Hb}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,t={}){var i;const r=e.split(".");let s=this;for(let o=0;o<r.length;o++){const a=r[o],c=s.getCurrent(),l=(i=s.children)==null?void 0:i[a];if(!l)throw Error(`${s.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==l.id&&(c==null||c.exit(t,a),s._current.set(l),l.enter(t,(c==null?void 0:c.id)||"initial"),!l.getIsActive()))break;s=l}return this}handleEvent(e){var s;const t=U3[e.name],r=this._current.__unsafe__getWithoutCapture();(s=this[t])==null||s.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,t){var r;if(ct.measurePerformance.get()&&H3.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const s=this.children[this.initial];this._current.set(s),s.enter(e,t)}}exit(e,t){var r,s;ct.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||(s=this.getCurrent())==null||s.exit(e,t)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}v(te,"id"),v(te,"initial"),v(te,"children"),v(te,"isLockable",!0);class Ap extends te{static children(){return[]}onKeyDown(e){var t;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((t=r.getCurrent())==null?void 0:t.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}v(Ap,"id","root"),v(Ap,"initial","");var K3=Object.create,G1=Object.defineProperty,q3=Object.getOwnPropertyDescriptor,W1=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),Y1=n=>{throw TypeError(n)},V1=(n,e,t)=>e in n?G1(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,G3=n=>[,,,K3((n==null?void 0:n[W1("metadata")])??null)],X1=["class","method","getter","setter","accessor","field","value","get","set"],Z1=n=>n!==void 0&&typeof n!="function"?Y1("Function expected"):n,W3=(n,e,t,r,s)=>({kind:X1[n],name:e,metadata:r,addInitializer:i=>t._?Y1("Already initialized"):s.push(Z1(i||null))}),Y3=(n,e)=>V1(e,W1("metadata"),n[3]),V3=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},Q=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=X1[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,q3(s,t)),b=r.length-1;b>=0;b--)c=W3(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,Z1(o)&&(x[g]=o);return x&&G1(s,t,x),s},oe=(n,e,t)=>V1(n,typeof e!="symbol"?e+"":e,t),J1,Q1,eP,tP,nP,rP,sP,iP,oP,aP,cP,lP,dP,uP,hP,pP,fP,gP,mP,yP,SP,xP,bP,wP,vP,PP,IP,CP,_P,EP,TP,kP,jP,MP,AP,DP,OP,RP,LP,FP,$P,zP,NP,BP,UP,HP,KP,qP,GP,WP,YP,VP,XP,ZP,JP,QP,eI,tI,nI,rI,sI,iI,oI,aI,cI,lI,dI,uI,hI,pI,fI,gI,Dp,J;class Z extends(Dp=yD,gI=[K],fI=[K],pI=[K],hI=[K],uI=[K],dI=[K],lI=[K],cI=[K],aI=[K],oI=[K],iI=[K],sI=[K],rI=[K],nI=[K],tI=[K],eI=[K],QP=[K],JP=[K],ZP=[K],XP=[K],VP=[K],YP=[K],WP=[K],GP=[K],qP=[K],KP=[K],HP=[K],UP=[K],BP=[K],NP=[K],zP=[K],$P=[K],FP=[K],LP=[K],RP=[K],OP=[K],DP=[K],AP=[K],MP=[K],jP=[K],kP=[K],TP=[K],EP=[K],_P=[K],CP=[K],IP=[K],PP=[K],vP=[K],wP=[K],bP=[K],xP=[K],SP=[K],yP=[K],mP=[K],gP=[K],fP=[K],pP=[K],hP=[K],uP=[K],dP=[K],lP=[K],cP=[K],aP=[K],oP=[K],iP=[K({isEqual:(e,t)=>e.equals(t)})],sP=[K],rP=[K],nP=[K],tP=[on],eP=[on],Q1=[on],J1=[on],Dp){constructor({store:e,user:t,shapeUtils:r,bindingUtils:s,tools:i,getContainer:o,cameraOptions:a,initialState:c,autoFocus:l,inferDarkMode:u,options:h,isShapeHidden:p}){var j;super(),V3(J,5,this),oe(this,"_isShapeHiddenPredicate"),oe(this,"options"),oe(this,"contextId",Fe()),oe(this,"store"),oe(this,"root"),oe(this,"disposables",new Set),oe(this,"isDisposed",!1),oe(this,"_tickManager"),oe(this,"snaps"),oe(this,"timers",jp.forContext(this.contextId)),oe(this,"user"),oe(this,"textMeasure"),oe(this,"environment",Be),oe(this,"scribbles"),oe(this,"sideEffects"),oe(this,"edgeScrollManager"),oe(this,"focusManager"),oe(this,"getContainer"),oe(this,"shapeUtils"),oe(this,"styleProps"),oe(this,"bindingUtils"),oe(this,"history"),oe(this,"_shouldIgnoreShapeLock",!1),oe(this,"_crashingError",null),oe(this,"_isChangingStyleTimeout",-1),oe(this,"menus",Un.forContext(this.contextId)),oe(this,"_cameraOptions",ht("camera options",ax)),oe(this,"_viewportAnimation",null),oe(this,"_willSetInitialBounds",!0),oe(this,"_isLockedOnFollowingUser",ht("isLockedOnFollowingUser",!1)),oe(this,"_cameraState",ht("camera state","idle")),oe(this,"_cameraStateTimeoutRemaining",0),oe(this,"_currentPageShapeIds"),oe(this,"_parentIdsToChildIds"),oe(this,"animatingShapes",new Map),oe(this,"externalAssetContentHandlers",{file:null,url:null}),oe(this,"temporaryAssetPreview",new Map),oe(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),oe(this,"inputs",{originPagePoint:new y,originScreenPoint:new y,previousPagePoint:new y,previousScreenPoint:new y,currentPagePoint:new y,currentScreenPoint:new y,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new y}),oe(this,"_clickManager",new bl(this)),oe(this,"_prevCursor","default"),oe(this,"_shiftKeyTimeout",-1),oe(this,"_altKeyTimeout",-1),oe(this,"_ctrlKeyTimeout",-1),oe(this,"_metaKeyTimeout",-1),oe(this,"_restoreToolId","select"),oe(this,"_pinchStart",1),oe(this,"_didPinch",!1),oe(this,"_selectedShapeIdsAtPointerDown",[]),oe(this,"_longPressTimeout",-1),oe(this,"capturedPointerId",null),oe(this,"performanceTracker"),oe(this,"performanceTrackerTimeout",-1),oe(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=p,this.options={...xO,...h},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new WO({store:e,annotateError:k=>{this.annotateError(k,{origin:"history.batch",willCrashApp:!0}),this.crash(k)}}),this.snaps=new ra(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...ax,...a}),this.user=new un(t??fv(),u??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=o,this.textMeasure=new E3(this),this._tickManager=new Pl(this);class f extends Ap{}v(f,"initial",c??""),this.root=new f(this),this.root.children={};const g=wv(r),m={},x={},b=new Map;for(const k of g){const R=new k(this);m[k.type]=R;const A=n0(k.props??{});x[k.type]=A;for(const D of A.keys())if(!b.has(D.id))b.set(D.id,D);else if(b.get(D.id)!==D)throw Error(`Multiple style props with id "${D.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=m,this.styleProps=x;const S=xv(s),P={};for(const k of S){const R=new k(this);P[k.type]=R}this.bindingUtils=P;for(const k of[...i]){if(Wn(this.root.children,k.id))throw Error(`Can't override tool with id "${k.id}"`);this.root.children[k.id]=new k(this,this.root)}this.scribbles=new XO(this);const w=(k,R)=>{let A=null;const D=k.selectedShapeIds.filter(B=>!R.has(B));D.length!==k.selectedShapeIds.length&&(A||(A={...k}),A.selectedShapeIds=D);const O=k.erasingShapeIds.filter(B=>!R.has(B));O.length!==k.erasingShapeIds.length&&(A||(A={...k}),A.erasingShapeIds=O),k.hoveredShapeId&&R.has(k.hoveredShapeId)&&(A||(A={...k}),A.hoveredShapeId=null),k.editingShapeId&&R.has(k.editingShapeId)&&(A||(A={...k}),A.editingShapeId=null);const $=k.hintingShapeIds.filter(B=>!R.has(B));return $.length!==k.hintingShapeIds.length&&(A||(A={...k}),A.hintingShapeIds=$),k.focusedGroupId&&R.has(k.focusedGroupId)&&(A||(A={...k}),A.focusedGroupId=null),A};this.sideEffects=this.store.sideEffects;let I=new Map;const E=new Set,T=new Set;let C=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var k,R,A,D;E.clear();for(const O of T){T.delete(O);const $=this.getShape(O);if(!$)continue;const B=this.getShapeUtil($),G=(k=B.onChildrenChange)==null?void 0:k.call(B,$);G!=null&&G.length&&this.updateShapes(G)}if(C.size){const O=C;C=new Set;for(const $ of O){const B=this.getBindingUtil($);(R=B.onOperationComplete)==null||R.call(B)}}if(I.size){const O=I;I=new Map;for(const $ of O.values())(D=(A=this.getBindingUtil($.binding)).onAfterDelete)==null||D.call(A,$)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(k,R)=>{var A,D,O,$;for(const B of this.getBindingsInvolvingShape(R))C.add(B.type),B.fromId===R.id&&((D=(A=this.getBindingUtil(B)).onAfterChangeFromShape)==null||D.call(A,{binding:B,shapeBefore:k,shapeAfter:R})),B.toId===R.id&&(($=(O=this.getBindingUtil(B)).onAfterChangeToShape)==null||$.call(O,{binding:B,shapeBefore:k,shapeAfter:R}));if(k.parentId!==R.parentId){const B=G=>{var ne,de,ae,Oe;const Y=this.getShape(G);if(Y)for(const ce of this.getBindingsInvolvingShape(Y))C.add(ce.type),ce.fromId===Y.id&&((de=(ne=this.getBindingUtil(ce)).onAfterChangeFromShape)==null||de.call(ne,{binding:ce,shapeBefore:Y,shapeAfter:Y})),ce.toId===Y.id&&((Oe=(ae=this.getBindingUtil(ce)).onAfterChangeToShape)==null||Oe.call(ae,{binding:ce,shapeBefore:Y,shapeAfter:Y}))};B(R.id),this.visitDescendants(R.id,B)}if(k.parentId!==R.parentId&&Zt(R.parentId)){const B=new Set([k.id]);this.visitDescendants(k.id,G=>{B.add(G)});for(const G of this.getPageStates()){if(G.pageId===R.parentId)continue;const Y=w(G,B);Y&&this.store.put([Y])}}k.parentId&&en(k.parentId)&&T.add(k.parentId),R.parentId!==k.parentId&&en(R.parentId)&&T.add(R.parentId)},beforeDelete:k=>{var O,$,B,G;if(E.has(k.id))return;k.parentId&&en(k.parentId)&&T.add(k.parentId),E.add(k.id);const R=[];for(const Y of this.getBindingsInvolvingShape(k)){C.add(Y.type),R.push(Y.id);const ne=this.getBindingUtil(Y);Y.fromId===k.id?((O=ne.onBeforeIsolateToShape)==null||O.call(ne,{binding:Y,removedShape:k}),($=ne.onBeforeDeleteFromShape)==null||$.call(ne,{binding:Y,shape:k})):((B=ne.onBeforeIsolateFromShape)==null||B.call(ne,{binding:Y,removedShape:k}),(G=ne.onBeforeDeleteToShape)==null||G.call(ne,{binding:Y,shape:k}))}R.length&&this.deleteBindings(R);const A=new Set([k.id]),D=fe(this.getPageStates().map(Y=>w(Y,A)));D.length&&this.store.put(D)}},binding:{beforeCreate:k=>{var A,D;const R=(D=(A=this.getBindingUtil(k)).onBeforeCreate)==null?void 0:D.call(A,{binding:k});return R||k},afterCreate:k=>{var R,A;C.add(k.type),(A=(R=this.getBindingUtil(k)).onAfterCreate)==null||A.call(R,{binding:k})},beforeChange:(k,R)=>{var D,O;const A=(O=(D=this.getBindingUtil(R)).onBeforeChange)==null?void 0:O.call(D,{bindingBefore:k,bindingAfter:R});return A||R},afterChange:(k,R)=>{var A,D;C.add(R.type),(D=(A=this.getBindingUtil(R)).onAfterChange)==null||D.call(A,{bindingBefore:k,bindingAfter:R})},beforeDelete:k=>{var R,A;(A=(R=this.getBindingUtil(k)).onBeforeDelete)==null||A.call(R,{binding:k})},afterDelete:k=>{var R,A;(A=(R=this.getBindingUtil(k)).onAfterDelete)==null||A.call(R,{binding:k}),C.add(k.type)}},page:{afterCreate:k=>{const R=cr.createId(k.id),A=qn.createId(k.id);this.store.has(R)||this.store.put([cr.create({id:R})]),this.store.has(A)||this.store.put([qn.create({id:A,pageId:k.id})])},afterDelete:(k,R)=>{var O,$;if(((O=this.getInstanceState())==null?void 0:O.currentPageId)===k.id){const B=($=this.getPages().find(G=>G.id!==k.id))==null?void 0:$.id;B?this.store.put([{...this.getInstanceState(),currentPageId:B}]):R==="user"&&this.store.ensureStoreIsUsable()}const A=cr.createId(k.id),D=qn.createId(k.id);this.store.remove([A,D])}},instance:{afterChange:(k,R,A)=>{var D;if(!this.store.has(R.currentPageId)){const O=this.store.has(k.currentPageId)?k.currentPageId:(D=this.getPages()[0])==null?void 0:D.id;O?this.store.update(R.id,$=>({...$,currentPageId:O})):A==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(k,R)=>{if((k==null?void 0:k.selectedShapeIds)!==(R==null?void 0:R.selectedShapeIds)){const A=R.selectedShapeIds.filter(O=>{var B,G;let $=(B=this.getShape(O))==null?void 0:B.parentId;for(;en($);){if(R.selectedShapeIds.includes($))return!1;$=(G=this.getShape($))==null?void 0:G.parentId}return!0});let D=null;if(A.length>0){const O=this.findCommonAncestor(fe(A.map($=>this.getShape($))),$=>this.isShapeOfType($,"group"));O&&(D=O)}else R!=null&&R.focusedGroupId&&(D=R.focusedGroupId);(A.length!==R.selectedShapeIds.length||D!==R.focusedGroupId)&&this.store.put([{...R,selectedShapeIds:A,focusedGroupId:D??null}])}}}})),this._currentPageShapeIds=OO(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=DO(this.store),this.disposables.add(this.store.listen(k=>{this.emit("change",k)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new HO(this),this.focusManager=new KO(this,l),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new Hb,(j=this.store.props.collaboration)!=null&&j.mode){const k=this.store.props.collaboration.mode;this.disposables.add(ur("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:k.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,r=>this.isShapeHidden(r))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,r=Ft(this.shapeUtils,t);return De(r,`No shape util found for type "${t}"`),r}getBindingUtil(e){const t=typeof e=="string"?e:e.type,r=Ft(this.bindingUtils,t);return De(r,`No binding util found for type "${t}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??Fe()),this}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${Fe()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(t==null?void 0:t.ignoreShapeLock)??r;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:r,tags:s,extras:i}){const o=this.createErrorAnnotations(t,r);return xf(e,{tags:{...o.tags,...s},extras:{...o.extras,...i}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const s=t.pop();if(!s)return!0;const i=r.getCurrent();if((i==null?void 0:i.id)===s){if(t.length===0)return!0;r=i;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var s;const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const i=t.pop();if(!i)return r;const o=(s=r.children)==null?void 0:s[i];if(!o)return;r=o}return r}getDocumentSettings(){return this.store.get(wp)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(Kt)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return qn.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return fe(e.map(t=>this.store.get(t)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(i=>typeof i=="string"?i:i.id),{selectedShapeIds:r}=this.getCurrentPageState(),s=new Set(r);if(t.length===s.size&&t.every(i=>s.has(i)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(t);if(!r)return!1;const s=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,i=>s.includes(i.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=this.getSelectedShapeIds();return r.length>0&&t.length>0&&this.setSelectedShapes(r.filter(s=>!t.includes(s))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=fe(e.map(r=>this.getShapePageBounds(r)));return t.length===0?null:V.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,r=0;for(let s=0,i=e.length;s<i;s++){const o=this.getShapePageTransform(e[s]);if(o)if(t){if(o.rotation()!==r)return 0}else t=!0,r=o.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const s=this.getShapeGeometry(e[0]).bounds.clone(),i=this.getShapePageTransform(e[0]);return s.point=i.applyToPoint(s.point),s}const r=V.FromPoints(e.flatMap(s=>{const i=this.getShapePageTransform(s);return i?i.applyToPoints(this.getShapeGeometry(s).bounds.corners):[]}).map(s=>s.rot(-t)));return r.point=r.point.rot(t),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:r}=this.pageToScreen(e.point),s=this.getZoomLevel();return new V(t,r,e.width*s,e.height*s)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==null){const r=this.getShape(t);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((t==null?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const r=this.getShape(t);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return fe(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:yf(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return fe(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id);t.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(t.length===r.length){for(let s=0;s<t.length;s++)if(t[s]!==r[s]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(t),s=this.getShapeUtil(r);r&&s.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}_unsafe_getCameraId(){return cr.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find(h=>h.userId===e);if(!t)return null;const{w:r,h:s}=t.screenBounds,{x:i,y:o,z:a}=t.camera,c=new V(-i,-o,r/a,s/a),l=this.getViewportScreenBounds().clone(),u=l.width/l.height;return l.width=c.width,l.height=l.width/u,l.height<c.height&&(l.height=c.height,l.width=l.height*u),l.center=c.center,l}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:r}=Ox(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw mt(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:r}=Ox(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw mt(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const t=Ve({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=t.zoomSteps)==null?void 0:r.length)<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const r=this.getCamera();let{x:s,y:i,z:o=r.z}=e;if(!(t!=null&&t.force)){const a=this.getCameraOptions(),c=a.zoomSteps[0],l=Pt(a.zoomSteps),u=this.getViewportScreenBounds();if(a.constraints){const{constraints:h}=a,p=Math.min(h.padding.y,u.w/2),f=Math.min(h.padding.x,u.h/2),g=V.From(a.constraints.bounds),m=(u.w-f*2)/g.w,x=(u.h-p*2)/g.h,b=this.getBaseZoom(),S=l*b,P=c*b;if(t!=null&&t.reset&&(o=this.getInitialZoom()),o<P||o>S){const{x:A,y:D,z:O}=r,$=-A+u.w/O/2,B=-D+u.h/O/2;o=wt(o,P,S);const G=-A+u.w/o/2,Y=-D+u.h/o/2;s=A+G-$,i=D+Y-B}const w=f/o-g.x,I=p/o-g.y,E=(u.w-f*2)/o-g.w,T=(u.h-p*2)/o-g.h,C=w+E*h.origin.x,j=I+T*h.origin.y,k=typeof h.behavior=="string"?h.behavior:h.behavior.x,R=typeof h.behavior=="string"?h.behavior:h.behavior.y;if(t!=null&&t.reset)s=C,i=j;else{switch(k){case"fixed":{s=C;break}case"contain":{o<m?s=C:s=wt(s,w+E,w);break}case"inside":{o<m?s=wt(s,w,(u.w-f)/o-g.w):s=wt(s,w+E,w);break}case"outside":{s=wt(s,f/o-g.w,(u.w-f)/o);break}case"free":break;default:throw mt(k)}switch(R){case"fixed":{i=j;break}case"contain":{o<x?i=j:i=wt(i,I+T,I);break}case"inside":{o<x?i=wt(i,I,(u.h-p)/o-g.h):i=wt(i,I+T,I);break}case"outside":{i=wt(i,p/o-g.h,(u.h-p)/o);break}case"free":break;default:throw mt(R)}}}else if(o>l||o<c){const{x:h,y:p,z:f}=r;o=wt(o,c,l),s=h+(-h+u.w/o/2)-(-h+u.w/f/2),i=p+(-p+u.h/o/2)-(-p+u.h/f/2)}}return{x:s,y:i,z:o}}_setCamera(e,t){const r=this.getCamera(),{x:s,y:i,z:o}=this.getConstrainedCamera(e,t);return r.x===s&&r.y===i&&r.z===o?this:(hr(()=>{const a={...r,x:s,y:i,z:o};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:l}=this.inputs,{screenBounds:u}=this.store.unsafeGetWithoutCapture(Kt);if(c.x/o-s!==l.x||c.y/o-i!==l.y){const h={type:"pointer",target:"canvas",name:"pointer_move",point:y.AddXY(c,u.x,u.y),pointerId:cx.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:Lt(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};t!=null&&t.immediate?this._flushEventForTick(h):this.dispatch(h)}this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(t!=null&&t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const s=y.Cast(e);Number.isFinite(s.x)||(s.x=0),Number.isFinite(s.y)||(s.y=0),(s.z===void 0||!Number.isFinite(s.z))&&(e.z=this.getZoomLevel());const i=this.getConstrainedCamera(s,t);if(t!=null&&t.animation){const{width:o,height:a}=this.getViewportScreenBounds();this._animateToViewport(new V(-i.x,-i.y,o/i.z,a/i.z),t)}else this._setCamera(i,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{width:s,height:i}=this.getViewportPageBounds();return this.setCamera(new y(-(e.x-s/2),-(e.y-i/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const r=V.Common(fe(t.map(s=>this.getShapePageBounds(s))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:r,constraints:s}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const i=this.getCamera(),{x:o,y:a,z:c}=i,{x:l,y:u}=e;let h=1;if(s){const p=this.getInitialZoom();c!==p&&(h=p)}return this.setCamera(new y(o+(l/h-l)-(l/c-l),a+(u/h-u)-(u/c-u),h),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{x:s,y:i,z:o}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let l=Pt(a)*c;for(let u=1;u<a.length;u++){const h=a[u-1]*c,p=a[u]*c;if(!(p-o<=(p-h)/2)){l=p;break}}this.setCamera(new y(s+(e.x/l-e.x)-(e.x/o-e.x),i+(e.y/l-e.y)-(e.y/o-e.y),l),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{zoomSteps:s}=this.getCameraOptions();if(s!==null&&s.length>1){const i=this.getBaseZoom(),{x:o,y:a,z:c}=this.getCamera();let l=s[0]*i;for(let u=s.length-1;u>0;u--){const h=s[u-1]*i,p=s[u]*i;if(!(p-c>=(p-h)/2)){l=h;break}}this.setCamera(new y(o+(e.x/l-e.x)-(e.x/c-e.x),a+(e.y/l-e.y)-(e.y/c-e.y),l),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(t!=null&&t.force))return this;const s=this.getViewportScreenBounds(),i=(t==null?void 0:t.inset)??Math.min(XM,s.width*.28),o=this.getBaseZoom(),a=r.zoomSteps[0],c=Pt(r.zoomSteps);let l=wt(Math.min((s.width-i)/e.w,(s.height-i)/e.h),a*o,c*o);return(t==null?void 0:t.targetZoom)!==void 0&&(l=Math.min(t.targetZoom,l)),this.setCamera(new y(-e.x+(s.width-e.w*l)/2/l,-e.y+(s.height-e.h*l)/2/l,l),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:r,duration:s,start:i,end:o}=this._viewportAnimation;if(t>s){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new y(-o.x,-o.y,this.getViewportScreenBounds().width/o.width));return}const a=s-t,c=r(1-a/s),l=i.minX+(o.minX-i.minX)*c,u=i.minY+(o.minY-i.minY)*c,h=i.maxX+(o.maxX-i.maxX)*c;this._setCamera(new y(-l,-u,this.getViewportScreenBounds().width/(h-l)),{force:!0})}_animateToViewport(e,t={animation:ch}){const{animation:r,...s}=t;if(!r)return;const{duration:i=0,easing:o=yt.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),i===0||a===0?this._setCamera(new y(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...s}):(this._viewportAnimation={elapsed:0,duration:i/a,easing:o,start:c.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:s,friction:i=this.options.cameraSlideFriction,direction:o,speedThreshold:a=.01}=e;let c=Math.min(s,1);const l=()=>{this.off("tick",u),this.off("stop-camera-animation",l)};this.once("stop-camera-animation",l);const u=h=>{const{x:p,y:f,z:g}=this.getCamera(),m=y.Mul(o,c*h/g);c*=1-i,c<a?l():this._setCamera(new y(p+m.x,f+m.y,g))};return this.on("tick",u),this}zoomToUser(e,t={animation:{duration:500}}){const r=this.getCollaborators().find(s=>s.userId===e);return r?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const s=r.currentPageId===this.getCurrentPageId();s||this.setCurrentPage(r.currentPageId),t&&t.animation&&!s&&(t.animation=void 0),this.centerOnPoint(r.cursor,t);const{highlightedUserIds:i}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...i,e]}),this.timers.setTimeout(()=>{const o=[...this.getInstanceState().highlightedUserIds],a=o.indexOf(e);a<0||(o.splice(a,1),this.updateInstanceState({highlightedUserIds:o}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof HTMLElement){const a=e.getBoundingClientRect();e=new V(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!fs(document.body.scrollWidth,e.maxX,1),!fs(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:s}=this;this._willSetInitialBounds=!1;const{screenBounds:i,insets:o}=this.getInstanceState();if(e.equals(i)&&r.every((a,c)=>a===o[c]))return this;if(s)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(y.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:r,h:s}=this.getInstanceState().screenBounds;return new V(e,t,r,s)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new y(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:r,y:s,z:i}=this.getCamera();return new V(-r,-s,e/i,t/i)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(Kt),{x:r,y:s,z:i=1}=this.getCamera();return new y((e.x-t.x)/i-r,(e.y-t.y)/i-s,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(Kt),{x:r,y:s,z:i=1}=this.getCamera();return new y((e.x+r)*i+t.x,(e.y+s)*i+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:r,z:s=1}=this.getCamera();return new y((e.x+t)*s,(e.y+r)*s,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(i=>i.userId===r).sort((i,o)=>o.lastActivityTimestamp-i.lastActivityTimestamp)[0]):zr}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter(i=>i.userId===e);if(!t.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),t.some(i=>i.followingUserId===r))return this;const s=K("latestLeaderPresence",()=>this.getCollaborators().find(i=>i.userId===e));return hr(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const i=ur("update current page",()=>{const c=s.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),o=()=>{i(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",o)},a=()=>{if(!s.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const l=this.user.getAnimationSpeed();if(l===0){this._isLockedOnFollowingUser.set(!0);return}const u=this.getViewportPageBoundsForFollowing();if(!u){this.stopFollowingUser();return}const h=this.getViewportPageBounds(),p=Math.abs(u.minX-h.minX)+Math.abs(u.maxX-h.maxX),f=Math.abs(u.minY-h.minY)+Math.abs(u.maxY-h.maxY);if(p<this.options.followChaseViewportSnap&&f<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const g=wt(l*.5,.1,.8),m=new V(_e(h.minX,u.minX,g),_e(h.minY,u.minY,g),_e(h.width,u.width,g),_e(h.height,u.height,g)),x=new y(-m.x,-m.y,this.getViewportScreenBounds().width/m.width);this.stopCameraAnimation(),this._setCamera(x)};this.once("stop-following",o),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let r=this.options.maxShapesPerPage*2,s=this.options.maxShapesPerPage;const i=this.getErasingShapeIds(),o=(c,l,u)=>{const h=this.getShape(c);if(!h||this.isShapeHidden(h))return;l*=h.opacity;let p=!1;const f=this.getShapeUtil(h);e&&(p=!u&&i.includes(c),p&&(l*=.32)),t.push({id:c,shape:h,util:f,index:r,backgroundIndex:s,opacity:l}),r+=1,s+=1;const g=this.getSortedChildIdsForParent(c);if(!g.length)return;let m=null;f.providesBackgroundForChildren(h)&&(m=s,s=r,r+=this.options.maxShapesPerPage);for(const x of g)o(x,l,u||p);m!==null&&(s=m)},a=e?[this.getCurrentPage()]:this.getPages();for(const c of a)for(const l of this.getSortedChildIdsForParent(c.id))o(l,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort(FT)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Rt)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(r.map(s=>s.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),r=CO(e.name??"Page 1",t.map(o=>o.name));let s=e.index;(!s||t.some(o=>o.index===s))&&(s=ar(t[t.length-1].index));const i=In.create({meta:{},...e,name:r,index:s});this.store.put([i])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const s=this.getPage(t);if(s){if(t===this.getCurrentPageId()){const i=r.findIndex(a=>a.id===t),o=r[i-1]??r[i+1];this.setCurrentPage(o.id)}this.store.remove([s.id])}}),this}duplicatePage(e,t=In.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,s=this.getPage(r);if(!s)return this;const i={...this.getCamera()},o=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(s.id));return this.run(()=>{var l;const a=this.getPages(),c=Lo(s.index,(l=a[a.indexOf(s)+1])==null?void 0:l.index);if(this.createPage({name:s.name+" Copy",id:t,index:c}),this.setCurrentPage(t),this.setCamera(i),o)return this.putContentOntoCurrentPage(o)}),this}renamePage(e,t){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(r=>r.id);return t.length<=0?this:(this.run(()=>this.store.remove(t),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:s=1,shouldResolveToOriginal:i=!1}=t,a=Math.max(.125,(u=>Math.pow(2,Math.ceil(Math.log2(u))))(s)),c="connection"in navigator?navigator.connection.effectiveType:null,l=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(r,{screenScale:s||1,steppedScreenScale:a,dpr:l,networkEffectiveType:c,shouldResolveToOriginal:i})}async uploadAsset(e,t){return await this.store.props.assets.upload(e,t)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var t,r;return(r=(t=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(t,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);if(!r)throw Error("Editor.getTransform: shape not found");return W.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Zt(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??W.Identity();return W.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);return!r||Zt(r.parentId)?W.Identity():this._getShapePageTransformCache().get(r.parentId)??W.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??W.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this._getShapePageTransformCache().get(e.id);return t?V.FromPoints(W.applyToPoints(t,this.getShapeGeometry(e).vertices)):new V})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${W.applyToPoints(W.Inverse(r),t).map(i=>`${i.x}px ${i.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Zt(e.parentId))return;const t=this.getShapeAncestors(e.id).filter(s=>this.isShapeOfType(s,"frame"));return t.length===0?void 0:t.map(s=>this._getShapePageTransformCache().get(s.id).applyToPoints(this.getShapeGeometry(s).vertices)).reduce((s,i)=>{if(!(i&&s))return;const o=Sx(s,i);return o?o.map(y.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:s}=t;if(s.every((o,a)=>o&&y.Equals(o,r[a])))return t.clone();const i=Sx(r,s);return i?V.FromPoints(i):void 0}return t})}getShapeAncestors(e,t=[]){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return t;const i=s.parentId;if(Zt(i))return t.reverse(),t;const o=this.store.get(i);return o?(t.push(o),this.getShapeAncestors(o,t)):t}findShapeAncestor(e,t){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return;const i=s.parentId;if(Zt(i))return;const o=this.getShape(i);if(o)return t(o)?o:this.findShapeAncestor(o,t)}hasAncestor(e,t){const r=typeof e=="string"?e:e==null?void 0:e.id,s=r&&this.getShape(r);return s?s.parentId===t?!0:this.hasAncestor(this.getShapeParent(s),t):!1}findCommonAncestor(e,t){var c;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(l=>l.id),s=fe(r.map(l=>this.getShape(l)));if(s.length===1){const l=s[0].parentId;return Zt(l)?void 0:t?(c=this.findShapeAncestor(s[0],t))==null?void 0:c.id:l}const[i,...o]=s;let a=this.getShapeParent(i);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(o.every(l=>this.hasAncestor(l,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const t=typeof e=="string"?this.getShape(e):e;return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}_notVisibleShapes(){return AO(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),r=this.getEditingShapeId(),s=new Set(e);return r&&s.delete(r),t.forEach(i=>{s.delete(i)}),s}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const r=this.getShapeMaskedPageBounds(t);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&t.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const r=this.getZoomLevel(),s=this.getViewportPageBounds(),{filter:i,margin:o=0,hitLocked:a=!1,hitLabels:c=!1,hitInside:l=!1,hitFrameInside:u=!1}=t;let h=1/0,p=null,f=1/0,g=null;const m=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(x=>{if(x.isLocked&&!a||this.isShapeHidden(x)||this.isShapeOfType(x,"group"))return!1;const b=this.getShapeMask(x);return b&&!wn(e,b)?!1:i?i(x):!0});for(let x=m.length-1;x>=0;x--){const b=m[x],S=this.getShapeGeometry(b),P=S instanceof Rn,w=this.getPointInShapeSpace(b,e);if(this.isShapeOfType(b,"frame")||(this.isShapeOfType(b,"arrow")||this.isShapeOfType(b,"geo")&&b.props.fill==="none")&&b.props.text.trim()){for(const E of S.children)if(E.isLabel&&E.isPointInBounds(w))return b}if(this.isShapeOfType(b,"frame")){const E=S.distanceToPoint(w,l);if(Math.abs(E)<=o)return g||b;if(S.hitTestPoint(w,0,!0))return g||p||(u?b:void 0);continue}let I;if(P){let E=1/0;for(const T of S.children){if(T.isLabel&&!c)continue;const C=T.distanceToPoint(w,l);C<E&&(E=C)}I=E}else o===0&&(S.bounds.w<1||S.bounds.h<1)||S.bounds.containsPoint(w,o)?I=S.distanceToPoint(w,l):I=1/0;if(S.isClosed){if(I<=o){if(S.isFilled||P&&S.children[0].isFilled)return g||b;if(this.getShapePageBounds(b).contains(s))continue;if(Math.abs(I)<o)Math.abs(I)<f&&(f=Math.abs(I),g=b);else if(!g){const{area:E}=S;E<h&&(h=E,p=b)}}}else if(I<this.options.hitTestMargin/r)return b}return g||p||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,t))}isPointInShape(e,t,r={}){const{hitInside:s=!1,margin:i=0}=r,o=typeof e=="string"?e:e.id,a=this.getShapeMask(o);return a&&!wn(t,a)?!1:this.getShapeGeometry(o).hitTestPoint(this.getPointInShapeSpace(e,t),i,s)}getPointInShapeSpace(e,t){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return new y(0,0);if(Zt(s.parentId))return y.From(t);const i=this.getShapePageTransform(s.parentId);return i?i.clone().invert().applyToPoint(t):y.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,s=t.length;r<s;r++)mI(this,t[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(en(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e==null?void 0:e.id;if(!t)return;const r=this.getShape(t);if(!(r===void 0||!en(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,s=>s.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,s=this.getShape(r);if(!s)return!1;let i=!1;if(s.parentId===t)i=!0;else{let o=this.getShape(s.parentId);e:for(;o;){if(o.parentId===t){i=!0;break e}o=this.getShape(o.parentId)}}return i}getAncestorPageId(e){const t=typeof e=="string"?e:e==null?void 0:e.id,r=t&&this.getShape(t);if(r)return Zt(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,t,r){const s=typeof e[0]=="string"?e:e.map(p=>p.id);if(s.length===0)return this;const i=[],o=Zt(t)?W.Identity():this.getShapePageTransform(t),a=o.rotation();let c=[];const l=fe(this.getSortedChildIdsForParent(t).map(p=>this.getShape(p)));if(r){const p=l.find(f=>f.index===r);if(p){const f=l[l.indexOf(p)+1];f?c=Pi(r,f.index,s.length):c=id(r,s.length)}else{const f=l.sort(Rt).find(g=>g.index>r);f?c=Pi(r,f.index,s.length):c=id(r,s.length)}}else{const p=l.length&&l[l.length-1];c=p?id(p.index,s.length):Fo(s.length)}const u=o.clone().invert(),h=fe(s.map(p=>this.getShape(p)));return this.run(()=>{for(let p=0;p<h.length;p++){const f=h[p],g=this.getShapePageTransform(f);if(!g)continue;const m=g.point();if(!m)continue;const x=u.applyToPoint(m),b=g.rotation()-a;i.push({id:f.id,type:f.type,parentId:t,x:x.x,y:x.y,rotation:b,index:c[p]})}this.updateShapes(i)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];if(!r||r.length===0)return"a1";const s=this.getShape(r[r.length-1]);return ar(s.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];return r||zr}visitDescendants(e,t){const r=typeof e=="string"?e:e.id,s=this.getSortedChildIdsForParent(r);for(const i of s)t(i)!==!1&&this.visitDescendants(i,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const r of e.map(s=>this.getShape(s)).sort(Rt))t.add(r.id),this.visitDescendants(r,s=>{t.add(s)});return t}getDroppingOverShape(e,t=[]){const r=this.getCurrentPageShapesSorted();for(let s=r.length-1;s>=0;s--){const i=r[s];if(this.isShapeHidden(i)||this.getSelectedShapeIds().includes(i.id)||!this.getShapeUtil(i).canDropShapes(i,t)||t.find(a=>a.id===i.id||this.hasAncestor(i,a.id)))continue;const o=this.getShapeMaskedPageBounds(i.id);if(o&&o.containsPoint(e)&&this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(i,e),0,!0))return i}}getOutermostSelectableShape(e,t){const r=typeof e=="string"?e:e.id,s=this.getShape(r);let i=s,o=s;const a=this.getFocusedGroup();for(;o;){if(this.isShapeOfType(o,"group")&&(a==null?void 0:a.id)!==o.id&&!this.hasAncestor(a,o.id)&&((t==null?void 0:t(o))??!0))i=o;else if((a==null?void 0:a.id)===o.id)break;o=this.getShapeParent(o)}return i}_getBindingsIndexCache(){const e=jO(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(s=>s.fromId===r&&s.type===t)}getBindingsToShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(s=>s.toId===r&&s.type===t)}getBindingsInvolvingShape(e,t){const r=typeof e=="string"?e:e.id,s=this._getBindingsIndexCache().get(r)??zr;return t?s.filter(i=>i.type===t):s}createBindings(e){const t=[];for(const r of e){const s=this.getShape(r.fromId),i=this.getShape(r.toId);if(!s||!i||!this.canBindShapes({fromShape:s,toShape:i,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),c=this.store.schema.types.binding.create({...r,id:r.id??Rs(),props:{...a,...r.props}});t.push(c)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const r of e){if(!r)continue;const s=this.getBinding(r.id);if(!s)continue;const i=nr(s,r);if(i===s)continue;const o=this.getShape(i.fromId),a=this.getShape(i.toId);!o||!a||this.canBindShapes({fromShape:o,toShape:a,binding:i})&&t.push(i)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const r=e.map(s=>typeof s=="string"?s:s.id);return t?this.store.atomic(()=>{var s,i;for(const o of r){const a=this.getBinding(o);if(!a)continue;const c=this.getBindingUtil(a);(s=c.onBeforeIsolateFromShape)==null||s.call(c,{binding:a,removedShape:this.getShape(a.toId)}),(i=c.onBeforeIsolateToShape)==null||i.call(c,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([o])}}):this.store.remove(r),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:r}){const s=typeof e=="string"?e:e.type,i=typeof t=="string"?t:t.type,o=typeof r=="string"?r:r.type,a={fromShapeType:s,toShapeType:i,bindingType:o};return s===i?this.getShapeUtil(s).canBind(a):this.getShapeUtil(s).canBind(a)&&this.getShapeUtil(i).canBind(a)}rotateShapesBy(e,t,r){const s=typeof e[0]=="string"?e:e.map(o=>o.id);if(s.length<=0)return this;const i=Hv({editor:this,ids:s});return i?(Ya({delta:t,snapshot:i,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,t){var i,o,a;let r=e;const s=this.getShapeUtil(e);return r=nr(r,((i=s.onTranslateStart)==null?void 0:i.call(s,r))??void 0),r=nr(r,{id:e.id,type:e.type,x:t.x,y:t.y}),r=nr(r,((o=s.onTranslate)==null?void 0:o.call(s,e,r))??void 0),r=nr(r,((a=s.onTranslateEnd)==null?void 0:a.call(s,e,r))??void 0),r}nudgeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(i=>i.id);if(r.length<=0)return this;const s=[];for(const i of r){const o=this.getShape(i),a=y.From(t),c=this.getShapeParentTransform(o);c&&a.rot(-c.rotation()),s.push(this.getChangesToTranslateShape(o,a.add(o)))}return this.updateShapes(s),this}duplicateShapes(e,t){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(p=>p.id);if(r.length<=0)return this;const s=new Set(r),i=this.getShapeAndDescendantIds(r),o=[...i].reverse(),a=new Map;for(const p of i)a.set(p,ze());const{shapesToCreateWithOriginals:c,bindingsToCreate:l}=Dx(this,i,p=>{const f=[];for(const m of p){const x=this.getBinding(m);if(!x)continue;const b=Rs();f.push({...x,id:b,fromId:tn(a.get(x.fromId)),toId:tn(a.get(x.toId))})}const g=[];for(const m of o){const x=tn(a.get(m)),b=this.getShape(m);if(!b)continue;let S=0,P=0;if(t&&s.has(m)){const w=this.getShapeParentTransform(b),I=new y(t.x,t.y).rot(-w.rotation());S=I.x,P=I.y}g.push({shape:{...b,id:x,x:b.x+S,y:b.y+P,index:"a1",parentId:a.get(b.parentId)??b.parentId},originalShape:b})}return{shapesToCreateWithOriginals:g,bindingsToCreate:f}});c.forEach(({shape:p,originalShape:f})=>{const g=f.parentId,m=this.getSortedChildIdsForParent(g),x=m.indexOf(f.id),b=m[x+1],S=b?this.getShape(b):void 0,P=Lo(f.index,S==null?void 0:S.index);p.index=P});const u=c.map(({shape:p})=>p);if(u.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Ta(this);return}if(this.createShapes(u),this.createBindings(l),this.setSelectedShapes(fe(r.map(p=>a.get(p)))),t!==void 0){const p=this.getSelectionPageBounds(),f=this.getViewportPageBounds();p&&!f.contains(p)&&this.centerOnPoint(p.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const s=this.getCurrentPageId();if(t===s)return this;if(!this.store.has(t))return this;const i=this.getContentFromCurrentPage(r);if(!i)return this;if(this.getPageShapeIds(t).size+i.shapes.length>this.options.maxShapesPerPage)return Ta(this,t),this;const o=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:o}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly()||t.length===0)return this;let r=!0,s=!0;const i=[];for(const o of t){const a=this.getShape(o);a&&(i.push(a),a.isLocked?s=!1:r=!1)}return this.run(()=>{s?(this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!1}))):this.updateShapes(i.map(o=>({id:o.id,type:o.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=_a(this,"toBack",t,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,t={}){const r=typeof e[0]=="string"?e:e.map(i=>i.id),s=_a(this,"backward",r,t);return s&&this.updateShapes(s),this}bringForward(e,t={}){const r=typeof e[0]=="string"?e:e.map(i=>i.id),s=_a(this,"forward",r,t);return s&&this.updateShapes(s),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=_a(this,"toFront",t);return r&&this.updateShapes(r),this}flipShapes(e,t){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(this.getIsReadonly())return this;let s=fe(r.map(o=>this.getShape(o)));if(!s.length)return this;s=fe(s.map(o=>this.isShapeOfType(o,"group")?this.getSortedChildIdsForParent(o.id).map(a=>this.getShape(a)):o).flat());const i=V.Common(fe(s.map(o=>this.getShapePageBounds(o)))).center;return this.run(()=>{for(const o of s){const a=this.getShapeGeometry(o).bounds,c=this.getShapePageTransform(o.id);c&&this.resizeShape(o.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:a,initialPageTransform:c,initialShape:o,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(o).isAspectRatioLocked(o),scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(e,t,r){const s=typeof e[0]=="string"?e:e.map(m=>m.id);if(this.getIsReadonly())return this;const i=s.map(m=>this.getShape(m)).filter(m=>m?this.getShapeUtil(m).canBeLaidOut(m):!1),o=i.length;if(r===0&&o<3||o<2)return this;const a=Object.fromEntries(i.map(m=>[m.id,this.getShapePageBounds(m)]));let c,l,u,h;t==="horizontal"?(c="x",l="minX",u="maxX",h="width"):(c="y",l="minY",u="maxY",h="height");let p;if(r===0){const m=[];i.sort((b,S)=>a[b.id][l]-a[S.id][l]);for(let b=0;b<o-1;b++){const S=i[b],P=i[b+1],w=a[S.id],E=a[P.id][l]-w[u],T=m.find(C=>C.gap===E);T?T.count++:m.push({gap:E,count:1})}let x=0;m.forEach(b=>{b.count>x&&(x=b.count,p=b.gap)}),x===1&&(p=Math.max(0,m.reduce((b,S)=>b+S.gap*S.count,0)/(o-1)))}else p=r;const f=[];let g=a[i[0].id][u];return i.forEach((m,x)=>{var I,E;if(x===0)return;const b={x:0,y:0};b[c]=g+p-a[m.id][c];const S=this.getShapeParent(m),P=S?y.Rot(b,-this.getShapePageTransform(S).decompose().rotation):b,w=(E=(I=this.getShapeUtil(m)).onTranslateStart)==null?void 0:E.call(I,m);f.push(w?{...w,[c]:m[c]+P[c]}:{id:m.id,type:m.type,[c]:m[c]+P[c]}),g+=a[m.id][h]+p}),this.updateShapes(f),this}packShapes(e,t){var E,T;const r=typeof e[0]=="string"?e:e.map(C=>C.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const s=r.map(C=>this.getShape(C)).filter(C=>C?this.getShapeUtil(C).canBeLaidOut(C):!1),i={},o={};let a,c,l=0;for(let C=0;C<s.length;C++)a=s[C],c=this.getShapePageBounds(a),i[a.id]=c,o[a.id]=c.clone(),l+=c.width*c.height;const u=V.Common(fe(Object.values(i))),h=u.width;s.sort((C,j)=>i[j.id].height-i[C.id].height);const p=Math.max(Math.ceil(Math.sqrt(l/.95)),h),f=[new V(u.x,u.y,p,1/0)];let g=0,m=0,x,b;for(let C=0;C<s.length;C++){a=s[C],c=o[a.id];for(let j=f.length-1;j>=0;j--)if(x=f[j],!(c.width>x.width||c.height>x.height)){c.x=x.x,c.y=x.y,m=Math.max(m,c.maxY),g=Math.max(g,c.maxX),c.width===x.width&&c.height===x.height?(b=f.pop(),j<f.length&&(f[j]=b)):c.height===x.height?(x.x+=c.width+t,x.width-=c.width+t):c.width===x.width?(x.y+=c.height+t,x.height-=c.height+t):(f.push(new V(x.x+(c.width+t),x.y,x.width-(c.width+t),c.height)),x.y+=c.height+t,x.height-=c.height+t);break}}const S=V.Common(Object.values(o)),P=y.Sub(u.center,S.center);let w;const I=[];for(let C=0;C<s.length;C++){a=s[C],c=i[a.id],w=o[a.id];const j=y.Sub(w.point,c.point).add(P),k=this.getShapeParentTransform(a);k&&j.rot(-k.rotation());const R={id:a.id,type:a.type,x:a.x+j.x,y:a.y+j.y},A=(T=(E=this.getShapeUtil(a)).onTranslateStart)==null?void 0:T.call(E,{...a,...R});A?I.push({...R,...A}):I.push(R)}return I.length&&this.updateShapes(I),this}alignShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const s=fe(r.map(c=>this.getShape(c))),i=Object.fromEntries(s.map(c=>[c.id,this.getShapePageBounds(c)])),o=V.Common(fe(Object.values(i))),a=[];return s.forEach(c=>{const l=i[c.id];if(!l)return;const u={x:0,y:0};switch(t){case"top":{u.y=o.minY-l.minY;break}case"center-vertical":{u.y=o.midY-l.minY-l.height/2;break}case"bottom":{u.y=o.maxY-l.minY-l.height;break}case"left":{u.x=o.minX-l.minX;break}case"center-horizontal":{u.x=o.midX-l.minX-l.width/2;break}case"right":{u.x=o.maxX-l.minX-l.width;break}}const h=this.getShapeParent(c),p=h?y.Rot(u,-this.getShapePageTransform(h).decompose().rotation):u;a.push(this.getChangesToTranslateShape(c,y.Add(c,p)))}),this.updateShapes(a),this}distributeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(S=>S.id);if(this.getIsReadonly())return this;if(r.length<3)return this;const s=r.length,i=fe(r.map(S=>this.getShape(S))),o=Object.fromEntries(i.map(S=>[S.id,this.getShapePageBounds(S)]));let a,c,l,u,h;t==="horizontal"?(a="x",c="minX",l="maxX",u="midX",h="width"):(a="y",c="minY",l="maxY",u="midY",h="height");const p=[],f=i.sort((S,P)=>o[S.id][c]-o[P.id][c])[0],g=i.sort((S,P)=>o[P.id][l]-o[S.id][l])[0],m=o[f.id][u],x=(o[g.id][u]-m)/(s-1),b=m+x;return i.filter(S=>S!==f&&S!==g).sort((S,P)=>o[S.id][u]-o[P.id][u]).forEach((S,P)=>{const w={x:0,y:0};w[a]=b+x*P-o[S.id][h]/2-o[S.id][a];const I=this.getShapeParent(S),E=I?y.Rot(w,-this.getShapePageTransform(I).rotation()):w;p.push(this.getChangesToTranslateShape(S,y.Add(S,E)))}),this.updateShapes(p),this}stretchShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const s=fe(r.map(c=>this.getShape(c))),i=Object.fromEntries(r.map(c=>[c,this.getShapeGeometry(c).bounds])),o=Object.fromEntries(r.map(c=>[c,this.getShapePageBounds(c)])),a=V.Common(fe(Object.values(o)));switch(t){case"vertical":{this.run(()=>{for(const c of s){if(this.getShapePageTransform(c).rotation()%Le)continue;const u=i[c.id],h=o[c.id],p=new y(0,a.minY-h.minY),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:g,y:m}=y.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:m}]);const x=new y(1,a.height/h.height);this.resizeShape(c.id,x,{initialBounds:u,scaleOrigin:new y(h.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of s){const l=i[c.id],u=o[c.id];if(this.getShapePageTransform(c).rotation()%Le)continue;const p=new y(a.minX-u.minX,0),f=this.getShapeParentTransform(c);f&&p.rot(-f.rotation());const{x:g,y:m}=y.Add(p,c);this.updateShapes([{id:c.id,type:c.type,x:g,y:m}]);const x=new y(a.width/u.width,1);this.resizeShape(c.id,x,{initialBounds:l,scaleOrigin:new y(a.minX,u.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(e,t,r={}){var f,g,m;const s=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new y(1,t.y)),Number.isFinite(t.y)||(t=new y(t.x,1));const i=r.initialShape??this.getShape(s);if(!i)return this;const o=r.scaleOrigin??((f=this.getShapePageBounds(s))==null?void 0:f.center);if(!o)return this;const a=r.initialPageTransform?W.Cast(r.initialPageTransform):this.getShapePageTransform(s);if(!a)return this;const c=a.rotation();if(c==null)return this;const l=r.scaleAxisRotation??c,u=r.initialBounds??this.getShapeGeometry(s).bounds;if(!u)return this;const h=r.isAspectRatioLocked??this.getShapeUtil(i).isAspectRatioLocked(i);if(!H0(c,l))return this._resizeUnalignedShape(s,t,{...r,initialBounds:u,scaleOrigin:o,scaleAxisRotation:l,initialPageTransform:a,isAspectRatioLocked:h,initialShape:i});const p=this.getShapeUtil(i);if(h&&(Math.abs(t.x)>Math.abs(t.y)?t=new y(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new y(Math.sign(t.x)*Math.abs(t.y),t.y)),p.onResize&&p.canResize(i)){const x=this._scalePagePoint(W.applyToPoint(a,new y(0,0)),o,t,l),b=this.getPointInParentSpace(i.id,x),S=new y(t.x,t.y),P=fs((c-l)%Math.PI,0);S.x=P?t.x:t.y,S.y=P?t.y:t.x;const w=W.applyToPoint(a,new y),{x:I,y:E}=this.getPointInParentSpace(i.id,w);let T=i;r.skipStartAndEndCallbacks||(T=nr(i,((g=p.onResizeStart)==null?void 0:g.call(p,i))??void 0)),T=nr(T,{id:s,type:i.type,x:b.x,y:b.y,...p.onResize({...i,x:I,y:E},{newPoint:b,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:S.x,scaleY:S.y,initialBounds:u,initialShape:i})}),r.skipStartAndEndCallbacks||(T=nr(T,((m=p.onResizeEnd)==null?void 0:m.call(p,i,T))??void 0)),this.updateShapes([T])}else{const x=W.applyToPoint(a,u.center),b=this._scalePagePoint(x,o,t,l),S=this.getPointInParentSpace(i.id,x),P=this.getPointInParentSpace(i.id,b),w=y.Sub(P,S);this.updateShapes([{id:s,type:i.type,x:i.x+w.x,y:i.y+w.y}])}return this}_scalePagePoint(e,t,r,s){const i=y.RotWith(e,t,-s).sub(t),o=y.MulV(i,r);return y.Add(o,t).rotWith(t,s)}_resizeUnalignedShape(e,t,r){const{type:s}=r.initialShape,i=new y(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?i.x=Math.sign(t.x)*Math.abs(t.y):i.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,i,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:x}=W.Decompose(r.initialPageTransform);x-=2*x,this.updateShapes([{id:e,type:s,rotation:x}])}const o=W.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(o,r.scaleOrigin,t,r.scaleAxisRotation),c=this.getShapePageBounds(e),l=this.getShapePageTransform(e),u=c.center,h=l.point();if(!u||!h)return this;const p=y.Sub(a,u),f=y.Add(h,p),{x:g,y:m}=this.getPointInParentSpace(e,f);return this.updateShapes([{id:e,type:s,x:g,y:m}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return Ta(this),this;const s=this.getFocusedGroupId();return this.run(()=>{var u,h;const i=this.getCurrentPageShapesSorted(),o=e.map(p=>{if(p.id||(p={id:ze(),...p}),!p.parentId||!(this.store.has(p.parentId)||e.some(f=>f.id===p.parentId))){let f=this.getFocusedGroupId();for(let m=i.length-1;m>=0;m--){const x=i[m];if(!this.isShapeHidden(x)&&this.getShapeUtil(x).canReceiveNewChildrenOfType(x,p.type)&&this.isPointInShape(x,{x:p.x??0,y:p.y??0},{margin:0,hitInside:!0})){f=x.id;break}}const g=p.parentId;if(f===p.id&&(f=s),f!==g&&(p={...p},p.parentId=f,en(f))){const m=this.getPointInShapeSpace(this.getShape(f),{x:p.x??0,y:p.y??0});p.x=m.x,p.y=m.y,p.rotation=-this.getShapePageTransform(f).rotation()+(p.rotation??0)}}return p}),a=new Map,c=[],{opacityForNextShape:l}=this.getInstanceState();for(const p of o){const f=this.getShapeUtil(p);let g=p.index;if(!g){const S=p.parentId??s;a.has(S)||a.set(S,this.getHighestIndexForParent(S)),g=a.get(S),a.set(S,ar(g))}const m=f.getDefaultProps();for(const[S,P]of this.styleProps[p.type])m[P]=this.getStyleForNextShape(S);let x=this.store.schema.types.shape.create({...p,index:g,opacity:p.opacity??l,parentId:p.parentId??s,props:"props"in p?{...m,...p.props}:m});if(x.index===void 0)throw Error("no index!");const b=(h=(u=this.getShapeUtil(x)).onBeforeCreate)==null?void 0:h.call(u,x);b&&(x=b),c.push(x)}c.forEach(p=>{p.meta={...this.getInitialMetaForShape(p),...p.meta}}),this.store.put(c)}),this}animateShape(e,t={animation:ch}){return this.animateShapes([e],t)}animateShapes(e,t={animation:ch}){if(!t.animation)return this;const{duration:r=500,easing:s=yt.linear}=t.animation,i=Fe();let o=r,a;const c=[];let l,u;for(let p=0,f=e.length;p<f;p++){if(l=e[p],!l)continue;const g=this.getShape(l.id);g&&(u={start:Ve(g),end:nr(Ve(g),l)},c.push(u),this.animatingShapes.set(g.id,i))}const h=p=>{var x,b;if(o-=p,o<0){const{animatingShapes:S}=this,P=e.filter(w=>w&&S.get(w.id)===i);P.length&&this.updateShapes(P),this.off("tick",h);return}a=s(1-o/r);const{animatingShapes:f}=this,g=[];let m;for(let S=0,P=c.length;S<P;S++){const{start:w,end:I}=c[S];m=f.get(w.id),m===i&&g.push({...I,x:w.x+(I.x-w.x)*a,y:w.y+(I.y-w.y)*a,opacity:w.opacity+(I.opacity-w.opacity)*a,rotation:w.rotation+(I.rotation-w.rotation)*a,props:((b=(x=this.getShapeUtil(I)).getInterpolatedProps)==null?void 0:b.call(x,w,I,a))??I.props})}this._updateShapes(g)};return this.on("tick",h),this}groupShapes(e,t={}){var g;const{groupId:r=ze(),select:s=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const i=typeof e[0]=="string"?e:e.map(m=>m.id);if(i.length<=1)return this;const o=fe((this._shouldIgnoreShapeLock?i:this._getUnlockedShapeIds(i)).map(m=>this.getShape(m))),a=o.sort(Rt).map(m=>m.id),c=V.Common(fe(o.map(m=>this.getShapePageBounds(m)))),{x:l,y:u}=c.point,h=this.findCommonAncestor(o)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const p=o.filter(m=>m.parentId===h).sort(Rt),f=(g=p[p.length-1])==null?void 0:g.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:h,index:f,x:l,y:u,opacity:1,props:{}}]),this.reparentShapes(a,r),s&&this.select(r)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:r=!0}=t,s=typeof e[0]=="string"?e:e.map(c=>c.id),i=fe((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(c=>this.getShape(c)));if(i.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const o=new Set,a=[];return i.forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):o.add(c.id)}),a.length===0?this:(this.run(()=>{let c;for(let l=0,u=a.length;l<u;l++){c=a[l];const h=this.getSortedChildIdsForParent(c.id);for(let p=0,f=h.length;p<f;p++)o.add(h[p]);this.reparentShapes(h,c.parentId,c.index)}this.deleteShapes(a.map(l=>l.id)),r&&this.select(...o)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let r=0,s=e.length;r<s;r++){const i=e[r];if(!i)continue;const o=this.getShape(i.id);if(o){if(!this._shouldIgnoreShapeLock){if(o.isLocked){if(!(Object.hasOwn(i,"isLocked")&&!i.isLocked))continue}else if(this.isShapeOrAncestorLocked(o))continue}this.animatingShapes.delete(i.id),t.push(i)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var i,o;const t=[];let r,s;for(let a=0,c=e.length;a<c;a++){const l=e[a];l&&(r=this.getShape(l.id),r&&(s=nr(r,l),s!==r&&(s=((o=(i=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:o.call(i,r,s))??s,t.push(s))))}this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>{var r;return!((r=this.getShape(t))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(i=>i.id),r=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(r.length===0)return this;const s=new Set(r);for(const i of r)this.visitDescendants(i,o=>{s.add(o)});return this.run(()=>this.store.remove([...s]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let s=0,i=r.length;s<i;s++)this._extractSharedStyles(this.getShape(r[s]),t)}else for(const[r,s]of this.styleProps[e.type])t.applyValue(r,Ft(e.props,s))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new Mp;for(const r of e)this._extractSharedStyles(r,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const r=this.styleProps[e.type].get(t);if(r!==void 0)return Ft(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new Mp;if(!e)return t;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())t.applyValue(r,this.getStyleForNextShape(r));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=s=>{const i=this.getShape(s);if(i)if(this.isShapeOfType(i,"group"))for(const o of this.getSortedChildIdsForParent(i.id))t(o);else e.push(i)};for(const s of this.getSelectedShapeIds())t(s);let r=null;for(const s of e)if(r===null)r=s.opacity;else if(r!==s.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const r=[],s=i=>{if(this.isShapeOfType(i,"group")){const o=this.getSortedChildIdsForParent(i);for(const a of o)s(this.getShape(a))}else r.push(i)};for(const i of t)s(i);this.updateShapes(r.map(i=>({id:i.id,type:i.type,opacity:e})))}return this}setStyleForNextShapes(e,t,r){const s=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...s,[e.id]:t}},r),this}setStyleForSelectedShapes(e,t){const r=this.getSelectedShapes();if(r.length>0){const s=[],i=o=>{if(this.isShapeOfType(o,"group")){const a=this.getSortedChildIdsForParent(o.id);for(const c of a)i(this.getShape(c))}else{const a=this.getShapeUtil(o),c=this.styleProps[o.type].get(e);if(c){const l={id:o.id,type:o.type,props:{[c]:t}};s.push({util:a,originalShape:o,updatePartial:l})}}};for(const o of r)i(o);this.updateShapes(s.map(({updatePartial:o})=>o))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,r;return await((r=(t=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,r;return(r=(t=this.externalContentHandlers)[e.type])==null?void 0:r.call(t,e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(s=>s.id);if(!t||t.length===0)return;const r=this.getShapeAndDescendantIds(t);return Dx(this,r,s=>{const i=[];for(const u of s){const h=this.getBinding(u);h&&i.push(h)}const o=[],a=[];for(const u of r){const h=this.getShape(u);if(!h)continue;if(!r.has(h.parentId)){const f=this.getShapePageTransform(h.id),g=f.point();a.push({...h,x:g.x,y:g.y,rotation:f.rotation(),parentId:this.getCurrentPageId()}),o.push(h.id)}else a.push(h)}const c=[],l=new Set;for(const u of a){if(!("assetId"in u.props))continue;const h=u.props.assetId;if(!h||l.has(h))continue;l.add(h);const p=this.getAsset(h);p&&c.push(p)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:o,bindings:i,assets:c}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async r=>{var s,i;if((r.type==="image"||r.type==="video")&&!((s=r.props.src)!=null&&s.startsWith("data:image"))&&!((i=r.props.src)!=null&&i.startsWith("http"))){const o=Ve(r),a=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});o.props.src=await Kn.blobToDataUrl(await fr(a).then(c=>c.blob())),t.push(o)}else t.push(r)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var k,R;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:s=!1,preservePosition:i=!1}=t;let{point:o=void 0}=t;const a=this.getCurrentPageId(),{rootShapeIds:c}=e,l=[],u=[],h=[],p={store:{...Object.fromEntries(e.assets.map(A=>[A.id,A])),...Object.fromEntries(e.shapes.map(A=>[A.id,A])),...Object.fromEntries(((k=e.bindings)==null?void 0:k.map(A=>[A.id,A]))??[])},schema:e.schema},f=this.store.schema.migrateStoreSnapshot(p);if(f.type==="error")throw Error("Could not put content: could not migrate content");for(const A of Object.values(f.value))switch(A.typeName){case"asset":{l.push(A);break}case"shape":{u.push(A);break}case"binding":{h.push(A);break}}const g=new Map(s?u.map(A=>[A.id,A.id]):u.map(A=>[A.id,ze()])),m=new Map(s?h.map(A=>[A.id,A.id]):h.map(A=>[A.id,Rs()]));let x=this.getCurrentPageId(),b=1/0,S=[];for(const A of this.getSelectedShapes()){if(b===0)break;const D=this.isShapeOfType(A,"frame"),O=this.getShapeAncestors(A);D&&O.push(A);const $=D?O.length+1:O.length;if($<b)b=$,S=O,x=D?A.id:A.parentId;else if($===b){if(S.length!==O.length)throw Error(`Ancestors: ${S.length} !== ${O.length}`);if(S.length===0){x=a;break}else{x=a;for(let B=0;B<S.length&&O[B]===S[B];B++)x=O[B].id}}}let P=!1;if(!Zt(x)){const A=this.getShape(x);if(A){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(A)))x=a;else if(c.length===1){const D=u.find(O=>O.id===c[0]);this.isShapeOfType(A,"frame")&&this.isShapeOfType(D,"frame")&&D.props.w===(A==null?void 0:A.props.w)&&D.props.h===(A==null?void 0:A.props.h)&&(P=!0)}}else x=a}P||(P=g.has(x)),P&&(x=this.getShape(x).parentId);let w=this.getHighestIndexForParent(x);const I=[],E=u.map(A=>{const D=g.get(A.id),O={...A,id:D};return c.includes(A.id)&&(O.parentId=a,I.push(O)),g.has(O.parentId)?O.parentId=g.get(A.parentId):(c.push(O.id),O.index=w,w=ar(w)),O});if(E.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Ta(this),this;const T=h.map(A=>({...A,id:tn(m.get(A.id)),fromId:tn(g.get(A.fromId)),toId:tn(g.get(A.toId))})),C=[],j=[];for(const A of l)this.store.has(A.id)||((A.type==="image"||A.type==="video")&&((R=A.props.src)!=null&&R.startsWith("data:image"))&&(j.push(Ve(A)),A.props.src=null),C.push(A));return Promise.allSettled(j.map(async A=>{const D=await wO(A.props.src,A.props.name,A.props.mimeType??"image/png"),O=await this.getAssetForExternalContent({type:"file",file:D,assetId:A.id});if(!O){this.deleteAssets([A.id]);return}this.updateAssets([{...O,id:A.id}])})),this.run(()=>{C.length>0&&this.createAssets(C),this.createShapes(E),this.createBindings(T),r&&this.select(...I.map(B=>B.id)),x!==a&&this.reparentShapes(I.map(B=>B.id),x);const A=E.map(B=>this.getShape(B.id)),D=V.Common(A.map(B=>this.getShapePageBounds(B)));if(o===void 0)if(Zt(x)){const B=this.getViewportPageBounds();i||B.includes(V.From(D))?o=D.center:o=B.center}else{const B=this.getShape(x);o=W.applyToPoint(this.getShapePageTransform(B),this.getShapeGeometry(B).bounds.center)}if(I.length===1){const B=I[0];if(this.isShapeOfType(B,"frame"))for(;this.getShapesAtPoint(o).some(G=>this.isShapeOfType(G,"frame")&&G.props.w===B.props.w&&G.props.h===B.props.h);)o.x+=D.w+16}const O=V.Common(fe(I.map(({id:B})=>this.getShapePageBounds(B)))).center,$=y.Sub(o,O);this.updateShapes(I.map(({id:B})=>{const G=this.getShape(B),Y=this.getShapeParentTransform(B).decompose().rotation,ne=y.Rot($,-Y);return{id:G.id,type:G.type,x:G.x+ne.x,y:G.y+ne.y}}))}),this}async getSvgElement(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(r.length!==0)return yO(this,r,t)}async getSvgString(e,t={}){const r=await this.getSvgElement(e,t);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,t={}){const r=await this.getSvgElement(e,t);if(r)return r.svg}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:r,previousPagePoint:s,currentScreenPoint:i,currentPagePoint:o}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(Kt),{x:c,y:l,z:u}=ga(()=>this.getCamera()),h=e.point.x-a.x,p=e.point.y-a.y,f=e.point.z??.5;r.setTo(i),s.setTo(o),i.set(h,p);const g=h/u-c,m=p/u-l;isFinite(g)&&isFinite(m)&&o.set(g,m,f),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(i),this.inputs.originPagePoint.setTo(o)),this.run(()=>{var x;this.store.put([{id:Ac,typeName:"pointer",x:o.x,y:o.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===cx.CAMERA_MOVE?((x=this.store.unsafeGetWithoutCapture(Ac))==null?void 0:x.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return vD(this.store)}loadSnapshot(e,t){return yv(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=fe(e.shapeIds.map(o=>this.getShape(o))),r={};for(const o of t){const a=this.getAncestorPageId(o);a&&(r[a]??(r[a]=[]),r[a].push(o))}const[s,i]=Object.entries(r).sort(([o,a],[c,l])=>l.length-a.length)[0]??["",[]];if(!s||!i.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(s);const o=V.Common(i.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(o,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:mt(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(IO(r))}catch(s){console.warn(s),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL((e==null?void 0:e.url)??window.location.href);return t.searchParams.set((e==null?void 0:e.param)??"d",PO((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=K("url with state",()=>{var c,l;const o=((c=e==null?void 0:e.getUrl)==null?void 0:c.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:o,to:(l=e==null?void 0:e.getTarget)==null?void 0:l.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var a;const o=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,o.toString())}),s=Zc(o=>o(),(e==null?void 0:e.debounceMs)??500),i=ur("update url on state change",()=>r(new URL(t.get()),this),{scheduleEffect:s});return()=>{i(),s.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Lt(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Lt(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Lt(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:Lt(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of t)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:t}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:s,currentPagePoint:i}=t;t.isPointing||(t.isDragging=!1);const o=this.store.unsafeGetWithoutCapture(Kt),a=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:l=1},delta:{x:u,y:h}}=e,{x:p,y:f}=y.SubXY(e.point,o.screenBounds.x,o.screenBounds.y);this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:g,y:m,z:x}=ga(()=>this.getCamera()),{panSpeed:b,zoomSpeed:S}=c;this._setCamera(new y(g+u*b/x-p/x+p/(l*S),m+h*b/x-f/x+f/(l*S),l*S),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:l}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,l.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(l)}));return}}}case"wheel":{if(c.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:l,zoomSpeed:u,wheelBehavior:h}=c;if(h!=="none"){this.stopCameraAnimation(),o.followingUserId&&this.stopFollowingUser();const{x:p,y:f,z:g}=ga(()=>this.getCamera()),{x:m,y:x,z:b=0}=e.delta;let S=h;switch(t.ctrlKey&&(S=h==="pan"?"zoom":"pan"),S){case"zoom":{const{x:P,y:w}=this.inputs.currentScreenPoint;let I=b;h==="zoom"&&(Math.abs(x)>10?I=10*Math.sign(x)/100:I=x/100);const E=g+(I??0)*u*g;this._setCamera(new y(p+(P/E-P)-(P/g-P),f+(w/E-w)-(w/g-w),E),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new y(p+m*l/g,f+x*l/g,g),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:l}=e,{isPenMode:u}=o;switch(e.name){case"pointer_down":{if(u&&!l)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{this.dispatch({...e,point:this.inputs.currentScreenPoint,name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===lx&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!u&&l&&this.updateInstanceState({isPenMode:!0}),e.button===dx?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===va&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!l&&u)return;const{x:h,y:p,z:f}=ga(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:g,previousScreenPoint:m}=this.inputs,{panSpeed:x}=c,b=y.Sub(g,m);this.setCamera(new y(h+b.x*x/f,p+b.y*x/f,f),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&y.Dist2(s,i)*this.getZoomLevel()>(o.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/f&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),o.isPenMode&&!l)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const h=this.inputs.pointerVelocity,p=Math.min(2,h.len());switch(e.button){case lx:{this.setCursor({type:"grab",rotation:0});break}case va:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}p>0&&this.slideCamera({speed:p,direction:h})}else e.button===dx&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=o.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let l;switch(e.code){case"ArrowUp":{l=new y(0,-1);break}case"ArrowRight":{l=new y(1,0);break}case"ArrowDown":{l=new y(0,1);break}case"ArrowLeft":{l=new y(-1,0);break}}if(l){const u=this.getViewportPageBounds(),h=u.clone().translate(l.mulV({x:u.w,y:u.h}));this._animateToViewport(h,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(va)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===va?e.name="middle_click":e.button===rg&&(e.name="right_click");const{isPenMode:l}=this.store.unsafeGetWithoutCapture(Kt);if(e.isPen===l){const u=this._clickManager.handlePointerEvent(e);if(e.name!==u.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(u),this.emit("event",u);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){ct.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}J=G3(Dp);Q(J,1,"getIsShapeHiddenCache",gI,Z);Q(J,1,"getCanUndo",fI,Z);Q(J,1,"getCanRedo",pI,Z);Q(J,1,"getPath",hI,Z);Q(J,1,"getCurrentTool",uI,Z);Q(J,1,"getCurrentToolId",dI,Z);Q(J,1,"getDocumentSettings",lI,Z);Q(J,1,"getInstanceState",cI,Z);Q(J,1,"getOpenMenus",aI,Z);Q(J,1,"getIsMenuOpen",oI,Z);Q(J,1,"getPageStates",iI,Z);Q(J,1,"_getPageStatesQuery",sI,Z);Q(J,1,"getCurrentPageState",rI,Z);Q(J,1,"_getCurrentPageStateId",nI,Z);Q(J,1,"getSelectedShapeIds",tI,Z);Q(J,1,"getSelectedShapes",eI,Z);Q(J,1,"getOnlySelectedShapeId",QP,Z);Q(J,1,"getOnlySelectedShape",JP,Z);Q(J,1,"getSelectionPageBounds",ZP,Z);Q(J,1,"getSelectionRotation",XP,Z);Q(J,1,"getSelectionRotatedPageBounds",VP,Z);Q(J,1,"getSelectionRotatedScreenBounds",YP,Z);Q(J,1,"getFocusedGroupId",WP,Z);Q(J,1,"getFocusedGroup",GP,Z);Q(J,1,"getEditingShapeId",qP,Z);Q(J,1,"getEditingShape",KP,Z);Q(J,1,"getHoveredShapeId",HP,Z);Q(J,1,"getHoveredShape",UP,Z);Q(J,1,"getHintingShapeIds",BP,Z);Q(J,1,"getHintingShape",NP,Z);Q(J,1,"getErasingShapeIds",zP,Z);Q(J,1,"getErasingShapes",$P,Z);Q(J,1,"_unsafe_getCameraId",FP,Z);Q(J,1,"getCamera",LP,Z);Q(J,1,"getViewportPageBoundsForFollowing",RP,Z);Q(J,1,"getCameraForFollowing",OP,Z);Q(J,1,"getZoomLevel",DP,Z);Q(J,1,"getViewportScreenBounds",AP,Z);Q(J,1,"getViewportScreenCenter",MP,Z);Q(J,1,"getViewportPageBounds",jP,Z);Q(J,1,"_getCollaboratorsQuery",kP,Z);Q(J,1,"getCollaborators",TP,Z);Q(J,1,"getCollaboratorsOnCurrentPage",EP,Z);Q(J,1,"getRenderingShapes",_P,Z);Q(J,1,"_getAllPagesQuery",CP,Z);Q(J,1,"getPages",IP,Z);Q(J,1,"getCurrentPageId",PP,Z);Q(J,1,"getCurrentPageShapeIdsSorted",vP,Z);Q(J,1,"_getAllAssetsQuery",wP,Z);Q(J,1,"_getShapeGeometryCache",bP,Z);Q(J,1,"_getShapeHandlesCache",xP,Z);Q(J,1,"_getShapePageTransformCache",SP,Z);Q(J,1,"_getShapePageBoundsCache",yP,Z);Q(J,1,"_getShapeClipPathCache",mP,Z);Q(J,1,"_getShapeMaskCache",gP,Z);Q(J,1,"_getShapeMaskedPageBoundsCache",fP,Z);Q(J,1,"_notVisibleShapes",pP,Z);Q(J,1,"getCulledShapes",hP,Z);Q(J,1,"getCurrentPageBounds",uP,Z);Q(J,1,"getCurrentPageShapes",dP,Z);Q(J,1,"getCurrentPageShapesSorted",lP,Z);Q(J,1,"getCurrentPageRenderingShapesSorted",cP,Z);Q(J,1,"_getBindingsIndexCache",aP,Z);Q(J,1,"_getSelectionSharedStyles",oP,Z);Q(J,1,"getSharedStyles",iP,Z);Q(J,1,"getSharedOpacity",sP,Z);Q(J,1,"getIsFocused",rP,Z);Q(J,1,"getIsReadonly",nP,Z);Q(J,1,"_setShiftKeyTimeout",tP,Z);Q(J,1,"_setAltKeyTimeout",eP,Z);Q(J,1,"_setCtrlKeyTimeout",Q1,Z);Q(J,1,"_setMetaKeyTimeout",J1,Z);Y3(J,Z);function Ta(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function nr(n,e){if(!e)return n;let t=null;const r=Object.entries(e);for(let s=0,i=r.length;s<i;s++){const[o,a]=r[s];if(a!==void 0&&!(o==="id"||o==="type"||o==="typeName")&&a!==n[o]){if(t||(t={...n}),o==="props"||o==="meta"){t[o]={...n[o]};for(const[c,l]of Object.entries(a))l!==void 0&&(t[o][c]=l);continue}t[o]=a}}return t||n}function mI(n,e,t){const r=n.getShape(e);if(!r)return;t.push(r);const s=n.getSortedChildIdsForParent(e);for(let i=0,o=s.length;i<o;i++)mI(n,s[i],t)}function Dx(n,e,t){let r;if(n.run(()=>{const s=n.store.extractingChanges(()=>{const i=new Set,o=new Set;for(const a of e)if(n.getShape(a))for(const l of n.getBindingsInvolvingShape(a)){const u=e.has(l.fromId),h=e.has(l.toId);if(u&&h){i.add(l.id);continue}(!u||!h)&&o.add(l.id)}n.deleteBindings([...o],{isolateShapes:!0});try{r=hs.ok(t(i))}catch(a){r=hs.err(a)}});n.store.applyDiff(Sp(s))},{history:"ignore"}),r.ok)return r.value;throw r.error}function Ox(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:r}}=e.constraints,s=n.getViewportScreenBounds(),i=V.From(e.constraints.bounds),o=(s.w-t*2)/i.w,a=(s.h-r*2)/i.h;return{zx:o,zy:a}}function ia(){const n=z(),e=ta();return N("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const Rx="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",Lx="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",ka='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function ns(n,e,t,r,s,i=16,o=16){const a=(-t-e)*(je/180),c=Math.sin(a),l=Math.cos(a),u=1*l-1*c,h=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${h}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${i} ${o}, pointer`}const X3=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],Z3={none:()=>"none","ew-resize":(n,e,t)=>ns(Lx,n,0,e,t),"ns-resize":(n,e,t)=>ns(Lx,n,90,e,t),"nesw-resize":(n,e,t)=>ns(Rx,n,0,e,t),"nwse-resize":(n,e,t)=>ns(Rx,n,90,e,t),"nwse-rotate":(n,e,t)=>ns(ka,n,0,e,t),"nesw-rotate":(n,e,t)=>ns(ka,n,90,e,t),"senw-rotate":(n,e,t)=>ns(ka,n,180,e,t),"swne-rotate":(n,e,t)=>ns(ka,n,270,e,t)};function gn(n,e=0,t="black"){return Z3[n](GM(e),!1,t)}function J3(){const n=z(),e=ft(),t=ia();ps("useCursor",()=>{const{type:r,rotation:s}=n.getInstanceState().cursor;if(X3.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",gn(r,s,t?"white":"black"))},[n,e,t])}function Q3(){const n=z(),e=ft(),t=ia(),r=N(ct.forceSrgb);Qe.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function e5(){const[n,e]=_.useState(0);_.useEffect(()=>e(t=>t+1),[])}const t5=n=>n.props.src,n5={upload:(n,e)=>Kn.blobToDataUrl(e)};function r5(n){return"schema"in n&&n.schema?n.schema:OM({shapes:"shapeUtils"in n&&n.shapeUtils?Fx(wv(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?Fx(xv(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function zc({initialData:n,defaultName:e="",id:t,assets:r=n5,onMount:s,collaboration:i,...o}={}){const a=r5(o),c=new Uf({id:t,schema:a,initialData:n,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??t5},onMount:l=>{De(l instanceof Z),s==null||s(l)},collaboration:i}});if(o.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");yv(c,o.snapshot)}return c}function Fx(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const s5=(n,e)=>e.some(t=>n instanceof t);let $x,zx;function i5(){return $x||($x=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function o5(){return zx||(zx=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const yI=new WeakMap,Op=new WeakMap,SI=new WeakMap,xh=new WeakMap,wg=new WeakMap;function a5(n){const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("success",i),n.removeEventListener("error",o)},i=()=>{t(Br(n.result)),s()},o=()=>{r(n.error),s()};n.addEventListener("success",i),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&yI.set(t,n)}).catch(()=>{}),wg.set(e,n),e}function c5(n){if(Op.has(n))return;const e=new Promise((t,r)=>{const s=()=>{n.removeEventListener("complete",i),n.removeEventListener("error",o),n.removeEventListener("abort",o)},i=()=>{t(),s()},o=()=>{r(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",i),n.addEventListener("error",o),n.addEventListener("abort",o)});Op.set(n,e)}let Rp={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Op.get(n);if(e==="objectStoreNames")return n.objectStoreNames||SI.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return Br(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function l5(n){Rp=n(Rp)}function d5(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(bh(this),e,...t);return SI.set(r,e.sort?e.sort():[e]),Br(r)}:o5().includes(n)?function(...e){return n.apply(bh(this),e),Br(yI.get(this))}:function(...e){return Br(n.apply(bh(this),e))}}function u5(n){return typeof n=="function"?d5(n):(n instanceof IDBTransaction&&c5(n),s5(n,i5())?new Proxy(n,Rp):n)}function Br(n){if(n instanceof IDBRequest)return a5(n);if(xh.has(n))return xh.get(n);const e=u5(n);return e!==n&&(xh.set(n,e),wg.set(e,n)),e}const bh=n=>wg.get(n);function xI(n,e,{blocked:t,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(n,e),a=Br(o);return r&&o.addEventListener("upgradeneeded",c=>{r(Br(o.result),c.oldVersion,c.newVersion,Br(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{i&&c.addEventListener("close",()=>i()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function bI(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),Br(t).then(()=>{})}const h5=["get","getKey","getAll","getAllKeys","count"],p5=["put","add","delete","clear"],wh=new Map;function Nx(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(wh.get(e))return wh.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,s=p5.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(s||h5.includes(t)))return;const i=async function(o,...a){const c=this.transaction(o,s?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[t](...a),s&&c.done]))[0]};return wh.set(e,i),i}l5(n=>({...n,get:(e,t,r)=>Nx(e,t)||n.get(e,t,r),has:(e,t)=>!!Nx(e,t)||n.has(e,t)}));const f5="TLDRAW_DOCUMENT_v2",g5="TLDRAW_ASSET_STORE_v1",wI="TLDRAW_DB_NAME_INDEX_v2",Ce={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function vI(n){const e=f5+n;return y5(e),await xI(e,4,{upgrade(t){t.objectStoreNames.contains(Ce.Records)||t.createObjectStore(Ce.Records),t.objectStoreNames.contains(Ce.Schema)||t.createObjectStore(Ce.Schema),t.objectStoreNames.contains(Ce.SessionState)||t.createObjectStore(Ce.SessionState),t.objectStoreNames.contains(Ce.Assets)||t.createObjectStore(Ce.Assets)}})}async function m5(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(p=>p.name):vg(),t=g5+n;if(!e.find(p=>p===t))return;const s=await xI(t,1,{upgrade(p){p.objectStoreNames.contains("assets")||p.createObjectStore("assets")}});if(!s.objectStoreNames.contains("assets"))return;const i=s.transaction(["assets"],"readonly"),o=i.objectStore("assets"),a=await o.getAllKeys(),c=await Promise.all(a.map(async p=>[p,await o.get(p)]));await i.done;const l=await vI(n),u=l.transaction([Ce.Assets],"readwrite"),h=u.objectStore(Ce.Assets);for(const[p,f]of c)h.put(f,p);await u.done,s.close(),l.close(),await bI(t)}const Do=class Do{constructor(e){v(this,"getDbPromise");v(this,"isClosed",!1);v(this,"pendingTransactionSet",new Set);Do.connectedInstances.add(this),this.getDbPromise=(async()=>(await m5(e),await vI(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Oo)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Do.connectedInstances.delete(this))}tx(e,t,r){const s=(async()=>{De(!this.isClosed,"db is closed");const o=(await this.getDb()).transaction(t,e),a=o.done.catch(c=>{if(!this.isClosed)throw c});try{return await r(o)}finally{this.isClosed?o.abort():await a}})();return this.pendingTransactionSet.add(s),s.finally(()=>this.pendingTransactionSet.delete(s)),s}async load({sessionId:e}={}){return await this.tx("readonly",[Ce.Records,Ce.Schema,Ce.SessionState],async t=>{var c,l;const r=t.objectStore(Ce.Records),s=t.objectStore(Ce.Schema),i=t.objectStore(Ce.SessionState);let o=e?(c=await i.get(e))==null?void 0:c.snapshot:null;return o||(o=(l=(await i.getAll()).sort((h,p)=>h.updatedAt-p.updatedAt).pop())==null?void 0:l.snapshot),{records:await r.getAll(),schema:await s.get(Ce.Schema),sessionStateSnapshot:o}})}async storeChanges({schema:e,changes:t,sessionId:r,sessionStateSnapshot:s}){await this.tx("readwrite",[Ce.Records,Ce.Schema,Ce.SessionState],async i=>{const o=i.objectStore(Ce.Records),a=i.objectStore(Ce.Schema),c=i.objectStore(Ce.SessionState);for(const[l,u]of Object.entries(t.added))await o.put(u,l);for(const[l,u]of Object.values(t.updated))await o.put(u,u.id);for(const l of Object.keys(t.removed))await o.delete(l);a.put(e.serialize(),Ce.Schema),s&&r?c.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:s}){await this.tx("readwrite",[Ce.Records,Ce.Schema,Ce.SessionState],async i=>{const o=i.objectStore(Ce.Records),a=i.objectStore(Ce.Schema),c=i.objectStore(Ce.SessionState);await o.clear();for(const[l,u]of Object.entries(t))await o.put(u,l);a.put(e.serialize(),Ce.Schema),s&&r?c.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[Ce.SessionState],async e=>{const t=e.objectStore(Ce.SessionState),r=(await t.getAll()).sort((i,o)=>i.updatedAt-o.updatedAt);if(r.length<10){await e.done;return}const s=r.slice(0,r.length-10);for(const{id:i}of s)await t.delete(i)})}async getAsset(e){return await this.tx("readonly",[Ce.Assets],async t=>await t.objectStore(Ce.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[Ce.Assets],async r=>{await r.objectStore(Ce.Assets).put(t,e)})}};v(Do,"connectedInstances",new Set);let Nc=Do;function vg(){const n=JSON.parse(Cf(wI)||"[]")??[];return Array.isArray(n)?n:[]}function y5(n){const e=new Set(vg());e.add(n),_f(wI,JSON.stringify([...e]))}function S5(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function x5(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const b5=350,w5=1e4,Bx=Symbol("UPDATE_INSTANCE_STATE"),v5=n=>n;class P5{constructor(e){v(this,"onmessage")}postMessage(e){}close(){}}const I5=typeof BroadcastChannel>"u"?P5:BroadcastChannel;class C5{constructor(e,{persistenceKey:t,sessionId:r=$c,onLoad:s,onLoadError:i},o=new I5(`tldraw-tab-sync-${t}`)){v(this,"disposables",new Set);v(this,"diffQueue",[]);v(this,"didDispose",!1);v(this,"shouldDoFullDBWrite",!0);v(this,"isReloading",!1);v(this,"persistenceKey");v(this,"sessionId");v(this,"serializedSchema");v(this,"isDebugging",!1);v(this,"documentTypes");v(this,"$sessionStateSnapshot");v(this,"db");v(this,"initTime",Date.now());v(this,"isPersisting",!1);v(this,"didLastWriteError",!1);v(this,"scheduledPersistTimeout",null);this.store=e,this.channel=o,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.db=new Nc(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=cg(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(v5({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(Bx),this.schedulePersist()},{scope:"session"})),this.connect(s,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(s){t(s),x5();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const s=Object.fromEntries(r.records.map(c=>[c.id,c])),i=r.sessionStateSnapshot??wD(s),o=this.store.schema.migrateStoreSnapshot({store:s,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(o.type==="error"){console.error("failed to migrate store",o),t(new Error(`Failed to migrate store: ${o.reason}`));return}const a=Object.values(o.value).filter(c=>this.documentTypes.has(c.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),i&&_p(this.store,i)}this.channel.onmessage=({data:s})=>{var a,c;this.debug("got message",s);const i=s,o=this.store.schema.getMigrationsSince(i.schema);if(o.ok){if(o.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}i.type==="diff"&&(this.debug("applying diff"),hr(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(i.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;t(s);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?w5:b5))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(De(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=Bf(e.filter(r=>r!==Bx));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),S5(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function PI(n){const e=_.useRef(n),[t,r]=_.useState(n);t!==e.current&&r(e.current);const s=_.useCallback(i=>{typeof i=="function"?e.current=i(e.current):e.current=i,r(e.current)},[]);return[t,s]}function _5(n){const[e,t]=PI({status:"loading"});return n=$i(n),_.useEffect(()=>{const{persistenceKey:r,sessionId:s,...i}=n;if(!r){t({status:"not-synced",store:zc(i)});return}t({status:"loading"});const o=new pr,a={upload:async(h,p)=>(await u.db.storeAsset(h.id,p),h.id),resolve:async h=>h.props.src?h.props.src.startsWith("asset:")?await o.get(h,async()=>{const p=await u.db.getAsset(h.id);return p?URL.createObjectURL(p):null}):h.props.src:null,...i.assets},c=zc({...i,assets:a});let l=!1;const u=new C5(c,{sessionId:s,persistenceKey:r,onLoad(){l||t({store:c,status:"synced-local"})},onLoadError(h){l||t({status:"error",error:h})}});return()=>{l=!0,u.close()}},[n,t]),e}function E5(){const n=z(),e=ft();_.useEffect(()=>{const t=i=>e.style.setProperty("--tl-zoom",i.toString()),r=Zc(t,100),s=new Ri("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return s.attach(),s.execute(),()=>{s.detach(),r.cancel()}},[n,e])}function Lp(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0,s=n.length;r<s;r++)t[r]=n.charCodeAt(r);return e}function T5(n){const e=atob(n),t=Lp(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const k5=5,So={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},j5=Math.max(...Object.values(So)),xo={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},M5=Object.keys(xo).length,vh="sales@tldraw.com",A5=`${us()}/watermarks/watermark-track.svg`;class Il{constructor(e,t,r){v(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");v(this,"isDevelopment");v(this,"isTest");v(this,"isCryptoAvailable");v(this,"state",ht("license state","pending"));v(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(s=>{const i=D5(s);!this.isDevelopment&&i&&fr(A5),i?this.state.set("unlicensed"):s.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,r]=e.split("."),[s,i]=t.split("/");if(!s.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${s}'`);const o=await T5(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},o,new Uint8Array(Lp(atob(r))),new Uint8Array(Lp(atob(i))))}catch(l){throw console.error(l),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(i))}catch{throw new Error("Could not parse object")}return c.length>M5&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[xo.ID],hosts:c[xo.HOSTS],flags:c[xo.FLAGS],expiryDate:c[xo.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(t),s=new Date(r.expiryDate),i=this.isFlagEnabled(r.flags,So.ANNUAL_LICENSE),o=this.isFlagEnabled(r.flags,So.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:s,isAnnualLicense:i,isAnnualLicenseExpired:i&&this.isAnnualLicenseExpired(s),isPerpetualLicense:o,isPerpetualLicenseExpired:o&&this.isPerpetualLicenseExpired(s),isInternalLicense:this.isFlagEnabled(r.flags,So.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,So.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const s=r.toLowerCase().trim();if(s===t||`www.${s}`===t||s===`www.${t}`||r==="*")return!0;if(r.includes("*")){const i=new RegExp(r.replace(/\*/g,".*?"));return i.test(t)||i.test(`www.${t}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+k5+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r=new Date>=t;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${vh} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r={major:new Date(sx.major),minor:new Date(sx.minor)};return r.major>=t||r.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${vh} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${vh} if you would like to use tldraw on other domains.`]),e.license.flags>=j5*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}v(Il,"className","tl-watermark_SEE-LICENSE");function D5(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const II=_.createContext({}),O5=()=>_.useContext(II);function R5({licenseKey:n,children:e}){const[t]=_.useState(()=>new Il(n));return d.jsx(II.Provider,{value:t,children:e})}function Ps(n){if(!n)throw Error("usePassThroughWheelEvents must be passed a ref");const e=ft();_.useEffect(()=>{function t(s){if(s.isSpecialRedispatchedEvent)return;xe(s);const i=e.querySelector(".tl-canvas");if(!i)return;const o=new WheelEvent("wheel",s);o.isSpecialRedispatchedEvent=!0,i.dispatchEvent(o)}const r=n.current;if(r)return r.addEventListener("wheel",t,{passive:!1}),()=>{r.removeEventListener("wheel",t)}},[e,n])}const L5='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',F5='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function $5(n){return N("watermarkState",()=>n.state.get(),[n])}const z5=`data:image/svg+xml;utf8,${encodeURIComponent(L5)}`,N5=`data:image/svg+xml;utf8,${encodeURIComponent(F5)}`,B5=_.memo(function(){const e=O5(),t=z(),r=N("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),s=$5(e);return["licensed-with-watermark","unlicensed"].includes(s)?d.jsxs(d.Fragment,{children:[d.jsx(H5,{}),d.jsx(U5,{src:r?N5:z5})]}):null}),U5=_.memo(function({src:e}){const t=z(),r=N("debug mode",()=>t.getInstanceState().isDebugMode,[t]),s=N("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),i=sg(),o=_.useRef(null);Ps(o);const a=`url('${e}') center 100% / 100% no-repeat`,c="https://tldraw.dev";return d.jsx("div",{ref:o,className:Il.className,"data-debug":r,"data-mobile":s,draggable:!1,...i,children:Be.isWebview?d.jsx("a",{draggable:!1,role:"button",onPointerDown:l=>{ut(l),xe(l)},onClick:()=>hl.openWindow(c,"_blank"),style:{mask:a,WebkitMask:a}}):d.jsx("a",{href:c,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:l=>{ut(l)},style:{mask:a,WebkitMask:a}})})}),H5=_.memo(function(){const e=Il.className,t=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}

	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return d.jsx("style",{children:t})}),K5=[],q5=[],G5=[],W5="tl-container",Y5=_.memo(function({store:e,components:t,className:r,user:s,options:i,...o}){const[a,c]=_.useState(null),l=_.useMemo(()=>s??fv(),[s]),u=(t==null?void 0:t.ErrorFallback)===void 0?iv:t==null?void 0:t.ErrorFallback,h={...o,shapeUtils:o.shapeUtils??K5,bindingUtils:o.bindingUtils??q5,tools:o.tools??G5,components:t,options:$i(i)};return d.jsx("div",{ref:c,"data-tldraw":z0,draggable:!1,className:se(`${W5} tl-theme__light`,r),onPointerDown:ut,tabIndex:-1,children:d.jsx(No,{fallback:u,onError:p=>xf(p,{tags:{origin:"react.tldraw-before-app"}}),children:a&&d.jsx(R5,{licenseKey:o.licenseKey,children:d.jsx(G0,{container:a,children:d.jsx(oD,{overrides:t,children:e?e instanceof Uf?d.jsx(_I,{...h,store:e,user:l}):d.jsx(CI,{...h,store:e,user:l}):d.jsx(V5,{...h,store:e,user:l})})})})})})});function V5(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:s,bindingUtils:i,persistenceKey:o,sessionId:a,user:c,assets:l}=n,u=_5({shapeUtils:s,bindingUtils:i,initialData:r,persistenceKey:o,sessionId:a,defaultName:e,snapshot:t,assets:l});return d.jsx(CI,{...n,store:u,user:c})}const CI=_.memo(function({store:e,user:t,...r}){const s=ft();_.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(s.classList.remove("tl-theme__light"),s.classList.add("tl-theme__dark"))},[s,t]);const{LoadingScreen:i}=Xe();switch(e.status){case"error":throw e.error;case"loading":return i?d.jsx(i,{}):null}return d.jsx(_I,{...r,store:e.store,user:t})}),Ph=()=>document.location.search.includes("tldraw_preserve_focus");function _I({onMount:n,children:e,store:t,tools:r,shapeUtils:s,bindingUtils:i,user:o,initialState:a,autoFocus:c=!0,inferDarkMode:l,cameraOptions:u,options:h,licenseKey:p,deepLinks:f,isShapeHidden:g}){const{ErrorFallback:m}=Xe(),x=ft(),[b,S]=PI(null),P=_.useRef(null),w=$i(f===!0?{}:f),I=_.useRef({autoFocus:c&&!Ph(),inferDarkMode:l,initialState:a,cameraOptions:u,deepLinks:w});_.useLayoutEffect(()=>{I.current={autoFocus:c&&!Ph(),inferDarkMode:l,initialState:a,cameraOptions:u,deepLinks:w}},[c,l,a,u,w]),_.useLayoutEffect(()=>{const{autoFocus:C,inferDarkMode:j,initialState:k,cameraOptions:R,deepLinks:A}=I.current,D=new Z({store:t,shapeUtils:s,bindingUtils:i,tools:r,getContainer:()=>x,user:o,initialState:k,autoFocus:C,inferDarkMode:j,cameraOptions:R,options:h,licenseKey:p,isShapeHidden:g});return D.updateViewportScreenBounds(P.current??x),A&&(A!=null&&A.getUrl?D.navigateToDeepLink({...A,url:A.getUrl(D)}):D.navigateToDeepLink(A)),S(D),()=>{D.dispose()}},[i,x,h,s,t,r,o,S,p,g]),_.useLayoutEffect(()=>{if(b&&w)return b.registerDeepLinkListener(w)},[b,w]),_.useLayoutEffect(()=>{b&&u&&b.setCameraOptions(u)},[b,u]);const E=_.useSyncExternalStore(_.useCallback(C=>b?(b.on("crash",C),()=>b.off("crash",C)):()=>{},[b]),()=>(b==null?void 0:b.getCrashingError())??null);_.useEffect(function(){if(!b)return;function j(){b&&b.focus()}function k(){b&&b.blur()}if(c&&Ph())return b.getContainer().addEventListener("pointerdown",j),document.body.addEventListener("pointerdown",k),()=>{var R;(R=b.getContainer())==null||R.removeEventListener("pointerdown",j),document.body.removeEventListener("pointerdown",k)}},[b,c]);const{Canvas:T}=Xe();return b?d.jsx(No,{fallback:m,onError:C=>b.annotateError(C,{origin:"react.tldraw",willCrashApp:!0}),children:E?d.jsx(Z5,{crashingError:E}):d.jsx(tg,{editor:b,children:d.jsxs(X5,{onMount:n,children:[e??(T?d.jsx(T,{}):null),d.jsx(B5,{})]})})}):d.jsx("div",{className:"tl-canvas",ref:P})}function X5({children:n,onMount:e}){return E5(),J3(),Q3(),e5(),TI(t=>{const r=t.store.props.onMount(t),s=e==null?void 0:e(t);return()=>{r==null||r(),s==null||s()}}),n}function Z5({crashingError:n}){throw n}function Pg({children:n}){return d.jsx("div",{className:"tl-loading",children:n})}function EI({children:n}){return d.jsx("div",{className:"tl-loading",children:n})}function TI(n){const e=z(),t=Sl(r=>{let s;return r.run(()=>{s=n==null?void 0:n(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,s});Qe.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function gs({children:n,className:e="",...t}){return d.jsx("div",{...t,className:se("tl-html-container",e),children:n})}class Va{constructor(e){this.editor=e}}v(Va,"props"),v(Va,"migrations"),v(Va,"type");function Cl(n,e,t={}){const{newPoint:r,handle:s,scaleX:i,scaleY:o}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:u=1/0}=t;let h=n.props.w*i,p=n.props.h*o;const f=new y(0,0);if(h>0){if(h<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=h-a;break}case"top":case"bottom":{f.x=(h-a)/2;break}default:f.x=0}h=a}}else if(f.x=h,h=-h,h<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-h;break}default:f.x=-a}h=a}if(p>0){if(p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=p-l;break}case"right":case"left":{f.y=(p-l)/2;break}default:f.y=0}p=l}}else if(f.y=p,p=-p,p<l){switch(s){case"top_left":case"top":case"top_right":{f.y=-p;break}default:f.y=-l}p=l}const{x:g,y:m}=f.rot(n.rotation).add(r);return{...n,x:g,y:m,props:{w:Math.min(c,h),h:Math.min(u,p)}}}class Ui extends Vn{getGeometry(e){return new yr({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return Cl(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,r){return{...t.props,w:_e(e.props.w,t.props.w,r),h:_e(e.props.h,t.props.h,r)}}}var Kh;let J5=(Kh=class extends te{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},v(Kh,"id","idle"),Kh);var qh;let Q5=(qh=class extends te{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,s=ze(),i=this.editor.markHistoryStoppingPoint(`creating_box:${s}`),o=Zn(t,this.editor);this.editor.createShapes([{id:s,type:r,x:o.x,y:o.y,props:{w:1,h:1}}]).select(s);const a=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:i,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:a.onCreate?c=>{var l;return(l=a.onCreate)==null?void 0:l.call(a,c)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,r=ze();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const s=this.editor.getShape(r);if(!s){this.cancel();return}let{w:i,h:o}=s.props;const a=new y(i/2,o/2),c=this.editor.getShapeParentTransform(s);c&&a.rot(-c.rotation());let l=1;this.editor.user.getIsDynamicResizeMode()&&(l=1/this.editor.getZoomLevel(),i*=l,o*=l,a.mul(l));const u=Ve(s),h=Zn(new y(s.x-a.x,s.y-a.y),this.editor);u.x=h.x,u.y=h.y,u.props.w=i,u.props.h=o,"scale"in s.props&&(u.props.scale=l),this.editor.updateShape(u),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},v(qh,"id","pointing"),qh);function Zn(n,e){const t=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return t?n.clone().snapToGrid(r):n.clone()}class Fp extends te{static children(){return[J5,Q5]}}v(Fp,"id","box"),v(Fp,"initial","idle");function eR(n,e,t){const r=_.useRef(!1),s=_.useCallback(o=>{r.current=o,o?Un.addOpenMenu(n):Un.deleteOpenMenu(n),e==null||e(o)},[n,e]),i=N("is menu open",()=>Un.getOpenMenus().includes(n),[n]);return _.useEffect(()=>(r.current&&(t==null||t("open-menu"),Un.addOpenMenu(n)),()=>{r.current&&(Un.deleteOpenMenu(n),Un.getOpenMenus().forEach(o=>{o.startsWith(n)&&(t==null||t("close-menu"),Un.deleteOpenMenu(o))}),r.current=!1)}),[n,t]),[i,s]}function _l(n){const e=z();return N("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function ir(n){const e=z();return _.useMemo(function(){const s=l=>{if(l.isKilled)return;if(l.button===rg){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Sn(l)});return}if(l.button!==0)return;const u=Fc(l.currentTarget);function h(){u.removeEventListener("pointerup",h),Qo(u,l)}Jo(u,l),u.addEventListener("pointerup",h),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Sn(l)}),ut(l)};let i,o;function a(l){l.isKilled||l.button===0&&(l.clientX===i&&l.clientY===o||(i=l.clientX,o=l.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Sn(l)})))}return{onPointerDown:s,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Sn(l)})}}},[e,n])}function tR(n){const[e,t]=_.useState(()=>({store:zc(n),opts:n}));if(!Yb(e.opts,n)){const r={store:zc(n),opts:n};return t(r),r.store}return e.store}const nR=20,rR=8;function Ig(n,e=nR){return Math.max(rR,Math.ceil(n/e))}class hi extends vs{constructor(t){super({...t,isFilled:!1,isClosed:!1});v(this,"_center");v(this,"radius");v(this,"start");v(this,"end");v(this,"largeArcFlag");v(this,"sweepFlag");v(this,"measure");v(this,"angleStart");v(this,"angleEnd");const{center:r,sweepFlag:s,largeArcFlag:i,start:o,end:a}=t;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=y.Angle(r,o),this.angleEnd=y.Angle(r,a),this.radius=y.Dist(r,o),this.measure=WM(this.angleStart,this.angleEnd,s,i),this.start=o,this.end=a,this.sweepFlag=s,this.largeArcFlag=i,this._center=r}nearestPoint(t){const{_center:r,measure:s,radius:i,angleEnd:o,angleStart:a,start:c,end:l}=this,u=Ip(s,a,o,r.angle(t));if(u<=0)return c;if(u>=1)return l;const h=r.clone().add(t.clone().sub(r).uni().mul(i));let p,f=1/0,g;for(const m of[c,l,h])g=y.Dist2(t,m),g<f&&(p=m,f=g);if(!p)throw Error("nearest point not found");return p}hitTestLineSegment(t,r){const{_center:s,radius:i,measure:o,angleStart:a,angleEnd:c}=this,l=ea(t,r,s,i);return l===null?!1:l.some(u=>{const h=Ip(o,a,c,s.angle(u));return h>=0&&h<=1})}getVertices(){const{_center:t,measure:r,length:s,radius:i,angleStart:o}=this,a=[];for(let c=0,l=Ig(Math.abs(s));c<l+1;c++){const u=c/l*r,h=o+u;a.push(Us(t,i,h))}return a}getSvgPathData(t=!0){const{start:r,end:s,radius:i,largeArcFlag:o,sweepFlag:a}=this;return`${t?`M${r.toFixed()}`:""} A${i} ${i} 0 ${o} ${a} ${s.toFixed()}`}getLength(){return this.measure*this.radius}}class Cg extends vs{constructor(t){super({isClosed:!0,...t});v(this,"_center");v(this,"radius");v(this,"x");v(this,"y");this.config=t;const{x:r=0,y:s=0,radius:i}=t;this.x=r,this.y=s,this._center=new y(i+r,i+s),this.radius=i}getBounds(){return new V(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,s=Le*r,i=[];for(let o=0,a=Ig(s);o<a;o++){const c=o/a*Le;i.push(Us(t,r,c))}return i}nearestPoint(t){const{_center:r,radius:s}=this;return r.equals(t)?y.AddXY(r,s,0):r.clone().add(t.clone().sub(r).uni().mul(s))}hitTestLineSegment(t,r,s=0){const{_center:i,radius:o}=this;return ea(t,r,i,o+s)!==null}getSvgPathData(){const{_center:t,radius:r}=this;return`M${t.x+r},${t.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class Ot extends zi{constructor(t){const{start:r,cp1:s,cp2:i,end:o}=t;super({...t,points:[r,o]});v(this,"a");v(this,"b");v(this,"c");v(this,"d");this.a=r,this.b=s,this.c=i,this.d=o}getVertices(){const t=[],{a:r,b:s,c:i,d:o}=this;for(let a=0,c=10;a<=c;a++){const l=a/c;t.push(new y((1-l)*(1-l)*(1-l)*r.x+3*((1-l)*(1-l))*l*s.x+3*(1-l)*(l*l)*i.x+l*l*l*o.x,(1-l)*(1-l)*(1-l)*r.y+3*((1-l)*(1-l))*l*s.y+3*(1-l)*(l*l)*i.y+l*l*l*o.y))}return t}midPoint(){return Ot.GetAtT(this,.5)}nearestPoint(t){let r,s=1/0,i,o;for(const a of this.segments)o=a.nearestPoint(t),i=y.Dist2(o,t),i<s&&(r=o,s=i);if(!r)throw Error("nearest point not found");return r}getSvgPathData(t=!0){const{a:r,b:s,c:i,d:o}=this;return`${t?`M ${r.toFixed()} `:""} C${s.toFixed()} ${i.toFixed()} ${o.toFixed()}`}static GetAtT(t,r){const{a:s,b:i,c:o,d:a}=t;return new y((1-r)*(1-r)*(1-r)*s.x+3*((1-r)*(1-r))*r*i.x+3*(1-r)*(r*r)*o.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*s.y+3*((1-r)*(1-r))*r*i.y+3*(1-r)*(r*r)*o.y+r*r*r*a.y)}getLength(t=32){let r,s=this.a,i=0;for(let o=1;o<=t;o++)r=Ot.GetAtT(this,o/t),i+=y.Dist(s,r),s=r;return i}}class sR extends vs{constructor(t){super({...t,isClosed:!1,isFilled:!1});v(this,"points");v(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,s=r-2,i=1.25;for(let o=0;o<r-1;o++){const a=o===0?t[0]:t[o-1],c=t[o],l=t[o+1],u=o===s?l:t[o+2],h=c,p=o===0?a:new y(c.x+(l.x-a.x)/6*i,c.y+(l.y-a.y)/6*i),f=o===s?l:new y(l.x-(u.x-c.x)/6*i,l.y-(u.y-c.y)/6*i),g=l;this._segments.push(new Ot({start:h,cp1:p,cp2:f,end:g}))}}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){const t=this.segments.reduce((r,s)=>r.concat(s.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,s=1/0,i,o;for(const a of this.segments)o=a.nearestPoint(t),i=y.Dist2(o,t),i<s&&(r=o,s=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.segments.some(s=>s.hitTestLineSegment(t,r))}getSvgPathData(){let t=this.segments.reduce((r,s,i)=>r+s.getSvgPathData(i===0),"");return this.isClosed&&(t+="Z"),t}}class iR extends vs{constructor(t){super({...t,isClosed:!0});v(this,"w");v(this,"h");v(this,"_edges");this.config=t;const{width:r,height:s}=t;this.w=r,this.h=s}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,s=t.length;r<s;r++){const i=t[r],o=t[(r+1)%s];this._edges.push(new Fr({start:i,end:o}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),s=t/2,i=r/2,o=Math.pow(s-i,2)/Math.pow(s+i,2),a=je*(s+i)*(1+3*o/(10+Math.sqrt(4-3*o))),c=Ig(a),l=Le/c,u=Math.cos(l),h=Math.sin(l);let p=0,f=1,g=0,m=1;const x=Array(c);for(let b=0;b<c;b++)x[b]=new y(s+s*f,i+i*p),g=h*f+u*p,m=u*f-h*p,p=g,f=m;return x}nearestPoint(t){let r,s=1/0,i,o;for(const a of this.edges)o=a.nearestPoint(t),i=y.Dist2(o,t),i<s&&(r=o,s=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.edges.some(s=>s.hitTestLineSegment(t,r))}getBounds(){return new V(0,0,this.w,this.h)}getLength(){const{w:t,h:r}=this,s=t/2,i=r/2,o=Math.max(0,s),a=Math.max(0,i);return B0(o,a)}getSvgPathData(t=!1){const{w:r,h:s}=this,i=r/2,o=s/2,a=Math.max(0,i),c=Math.max(0,o);return`${t?`M${i-a},${o}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class oR extends vs{constructor(t){super({...t,isClosed:!0});v(this,"w");v(this,"h");v(this,"a");v(this,"b");v(this,"c");v(this,"d");this.config=t;const{width:r,height:s}=t;if(this.w=r,this.h=s,s>r){const i=r/2;this.a=new hi({start:new y(0,i),end:new y(r,i),center:new y(r/2,i),sweepFlag:1,largeArcFlag:1}),this.b=new Fr({start:new y(r,i),end:new y(r,s-i)}),this.c=new hi({start:new y(r,s-i),end:new y(0,s-i),center:new y(r/2,s-i),sweepFlag:1,largeArcFlag:1}),this.d=new Fr({start:new y(0,s-i),end:new y(0,i)})}else{const i=s/2;this.a=new hi({start:new y(i,s),end:new y(i,0),center:new y(i,i),sweepFlag:1,largeArcFlag:1}),this.b=new Fr({start:new y(i,0),end:new y(r-i,0)}),this.c=new hi({start:new y(r-i,0),end:new y(r-i,s),center:new y(r-i,i),sweepFlag:1,largeArcFlag:1}),this.d=new Fr({start:new y(r-i,s),end:new y(i,s)})}}nearestPoint(t){let r,s=1/0,i,o;const{a,b:c,c:l,d:u}=this;for(const h of[a,c,l,u])o=h.nearestPoint(t),i=y.Dist2(o,t),i<s&&(r=o,s=i);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){const{a:s,b:i,c:o,d:a}=this;return[s,i,o,a].some(c=>c.hitTestLineSegment(t,r))}getVertices(){const{a:t,b:r,c:s,d:i}=this;return[t,r,s,i].reduce((o,a)=>(o.push(...a.vertices),o),[])}getBounds(){return new V(0,0,this.w,this.h)}getLength(){const{h:t,w:r}=this;return t>r?(je*(r/2)+(t-r))*2:(je*(t/2)+(r-t))*2}getSvgPathData(){const{a:t,b:r,c:s,d:i}=this;return[t,r,s,i].map((o,a)=>o.getSvgPathData(a===0)).join(" ")+" Z"}}async function aR({shouldReload:n=!0}={}){zT();for(const e of Nc.connectedInstances)await e.close();await Promise.all(vg().map(e=>bI(e))),$T(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=aR);function cR(n,e="_blank"){hl.openWindow(n,e)}Ss("@tldraw/editor","3.5.0","esm");const kI=()=>{},jI=_.createContext(null);function lR({onEvent:n,children:e}){return d.jsx(jI.Provider,{value:n??kI,children:e})}function kt(){return _.useContext(jI)??kI}function He(n,e){var s;const t=new Set;for(const i of e){const o=n.getShape(i);if(!o)continue;n.getShapeUtil(o).onDragShapesOut&&t.add(o);const a=n.getShape(o.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&t.add(a)}const r=new Map;for(const i of t){const o=MI(n,i);o.length&&r.set(i,o)}for(const[i,o]of r){const a=n.getShapeUtil(i),c=fe(o.map(l=>n.getShape(l)));(s=a.onDragShapesOut)==null||s.call(a,i,c)}}function MI(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const r=n.getShapePageBounds(e);if(!r)return[];let s,i,o;const a=[];for(const c of t){const l=n.getShapePageBounds(c);if(!l)continue;if(!r.includes(l)){a.push(c);continue}s??(s=n.getShapeGeometry(e)),i??(i=n.getShapePageTransform(e)),o??(o=i.applyToPoints(s.vertices));const u=n.getShapePageTransform(c).clone().invert().applyToPoints(o),{vertices:h,isClosed:p}=n.getShapeGeometry(c);if(!h.some(f=>wn(f,u))){if(p){if(hg(u,h))continue}else if(_D(u,h))continue;a.push(c)}}return a}function Bc(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id})}function dR(n,e){const t=fe(e.map(s=>n.getShape(s)).filter(s=>s&&n.isShapeOfType(s,"frame")));if(!t.length)return;const r=[];n.run(()=>{t.map(s=>{const i=n.getSortedChildIdsForParent(s.id);i.length&&(n.reparentShapes(i,s.parentId,s.index),r.push(...i))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const uR=50;function hR(n,e,t={}){const r=n.getShape(e);if(!r)return;const s=n.getSortedChildIdsForParent(r.id),i=fe(s.map(f=>n.getShape(f)));if(!i.length)return;const o=V.FromPoints(i.flatMap(f=>{const g=n.getShapeGeometry(f.id);return n.getShapeLocalTransform(f).applyToPoints(g.vertices)})),{padding:a=uR}=t,c=o.w+2*a,l=o.h+2*a,u=a-o.minX,h=a-o.minY;if(u===0&&h===0&&r.props.w===c&&r.props.h===l)return;const p=new y(u,h).rot(r.rotation);n.run(()=>{const f=s.map(g=>{const m=n.getShape(g);return{id:m.id,type:m.type,x:m.x+u,y:m.y+h}});f.push({id:r.id,type:r.type,x:r.x-p.x,y:r.y-p.y,props:{w:c,h:l}}),n.updateShapes(f)})}const AI=_.createContext(null);function pR({assetUrls:n,children:e}){return _.useEffect(()=>{for(const t of Object.values(n.icons)){const r=Ro();r.src=t,r.decode()}for(const t of Object.values(n.embedIcons)){const r=Ro();r.src=t,r.decode()}},[n]),d.jsx(AI.Provider,{value:n,children:e})}function _g(){const n=_.useContext(AI);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const $p={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},fR=new Set(["ar","fa","he","ur","ku"]),si={locale:"en",label:"English",messages:$p,dir:"ltr"};async function gR(n,e){if(!(await fr(e.translations.en)).ok)return console.warn("No main translations found."),si;if(n==="en")return si;const r=zo.find(o=>o.locale===n);if(!r)return console.warn(`No translation found for locale ${n}`),si;const i=await(await fr(e.translations[r.locale])).json();if(!i)return console.warn(`No messages found for locale ${n}`),si;for(const o in si.messages)i[o];return{locale:n,label:r.label,dir:fR.has(r.locale)?"rtl":"ltr",messages:{...si.messages,...i}}}const DI=_.createContext(null);function OI(){const n=_.useContext(DI);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}function mR({overrides:n,locale:e,children:t}){const r=_g(),[s,i]=_.useState(()=>n&&n.en?{locale:"en",label:"English",dir:"ltr",messages:{...$p,...n.en}}:{locale:"en",label:"English",dir:"ltr",messages:$p});return _.useEffect(()=>{let o=!1;async function a(){const c=await gR(e,r);c&&!o&&(n&&n[e]?i({...c,messages:{...c.messages,...n[e]}}):i(c))}return a(),()=>{o=!0}},[r,e,n]),d.jsx(DI.Provider,{value:s,children:t})}function Pe(){const n=OI();return _.useCallback(function(t){return n.messages[t]??t},[n])}const ie=_.forwardRef(function({children:e,type:t,...r},s){return d.jsx("button",{ref:s,type:"button",draggable:!1,...r,className:se("tlui-button",`tlui-button__${t}`,r.className),children:e})});function lt({children:n}){return d.jsx("span",{className:"tlui-button__label",children:n})}const Sr=_.memo(function({small:e,invertIcon:t,icon:r,color:s,className:i,...o}){const a=_g(),c=a.icons[r]??a.icons["question-mark-circle"],l=_.useRef(null);return _.useLayoutEffect(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),l!=null&&l.current&&(l.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[l,c,r]),r==="none"?d.jsx("div",{className:se("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},i)}):d.jsx("div",{...o,ref:l,className:se("tlui-icon",{"tlui-icon__small":e},i),style:{color:s,mask:`url(${c}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function we({icon:n,small:e,invertIcon:t}){return d.jsx(Sr,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}function El({className:n,children:e}){return d.jsx("div",{className:se("tlui-dialog__header",n),children:e})}function Tl({className:n,children:e}){return d.jsx(SE,{dir:"ltr",className:se("tlui-dialog__header__title",n),children:e})}function kl(){return d.jsx("div",{className:"tlui-dialog__header__close",children:d.jsx(xE,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:d.jsx(ie,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:d.jsx(we,{small:!0,icon:"cross-2"})})})})}function Bo({className:n,children:e,style:t}){return d.jsx("div",{className:se("tlui-dialog__body",n),style:t,children:e})}function Eg({className:n,children:e}){return d.jsx("div",{className:se("tlui-dialog__footer",n),children:e})}const jl=_.forwardRef(function({className:e,label:t,icon:r,iconLeft:s,autoSelect:i=!1,autoFocus:o=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:u,onCancel:h,onFocus:p,onBlur:f,shouldManuallyMaintainScrollPositionWhenFocused:g=!1,children:m,value:x},b){const S=ws(),P=_.useRef(null);_.useImperativeHandle(b,()=>P.current);const w=Pe(),I=_.useRef(a??""),E=_.useRef(a??""),[T,C]=_.useState(!1),j=_.useCallback(D=>{C(!0);const O=D.currentTarget;E.current=O.value,S?S.timers.requestAnimationFrame(()=>{i&&O.select()}):jp.requestAnimationFrame("anon",()=>{i&&O.select()}),p==null||p()},[i,S,p]),k=_.useCallback(D=>{const O=D.currentTarget.value;E.current=O,u==null||u(O)},[u]),R=_.useCallback(D=>{switch(D.key){case"Enter":{D.currentTarget.blur(),ut(D),l==null||l(D.currentTarget.value);break}case"Escape":{D.currentTarget.value=I.current,h==null||h(D.currentTarget.value),D.currentTarget.blur(),ut(D);break}}},[l,h]),A=_.useCallback(D=>{C(!1);const O=D.currentTarget.value;f==null||f(O)},[f]);return _.useEffect(()=>{if(!Be.isIos)return;const D=window.visualViewport;if(T&&g&&D){const O=()=>{var $;($=P.current)==null||$.scrollIntoView({block:"center"})};return D.addEventListener("resize",O),D.addEventListener("scroll",O),S?S.timers.requestAnimationFrame(()=>{var $;($=P.current)==null||$.scrollIntoView({block:"center"})}):jp.requestAnimationFrame("anon",()=>{var $;($=P.current)==null||$.scrollIntoView({block:"center"})}),()=>{D.removeEventListener("resize",O),D.removeEventListener("scroll",O)}}},[T,S,g]),d.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[m,t&&d.jsx("label",{children:w(t)}),s&&d.jsx(Sr,{icon:s,className:"tlui-icon-left",small:!0}),d.jsx("input",{ref:P,className:se("tlui-input",e),type:"text",defaultValue:a,onKeyDownCapture:R,onChange:k,onFocus:j,onBlur:A,autoFocus:o,placeholder:c,value:x}),r&&d.jsx(Sr,{icon:r,small:!!t})]})});function Ux(n){return vn.isValid(n)?{isValid:!0,hasProtocol:!0}:vn.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const yR=Et(function({onClose:e}){const r=z().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?d.jsx(SR,{onClose:e,selectedShape:r}):null}),SR=Et(function({onClose:e,selectedShape:t}){const r=z(),s=Pe(),i=_.useRef(null);_.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var g;return(g=i.current)==null?void 0:g.focus()})},[r]);const o=_.useRef(t.props.url),[a,c]=_.useState(()=>{const g=Ux(t.props.url),m=g.isValid===!0?g.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=_.useCallback(g=>{const m=g.replace(/https?:\/\/(https?:\/\/)/,(S,P)=>P),x=Ux(m),b=x.isValid===!0?x.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:b,valid:x.isValid})},[]),u=_.useCallback(()=>{const g=r.getOnlySelectedShape();g&&(r.updateShapes([{id:g.id,type:g.type,props:{url:""}}]),e())},[r,e]),h=_.useCallback(()=>{const g=r.getOnlySelectedShape();g&&(g&&"url"in g.props&&g.props.url!==a.safe&&r.updateShapes([{id:g.id,type:g.type,props:{url:a.safe}}]),e())},[r,e,a]),p=_.useCallback(()=>{e()},[e]);if(!t)return e(),null;const f=o.current&&!a.valid;return d.jsxs(d.Fragment,{children:[d.jsxs(El,{children:[d.jsx(Tl,{children:s("edit-link-dialog.title")}),d.jsx(kl,{})]}),d.jsx(Bo,{children:d.jsxs("div",{className:"tlui-edit-link-dialog",children:[d.jsx(jl,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:l,onComplete:h,onCancel:p}),d.jsx("div",{children:a.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),d.jsxs(Eg,{className:"tlui-dialog__footer__actions",children:[d.jsx(ie,{type:"normal",onClick:p,onTouchEnd:p,children:d.jsx(lt,{children:s("edit-link-dialog.cancel")})}),f?d.jsx(ie,{type:"danger",onTouchEnd:u,onClick:u,children:d.jsx(lt,{children:s("edit-link-dialog.clear")})}):d.jsx(ie,{type:"primary",disabled:!a.valid,onTouchEnd:h,onClick:h,children:d.jsx(lt,{children:s("edit-link-dialog.save")})})]})]})});var xR={};const Hx=/(^\/r\/[^/]+\/?$)/,Tg=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(Hx))return n},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(Hx))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,s,i]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${xR.NEXT_PUBLIC_GC_API_KEY}&center=${r},${s}&zoom=${i}`}else t="";return t}},fromEmbedUrl:n=>{const e=pe(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[s,i]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${i},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=pe(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,s,i]=t;return`https://codepen.io/${s}/embed/${i}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,s,i]=t;return`https://codepen.io/${s}/pen/${i}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,s]=t;return`https://scratch.mit.edu/projects/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,s]=t;return`https://scratch.mit.edu/projects/${s}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=pe(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=pe(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=pe(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=pe(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=pe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=pe(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=pe(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],bR={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},wR=Tg.map(n=>n.type);function vR(n){return wR.includes(n)}function PR(n){return"icon"in n}function RI(){return z().getShapeUtil("embed")}function kg(){const n=RI();return e=>n?n.getEmbedDefinition(e):void 0}function IR(){const n=RI();return n?n.getEmbedDefinitions():[]}const LI=Et(function({onClose:e}){const t=z(),r=Pe(),s=_g(),[i,o]=_.useState(null),[a,c]=_.useState(""),[l,u]=_.useState(null),[h,p]=_.useState(!1),f=_.useRef(-1),g=IR(),m=kg();return d.jsxs(d.Fragment,{children:[d.jsxs(El,{children:[d.jsx(Tl,{children:i?`${r("embed-dialog.title")} — ${i.title}`:r("embed-dialog.title")}),d.jsx(kl,{})]}),i?d.jsxs(d.Fragment,{children:[d.jsxs(Bo,{className:"tlui-embed-dialog__enter",children:[d.jsx(jl,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:x=>{c(x);const b=m(x);u(b&&b.definition.type===i.type?b:null),p(!1),clearTimeout(f.current),f.current=t.timers.setTimeout(()=>p(!b),320)}}),a===""?d.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[d.jsx("span",{children:r("embed-dialog.instruction")})," ",i.instructionLink&&d.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",d.jsx(Sr,{icon:"external-link",small:!0})]})]}):d.jsx("div",{className:"tlui-embed-dialog__warning",children:h?r("embed-dialog.invalid-url"):" "})]}),d.jsxs(Eg,{className:"tlui-dialog__footer__actions",children:[d.jsx(ie,{type:"normal",onClick:()=>{o(null),u(null),c("")},children:d.jsx(lt,{children:r("embed-dialog.back")})}),d.jsx("div",{className:"tlui-embed__spacer"}),d.jsx(ie,{type:"normal",onClick:e,children:d.jsx(lt,{children:r("embed-dialog.cancel")})}),d.jsx(ie,{type:"primary",disabled:!l,onClick:()=>{l&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:l.definition}),e())},children:d.jsx(lt,{children:r("embed-dialog.create")})})]})]}):d.jsx(d.Fragment,{children:d.jsx(Bo,{className:"tlui-embed-dialog__list",children:g.map(x=>{const b=vR(x.type)?s.embedIcons[x.type]:PR(x)?x.icon:void 0;return d.jsxs(ie,{type:"menu",onClick:()=>o(x),children:[d.jsx(lt,{children:x.title}),b&&d.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${b})`}})]},x.type)})})})]})});var Ih={exports:{}},Kx;function CR(){return Kx||(Kx=1,(function(n){var e=(function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",i={};function o(c,l){if(!i[c]){i[c]={};for(var u=0;u<c.length;u++)i[c][c.charAt(u)]=u}return i[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return o(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return t(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),h=0,p=l.length;h<p;h++){var f=l.charCodeAt(h);u[h*2]=f>>>8,u[h*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,h=l.length;u<h;u++)l[u]=c[u*2]*256+c[u*2+1];var p=[];return l.forEach(function(f){p.push(t(f))}),a.decompress(p.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return s.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return o(s,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return t(l)})},_compress:function(c,l,u){if(c==null)return"";var h,p,f={},g={},m="",x="",b="",S=2,P=3,w=2,I=[],E=0,T=0,C;for(C=0;C<c.length;C+=1)if(m=c.charAt(C),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=P++,g[m]=!0),x=b+m,Object.prototype.hasOwnProperty.call(f,x))b=x;else{if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(h=0;h<w;h++)E=E<<1,T==l-1?(T=0,I.push(u(E)),E=0):T++;for(p=b.charCodeAt(0),h=0;h<8;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1}else{for(p=1,h=0;h<w;h++)E=E<<1|p,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=0;for(p=b.charCodeAt(0),h=0;h<16;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1}S--,S==0&&(S=Math.pow(2,w),w++),delete g[b]}else for(p=f[b],h=0;h<w;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1;S--,S==0&&(S=Math.pow(2,w),w++),f[x]=P++,b=String(m)}if(b!==""){if(Object.prototype.hasOwnProperty.call(g,b)){if(b.charCodeAt(0)<256){for(h=0;h<w;h++)E=E<<1,T==l-1?(T=0,I.push(u(E)),E=0):T++;for(p=b.charCodeAt(0),h=0;h<8;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1}else{for(p=1,h=0;h<w;h++)E=E<<1|p,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=0;for(p=b.charCodeAt(0),h=0;h<16;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1}S--,S==0&&(S=Math.pow(2,w),w++),delete g[b]}else for(p=f[b],h=0;h<w;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1;S--,S==0&&(S=Math.pow(2,w),w++)}for(p=2,h=0;h<w;h++)E=E<<1|p&1,T==l-1?(T=0,I.push(u(E)),E=0):T++,p=p>>1;for(;;)if(E=E<<1,T==l-1){I.push(u(E));break}else T++;return I.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var h=[],p=4,f=4,g=3,m="",x=[],b,S,P,w,I,E,T,C={val:u(0),position:l,index:1};for(b=0;b<3;b+=1)h[b]=b;for(P=0,I=Math.pow(2,2),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;switch(P){case 0:for(P=0,I=Math.pow(2,8),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;T=t(P);break;case 1:for(P=0,I=Math.pow(2,16),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;T=t(P);break;case 2:return""}for(h[3]=T,S=T,x.push(T);;){if(C.index>c)return"";for(P=0,I=Math.pow(2,g),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;switch(T=P){case 0:for(P=0,I=Math.pow(2,8),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;h[f++]=t(P),T=f-1,p--;break;case 1:for(P=0,I=Math.pow(2,16),E=1;E!=I;)w=C.val&C.position,C.position>>=1,C.position==0&&(C.position=l,C.val=u(C.index++)),P|=(w>0?1:0)*E,E<<=1;h[f++]=t(P),T=f-1,p--;break;case 2:return x.join("")}if(p==0&&(p=Math.pow(2,g),g++),h[T])m=h[T];else if(T===f)m=S+S.charAt(0);else return null;x.push(m),h[f++]=S+m.charAt(0),p--,S=m,p==0&&(p=Math.pow(2,g),g++)}}};return a})();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(Ih)),Ih.exports}var _R=CR();const FI=ki(_R),jg="web image/vnd.tldraw+png",ER={"image/png":jg},TR={[jg]:"image/png"};function kR(n){return Ft(ER,n)??null}function jR(n){return Ft(TR,n)??n}function MR(n){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(n)}function AR(n){const e=Object.entries(n);for(const[t,r]of e)r.catch(s=>console.error(s));return navigator.clipboard.write([new ClipboardItem(n)]).catch(t=>(console.error(t),Promise.all(e.map(async([r,s])=>[r,await s])).then(r=>{const s=wf(r);return navigator.clipboard.write([new ClipboardItem(s)])})))}async function DR(n,e,t){var b,S,P;const{elements:r,files:s}=e,i={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},o=new Map,a=new Map,c=n.getCurrentPageId(),l=new Map,u=[],h=new Set;r.forEach(w=>{if(l.set(w.id,ze()),w.boundElements!==null)for(const I of w.boundElements)I.type==="text"&&h.add(I.id)});let p=ow;for(const w of r){if(h.has(w.id))continue;const I=l.get(w.id),E={id:I,typeName:"shape",parentId:c,index:p,x:w.x,y:w.y,rotation:0,isLocked:w.locked,opacity:OR(w.opacity),meta:{}};switch(w.angle!==0&&a.set(I,w.angle),w.groupIds&&w.groupIds.length>0?o.has(w.groupIds[0])?(b=o.get(w.groupIds[0]))==null||b.push(I):o.set(w.groupIds[0],[I]):u.push(I),w.type){case"rectangle":case"ellipse":case"diamond":{let T="",C="middle";if(w.boundElements!==null){for(const k of w.boundElements)if(k.type==="text"){const R=r.find(A=>A.id===k.id);R&&(T=R.text,C=BR[R.textAlign])}}const j=w.backgroundColor==="transparent"?w.strokeColor:w.backgroundColor;i.shapes.push({...E,type:"geo",props:{geo:w.type,url:w.link??"",w:w.width,h:w.height,size:ja[w.strokeWidth]??"draw",color:oo[j]??"black",text:T,align:C,dash:Ma(w),fill:KR(w)}});break}case"freedraw":{i.shapes.push({...E,type:"draw",props:{dash:Ma(w),size:ja[w.strokeWidth],color:oo[w.strokeColor]??"black",segments:[{type:"free",points:w.points.map(([T,C,j=.5])=>({x:T,y:C,z:j}))}]}});break}case"line":{if(w.points.slice().length<2)break;const C=Fo(w.points.length);i.shapes.push({...E,type:"line",props:{dash:Ma(w),size:ja[w.strokeWidth],color:oo[w.strokeColor]??"black",spline:w.roundness?"cubic":"line",points:{...Object.fromEntries(w.points.map(([j,k],R)=>{const A=C[R];return[A,{id:A,index:A,x:j,y:k}]}))}}});break}case"arrow":{let T="";if(w.boundElements!==null){for(const A of w.boundElements)if(A.type==="text"){const D=r.find(O=>O.id===A.id);D&&(T=D.text)}}const C=w.points[0],j=w.points[w.points.length-1],k=l.get((S=w.startBinding)==null?void 0:S.elementId),R=l.get((P=w.endBinding)==null?void 0:P.elementId);i.shapes.push({...E,type:"arrow",props:{text:T,bend:HR(w,C,j),dash:Ma(w),size:ja[w.strokeWidth]??"m",color:oo[w.strokeColor]??"black",start:{x:C[0],y:C[1]},end:{x:j[0],y:j[1]},arrowheadEnd:qx[w.endArrowhead]??"none",arrowheadStart:qx[w.startArrowhead]??"none"}}),k&&i.bindings.push({id:Rs(),typeName:"binding",type:"arrow",fromId:I,toId:k,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),R&&i.bindings.push({id:Rs(),typeName:"binding",type:"arrow",fromId:I,toId:R,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:T,scale:C}=LR(w.fontSize);i.shapes.push({...E,type:"text",props:{size:T,scale:C,font:FR[w.fontFamily]??"draw",color:oo[w.strokeColor]??"black",text:w.text,textAlign:UR[w.textAlign]}});break}case"image":{const T=s[w.fileId];if(!T)break;const C=os.createId();i.assets.push({id:C,typeName:"asset",type:"image",props:{w:w.width,h:w.height,fileSize:T.size,name:w.id??"Untitled",isAnimated:!1,mimeType:T.mimeType,src:T.dataURL},meta:{}}),i.shapes.push({...E,type:"image",props:{w:w.width,h:w.height,assetId:C}})}}p=ar(p)}const f=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(i,{point:f,select:!1,preserveIds:!0});for(const w of o.values())if(w.length>1){n.groupShapes(w);const I=n.getShape(w[0]);I!=null&&I.parentId&&en(I.parentId)&&u.push(I.parentId)}for(const[w,I]of a)n.select(w),n.rotateShapesBy([w],I);const g=fe(u.map(w=>n.getShape(w))),m=V.Common(g.map(w=>n.getShapePageBounds(w))),x=n.getViewportPageBounds().center;n.updateShapes(g.map(w=>{const I={x:(w.x??0)-(m.x+m.w/2),y:(w.y??0)-(m.y+m.h/2)};return{id:w.id,type:w.type,x:x.x+I.x,y:x.y+I.y}})),n.setSelectedShapes(u)}const OR=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},ja={1:"s",2:"m",3:"l",4:"xl"},RR={16:"s",20:"m",28:"l",36:"xl"};function LR(n){const e=RR[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const FR={1:"draw",2:"sans",3:"mono"},$R={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function rr(n,e,t){const r=[0,1,2,3,4].map(s=>$R[n][s]);return Object.fromEntries(r.map((s,i)=>[s,i<3?e:t]))}const oo={...rr("gray","grey","black"),...rr("red","light-red","red"),...rr("pink","light-red","red"),...rr("grape","light-violet","violet"),...rr("blue","light-blue","blue"),...rr("cyan","light-blue","blue"),...rr("teal","light-green","green"),...rr("green","light-green","green"),...rr("yellow","yellow","orange"),...rr("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},zR={solid:"draw",dashed:"dashed",dotted:"dotted"},NR={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},BR={left:"start",center:"middle",right:"end"},UR={left:"start",center:"middle",right:"end"},qx={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function HR(n,e,t){let r=0;if(n.points.length>2){const s=new y(e[0],e[1]),i=new y(t[0],t[1]),o=new y(n.points[1][0],n.points[1][1]),a=y.Sub(i,s),c=y.Per(a),l=y.Med(i,s),u=y.Sub(l,c),h=y.Add(l,c),p=y.NearestPointOnLineSegment(u,h,o,!1);r=y.Dist(p,l),y.Clockwise(p,i,l)&&(r*=-1)}return r}const Ma=n=>{let e=zR[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},KR=n=>n.backgroundColor==="transparent"?"none":NR[n.fillStyle]??"solid";async function qR(n,e,t,r){const s=e.map(i=>i instanceof File?i:new File([i],"tldrawFile",{type:i.type}));n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"files",files:s,point:t,ignoreParent:!1,sources:r})}function GR(n,e,t){const r=n.getSelectionPageBounds();n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(e,{point:t,select:!0});const s=n.getSelectionPageBounds();r&&s&&(r!=null&&r.collides(s))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function zp(n,e,t,r){return n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const WR=[jg,"image/png","image/jpeg","image/webp","image/svg+xml"];function YR(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const VR=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},XR=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return V0(e)},ZR=n=>/^<svg/.test(n),JR=["input","select","textarea"];function Ch(n){const{activeElement:e}=document;return n.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||JR.indexOf(e.tagName.toLowerCase())>-1)}const _h=(n,e,t,r)=>{const s=XR(e);if(s)for(const i of s)zp(n,i,t);else VR(e)?zp(n,e,t):ZR(e)?(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},QR=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const s of Object.values(e.items))switch(s.kind){case"file":{r.push({type:"file",source:new Promise(i=>i(s.getAsFile()))});break}case"string":{s.type==="text/html"?r.push({type:"html",source:new Promise(i=>s.getAsString(i))}):s.type==="text/plain"?r.push({type:"text",source:new Promise(i=>s.getAsString(i))}):r.push({type:s.type,source:new Promise(i=>s.getAsString(i))});break}}zI(n,r,t)},$I=async(n,e,t)=>{const r=[];for(const s of e){for(const i of WR)if(s.types.includes(i)){const o=s.getType(i).then(a=>Kn.rewriteMimeType(a,jR(i)));r.push({type:"blob",source:o});break}s.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const i=await s.getType("text/html");return await Kn.blobToText(i)})()}),s.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const i=await s.getType("text/uri-list");return await Kn.blobToText(i)})()}),s.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const i=await s.getType("text/plain");return await Kn.blobToText(i)})()})}return await zI(n,r,t)};async function zI(n,e,t){const r=e.filter(i=>(i.type==="file"||i.type==="blob")&&i.source!==null);if(r.length){if(r.length>n.options.maxFilesAtOnce)throw Error("Too many files");const i=fe(await Promise.all(r.map(o=>o.source)));return await qR(n,i,t)}const s=await Promise.all(e.filter(i=>i.type!=="file").map(i=>new Promise(o=>{const a=i;if(a.type==="file"){o({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var u;const l=(u=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:u[1];if(l)try{const h=FI.decompressFromBase64(l);if(h===null){o({type:"error",data:h,reason:"found tldraw data comment but could not parse base64"});return}else{const p=JSON.parse(h);if(p.type!=="application/tldraw"&&o({type:"error",data:p,reason:`found tldraw data comment but JSON was of a different type: ${p.type}`}),typeof p.data=="string"){o({type:"error",data:p,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}o({type:"tldraw",data:p.data});return}}catch{o({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){o({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){o({type:"text",data:c,subtype:"url"});return}try{const h=JSON.parse(c);if(h.type==="excalidraw/clipboard"){o({type:"excalidraw",data:h});return}else{o({type:"text",data:c,subtype:"json"});return}}catch{o({type:"text",data:c,subtype:"text"});return}}o({type:"error",data:c,reason:"unhandled case"})})})));for(const i of s)if(i.type==="tldraw"){GR(n,i.data,t);return}for(const i of s)if(i.type==="excalidraw"){DR(n,i.data,t);return}for(const i of s)if(i.type==="text"&&i.subtype==="html"){const a=new DOMParser().parseFromString(i.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");_h(n,l,t,s);return}if(!s.some(l=>l.type==="text"&&l.subtype!=="html")&&i.data.trim()){_h(n,YR(i.data),t,s);return}}for(const i of s)if(i.type==="text"&&i.subtype==="url"){zp(n,i.data,t,s);return}for(const i of s)if(i.type==="text"&&i.subtype==="text"&&i.data.trim()){_h(n,i.data,t,s);return}}const Uc=async n=>{var r;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=FI.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const s=e.shapes.map(i=>n.getShapeUtil(i).getText(i)).filter(HT);if((r=navigator.clipboard)!=null&&r.write){const i=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let o=s.join(" ");o===""&&(o=" "),navigator.clipboard.write([new ClipboardItem({"text/html":i,"text/plain":new Blob([o],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function eL(){const n=z(),e=kt(),t=_.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Uc(n),e("copy",{source:o}))},[n,e]),r=_.useCallback(async function(o){n.getSelectedShapeIds().length!==0&&(await Uc(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:o}))},[n,e]),s=_.useCallback(async function(o,a,c){n.getEditingShapeId()===null&&(Array.isArray(o)&&o[0]instanceof ClipboardItem?($I(n,o,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{s(l,a,c)}))},[n,e]);return{copy:t,cut:r,paste:s}}function tL(){const n=z(),e=kt(),t=N("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);_.useEffect(()=>{if(!t)return;const r=async c=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Ch(n)||(xe(c),await Uc(n),e("copy",{source:"kbd"}))};async function s(c){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||Ch(n)||(xe(c),await Uc(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let i=!1;const o=c=>{c.button===1&&(i=!0,n.timers.requestAnimationFrame(()=>{i=!1}))},a=c=>{var p;if(i){ut(c);return}if(n.getEditingShapeId()!==null||Ch(n))return;let l,u=!1;n.inputs.shiftKey&&(u=!0),n.user.getIsPasteAtCursorMode()&&(u=!u),u&&(l=n.inputs.currentPagePoint);const h=()=>{c.clipboardData&&QR(n,c.clipboardData,l)};(p=navigator.clipboard)!=null&&p.read?navigator.clipboard.read().then(f=>{Array.isArray(f)&&f[0]instanceof ClipboardItem&&$I(n,f,l)},()=>{h()}):h(),xe(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",s),document.addEventListener("paste",a),document.addEventListener("pointerup",o),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",s),document.removeEventListener("paste",a),document.removeEventListener("pointerup",o)}},[n,e,t])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function nL(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,s,i,o,a=[],c=!0,l=!1;try{if(i=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=i.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,s=u}finally{try{if(!c&&t.return!=null&&(o=t.return(),Object(o)!==o))return}finally{if(l)throw s}}return a}}function Gx(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(s){return Object.getOwnPropertyDescriptor(n,s).enumerable}))),t.push.apply(t,r)}return t}function mn(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Gx(Object(t),!0).forEach((function(r){rL(n,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):Gx(Object(t)).forEach((function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))}))}return n}function rL(n,e,t){return e=hL(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function sL(n,e){if(n==null)return{};var t={},r=Object.keys(n),s,i;for(i=0;i<r.length;i++)s=r[i],!(e.indexOf(s)>=0)&&(t[s]=n[s]);return t}function iL(n,e){if(n==null)return{};var t=sL(n,e),r,s;if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(n);for(s=0;s<i.length;s++)r=i[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function Wx(n,e){return aL(n)||nL(n,e)||NI(n,e)||dL()}function Aa(n){return oL(n)||cL(n)||NI(n)||lL()}function oL(n){if(Array.isArray(n))return Np(n)}function aL(n){if(Array.isArray(n))return n}function cL(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function NI(n,e){if(n){if(typeof n=="string")return Np(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Np(n,e)}}function Np(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function lL(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uL(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e);if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function hL(n){var e=uL(n,"string");return typeof e=="symbol"?e:String(e)}function ko(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),s=[t-1,r-1,1,1],i=Date.now(),o=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;o?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=t,c.height=r);var l=a.getContext("2d"),u=c.getContext("2d");u&&(u.fillRect.apply(u,s),l.drawImage(c,t-1,r-1,1,1,0,0,1,1));var h=l&&l.getImageData(0,0,1,1).data[3]!==0,p=Date.now()-i;return[a,c].forEach((function(f){f.height=0,f.width=0})),o?(postMessage({width:t,height:r,benchmark:p,isTestPass:h}),!h&&n.sizes.length&&ko(n)):h?n.onSuccess(t,r,p):(n.onError(t,r,p),n.sizes.length&&ko(n)),h}var Eh={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},pL=["onError","onSuccess"],pi={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},ao={};function Th(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,s=[];if(!n.width||!n.height)n.sizes.forEach((function(u){var h=e||t?u:1,p=e||r?u:1;s.push([h,p])}));else for(var i=n.min||pi.min,o=n.step||pi.step,a=Math.max(n.width,n.height);a>=i;){var c=e||t?a:1,l=e||r?a:1;s.push([c,l]),a-=o}return s}function Da(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),s=n.onError,i=n.onSuccess,o=iL(n,pL),a=null;if(!e)return!1;if(n.useWorker&&t){var c=`
            var canvasTest = `.concat(ko.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),u=URL.createObjectURL(l);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(h){var p=h.data,f=p.width,g=p.height,m=p.benchmark,x=p.isTestPass;x?(ao[r].onSuccess(f,g,m),delete ao[r]):ao[r].onError(f,g,m)}}if(n.usePromise)return new Promise((function(h,p){var f=mn(mn({},n),{},{onError:function(b,S,P){var w;if(n.sizes.length===0)w=!0;else{var I=n.sizes.slice(-1),E=Wx(I,1),T=Wx(E[0],2),C=T[0],j=T[1];w=b===C&&S===j}s(b,S,P),w&&p({width:b,height:S,benchmark:P})},onSuccess:function(b,S,P){i(b,S,P),h({width:b,height:S,benchmark:P})}});if(a){var g=f.onError,m=f.onSuccess;ao[r]={onError:g,onSuccess:m},a.postMessage(o)}else ko(f)}));if(a)ao[r]={onError:s,onSuccess:i},a.postMessage(o);else return ko(n)}var kh={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Th({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Aa(Eh.area)}),r=mn(mn(mn({},pi),e),{},{sizes:t});return Da(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Th({width:1,height:e.max,min:e.min,step:e.step,sizes:Aa(Eh.height)}),r=mn(mn(mn({},pi),e),{},{sizes:t});return Da(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Th({width:e.max,height:1,min:e.min,step:e.step,sizes:Aa(Eh.width)}),r=mn(mn(mn({},pi),e),{},{sizes:t});return Da(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=mn(mn({},pi),e);return t.sizes=Aa(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Da(t)}};let jh=null;function fL(){return jh||(jh=gL()),jh}async function gL(){const n=await kh.maxWidth({usePromise:!0}),e=await kh.maxHeight({usePromise:!0}),t=await kh.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const Yx=8192,mL=4096*4096;async function yL(n,e){if(n<=Yx&&e<=Yx&&n*e<=mL)return[n,e];const{maxWidth:t,maxHeight:r,maxArea:s}=await fL(),i=n/e;if(n>t&&(n=t,e=n/i),e>r&&(e=r,n=e*i),n*e>s){const o=Math.sqrt(s/(n*e));n*=o,e*=o}return[n,e]}async function BI(n,e,t){const{type:r,width:s,height:i,quality:o=1,pixelRatio:a=2}=t;let[c,l]=await yL(s*a,i*a);c=Math.floor(c),l=Math.floor(l);const u=c/s,h=await Kn.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),p=await new Promise(g=>{const m=Ro();m.crossOrigin="anonymous",m.onload=async()=>{Be.isSafari&&await up(250);const x=document.createElement("canvas"),b=x.getContext("2d");x.width=c,x.height=l,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(m,0,0,c,l),URL.revokeObjectURL(h),g(x)},m.onerror=()=>{g(null)},m.src=h});if(!p)return null;const f=await new Promise(g=>p.toBlob(m=>{(!m||ct.throwToBlob.get())&&g(null),g(m)},"image/"+r,o));if(!f)return null;if(r==="png"){const g=new DataView(await f.arrayBuffer());return or.setPhysChunk(g,u,{type:"image/"+r})}else return f}async function UI(n,e,t){const r=await n.getSvgString(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:t.scale??1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function Bp(n,e,t,r={}){var s;switch(t){case"svg":return(s=await UI(n,e,r))==null?void 0:s.svg;case"json":{const i=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(i)}default:mt(t)}}async function HI({editor:n,ids:e,format:t,opts:r={}}){switch(t){case"svg":return new Blob([await Bp(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await Bp(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const s=await UI(n,e,r);if(!s)throw new Error("Could not construct image.");const i=await BI(n,s.svg,{type:t,quality:r.quality,pixelRatio:r.pixelRatio,width:s.width,height:s.height});if(!i)throw new Error("Could not construct image.");return i}default:mt(t)}}const SL={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function xL(n,e,t,r={}){return{blobPromise:HI({editor:n,ids:e,format:t,opts:r}),mimeType:SL[t]}}function bL(n,e,t="svg",r={}){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:s,mimeType:i}=xL(n,e,t,r),o={[i]:s},a=kR(i);return a&&MR(a)&&(o[a]=s.then(c=>Kn.rewriteMimeType(c,a))),AR(o)}switch(t){case"json":case"svg":return wL(async()=>Bp(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:mt(t)}}async function wL(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}const KI=_.createContext(null);function vL({children:n}){const e=Vw("toasts",[]),t=_.useMemo(()=>({toasts:e,addToast(r){const s=r.id??Fe();return e.update(i=>[...i.filter(o=>o.id!==r.id),{...r,id:s}]),s},removeToast(r){return e.update(s=>s.filter(i=>i.id!==r)),r},clearToasts(){e.set([])}}),[e]);return d.jsx(bE,{children:d.jsx(KI.Provider,{value:t,children:n})})}function vr(){const n=_.useContext(KI);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}function PL(){const n=z(),{addToast:e}=vr(),t=Pe();return _.useCallback((r,s="svg")=>{bL(n,r,s).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function IL(n,e,t="png",r,s={}){if(!r&&(r=`shapes at ${Vx()}`,e.length===1)){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?r=a.props.name??"frame":r=`${dl(a.id)} at ${Vx()}`}r+=`.${t}`;const i=await HI({editor:n,ids:e,format:t,opts:s}),o=new File([i],r,{type:i.type});CL(o)}function Vx(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),s=String(n.getHours()).padStart(2,"0"),i=String(n.getMinutes()).padStart(2,"0"),o=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${s}.${i}.${o}`}function CL(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function _L(){const n=z(),{addToast:e}=vr(),t=Pe();return _.useCallback((r,s="png",i)=>{IL(n,r,s,i,{scale:1,background:n.getInstanceState().exportBackground}).catch(o=>{console.error(o.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}async function EL(n,e,t){const r=fe(e.map(a=>{const c=n.getShape(a);if(!(!c||n.getShapeUtil(c.type).toSvg===void 0))return c}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||n.isShapeOfType(a,"image"))return}const s=[];if(t!==void 0){const a=r.map(c=>({shape:c,bounds:n.getShapeMaskedPageBounds(c).clone().expandBy(t)}));for(let c=0;c<a.length;c++){const l=a[c];if(c===0){s[0]={shapes:[l.shape],bounds:l.bounds};continue}let u=!1;for(const h of s)if(h.bounds.includes(l.bounds)){h.shapes.push(l.shape),h.bounds.expand(l.bounds),u=!0;break}u||s.push({shapes:[l.shape],bounds:l.bounds})}}else{const a=V.Common(r.map(c=>n.getShapeMaskedPageBounds(c)));s.push({shapes:r,bounds:a})}const i=n.options.flattenImageBoundsPadding;for(const a of s){t!==void 0&&a.bounds.expandBy(-t);const c=await n.getSvgString(a.shapes,{padding:i});if(!(c!=null&&c.svg))continue;const l=new Blob([c.svg],{type:"image/svg+xml"}),u=await n.getAssetForExternalContent({type:"file",file:new File([l],"asset.svg",{type:"image/svg+xml"})});u&&(a.asset=u)}const o=[];return hr(()=>{for(const a of s){const{asset:c,bounds:l,shapes:u}=a;if(!c)continue;const h=n.findCommonAncestor(u)??n.getCurrentPageId();if(!h)continue;let p="a1";for(const b of u)if(b.parentId===h){b.index>p&&(p=b.index);break}let f,g,m;if(en(h)){const b=n.getShape(h);if(!b)continue;const S=n.getPointInShapeSpace(b,{x:l.x,y:l.y});m=n.getShapePageTransform(h).rotation(),S.sub(new y(i,i).rot(-m)),f=S.x,g=S.y}else f=l.x-i,g=l.y-i,m=0;n.deleteShapes(u),n.createAssets([{...c,id:c.id}]);const x=ze();n.createShape({id:x,type:"image",index:p,parentId:h,x:f,y:g,rotation:-m,props:{assetId:c.id,w:l.w+i*2,h:l.h+i*2}}),o.push(x)}}),o}const qI=Qe.createContext([]);function GI(){const n=z(),e=_.useRef(),t=cs(Qe.useContext(qI));return _.useEffect(()=>{const r=window.document.createElement("input");r.type="file",r.accept=(t==null?void 0:t.join(","))??xT,r.multiple=!0,e.current=r;async function s(i){const o=i.target.files;!o||o.length===0||(n.markHistoryStoppingPoint("insert media"),await n.putExternalContent({type:"files",files:Array.from(o),point:n.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",s),()=>{e.current=void 0,r.removeEventListener("change",s)}},[n,t]),_.useCallback(()=>{var r;(r=e.current)==null||r.click()},[e])}function Ml(){const n=ws();return(n==null?void 0:n.store.props.collaboration)!==void 0}function TL(){const n=ws();return N("sync status",()=>{var e;return(e=n==null?void 0:n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}function kL(){const n=z(),e=_.useRef(null),t=_.useRef(null);return _.useCallback(async function(){const s=document.createElement("div"),i=document.createElement("style"),o=(b,S)=>{b&&(b.innerHTML=""),S&&document.head.contains(S)&&document.head.removeChild(S),b&&document.body.contains(b)&&document.body.removeChild(b)};o(e.current,t.current),e.current=s,t.current=i;const a=`tl-print-surface-${Fe()}`;s.className=a,i.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(i),document.body.appendChild(s)},l=()=>{n.once("tick",()=>{o(s,i)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function u(b,S,P){try{s.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${P}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${S?"":"hide"}">
          ${S??""}
        </div>
      </div>`}catch(w){console.error(w)}}function h(){Be.isChromeForIos?(c(),window.print()):Be.isSafari?(c(),document.execCommand("print",!1)):window.print()}const p=n.getSelectedShapeIds(),f=n.getCurrentPageId(),g=n.getPages(),x={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const b=await n.getSvgString(p,x);if(b){const S=g.find(P=>P.id===f);u(`tldraw — ${S==null?void 0:S.name}`,null,b.svg),h()}}else{const b=n.getCurrentPage(),S=await n.getSvgString(n.getSortedChildIdsForParent(b.id),x);S&&(u(`tldraw — ${b.name}`,null,S.svg),h())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[n])}const WI=_.createContext(null);function jL({context:n,children:e}){const t=kt(),r=Vw("dialogs",[]),s=_.useMemo(()=>({dialogs:r,addDialog(i){const o=i.id??Fe();return r.update(a=>[...a.filter(c=>c.id!==i.id),{...i,id:o}]),t("open-menu",{source:"dialog",id:o}),Un.addOpenMenu(o,n),o},removeDialog(i){var a;const o=r.get().find(c=>c.id===i);return o&&((a=o.onClose)==null||a.call(o),t("close-menu",{source:"dialog",id:i}),Un.deleteOpenMenu(i,n),r.update(c=>c.filter(l=>l!==o))),i},clearDialogs(){const i=r.get();i.length!==0&&(i.forEach(o=>{var a;(a=o.onClose)==null||a.call(o),t("close-menu",{source:"dialog",id:o.id}),Un.deleteOpenMenu(o.id,n)}),r.set([]))}}),[t,r,n]);return d.jsx(WI.Provider,{value:s,children:e})}function Xs(){const n=_.useContext(WI);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}const YI=_.createContext(null);function ML(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function ii(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function AL({overrides:n,children:e}){const t=z(),r=Ml(),{addDialog:s,clearDialogs:i}=Xs(),{clearToasts:o,addToast:a}=vr(),c=Pe(),l=GI(),u=kL(),{cut:h,copy:p,paste:f}=eL(),g=PL(),m=_L(),x=c("document.default-name"),b=kg(),S=kt(),P=_.useMemo(()=>{function w(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function I(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const E=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(C){I()&&(w()||(S("edit-link",{source:C}),t.markHistoryStoppingPoint("edit-link"),s({component:yR})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(C){S("insert-embed",{source:C}),s({component:LI})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(C){S("insert-media",{source:C}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(C){S("undo",{source:C}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(C){S("redo",{source:C}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("export-as",{format:"svg",source:C}),m(j,"svg",ii(t,x)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("export-as",{format:"png",source:C}),m(j,"png",ii(t,x)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("export-as",{format:"json",source:C}),m(j,"json",ii(t,x)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("export-all-as",{format:"svg",source:C}),m(Array.from(t.getCurrentPageShapeIds()),"svg",ii(t,x)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(C){const j=Array.from(t.getCurrentPageShapeIds().values());j.length!==0&&(S("export-all-as",{format:"png",source:C}),m(j,"png",ii(t,x)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(C){const j=Array.from(t.getCurrentPageShapeIds().values());j.length!==0&&(S("export-all-as",{format:"json",source:C}),m(j,"json",ii(t,x)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("copy-as",{format:"svg",source:C}),g(j,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("copy-as",{format:"png",source:C}),g(j,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(C){let j=t.getSelectedShapeIds();j.length===0&&(j=Array.from(t.getCurrentPageShapeIds().values())),j.length!==0&&(S("copy-as",{format:"json",source:C}),g(j,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(C){if(!I()||w())return;S("toggle-auto-size",{source:C}),t.markHistoryStoppingPoint("toggling auto size");const j=t.getSelectedShapes().filter(k=>t.isShapeOfType(k,"text")&&k.props.autoSize===!1);t.updateShapes(j.map(k=>({id:k.id,type:k.type,props:{...k.props,w:8,autoSize:!0}}))),He(t,j.map(k=>k.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(C){S("open-embed-link",{source:C});const j=t.getSelectedShapeIds(),k="No embed shapes selected";if(j.length!==1){console.error(k);return}const R=t.getShape(j[0]);if(!R||!t.isShapeOfType(R,"embed")){console.error(k);return}cR(R.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(C){var j,k;if(((j=t.root.getCurrent())==null?void 0:j.id)!=="zoom"&&(S("zoom-tool",{source:C}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const R=t.root.getCurrent();R&&((k=R.getCurrent())==null?void 0:k.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:R.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(C){I()&&(w()||t.run(()=>{S("convert-to-bookmark",{source:C});const j=t.getSelectedShapes(),k=[],R=[];for(const A of j){if(!A||!t.isShapeOfType(A,"embed")||!A.props.url)continue;const D=new y(A.x,A.y);D.rot(-A.rotation),D.add(new y(A.props.w/2-300/2,A.props.h/2-320/2)),D.rot(A.rotation);const O={id:ze(),type:"bookmark",rotation:A.rotation,x:D.x,y:D.y,opacity:1,props:{url:A.props.url}};k.push(O),R.push(A.id)}t.markHistoryStoppingPoint("convert shapes to bookmark"),t.deleteShapes(R),t.createShapes(k)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(C){I()&&(w()||(S("convert-to-embed",{source:C}),t.run(()=>{const j=t.getSelectedShapeIds(),k=fe(j.map(D=>t.getShape(D))),R=[],A=[];for(const D of k){if(!t.isShapeOfType(D,"bookmark"))continue;const{url:O}=D.props,$=b(O);if(!$||!$.definition)continue;const{width:B,height:G}=$.definition,Y=new y(D.x,D.y);Y.rot(-D.rotation),Y.add(new y(D.props.w/2-B/2,D.props.h/2-G/2)),Y.rot(D.rotation);const ne={id:ze(),type:"embed",x:Y.x,y:Y.y,rotation:D.rotation,props:{url:O,w:B,h:G}};R.push(ne),A.push(D.id)}t.markHistoryStoppingPoint("convert shapes to embed"),t.deleteShapes(A),t.createShapes(R)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(C){if(!I()||w())return;S("duplicate-shapes",{source:C});const j=t.getInstanceState();let k,R;if(j.duplicateProps)k=j.duplicateProps.shapeIds,R=j.duplicateProps.offset;else{k=t.getSelectedShapeIds();const A=V.Common(fe(k.map(D=>t.getShapePageBounds(D))));R=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:A.width+t.options.adjacentShapeMargin,y:0}}t.markHistoryStoppingPoint("duplicate shapes"),t.duplicateShapes(k,R),j.duplicateProps&&t.updateInstanceState({duplicateProps:{...j.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(C){I()&&(w()||(S("ungroup-shapes",{source:C}),t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(C){if(!I()||w())return;S("group-shapes",{source:C});const j=t.getOnlySelectedShape();j&&t.isShapeOfType(j,"group")?(t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.markHistoryStoppingPoint("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(C){if(!I())return;S("remove-frame",{source:C});const j=t.getSelectedShapes();j.length>0&&j.every(k=>t.isShapeOfType(k,"frame"))&&(t.markHistoryStoppingPoint("remove-frame"),dR(t,j.map(k=>k.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(C){if(!I())return;S("fit-frame-to-content",{source:C});const j=t.getOnlySelectedShape();j&&t.isShapeOfType(j,"frame")&&(t.markHistoryStoppingPoint("fit-frame-to-content"),hR(t,j.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"left",source:C}),t.markHistoryStoppingPoint("align left");const j=t.getSelectedShapeIds();t.alignShapes(j,"left"),He(t,j)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"center-horizontal",source:C}),t.markHistoryStoppingPoint("align center horizontal");const j=t.getSelectedShapeIds();t.alignShapes(j,"center-horizontal"),He(t,j)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"right",source:C}),t.markHistoryStoppingPoint("align right");const j=t.getSelectedShapeIds();t.alignShapes(j,"right"),He(t,j)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"center-vertical",source:C}),t.markHistoryStoppingPoint("align center vertical");const j=t.getSelectedShapeIds();t.alignShapes(j,"center-vertical"),He(t,j)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"top",source:C}),t.markHistoryStoppingPoint("align top");const j=t.getSelectedShapeIds();t.alignShapes(j,"top"),He(t,j)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(C){if(!I()||w())return;S("align-shapes",{operation:"bottom",source:C}),t.markHistoryStoppingPoint("align bottom");const j=t.getSelectedShapeIds();t.alignShapes(j,"bottom"),He(t,j)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(C){if(!I()||w())return;S("distribute-shapes",{operation:"horizontal",source:C}),t.markHistoryStoppingPoint("distribute horizontal");const j=t.getSelectedShapeIds();t.distributeShapes(j,"horizontal"),He(t,j)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(C){if(!I()||w())return;S("distribute-shapes",{operation:"vertical",source:C}),t.markHistoryStoppingPoint("distribute vertical");const j=t.getSelectedShapeIds();t.distributeShapes(j,"vertical"),He(t,j)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(C){if(!I()||w())return;S("stretch-shapes",{operation:"horizontal",source:C}),t.markHistoryStoppingPoint("stretch horizontal");const j=t.getSelectedShapeIds();t.stretchShapes(j,"horizontal"),He(t,j)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(C){if(!I()||w())return;S("stretch-shapes",{operation:"vertical",source:C}),t.markHistoryStoppingPoint("stretch vertical");const j=t.getSelectedShapeIds();t.stretchShapes(j,"vertical"),He(t,j)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(C){if(!I()||w())return;S("flip-shapes",{operation:"horizontal",source:C}),t.markHistoryStoppingPoint("flip horizontal");const j=t.getSelectedShapeIds();t.flipShapes(j,"horizontal"),He(t,j)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(C){if(!I()||w())return;S("flip-shapes",{operation:"vertical",source:C}),t.markHistoryStoppingPoint("flip vertical");const j=t.getSelectedShapeIds();t.flipShapes(j,"vertical"),He(t,j)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(C){if(!I()||w())return;S("pack-shapes",{source:C}),t.markHistoryStoppingPoint("pack");const j=t.getSelectedShapeIds();t.packShapes(j,t.options.adjacentShapeMargin),He(t,j)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(C){if(!I()||w())return;S("stack-shapes",{operation:"vertical",source:C}),t.markHistoryStoppingPoint("stack-vertical");const j=t.getSelectedShapeIds();t.stackShapes(j,"vertical",16),He(t,j)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(C){if(!I()||w())return;S("stack-shapes",{operation:"horizontal",source:C}),t.markHistoryStoppingPoint("stack-horizontal");const j=t.getSelectedShapeIds();t.stackShapes(j,"horizontal",16),He(t,j)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(C){I()&&(w()||(S("reorder-shapes",{operation:"toFront",source:C}),t.markHistoryStoppingPoint("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(C){I()&&(w()||(S("reorder-shapes",{operation:"forward",source:C}),t.markHistoryStoppingPoint("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(C){I()&&(w()||(S("reorder-shapes",{operation:"backward",source:C}),t.markHistoryStoppingPoint("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(C){I()&&(w()||(S("reorder-shapes",{operation:"toBack",source:C}),t.markHistoryStoppingPoint("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(C){I()&&(w()||(t.markHistoryStoppingPoint("cut"),h(C)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(C){I()&&(w()||p(C))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(C){var j;(j=navigator.clipboard)==null||j.read().then(k=>{f(k,C,C==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{a({title:c("action.paste-error-title"),description:c("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(C){t.run(()=>{w()||(S("select-all-shapes",{source:C}),t.markHistoryStoppingPoint("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(C){I()&&(w()||(S("select-none-shapes",{source:C}),t.markHistoryStoppingPoint("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(C){I()&&(w()||(S("delete-shapes",{source:C}),t.markHistoryStoppingPoint("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(C){if(!I()||w())return;S("rotate-cw",{source:C}),t.markHistoryStoppingPoint("rotate-cw");const j=t.getSelectionRotation()%(Ke/2),k=fs(j,0)||fs(j,Ke/2),R=t.getSelectedShapeIds();t.rotateShapesBy(R,Ke/2-(k?0:j)),He(t,R)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(C){if(!I()||w())return;S("rotate-ccw",{source:C}),t.markHistoryStoppingPoint("rotate-ccw");const j=t.getSelectionRotation()%(Ke/2),k=fs(j,0),R=t.getSelectedShapeIds();t.rotateShapesBy(R,k?-(Ke/2):-j),He(t,R)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(C){S("zoom-in",{source:C}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(C){S("zoom-out",{source:C}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(C){S("reset-zoom",{source:C}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(C){S("zoom-to-fit",{source:C}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(C){I()&&(w()||(S("zoom-to-selection",{source:C}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(C){S("toggle-snap-mode",{source:C}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(C){const j=t.user.getIsDarkMode()?"light":"dark";S("color-scheme",{source:C,value:j}),t.user.updateUserPreferences({colorScheme:j})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(C){S("toggle-wrap-mode",{source:C}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(C){S("toggle-dynamic-size-mode",{source:C}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(C){S("toggle-paste-at-cursor",{source:C}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(C){S("toggle-reduce-motion",{source:C}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(C){S("toggle-edge-scrolling",{source:C}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(C){S("toggle-transparent",{source:C}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(C){S("toggle-tool-lock",{source:C}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(C){S("unlock-all",{source:C});const j=[];for(const k of t.getCurrentPageShapes())k.isLocked&&j.push({id:k.id,type:k.type,isLocked:!1});j.length>0&&t.updateShapes(j)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(C){t.timers.requestAnimationFrame(()=>{t.run(()=>{S("toggle-focus-mode",{source:C}),i(),o(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(C){S("toggle-grid-mode",{source:C}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(C){S("toggle-debug-mode",{source:C}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(C){S("print",{source:C}),u()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(C){S("exit-pen-mode",{source:C}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(C){S("stop-following",{source:C}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(C){S("zoom-to-content",{source:C});const j=t.getSelectionPageBounds()??t.getCurrentPageBounds();j&&t.zoomToBounds(j,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(C){t.markHistoryStoppingPoint("locking"),S("toggle-lock",{source:C}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(C){const j=In.createId(),k=t.getSelectedShapeIds();t.run(()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.createPage({name:c("page-menu.new-page-initial-name"),id:j}),t.moveShapesToPage(k,j)}),S("move-to-new-page",{source:C})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(C){const j=Pn;t.run(()=>{t.markHistoryStoppingPoint("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(j,"white"),t.setStyleForNextShapes(j,"white")}),S("set-style",{source:C,id:j.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(C){const j=Bs;t.run(()=>{t.markHistoryStoppingPoint("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(j,"fill"),t.setStyleForNextShapes(j,"fill")}),S("set-style",{source:C,id:j.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async C=>{const j=t.getSelectedShapeIds();if(j.length===0)return;t.markHistoryStoppingPoint("flattening to image"),S("flatten-to-image",{source:C});const k=await EL(t,j,t.options.flattenImageBoundsExpand);k!=null&&k.length&&t.setSelectedShapes(k)}}];r&&E.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(C){S("open-cursor-chat",{source:C}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const T=ML(E);return n?n(t,T,void 0):T},[t,S,n,s,a,l,m,g,h,p,f,i,o,u,c,x,r,b]);return d.jsx(YI.Provider,{value:P,children:e})}function Zs(){const n=_.useContext(YI);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Uo(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}function _n(){const n=ws();return N("isReadonlyMode",()=>!!(n!=null&&n.getIsReadonly()),[n])}const Mh=[0,389,436,476,580,640,840,1023];var ot=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(ot||{});const VI=Qe.createContext(null);function DL({forceMobile:n=!1,children:e}){const t=ws(),r=N("breakpoint",()=>{const{width:s}=(t==null?void 0:t.getViewportScreenBounds())??{width:window.innerWidth},i=n?ot.MOBILE_SM:Mh.length-1;for(let o=0;o<i;o++)if(s>Mh[o]&&s<=Mh[o+1])return o;return i},[t]);return d.jsx(VI.Provider,{value:r,children:e})}function Yt(){const n=_.useContext(VI);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}const OL=Be.isDarwin?"⌘":"Ctrl",RL=Be.isDarwin?"⌥":"Alt";function XI(n){return n===","?[","]:n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,OL).replace(/\?/g,RL).replace(/!/g,"⇧");return t[0].toUpperCase()+t.slice(1)})}function Up(n){return"— "+XI(n).join(" ")}function jo({children:n,visibleOnMobileLayout:e=!1}){const t=Yt();return!e&&t<ot.MOBILE?null:d.jsx("kbd",{className:"tlui-kbd",children:XI(n).map((r,s)=>d.jsx("span",{children:r},s))})}const ZI=_.createContext(null);function Al(){const n=_.useContext(ZI);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function Ln({type:n,sourceId:e,children:t}){return d.jsx(ZI.Provider,{value:{type:n,sourceId:e},children:t})}function Dl({id:n,kbd:e,label:t,readonlyOk:r,onSelect:s,toggle:i=!1,disabled:o=!1,checked:a=!1}){const{type:c,sourceId:l}=Al(),u=_n(),h=Pe();if(u&&!r)return null;const p=Uo(t,c),f=p?h(p):void 0;switch(c){case"menu":return d.jsxs(vE,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:f,onSelect:g=>{s==null||s(l),xe(g)},disabled:o,checked:a,children:[d.jsx(Sr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&d.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&d.jsx(jo,{children:e})]});case"context-menu":return d.jsxs(wE,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:f,onSelect:g=>{s(l),xe(g)},disabled:o,checked:a,children:[d.jsx(Sr,{small:!0,icon:i?a?"toggle-on":"toggle-off":a?"check":"none"}),f&&d.jsx("span",{className:"tlui-button__label",draggable:!1,children:f}),e&&d.jsx(jo,{children:e})]},n);default:return null}}function Vr(n,e){const t=ws(),r=_.useCallback(o=>{o&&(t==null||t.complete()),e==null||e(o)},[t,e]),s=kt(),i=_.useCallback(o=>{s(o,{source:"unknown",id:n})},[n,s]);return eR(t?`${n}-${t.contextId}`:n,r,i)}function Hs({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[s,i]=Vr(n);return d.jsx(df,{open:r||s,dir:"ltr",modal:t,onOpenChange:i,children:e})}function Ks({children:n,...e}){return d.jsx(uf,{dir:"ltr",asChild:!0,onTouchEnd:t=>xe(t),...e,children:n})}function qs({className:n,side:e="bottom",align:t="start",sideOffset:r=8,alignOffset:s=8,children:i}){const o=ft();return d.jsx(Xc,{container:o,children:d.jsx(hf,{className:se("tlui-menu",n),side:e,sideOffset:r,align:t,alignOffset:s,collisionPadding:4,children:i})})}function LL({id:n,children:e}){const[t,r]=Vr(n);return d.jsx(CE,{open:t,onOpenChange:r,children:e})}function FL({id:n,label:e,title:t,disabled:r}){return d.jsx(_E,{dir:"ltr",asChild:!0,disabled:r,children:d.jsxs(ie,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:t,children:[d.jsx(lt,{children:e}),d.jsx(we,{icon:"chevron-right",small:!0})]})})}function $L({id:n,alignOffset:e=-1,sideOffset:t=-6,size:r="small",children:s}){const i=ft();return d.jsx(Xc,{container:i,children:d.jsx(EE,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":r,children:s})})}function zL({children:n}){return d.jsx(IE,{dir:"ltr",className:"tlui-menu__group",children:n})}function Ho({noClose:n,children:e}){return d.jsx(PE,{dir:"ltr",asChild:!0,onClick:n?xe:void 0,children:e})}function Se({id:n,label:e,children:t}){const{type:r,sourceId:s}=Al(),i=Pe(),o=Uo(e,r),a=o?i(o):void 0;switch(r){case"panel":return d.jsx("div",{className:"tlui-menu__group","data-testid":`${s}-group.${n}`,children:t});case"menu":return d.jsx(zL,{"data-testid":`${s}-group.${n}`,children:t});case"context-menu":return d.jsx(TE,{dir:"ltr",className:"tlui-menu__group","data-testid":`${s}-group.${n}`,children:t});case"keyboard-shortcuts":return d.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${s}-group.${n}`,children:[d.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),d.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function hn({id:n,disabled:e=!1,label:t,size:r="small",children:s}){const{type:i,sourceId:o}=Al(),a=ft(),c=Pe(),l=t?typeof t=="string"?t:t[i]??t.default:void 0,u=l?c(l):void 0;switch(i){case"menu":return d.jsxs(LL,{id:`${o}-sub.${n}`,children:[d.jsx(FL,{id:`${o}-sub.${n}-button`,disabled:e,label:u,title:u}),d.jsx($L,{id:`${o}-sub.${n}-content`,size:r,children:s})]});case"context-menu":return e?null:d.jsxs(NL,{id:`${o}-sub.${n}`,children:[d.jsx(kE,{dir:"ltr",disabled:e,asChild:!0,children:d.jsxs(ie,{"data-testid":`${o}-sub.${n}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[d.jsx(lt,{children:u}),d.jsx(we,{icon:"chevron-right",small:!0})]})}),d.jsx(jE,{container:a,children:d.jsx(ME,{"data-testid":`${o}-sub.${n}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:s})})]});default:return s}}function NL({id:n,children:e}){const[t,r]=Vr(n);return d.jsx(AE,{open:t,onOpenChange:r,children:e})}const BL=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function UL(){const n=z(),e=kt(),t=N("colorScheme",()=>n.user.getUserPreferences().colorScheme??(n.user.getIsDarkMode()?"dark":"light"),[n]);return d.jsx(hn,{id:"help menu color-scheme",label:"menu.theme",children:d.jsx(Se,{id:"theme",children:BL.map(({colorScheme:r,label:s})=>d.jsx(Dl,{id:`color-scheme-${r}`,label:s,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}const HL=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=Xs(),s=ft(),i=_.useCallback(o=>{if(!o){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return d.jsx(DE,{onOpenChange:i,defaultOpen:!0,children:d.jsx(OE,{container:s,children:d.jsx(RE,{dir:"ltr",className:"tlui-dialog__overlay",onClick:o=>{o.target===o.currentTarget&&i(!1)},children:d.jsx(LE,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,children:d.jsx(e,{onClose:()=>i(!1)})})})})})},KL=_.memo(function(){const{dialogs:e}=Xs();return N("dialogs",()=>e.get(),[e]).map(r=>d.jsx(HL,{...r},r.id))}),qL=4e3,GL={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function WL({toast:n}){const{removeToast:e}=vr(),t=Pe(),r=o=>{o||e(n.id)},s=n.actions&&n.actions.length>0,i=n.icon||n.severity&&GL[n.severity];return d.jsxs($E,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:qL,"data-severity":n.severity,children:[i&&d.jsx("div",{className:"tlui-toast__icon",children:d.jsx(Sr,{icon:i})}),d.jsxs("div",{className:"tlui-toast__main","data-title":!!n.title,"data-description":!!n.description,"data-actions":!!n.actions,children:[d.jsxs("div",{className:"tlui-toast__content",children:[n.title&&d.jsx(zE,{className:"tlui-toast__title",children:n.title}),n.description&&d.jsx(NE,{className:"tlui-toast__description",children:n.description})]}),n.actions&&d.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((o,a)=>d.jsx(BE,{altText:o.label,asChild:!0,onClick:o.onClick,children:d.jsx(ie,{type:o.type,children:d.jsx(lt,{children:o.label})})},a)),d.jsx(am,{asChild:!0,children:d.jsx(ie,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:d.jsx(lt,{children:n.closeLabel??t("toast.close")})})})]})]}),!s&&d.jsx(am,{asChild:!0,children:d.jsx(ie,{type:"normal",className:"tlui-toast__close",children:d.jsx(lt,{children:n.closeLabel??t("toast.close")})})})]})}const YL=_.memo(function(){const{toasts:e}=vr(),t=N("toasts",()=>e.get(),[]);return d.jsxs(d.Fragment,{children:[t.map(r=>d.jsx(WL,{toast:r},r.id)),d.jsx(FE,{className:"tlui-toast__viewport"})]})});function er({actionId:n="",...e}){const r=Zs()[n];return r?d.jsx(Dl,{...r,...e}):null}function Xx(n){return d.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:d.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[d.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),d.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:d.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function It({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:r,kbd:s,label:i,icon:o,onSelect:a,noClose:c,isSelected:l}){const{type:u,sourceId:h}=Al(),p=Pe(),[f,g]=_.useState(!1);if(_n()&&!t)return null;const x=Uo(i,u),b=s?Up(s):void 0,S=x?p(x):void 0,P=S&&b?`${S} ${b}`:S;switch(u){case"menu":return d.jsx(Ho,{children:d.jsxs(ie,{type:"menu","data-testid":`${h}.${r}`,disabled:n,title:P,onClick:w=>{c&&xe(w),f?g(!1):a(h)},children:[d.jsx(lt,{children:S}),s&&d.jsx(jo,{children:s})]})});case"context-menu":return n?null:d.jsxs(UE,{dir:"ltr",title:P,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${h}.${r}`,onSelect:w=>{c&&xe(w),f?g(!1):a(h)},children:[d.jsx("span",{className:"tlui-button__label",draggable:!1,children:S}),s&&d.jsx(jo,{children:s}),e&&d.jsx(Xx,{})]});case"panel":return d.jsxs(ie,{"data-testid":`${h}.${r}`,type:"menu",title:P,disabled:n,onClick:()=>a(h),children:[d.jsx(lt,{children:S}),e?d.jsx(Xx,{}):o&&d.jsx(we,{icon:o})]});case"small-icons":case"icons":return d.jsx(ie,{"data-testid":`${h}.${r}`,type:"icon",title:P,disabled:n,onClick:()=>a(h),children:d.jsx(we,{icon:o,small:u==="small-icons"})});case"keyboard-shortcuts":return s?d.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${h}.${r}`,children:[d.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:S}),d.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:d.jsx(jo,{visibleOnMobileLayout:!0,children:s})})]}):(console.warn(`Menu item '${i}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return d.jsxs(ie,{type:"low",onClick:()=>a(h),children:[d.jsx(we,{icon:o}),d.jsx(lt,{children:S})]});case"toolbar":return d.jsx(ie,{type:"tool","data-testid":`tools.${r}`,"aria-label":x,"data-value":r,onClick:()=>a("toolbar"),title:P,disabled:n,onTouchStart:w=>{xe(w),a("toolbar")},role:"radio","aria-checked":l?"true":"false",children:d.jsx(we,{icon:o})});case"toolbar-overflow":return d.jsx(Ho,{"aria-label":i,children:d.jsx(ie,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:P,disabled:n,role:"radio","aria-checked":l?"true":"false","data-value":r,children:d.jsx(we,{icon:o})})});default:throw mt(u)}}function H({actionId:n="",...e}){const r=Zs()[n];return r?d.jsx(It,{...r,...e}):null}const JI=_.createContext(null);function VL({overrides:n,children:e}){const t=z(),r=kt(),{addDialog:s}=Xs(),i=GI(),o=_.useMemo(()=>{const a=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(l){if(t.isIn("select")){const u=t.root.getCurrent();u.exit({},u.id),u.enter({},u.id)}t.setCurrentTool("select"),r("select-tool",{source:l,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(l){t.setCurrentTool("hand"),r("select-tool",{source:l,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(l){t.setCurrentTool("eraser"),r("select-tool",{source:l,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(l){t.setCurrentTool("draw"),r("select-tool",{source:l,id:"draw"})}},...[...Gn.values].map(l=>({id:l,label:`tool.${l}`,meta:{geo:l},kbd:l==="rectangle"?"r":l==="ellipse"?"o":void 0,icon:"geo-"+l,onSelect(u){t.run(()=>{t.setStyleForNextShapes(Gn,l),t.setCurrentTool("geo"),r("select-tool",{source:u,id:`geo-${l}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(l){t.setCurrentTool("arrow"),r("select-tool",{source:l,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(l){t.setCurrentTool("line"),r("select-tool",{source:l,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(l){t.setCurrentTool("frame"),r("select-tool",{source:l,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(l){t.setCurrentTool("text"),r("select-tool",{source:l,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(l){i(),r("select-tool",{source:l,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(l){t.setCurrentTool("note"),r("select-tool",{source:l,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(l){t.setCurrentTool("laser"),r("select-tool",{source:l,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(l){s({component:LI}),r("select-tool",{source:l,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(l){t.setCurrentTool("highlight"),r("select-tool",{source:l,id:"highlight"})}}];a.push();const c=Object.fromEntries(a.map(l=>[l.id,l]));return n?n(t,c,{insertMedia:i}):c},[n,t,r,i,s]);return d.jsx(JI.Provider,{value:o,children:e})}function Mg(){const n=_.useContext(JI);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Jt({toolId:n="",...e}){const r=Mg()[n];return r?d.jsx(It,{...r,...e}):null}function XL({children:n}){const e=z();return N("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?d.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:ZL}=Math,wi=ZL+1e-4;function QI(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const s=n[0],i=n[n.length-1],o=i.runningLength,a=Math.pow(t*r,2),c=[],l=[];let u=n[0].vector,h=n[0].point,p=h,f=h,g=p,m=!1,x;for(let b=0;b<n.length;b++){x=n[b];const{point:S,vector:P}=n[b],w=x.vector.dpr(u),I=(b<n.length-1?n[b+1]:n[b]).vector,E=b<n.length-1?I.dpr(x.vector):1,T=w<0&&!m,C=E!==null&&E<.2;if(T||C){if(E>-.62&&o-x.runningLength>x.radius){const k=u.clone().mul(x.radius);u.clone().cpr(I)<0?(f=y.Add(S,k),g=y.Sub(S,k)):(f=y.Sub(S,k),g=y.Add(S,k)),c.push(f),l.push(g)}else{const k=u.clone().mul(x.radius).per(),R=y.Sub(x.input,k);for(let A=1/13,D=0;D<1;D+=A)f=y.RotWith(R,x.input,wi*D),c.push(f),g=y.RotWith(R,x.input,wi+wi*-D),l.push(g)}h=f,p=g,C&&(m=!0);continue}if(m=!1,x===s||x===i){const k=y.Per(P).mul(x.radius);c.push(y.Sub(S,k)),l.push(y.Add(S,k));continue}const j=y.Lrp(I,P,E).per().mul(x.radius);f=y.Sub(S,j),(b<=1||y.Dist2(h,f)>a)&&(c.push(f),h=f),g=y.Add(S,j),(b<=1||y.Dist2(p,g)>a)&&(l.push(g),p=g),u=P}return{left:c,right:l}}function Ag(n,e={}){const{size:t=16,start:r={},end:s={},last:i=!1}=e,{cap:o=!0}=r,{cap:a=!0}=s;if(n.length===0||t<=0)return[];const c=n[0],l=n[n.length-1],u=l.runningLength,h=r.taper===!1?0:r.taper===!0?Math.max(t,u):r.taper,p=s.taper===!1?0:s.taper===!0?Math.max(t,u):s.taper,{left:f,right:g}=QI(n,e),m=c.point,x=n.length>1?n[n.length-1].point:y.AddXY(c.point,1,1);if(n.length===1&&(!(h||p)||i)){const w=y.Add(m,y.Sub(m,x).uni().per().mul(-c.radius)),I=[];for(let E=1/13,T=E;T<=1;T+=E)I.push(y.RotWith(w,m,wi*2*T));return I}const b=[];if(!(h||p&&n.length===1))if(o)for(let w=1/8,I=w;I<=1;I+=w){const E=y.RotWith(g[0],m,wi*I);b.push(E)}else{const w=y.Sub(f[0],g[0]),I=y.Mul(w,.5),E=y.Mul(w,.51);b.push(y.Sub(m,I),y.Sub(m,E),y.Add(m,E),y.Add(m,I))}const S=[],P=l.vector.clone().per().neg();if(p||h&&n.length===1)S.push(x);else if(a){const w=y.Add(x,y.Mul(P,l.radius));for(let I=1/29,E=I;E<1;E+=I)S.push(y.RotWith(w,x,wi*3*E))}else S.push(y.Add(x,y.Mul(P,l.radius)),y.Add(x,y.Mul(P,l.radius*.99)),y.Sub(x,y.Mul(P,l.radius*.99)),y.Sub(x,y.Mul(P,l.radius)));return f.concat(S,g.reverse(),b)}const JL=.025,QL=.01;function xr(n,e={}){var x;const{streamline:t=.5,size:r=16,simulatePressure:s=!1}=e;if(n.length===0)return[];const i=.15+(1-t)*.85;let o=n.map(y.From),a=0;if(!s){let b=o[0];for(;b&&!(b.z>=JL);)o.shift(),b=o[0]}if(!s){let b=o[o.length-1];for(;b&&!(b.z>=QL);)o.pop(),b=o[o.length-1]}if(o.length===0)return[{point:y.From(n[0]),input:y.From(n[0]),pressure:s?.5:.15,vector:new y(1,1),distance:0,runningLength:0,radius:1}];let c=o[1];for(;c&&!(y.Dist2(c,o[0])>(r/3)**2);)o[0].z=Math.max(o[0].z,c.z),o.splice(1,1),c=o[1];const l=o.pop();for(c=o[o.length-1];c&&!(y.Dist2(c,l)>(r/3)**2);)o.pop(),c=o[o.length-1],a++;o.push(l);const u=e.last||!e.simulatePressure||o.length>1&&y.Dist2(o[o.length-1],o[o.length-2])<r**2||a>0;if(o.length===2&&e.simulatePressure){const b=o[1];o=o.slice(0,-1);for(let S=1;S<5;S++){const P=y.Lrp(o[0],b,S/4);P.z=(o[0].z+(b.z-o[0].z))*S/4,o.push(P)}}const h=[{point:o[0],input:o[0],pressure:s?.5:o[0].z,vector:new y(1,1),distance:0,runningLength:0,radius:1}];let p=0,f=h[0],g,m;u&&t>0&&o.push(o[o.length-1].clone());for(let b=1,S=o.length;b<S;b++)g=!i||e.last&&b===S-1?o[b].clone():o[b].clone().lrp(f.point,1-i),!f.point.equals(g)&&(m=y.Dist(g,f.point),p+=m,!(b<4&&p<r)&&(f={input:o[b],point:g,pressure:s?.5:o[b].z,vector:y.Sub(f.point,g).uni(),distance:m,runningLength:p,radius:1},h.push(f)));if((x=h[1])!=null&&x.vector&&(h[0].vector=h[1].vector.clone()),p<1){const b=Math.max(.5,...h.map(S=>S.pressure));h.forEach(S=>S.pressure=b)}return h}const{min:rs}=Math,Ah=.275;function Ol(n,e){const{size:t=16,thinning:r=.5,simulatePressure:s=!0,easing:i=x=>x,start:o={},end:a={}}=e,{easing:c=yt.easeOutQuad}=o,{easing:l=yt.easeOutCubic}=a,u=n[n.length-1].runningLength;let h,p=n[0].pressure,f;if(!s&&u<t){const x=n.reduce((b,S)=>Math.max(b,S.pressure),.5);return n.forEach(b=>{b.pressure=x,b.radius=t*i(.5-r*(.5-b.pressure))}),n}else{let x;for(let b=0,S=n.length;b<S&&(f=n[b],!(f.runningLength>t*5));b++){const P=rs(1,f.distance/t);if(s){const w=rs(1,1-P);x=rs(1,p+(w-p)*(P*Ah))}else x=rs(1,p+(f.pressure-p)*.5);p=p+(x-p)*.5}for(let b=0;b<n.length;b++){if(f=n[b],r){let{pressure:S}=f;const P=rs(1,f.distance/t);if(s){const w=rs(1,1-P);S=rs(1,p+(w-p)*(P*Ah))}else S=rs(1,p+(S-p)*(P*Ah));f.radius=t*i(.5-r*(.5-S)),p=S}else f.radius=t/2;h===void 0&&(h=f.radius)}}const g=o.taper===!1?0:o.taper===!0?Math.max(t,u):o.taper,m=a.taper===!1?0:a.taper===!0?Math.max(t,u):a.taper;if(g||m)for(let x=0;x<n.length;x++){f=n[x];const{runningLength:b}=f,S=b<g?c(b/g):1,P=u-b<m?l((u-b)/m):1;f.radius=Math.max(.01,f.radius*Math.min(S,P))}return n}function eF(n,e={}){return Ag(Ol(xr(n,e),e),e)}function Zx({scribble:n,zoom:e,color:t,opacity:r,className:s}){if(!n.points.length)return null;const i=eF(n.points,{size:n.size/e,start:{taper:n.taper,easing:yt.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let o;if(i.length<4){const a=n.size/e/2,{x:c,y:l}=n.points[n.points.length-1];o=`M ${c-a},${l} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else o=ig(i);return d.jsx("svg",{className:s&&se("tl-overlays__item",s),children:d.jsx("path",{className:"tl-scribble",d:o,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})}const tF=({bounds:n,rotation:e})=>{const t=z();return N("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?d.jsx(ev,{bounds:n,rotation:e}):null};function nF({size:n,width:e,height:t,hideAlternateHandles:r}){const s=F(n/3),i=s/2;return d.jsxs("svg",{className:"tl-overlays__item",children:[d.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${F(0-i)},${F(n)} 
						${F(0-i)},${F(0-i)} 
						${F(n)},${F(0-i)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),d.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:F(e/2-n),y1:F(0-i),x2:F(e/2+n),y2:F(0-i),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),d.jsx("polyline",{className:se("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${F(e-n)},${F(0-i)} 
						${F(e+i)},${F(0-i)} 
						${F(e+i)},${F(n)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),d.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:F(e+i),y1:F(t/2-n),x2:F(e+i),y2:F(t/2+n),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),d.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${F(e+i)},${F(t-n)} 
						${F(e+i)},${F(t+i)}
						${F(e-n)},${F(t+i)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),d.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:F(e/2-n),y1:F(t+i),x2:F(e/2+n),y2:F(t+i),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),d.jsx("polyline",{className:se("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${F(0+n)},${F(t+i)} 
						${F(0-i)},${F(t+i)}
						${F(0-i)},${F(t-n)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),d.jsx("line",{className:se("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:F(0-i),y1:F(t/2-n),x2:F(0-i),y2:F(t/2+n),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const rF=Et(function({bounds:e,rotation:t}){const r=z(),s=_.useRef(null),i=_n(),o=ir("top"),a=ir("right"),c=ir("bottom"),l=ir("left"),u=ir("top_left"),h=ir("top_right"),p=ir("bottom_right"),f=ir("bottom_left"),g=r.getInstanceState().cursor.type==="default",m=r.getInstanceState().isCoarsePointer,x=r.getOnlySelectedShape(),b=x&&r.isShapeOrAncestorLocked(x),S=x?r.getShapeUtil(x).expandSelectionOutlinePx(x):0;if(Fi(s,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:-S,y:-S}),x&&r.isShapeHidden(x)||!e)return null;e=e.clone().expandBy(S).zeroFix();const P=r.getZoomLevel(),w=r.getInstanceState().isChangingStyle,I=e.width,E=e.height,T=8/P,C=I<T*2,j=E<T*2,k=I<T*4,R=E<T*4,A=I<T*5,D=E<T*5,O=m?1.75:1,$=6/P*O,B=(k?$/2:$)*(O*.75),G=(R?$/2:$)*(O*.75),Y=(x?!r.getShapeUtil(x).hideSelectionBoundsFg(x):!0)&&!w;let ne=Y&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||Y&&r.isIn("select.resizing")&&x&&r.isShapeOfType(x,"text");x&&ne&&Be.isFirefox&&r.isShapeOfType(x,"embed")&&(ne=!1);const de=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!w&&!i,ae=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!w&&!i,Oe=!m&&!(C||j)&&(ae||de)&&(x?!r.getShapeUtil(x).hideRotateHandle(x):!0)&&!b,ce=m&&(!k||!R)&&(ae||de)&&(x?!r.getShapeUtil(x).hideRotateHandle(x):!0)&&!b,Ne=ae&&(x?r.getShapeUtil(x).canResize(x)&&!r.getShapeUtil(x).hideResizeHandles(x):!0)&&!de&&!b,re=C||j,pt=C&&j,Ie=A||D,me=Ne||de,Me=!Oe,Re=!ae||!ce,Te=!ae||!me,jt=!ae||!me||re,st=!ae||!me||re,xt=!ae||!me||pt&&!de;let qe=!0,et=!0;if(de)qe=Ie,et=Ie;else if(Ne){qe=re||pt||m;const Ki=m&&x&&x.type==="text";et=qe&&!Ki}const pn=Math.min(24/P,E-G*3),Zr=ae&&m&&x&&r.isShapeOfType(x,"text")&&pn*P>=4;return d.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:d.jsxs("g",{ref:s,children:[ne&&d.jsx("rect",{className:"tl-selection__fg__outline",width:F(I),height:F(E)}),d.jsx(Oa,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:$,corner:"top_left_rotate",cursor:g?gn("nwse-rotate",t):void 0,isHidden:Me}),d.jsx(Oa,{"data-testid":"selection.rotate.top-right",cx:I+$*3,cy:0,targetSize:$,corner:"top_right_rotate",cursor:g?gn("nesw-rotate",t):void 0,isHidden:Me}),d.jsx(Oa,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:E+$*3,targetSize:$,corner:"bottom_left_rotate",cursor:g?gn("swne-rotate",t):void 0,isHidden:Me}),d.jsx(Oa,{"data-testid":"selection.rotate.bottom-right",cx:I+$*3,cy:E+$*3,targetSize:$,corner:"bottom_right_rotate",cursor:g?gn("senw-rotate",t):void 0,isHidden:Me}),d.jsx(iF,{"data-testid":"selection.rotate.mobile",cx:k?-$*1.5:I/2,cy:k?E/2:-$*1.5,size:T,isHidden:Re}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":qe}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:F(0-(R?G*2:G)),width:F(I),height:F(Math.max(1,G*2)),style:g?{cursor:gn("ns-resize",t)}:void 0,...o}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:F(I-(k?0:B)),y:0,height:F(E),width:F(Math.max(1,B*2)),style:g?{cursor:gn("ew-resize",t)}:void 0,...a}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":qe}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:F(E-(R?0:G)),width:F(I),height:F(Math.max(1,G*2)),style:g?{cursor:gn("ns-resize",t)}:void 0,...c}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:F(0-(k?B*2:B)),y:0,height:F(E),width:F(Math.max(1,B*2)),style:g?{cursor:gn("ew-resize",t)}:void 0,...l}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":Te}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:F(0-(k?B*2:B*1.5)),y:F(0-(R?G*2:G*1.5)),width:F(B*3),height:F(G*3),style:g?{cursor:gn("nwse-resize",t)}:void 0,...u}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":jt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:F(I-(k?0:B*1.5)),y:F(0-(R?G*2:G*1.5)),width:F(B*3),height:F(G*3),style:g?{cursor:gn("nesw-resize",t)}:void 0,...h}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":xt}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:F(I-(k?B:B*1.5)),y:F(E-(R?G:G*1.5)),width:F(B*3),height:F(G*3),style:g?{cursor:gn("nwse-resize",t)}:void 0,...p}),d.jsx("rect",{className:se("tl-transparent",{"tl-hidden":st}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:F(0-(k?B*3:B*1.5)),y:F(E-(R?0:G*1.5)),width:F(B*3),height:F(G*3),style:g?{cursor:gn("nesw-resize",t)}:void 0,...f}),Ne&&d.jsxs(d.Fragment,{children:[d.jsx("rect",{"data-testid":"selection.resize.top-left",className:se("tl-corner-handle",{"tl-hidden":Te}),"aria-label":"top_left handle",x:F(0-T/2),y:F(0-T/2),width:F(T),height:F(T)}),d.jsx("rect",{"data-testid":"selection.resize.top-right",className:se("tl-corner-handle",{"tl-hidden":jt}),"aria-label":"top_right handle",x:F(I-T/2),y:F(0-T/2),width:F(T),height:F(T)}),d.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:se("tl-corner-handle",{"tl-hidden":xt}),"aria-label":"bottom_right handle",x:F(I-T/2),y:F(E-T/2),width:F(T),height:F(T)}),d.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:se("tl-corner-handle",{"tl-hidden":st}),"aria-label":"bottom_left handle",x:F(0-T/2),y:F(E-T/2),width:F(T),height:F(T)})]}),Zr&&d.jsxs(d.Fragment,{children:[d.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:F(0-T/4),y:F(E/2-pn/2),rx:T/4,width:F(T/2),height:F(pn)}),d.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:T/4,x:F(I-T/4),y:F(E/2-pn/2),width:F(T/2),height:F(pn)})]}),de&&d.jsx(nF,{size:T,width:I,height:E,hideAlternateHandles:Ie})]})})}),Oa=function({cx:e,cy:t,targetSize:r,corner:s,cursor:i,isHidden:o,"data-testid":a}){const c=ir(s);return d.jsx("rect",{className:se("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${s} target`,pointerEvents:"all",x:F(e-r*3),y:F(t-r*3),width:F(Math.max(1,r*3)),height:F(Math.max(1,r*3)),cursor:i,...c})},sF=Math.sqrt(Math.PI),iF=function({cx:e,cy:t,size:r,isHidden:s,"data-testid":i}){const o=ir("mobile_rotate"),a=z(),c=N("zoom level",()=>a.getZoomLevel(),[a]),l=Math.max(14*(1/c),20/Math.max(1,c));return d.jsxs("g",{children:[d.jsx("circle",{"data-testid":i,pointerEvents:"all",className:se("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:e,cy:t,r:l,...o}),d.jsx("circle",{className:se("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:e,cy:t,r:r/sF})]})};function oF(){const n=z();return N("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?d.jsx(tv,{}):null}function Hp(n,e,t){const{arrowheadStart:r,arrowheadEnd:s}=e.props,i=fi(n,e,t),o=i.start.clone(),a=i.end.clone(),c=y.Med(o,a);if(y.Equals(o,a))return{bindings:t,isStraight:!0,start:{handle:o,point:o,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const l=y.Sub(a,o).uni(),u=Hc(n,e,"start"),h=Hc(n,e,"end"),p=n.getShapePageTransform(e);Jx(a,i.start,p,h),Jx(o,i.end,p,u);let f=0,g=0,m=0,x=0,b=gi*e.props.scale;const S=u&&h&&u.shape===h.shape,P=u&&h?Dg(n,u.shape.id,h.shape.id):"safe";P==="safe"&&u&&h&&!S&&!u.isExact&&!h.isExact&&(h.didIntersect&&!u.didIntersect?u.isClosed&&o.setTo(a.clone().add(l.clone().mul(gi*e.props.scale))):h.didIntersect||h.isClosed&&a.setTo(o.clone().sub(l.clone().mul(gi*e.props.scale))));const w=y.Sub(a,o),I=y.Len(w)?w.uni():y.From(w),E=!y.Equals(I,l);S||(P!=="start-contains-end"&&u&&r!=="none"&&!u.isExact&&(m=dr[e.props.size]/2+("size"in u.shape.props?dr[u.shape.props.size]/2:0),f=(Kc+m)*e.props.scale,b+=m*e.props.scale),P!=="end-contains-start"&&h&&s!=="none"&&!h.isExact&&(x=dr[e.props.size]/2+("size"in h.shape.props?dr[h.shape.props.size]/2:0),g=(Kc+x)*e.props.scale,b+=x*e.props.scale));const T=o.clone().add(I.clone().mul(f*(E?-1:1))),C=a.clone().sub(I.clone().mul(g*(E?-1:1)));y.DistMin(T,C,b)&&(f!==0&&g!==0?(f*=-1.5,g*=-1.5):f!==0?f*=-1:g!==0&&(g*=-1)),o.add(I.clone().mul(f*(E?-1:1))),a.sub(I.clone().mul(g*(E?-1:1))),E?(u&&h&&a.setTo(y.Add(o,I.clone().mul(-gi*e.props.scale))),c.setTo(y.Med(i.start,i.end))):c.setTo(y.Med(o,a));const j=y.Dist(o,a);return{bindings:t,isStraight:!0,start:{handle:i.start,point:o,arrowhead:e.props.arrowheadStart},end:{handle:i.end,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:j>0,length:j}}function Jx(n,e,t,r){if(r===void 0||r.isExact)return;const s=W.applyToPoint(t,e),i=W.applyToPoint(t,n),o=W.applyToPoint(W.Inverse(r.transform),s),a=W.applyToPoint(W.Inverse(r.transform),i),c=r.isClosed,u=(c?dg:PD)(o,a,r.outline);let h;if(u!==null&&(h=u.sort((g,m)=>y.Dist2(g,o)-y.Dist2(m,o))[0]??(c?void 0:a)),h===void 0)return;const p=W.applyToPoint(r.transform,h),f=W.applyToPoint(W.Inverse(t),p);n.setTo(f),r.didIntersect=!0}function aF(n,e,t){const{arrowheadEnd:r,arrowheadStart:s}=e.props,i=e.props.bend;if(Math.abs(i)>Math.abs(e.props.bend*(hF*e.props.scale)))return Hp(n,e,t);const o=fi(n,e,t),a=y.Med(o.start,o.end),c=y.Sub(o.end,o.start),l=y.Len(c)?c.uni():y.From(c),u=y.Add(a,l.per().mul(-i)),h=Hc(n,e,"start"),p=Hc(n,e,"end"),f=o.start.clone(),g=o.end.clone(),m=u.clone();if(y.Equals(f,g))return{bindings:t,isStraight:!0,start:{handle:f,point:f,arrowhead:e.props.arrowheadStart},end:{handle:g,point:g,arrowhead:e.props.arrowheadEnd},middle:m,isValid:!1,length:0};const x=e.props.bend<0,b=x?Zo:U0,S=Qx(f,g,m),P=y.Angle(S.center,f),w=y.Angle(S.center,g),I=b(P,w);if(S.length===0||S.size===0||!ox(S.length)||!ox(S.size))return Hp(n,e,t);const E=f.clone(),T=g.clone(),C=m.clone(),j=n.getShapePageTransform(e);let k=0,R=0,A=gi*e.props.scale;if(h&&!h.isExact){const de=W.applyToPoint(j,E),ae=W.applyToPoint(j,S.center),Oe=W.applyToPoint(j,T),ce=W.Inverse(h.transform),Ne=W.applyToPoint(ce,de),re=W.applyToPoint(ce,ae),pt=W.applyToPoint(ce,Oe),{isClosed:Ie}=h,me=Ie?Ep:yx;let Me,Re=me(re,S.radius,h.outline);if(Re){const Te=re.angle(Ne),jt=re.angle(pt),st=b(Te,jt);Re=Re.filter(qe=>b(Te,re.angle(qe))<=st);const xt=st*.25;Re.sort(Ie?(qe,et)=>Math.abs(b(Te,re.angle(qe))-xt)<Math.abs(b(Te,re.angle(et))-xt)?-1:1:(qe,et)=>b(Te,re.angle(qe))<b(Te,re.angle(et))?-1:1),Me=Re[0]??(Ie?void 0:Ne)}else Me=Ie?void 0:Ne;if(Me&&(E.setTo(n.getPointInShapeSpace(e,W.applyToPoint(h.transform,Me))),h.didIntersect=!0,s!=="none")){const Te=dr[e.props.size]/2+("size"in h.shape.props?dr[h.shape.props.size]/2:0);k=(Kc+Te)*e.props.scale,A+=Te*e.props.scale}}if(p&&!p.isExact){const de=W.applyToPoint(j,E),ae=W.applyToPoint(j,T),Oe=W.applyToPoint(j,S.center),ce=W.Inverse(p.transform),Ne=W.applyToPoint(ce,de),re=W.applyToPoint(ce,Oe),pt=W.applyToPoint(ce,ae),Ie=p.isClosed,me=Ie?Ep:yx;let Me,Re=me(re,S.radius,p.outline);if(Re){const Te=re.angle(Ne),jt=re.angle(pt),st=b(Te,jt),xt=st*.75;Re=Re.filter(qe=>b(Te,re.angle(qe))<=st),Re.sort(Ie?(qe,et)=>Math.abs(b(Te,re.angle(qe))-xt)<Math.abs(b(Te,re.angle(et))-xt)?-1:1:(qe,et)=>b(Te,re.angle(qe))<b(Te,re.angle(et))?-1:1),Re[0]?Me=Re[0]:Me=Ie?void 0:pt}else Me=Ie?void 0:pt;if(Me&&(T.setTo(n.getPointInShapeSpace(e,W.applyToPoint(p.transform,Me))),p.didIntersect=!0,r!=="none")){const Te=dr[e.props.size]/2+("size"in p.shape.props?dr[p.shape.props.size]/2:0);R=(Kc+Te)*e.props.scale,A+=Te*e.props.scale}}let D=y.Angle(S.center,E),O=y.Angle(S.center,T),$=b(D,O),B=$*S.radius;const G=E.clone(),Y=T.clone();if(k!==0&&G.setTo(S.center).add(y.FromAngle(D+$*(k/B*(x?1:-1))).mul(S.radius)),R!==0&&Y.setTo(S.center).add(y.FromAngle(O+$*(R/B*(x?-1:1))).mul(S.radius)),y.DistMin(G,Y,A)&&(k!==0&&R!==0?(k*=-1.5,R*=-1.5):k!==0?k*=-2:R!==0&&(R*=-2)),k!==0&&E.setTo(S.center).add(y.FromAngle(D+$*(k/B*(x?1:-1))).mul(S.radius)),R!==0&&T.setTo(S.center).add(y.FromAngle(O+$*(R/B*(x?-1:1))).mul(S.radius)),h&&p&&!h.isExact&&!p.isExact){D=y.Angle(S.center,E),O=y.Angle(S.center,T),$=b(D,O),B=$*S.radius;const de=Dg(n,h.shape.id,p.shape.id);de==="double-bound"&&B<30?(E.setTo(f),T.setTo(g),C.setTo(m)):de==="safe"&&(h&&!h.didIntersect&&E.setTo(f),(p&&!p.didIntersect||b(P,D)>b(P,O))&&T.setTo(S.center).add(y.FromAngle(D+$*(Math.min(.9,gi*e.props.scale/B)*(x?1:-1))).mul(S.radius)))}cF(S.center,S.radius,E,T,C,I,x),E.equals(T)&&(E.setTo(C.clone().addXY(1,1)),T.setTo(C.clone().subXY(1,1))),f.setTo(E),g.setTo(T),m.setTo(C);const ne=Qx(f,g,m);return{bindings:t,isStraight:!1,start:{point:f,handle:o.start,arrowhead:e.props.arrowheadStart},end:{point:g,handle:o.end,arrowhead:e.props.arrowheadEnd},middle:m,handleArc:S,bodyArc:ne,isValid:ne.length!==0&&isFinite(ne.center.x)&&isFinite(ne.center.y)}}function Qx(n,e,t){const r=ng(n,e,t)??y.Med(n,e),s=y.Dist(r,n),i=+y.Clockwise(n,t,e),o=((n.y-e.y)**2+(n.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,c=((t.y-n.y)**2+(t.x-n.x)**2)**.5,l=Math.acos((a*a+c*c-o*o)/(2*a*c))*2,u=+(je>l),h=(Le-l)*(i?1:-1),p=h*s;return{center:r,radius:s,size:h,length:p,largeArcFlag:u,sweepFlag:i}}function cF(n,e,t,r,s,i,o){const a=y.Angle(n,t),c=y.Angle(n,r);let l=Zo(a,c);if(o||(l=Le-l),s.setTo(n).add(y.FromAngle(a+l*(.5*(o?1:-1))).mul(e)),l>i){s.rotWith(n,je);const u=r.clone();r.setTo(t),t.setTo(u)}}const lF=8;function dF(n){return Math.abs(n.props.bend)<lF*n.props.scale}function Hc(n,e,t){const r=n.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===t);if(!r)return;const s=n.getShape(r.toId);if(!s)return;const i=n.getShapePageTransform(s),o=n.getShapeGeometry(s),a=o instanceof Rn?o.children[0].vertices:o.vertices;return{shape:s,transform:i,isClosed:o.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function eb(n,e,t,r){const s=n.getShape(t.toId);if(s){const{point:i,size:o}=n.getShapeGeometry(s).bounds,a=y.Add(i,y.MulV(t.props.isPrecise||r?t.props.normalizedAnchor:{x:.5,y:.5},o)),c=W.applyToPoint(n.getShapePageTransform(s),a);return W.applyToPoint(W.Inverse(e),c)}else return new y(0,0)}function rn(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(r=>r.props.terminal==="start"),end:t.find(r=>r.props.terminal==="end")}}const uF=vj("arrow info",(n,e)=>{const t=rn(n,e);return dF(e)?Hp(n,e,t):aF(n,e,t)});function lr(n,e){const t=typeof e=="string"?e:e.id;return uF.get(n,t)}function fi(n,e,t){var a,c;const r=n.getShapePageTransform(e),s=Dg(n,(a=t.start)==null?void 0:a.toId,(c=t.end)==null?void 0:c.toId),i=t.start?eb(n,r,t.start,s==="double-bound"||s==="start-contains-end"):y.From(e.props.start),o=t.end?eb(n,r,t.end,s==="double-bound"||s==="end-contains-start"):y.From(e.props.end);return{start:i,end:o}}function co(n,e,t,r){const s=typeof e=="string"?e:e.id,i=typeof t=="string"?t:t.id,o=n.getBindingsFromShape(s,"arrow").filter(c=>c.props.terminal===r.terminal);o.length>1&&n.deleteBindings(o.slice(1));const a=o[0];a?n.updateBinding({...a,toId:i,props:r}):n.createBinding({type:"arrow",fromId:s,toId:i,props:r})}function Xa(n,e,t){const r=n.getBindingsFromShape(e,"arrow").filter(s=>s.props.terminal===t);n.deleteBindings(r)}const gi=10,Kc=10,hF=10,dr={s:2,m:3.5,l:5,xl:10};function Dg(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),s=n.getShapePageBounds(t);if(r&&s){if(r.contains(s))return"start-contains-end";if(s.contains(r))return"end-contains-start"}return"safe"}class Za extends Va{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&Dh(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&Dh(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){Dh(this.editor,e)}onAfterChangeToShape({binding:e}){eC(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&qc({editor:this.editor,arrow:t,terminal:e.props.terminal})}}v(Za,"type","arrow"),v(Za,"props",l0),v(Za,"migrations",d0);function eC(n,e){var x;const t=n.getShape(e);if(!t)return;const r=rn(n,t),{start:s,end:i}=r,o=s?n.getShape(s.toId):void 0,a=i?n.getShape(i.toId):void 0,c=n.getAncestorPageId(t);if(!c)return;let l;if(o&&a)l=n.findCommonAncestor([o,a])??c;else if(o||a){const b=(x=o||a)==null?void 0:x.parentId;b&&b===t.parentId?l=t.parentId:l=c}else return;l&&l!==t.parentId&&n.reparentShapes([e],l);const u=n.getShape(e);if(!u)throw Error("no reparented arrow");const h=n.getShapeNearestSibling(u,o),p=n.getShapeNearestSibling(u,a);let f;if(h&&p)f=h.index>p.index?h:p;else if(h&&!p)f=h;else if(p&&!h)f=p;else return;let g;const m=n.getSortedChildIdsForParent(f.parentId).map(b=>n.getShape(b)).filter(b=>b.index>f.index);if(m.length){const b=m.find(S=>S.type!=="arrow");if(u.index>f.index&&(!b||u.index<b.index))return;g=Lo(f.index,m[0].index)}else g=ar(f.index);g!==u.index&&n.updateShapes([{id:e,type:"arrow",index:g}])}function Dh(n,e){const t=rn(n,e);for(const r of["start","end"]){const s=t[r];if(!s)continue;const i=n.getShape(s.toId),o=n.getAncestorPageId(e)===n.getAncestorPageId(i);(!i||!o)&&qc({editor:n,arrow:e,terminal:r,unbind:!0})}eC(n,e.id)}function qc({editor:n,arrow:e,terminal:t,unbind:r=!1,useHandle:s=!1}){const i=lr(n,e);if(!i)throw new Error("expected arrow info");const o=s?i.start.handle:i.start.point,a=s?i.end.handle:i.end.point,c=t==="start"?o:a,l={id:e.id,type:"arrow",props:{[t]:{x:c.x,y:c.y},bend:e.props.bend}};if(!i.isStraight){const u=t==="start"?o:i.start.handle,h=t==="end"?a:i.end.handle,p=y.Med(u,h),f=y.Sub(u,h).per().uni().mul(i.handleArc.radius*2*Math.sign(e.props.bend)),g=ea(i.handleArc.center,y.Add(p,f),i.handleArc.center,i.handleArc.radius);De((g==null?void 0:g.length)===1);const m=y.Dist(p,g[0])*Math.sign(e.props.bend);fs(m,l.props.bend)||(l.props.bend=m)}n.updateShape(l),r&&Xa(n,e,t)}const tC=[Za],zt={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},$t={s:2,m:3.5,l:5,xl:10},Ii={s:18,m:24,l:36,xl:44},Ur={s:18,m:22,l:26,xl:32},pF={s:18,m:20,l:24,xl:28},Hr={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},fF=20,Gc=4.25,Dn=16;function gF(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const mi="  ",Ht=class Ht{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,s=r.activeElement;s!==e&&e.focus(),r.execCommand("insertText",!1,t)||Ht.insertTextFirefox(e,t),s===r.body?e.blur():s instanceof HTMLElement&&s!==e&&s.focus()}static set(e,t){e.select(),Ht.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:s,selectionEnd:i}=e,o=Ht.getSelection(e);Ht.insert(e,t+o+(r??t)),e.selectionStart=(s||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,r){let s=0;e.value.replace(t,(...i)=>{const o=s+i[i.length-2],a=i[0].length;e.selectionStart=o,e.selectionEnd=o+a;const c=typeof r=="string"?r:r(...i);return Ht.insert(e,c),e.selectionStart=o,s+=c.length-a,c})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:s}=e,i=s.slice(t,r),o=(a=/\n/g.exec(i))==null?void 0:a.length;if(o&&o>0){const c=s.lastIndexOf(`
`,t-1)+1,l=e.value.slice(c,r-1),u=l.replace(/^|\n/g,`$&${mi}`),h=u.length-l.length;e.setSelectionRange(c,r-1),Ht.insert(e,u),e.setSelectionRange(t+1,r+h)}else Ht.insert(e,mi)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:s}=e,i=s.lastIndexOf(`
`,t-1)+1,o=Ht.findLineEnd(s,r),a=e.value.slice(i,o),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;e.setSelectionRange(i,o),Ht.insert(e,c);const u=/\t| {1,2}/.exec(s.slice(i,t)),h=u?u[0].length:0,p=t-h;e.setSelectionRange(t-h,Math.max(p,r-l))}static indentCE(e){var c;const t=window.getSelection(),r=e.innerText,s=Ra(e)??0,i=Ra(e)??0,o=r.slice(s,i),a=(c=/\n/g.exec(o))==null?void 0:c.length;if(a&&a>0){const l=r.lastIndexOf(`
`,s-1)+1,u=r.slice(l,i-1),p=u.replace(/^|\n/g,`$&${mi}`).length-u.length;t&&t.setBaseAndExtent(e,s+1,e,i+p)}else{const l=window.getSelection();e.innerText=r.slice(0,s)+mi+r.slice(s),l==null||l.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,s=Ra(e)??0,i=Ra(e)??0,o=r.lastIndexOf(`
`,s-1)+1,a=Ht.findLineEnd(r,i),c=r.slice(o,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-l.length;if(t){t.setBaseAndExtent(e,o,e,a);const h=/\t| {1,2}/.exec(r.slice(o,s)),p=h?h[0].length:0,f=s-p;t.setBaseAndExtent(e,s-p,e,Math.max(f,i-u))}}static normalizeText(e){return e.replace(Ht.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(Ht.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};v(Ht,"fixNewLines",/\r?\n|\r/g);let Ci=Ht;function Ra(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(n),s.setEnd(r.endContainer,r.endOffset),t=s.toString().length}return t}const mF=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function nC(n){return mF.test(n)}function yF(n){return n.replace(/\t/g,mi)}function SF(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const s=r.length-r.trimStart().length;t=Math.min(t,s)}return e.map(r=>r.slice(t)).join(`
`)}const rC={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},xF=new RegExp(Object.keys(rC).join("|"),"g");function bF(n){return n.replace(xF,e=>rC[e])}function wF(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function vF(n){return wF(SF(yF(n)))}function PF(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:s},{toasts:i,msg:o}){n.registerExternalAssetHandler("file",async({file:a,assetId:c})=>{const l=r.includes(a.type),u=s.includes(a.type);!l&&!u&&i.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),De(l||u,`File type not allowed: ${a.type}`),a.size>t&&i.addToast({title:o("assets.files.size-too-big"),severity:"error"}),De(a.size<=t,`File size too big: ${(a.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);const h=pm(await a.arrayBuffer());c=c??os.createId(h);const p=await tb(a,c,l,u);if(isFinite(e)){const f={w:p.props.w,h:p.props.h},g=gF(f,{w:e,h:e});f!==g&&yn.isStaticImageType(a.type)&&(p.props.w=g.w,p.props.h=g.h)}return p.props.src=await n.uploadAsset(p,a),os.create(p)}),n.registerExternalAssetHandler("url",async({url:a})=>{var l,u,h,p,f;let c;try{const m=await(await fr(a,{method:"GET",mode:"no-cors"})).text(),x=new DOMParser().parseFromString(m,"text/html");c={image:((l=x.head.querySelector('meta[property="og:image"]'))==null?void 0:l.getAttribute("content"))??"",favicon:((u=x.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:u.getAttribute("href"))??((h=x.head.querySelector('link[rel="icon"]'))==null?void 0:h.getAttribute("href"))??"",title:((p=x.head.querySelector('meta[property="og:title"]'))==null?void 0:p.getAttribute("content"))??a,description:((f=x.head.querySelector('meta[property="og:description"]'))==null?void 0:f.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,a).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,a).href)}catch(g){console.error(g),i.addToast({title:o("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:os.createId(hp(a)),typeName:"asset",type:"bookmark",props:{src:a,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:a,text:c})=>{const l=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!u)throw new Error("No <svg/> element present");let h=parseFloat(u.getAttribute("width")||"0"),p=parseFloat(u.getAttribute("height")||"0");if(!(h&&p)){document.body.appendChild(u);const g=u.getBoundingClientRect();document.body.removeChild(u),h=g.width,p=g.height}const f=await n.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!f)throw Error("Could not create an asset");nb(n,[f],l)}),n.registerExternalContentHandler("embed",({point:a,url:c,embed:l})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:h,height:p}=l,f=ze(),g={id:f,type:"embed",x:u.x-(h||450)/2,y:u.y-(p||450)/2,props:{w:h,h:p,url:c}};n.createShapes([g]).select(f)}),n.registerExternalContentHandler("files",async({point:a,files:c})=>{if(c.length>n.options.maxFilesAtOnce)throw Error("Too many files");const l=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=new y(l.x,l.y),h=[],p=[];for(const f of c){if(f.size>t){i.addToast({title:o("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(f.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);continue}if(!f.type){i.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!r.concat(s).includes(f.type)){i.addToast({title:o("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${f.name} not loaded - Mime type not allowed ${f.type}.`);continue}const g=r.includes(f.type),m=s.includes(f.type),x=pm(await f.arrayBuffer()),b=os.createId(x),S=await tb(f,b,g,m);let P;g&&(P=n.createTemporaryAssetPreview(b,f)),h.push(S),p.push({asset:S,file:f,temporaryAssetPreview:P})}Promise.allSettled(p.map(async f=>{try{const g=await n.getAssetForExternalContent({type:"file",file:f.file});if(!g)throw Error("Could not create an asset");n.updateAssets([{...g,id:f.asset.id}])}catch(g){i.addToast({title:o("assets.files.upload-failed"),severity:"error"}),console.error(g);return}})),nb(n,h,u)}),n.registerExternalContentHandler("text",async({point:a,text:c})=>{const l=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),u=n.getShapeUtil("text").getDefaultProps(),h=vF(c),p=n.getOnlySelectedShape();if(p&&"text"in p.props){n.updateShapes([{id:p.id,type:p.type,props:{text:h}}]);return}let f,g,m,x="middle";const b=h.split(`
`).length>1,S=nC(h);b&&(x=b?S?"end":"start":"middle");const P=n.textMeasure.measureText(h,{...zt,fontFamily:Hr[u.font],fontSize:Ii[u.size],maxWidth:null}),w=Math.min(b?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(P.w>w){const I=n.textMeasure.measureText(h,{...zt,fontFamily:Hr[u.font],fontSize:Ii[u.size],maxWidth:w});f=I.w,g=I.h,m=!1,x=S?"end":"start"}else f=P.w,g=P.h,m=!0;l.y-g/2<n.getViewportPageBounds().minY+40&&(l.y=n.getViewportPageBounds().minY+40+g/2),n.createShapes([{id:ze(),type:"text",x:l.x-f/2,y:l.y-g/2,props:{text:h,textAlign:x,autoSize:m,w:f}}])}),n.registerExternalContentHandler("url",async({point:a,url:c})=>{const l=n.getShapeUtil("embed"),u=l==null?void 0:l.getEmbedDefinition(c);if(u)return n.putExternalContent({type:"embed",url:u.url,point:a,embed:u.definition});const h=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),p=os.createId(hp(c)),f=IF(n,c,h);let g=n.getAsset(p),m=!1;if(!g){m=!0;try{const x=await n.getAssetForExternalContent({type:"url",url:c});if(!x)throw Error("Could not create an asset");g=x}catch{i.addToast({title:o("assets.url.failed"),severity:"error"});return}}n.run(()=>{m&&n.createAssets([g]),n.updateShapes([{id:f.id,type:f.type,props:{assetId:g.id}}])})})}async function tb(n,e,t,r){let s=n.type;n.type==="video/quicktime"&&(s="video/mp4");const i=t?await yn.getImageSize(n):await yn.getVideoSize(n),o=await yn.isAnimated(n)||r;return{id:e,type:t?"image":"video",typeName:"asset",props:{name:n.name,src:"",w:i.w,h:i.h,fileSize:n.size,mimeType:s,isAnimated:o},meta:{}}}async function nb(n,e,t){if(!e.length)return[];const r=y.From(t),s=[];for(let i=0;i<e.length;i++){const o=e[i];switch(o.type){case"image":{s.push({id:ze(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":s.push({id:ze(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}}return n.run(()=>{const i=e.filter(o=>!n.getAsset(o.id));i.length&&n.createAssets(i),n.createShapes(s).select(...s.map(o=>o.id)),sC(n,t)}),s.map(i=>i.id)}function sC(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const s=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(i=>{const o=n.getShapeParentTransform(i).decompose().rotation,a=y.Rot(s,-o);return{id:i.id,type:i.type,x:i.x-a.x,y:i.y-a.y}}))}if(r=n.getSelectionPageBounds(),r&&n.getInstanceState().isGridMode){const s=n.getDocumentSettings().gridSize,i=new y(r.minX,r.minY),o=i.clone().snapToGrid(s),a=y.Sub(i,o);n.updateShapes(n.getSelectedShapes().map(c=>{const l={x:c.x-a.x,y:c.y-a.y};return{id:c.id,type:c.type,x:l.x,y:l.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})}function IF(n,e,t){const r={id:ze(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([r]).select(r.id),sC(n,t)}),n.getShape(r.id)}var Gh;let CF=(Gh=class extends te{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}},v(Gh,"id","idle"),Gh);var Wh;let _F=(Wh=class extends te{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"preciseTimeout",-1);v(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var h;const{originPagePoint:t}=this.editor.inputs,r=ze();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`);const s=Zn(t,this.editor);this.editor.createShape({id:r,type:"arrow",x:s.x,y:s.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(r);if(!i)throw Error("expected shape");const o=this.editor.getShapeHandles(i);if(!o)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),c=this.shape,l=o.find(p=>p.id==="start"),u=(h=a.onHandleDrag)==null?void 0:h.call(a,i,{handle:{...l,x:0,y:0},isPrecise:!0,initial:c});u&&this.editor.updateShapes([u]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var s,i;const t=this.shape;if(!t)throw Error("expected shape");const r=this.editor.getShapeHandles(t);if(!r)throw Error("expected handles for arrow");{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=r.find(u=>u.id==="start"),l=(s=o.onHandleDrag)==null?void 0:s.call(o,t,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:a});l&&this.editor.updateShapes([l])}{const o=this.editor.getShapeUtil("arrow"),a=this.shape,c=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),l=r.find(h=>h.id==="end"),u=(i=o.onHandleDrag)==null?void 0:i.call(o,this.editor.getShape(t),{handle:{...l,x:c.x,y:c.y},isPrecise:!1,initial:a});u&&this.editor.updateShapes([u])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},v(Wh,"id","pointing"),Wh);class Kp extends te{constructor(){super(...arguments);v(this,"shapeType","arrow")}static children(){return[CF,_F]}}v(Kp,"id","arrow"),v(Kp,"initial","idle");class Og extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"initialShape");v(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");v(this,"util",this.editor.getShapeUtil(this.shapeType));v(this,"isPen",!1);v(this,"isPenOrStylus",!1);v(this,"segmentMode","free");v(this,"didJustShiftClickToExtendPreviousShapeLine",!1);v(this,"pagePointWhereCurrentSegmentChanged",{});v(this,"pagePointWhereNextSegmentChanged",null);v(this,"lastRecordedPoint",{});v(this,"mergeNextPoint",!1);v(this,"currentLineLength",0);v(this,"markId",null)}onEnter(t){this.markId=null,this.info=t,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:t}=this.editor;if(this.isPen&&!t.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?y.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(t){if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(t){if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r,s){if(!this.canClose())return!1;const i=$t[r],o=t[0].points[0],a=t[t.length-1],c=a.points[a.points.length-1];return o!==c&&this.currentLineLength>i*4*s&&y.DistMin(o,c,i*2*s)}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:s=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||s>0&&s<.5||s>.5&&s<1;const i=this.isPenOrStylus?s*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=Pt(a.props.segments);if(!c)throw Error("Expected a previous segment!");const l=Pt(c.points);if(!l)throw Error("Expected a previous point!");const{x:u,y:h}=this.editor.getPointInShapeSpace(a,t).toFixed(),p={type:this.segmentMode,points:[{x:l.x,y:l.y,z:+i.toFixed(2)},{x:u,y:h,z:+i.toFixed(2)}]},f=W.applyToPoint(this.editor.getShapePageTransform(a.id),l);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const g=[...a.props.segments,p];this.currentLineLength<$t[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const m={id:a.id,type:this.shapeType,props:{segments:g}};this.canClose()&&(m.props.isClosed=this.getIsClosed(g,a.props.size,a.props.scale)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const o=ze();this.editor.createShapes([{id:o,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+i.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateDrawingShape(){const{initialShape:t}=this,{inputs:r}=this.editor;if(!t)return;const{id:s,props:{size:i,scale:o}}=t,a=this.editor.getShape(s);if(!a)return;const{segments:c}=a.props,{x:l,y:u,z:h}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),p=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,f={x:l,y:u,z:p};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(y.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const x=Pt(c);if(!x)throw Error("Expected a previous segment!");const b=Pt(x.points);if(!b)throw Error("Expected a previous last point!");let S;const P=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(x.type==="straight"){this.currentLineLength+=y.Dist(b,P),S={type:"straight",points:[{...b},P]};const I=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=W.applyToPoint(I,b)}else S={type:"straight",points:[P,f]};const w={id:s,type:this.shapeType,props:{segments:[...c,S]}};this.canClose()&&(w.props.isClosed=this.getIsClosed(c,i,o)),this.editor.updateShapes([w])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:g}=this;if(g===null)throw Error("We should have a point where the segment changed");if(y.Dist2(g,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const x=c.slice(),b=x[x.length-1],S=Pt(b.points);if(!S)throw Error("No previous point!");const P={type:"free",points:[...y.PointsBetween(S,f,6).map(E=>({x:Lr(E.x),y:Lr(E.y),z:Lr(E.z)}))]},w=[...x,P];this.currentLineLength<$t[a.props.size]*4&&(this.currentLineLength=this.getLineLength(w));const I={id:s,type:this.shapeType,props:{segments:w}};this.canClose()&&(I.props.isClosed=this.getIsClosed(w,i,o)),this.editor.updateShapes([I])}break}case"straight":{const g=c.slice(),m=g[g.length-1],{pagePointWhereCurrentSegmentChanged:x}=this,{ctrlKey:b,currentPagePoint:S}=this.editor.inputs;if(!x)throw Error("We should have a point where the segment changed");let P,w=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(w=!b,this.didJustShiftClickToExtendPreviousShapeLine=!1):w=!b;let I=this.editor.getPointInShapeSpace(a,S).toFixed().toJson(),E=!1,T;if((this.editor.user.getIsSnapMode()?!b:b)&&g.length>2){let k,R=8/this.editor.getZoomLevel();for(let A=0,D=c.length-2;A<D;A++){const O=c[A];if(!O)break;if(O.type==="free")continue;const $=O.points[0],B=Pt(O.points);if(!($&&B))continue;const G=y.NearestPointOnLineSegment($,B,I);if(y.DistMin(G,I,R)){k=G.toFixed().toJson(),R=y.Dist(G,I),T=O;break}}k&&(E=!0,I=k)}if(E&&T){const k=this.editor.getShapePageTransform(a),R=T.points[0],A=Pt(T.points);if(!A)throw Error("Expected a last point!");const D=W.applyToPoint(k,R),O=W.applyToPoint(k,A),$=W.applyToPoint(k,I);this.editor.snaps.setIndicators([{id:Fe(),type:"points",points:[D,$,O]}])}else{if(this.editor.snaps.clearIndicators(),w){const k=y.Angle(x,S),A=Lc(k,24)-k;P=y.RotWith(S,x,A)}else P=S;I=this.editor.getPointInShapeSpace(a,P).toFixed().toJson()}this.currentLineLength+=y.Dist(m.points[0],I),g[g.length-1]={...m,type:"straight",points:[m.points[0],I]};const j={id:s,type:this.shapeType,props:{segments:g}};this.canClose()&&(j.props.isClosed=this.getIsClosed(c,i,o)),this.editor.updateShapes([j]);break}case"free":{const g=c.slice(),m=g[g.length-1],x=[...m.points];if(x.length&&this.mergeNextPoint){const{z:S}=x[x.length-1];x[x.length-1]={x:f.x,y:f.y,z:S?Math.max(S,f.z):f.z}}else this.currentLineLength+=y.Dist(x[x.length-1],f),x.push(f);g[g.length-1]={...m,points:x},this.currentLineLength<$t[a.props.size]*4&&(this.currentLineLength=this.getLineLength(g));const b={id:s,type:this.shapeType,props:{segments:g}};if(this.canClose()&&(b.props.isClosed=this.getIsClosed(g,i,o)),this.editor.updateShapes([b]),x.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:s,type:this.shapeType,props:{isComplete:!0}}]);const S=ze(),P=this.editor.getShape(s).props;this.editor.createShapes([{id:S,type:this.shapeType,x:Lr(r.currentPagePoint.x),y:Lr(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:P.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(h*1.25).toFixed():.5}]}]}}]),this.initialShape=Ve(this.editor.getShape(S)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const s of t)for(let i=0;i<s.points.length-1;i++){const o=s.points[i],a=s.points[i+1];r+=y.Dist2(a,o)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}v(Og,"id","drawing");var Yh;let iC=(Yh=class extends te{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},v(Yh,"id","idle"),Yh);class Ja extends te{constructor(){super(...arguments);v(this,"shapeType","draw")}static children(){return[iC,Og]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}v(Ja,"id","draw"),v(Ja,"initial","idle"),v(Ja,"isLockable",!1);class qp extends Fp{constructor(){super(...arguments);v(this,"shapeType","frame")}onCreate(t){if(!t)return;const r=this.editor.getShapePageBounds(t),s=[],i=this.editor.getShapeAncestors(t).map(o=>o.id);this.editor.getSortedChildIdsForParent(t.parentId).map(o=>{const a=this.editor.getShape(o);if(!a||a.id===t.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&r.contains(c)&&EF(a,i,t)&&s.push(a.id)}),this.editor.reparentShapes(s,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}v(qp,"id","frame"),v(qp,"initial","idle");function EF(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var Vh;let TF=(Vh=class extends te{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},v(Vh,"id","idle"),Vh);var Xh;let kF=(Xh=class extends te{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=ze(),s=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),i=Zn(t,this.editor);this.editor.createShapes([{id:r,type:"geo",x:i.x,y:i.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Gn),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=ze();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,s=this.editor.getStyleForNextShape(Gn),i=s==="star"?{w:200,h:190}:s==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Gn),scale:r,...i}}]);const o=this.editor.getShape(t);if(!o)return;const{w:a,h:c}=o.props,l=new y(a/2,c/2).mul(r),u=this.editor.getShapeParentTransform(o);u&&l.rot(-u.rotation());const h=Zn(new y(o.x-l.x,o.y-l.y),this.editor);this.editor.select(t),this.editor.updateShape({id:o.id,type:"geo",x:h.x,y:h.y,props:{geo:this.editor.getStyleForNextShape(Gn),w:a*r,h:c*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},v(Xh,"id","pointing"),Xh);class Gp extends te{constructor(){super(...arguments);v(this,"shapeType","geo")}static children(){return[TF,kF]}}v(Gp,"id","geo"),v(Gp,"initial","idle");class Qa extends te{constructor(){super(...arguments);v(this,"shapeType","highlight")}static children(){return[iC,Og]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}v(Qa,"id","highlight"),v(Qa,"initial","idle"),v(Qa,"isLockable",!1);var Zh;let jF=(Zh=class extends te{constructor(){super(...arguments);v(this,"shapeId","")}onEnter(t){this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},v(Zh,"id","idle"),Zh);const rb=2;var Jh;let MF=(Jh=class extends te{constructor(){super(...arguments);v(this,"shape",{});v(this,"markId")}onEnter(t){const{inputs:r}=this.editor,{currentPagePoint:s}=r;this.markId=void 0;const i=t.shapeId&&this.editor.getShape(t.shapeId);if(i&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i.id}`),this.shape=i;const o=this.editor.getShapeHandles(this.shape);if(!o)return;const a=o.filter(g=>g.type==="vertex").sort(Rt),c=a[a.length-1],l=a[a.length-2],u=W.applyToPoint(this.editor.getShapeParentTransform(this.shape),new y(this.shape.x,this.shape.y)),h=y.Sub(s,u).addXY(.1,.1),p=Zn(h,this.editor),f=Ve(this.shape.props.points);if(y.DistMin(c,l,rb)||y.DistMin(p,c,rb))f[c.id]={id:c.id,index:c.index,x:p.x,y:p.y};else{const g=ar(c.index);f[g]={id:g,index:g,x:p.x,y:p.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:f}}])}else{const o=ze();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${o}`);const a=Zn(s,this.editor);this.editor.createShapes([{id:o,type:"line",x:a.x,y:a.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(o),this.shape=this.editor.getShape(o)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=Pt(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},v(Jh,"id","pointing"),Jh);class Wp extends te{constructor(){super(...arguments);v(this,"shapeType","line")}static children(){return[jF,MF]}}v(Wp,"id","line"),v(Wp,"initial","idle");var Qh;let AF=(Qh=class extends te{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},v(Qh,"id","idle"),Qh);const DF=0,$e=200,Rl=new y($e/2,$e/2),oC=10,OF=n=>[[["a1"],new y($e*.5,$e*-.5-n.options.adjacentShapeMargin)],[["a2"],new y($e*1.5+n.options.adjacentShapeMargin,$e*.5)],[["a3"],new y($e*.5,$e*1.5+n.options.adjacentShapeMargin)],[["a4"],new y($e*-.5-n.options.adjacentShapeMargin,$e*.5)]];function RF(n,e){if(e===1)return OF(n);const t=$e*e,r=n.options.adjacentShapeMargin*e;return[[["a1"],new y(t*.5,t*-.5-r)],[["a2"],new y(t*1.5+r,t*.5)],[["a3"],new y(t*.5,t*1.5+r)],[["a4"],new y(t*-.5-r,t*.5)]]}function aC(n,e,t,r,s,i){return Object.fromEntries(RF(n,i).map(([o,a],c)=>{const l=a.clone();return c===0&&s?l.y-=s:c===2&&r&&(l.y+=r),[o,l.rot(t).add(e)]}))}function cC(n,e,t,r){const s=new Set(n.getSelectedShapeIds()),i=($e+n.options.adjacentShapeMargin+r)**2,o=new Map,a=[];for(const u of n.getCurrentPageShapes()){if(!n.isShapeOfType(u,"note")||t!==u.props.scale||s.has(u.id))continue;const h=n.getShapePageTransform(u.id);e===h.rotation()&&(o.set(u,n.getShapePageBounds(u).center),a.push(...Object.values(aC(n,h.point(),e,u.props.growY,r,t))))}const c=a.length;let l;for(const[u,h]of o)for(let p=0;p<c;p++)l=a[p],l&&(y.Dist2(h,l)>i||n.isPointInShape(u,l)&&(a[p]=void 0));return fe(a)}function lC(n,e,t,r,s=!1){let i;const o=n.getCurrentPageShapesSorted(),a=($e+n.options.adjacentShapeMargin**2)**e.props.scale;for(let c=o.length-1;c>=0;c--){const l=o[c];if(l.type==="note"&&l.id!==e.id){const u=n.getShapePageBounds(l);if(u&&y.Dist2(u.center,t)<a&&n.isPointInShape(l,t)){i=l;break}}}if(n.complete(),!i||s){n.markHistoryStoppingPoint("creating note shape");const c=ze();n.createShape({id:c,type:"note",x:t.x,y:t.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const l=n.getShape(c);if(!l)return;const u=n.getPointInParentSpace(l,y.Sub(t,y.Rot(Rl.clone().mul(l.props.scale),r)));n.updateShape({id:c,type:"note",x:u.x,y:u.y}),i=n.getShape(c)}return FF(n),i}const LF=16;function FF(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const r=e.clone().expandBy(LF/n.getZoomLevel()).expand(t),s=t.clone().translate({x:(r.center.x-t.center.x)*2,y:(r.center.y-t.center.y)*2});n.zoomToBounds(s,{animation:{duration:n.options.animationMediumMs},inset:0})}}var ep;let $F=(ep=class extends te{constructor(){super(...arguments);v(this,"dragged",!1);v(this,"info",{});v(this,"markId","");v(this,"shape",{})}onEnter(){const{editor:t}=this,r=ze();this.markId=t.markHistoryStoppingPoint(`creating_note:${r}`);const s=this.editor.inputs.originPagePoint.clone(),i=zF(this.editor,s,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);i&&s.sub(i),this.shape=NF(this.editor,r,s)}onPointerMove(t){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},v(ep,"id","pointing"),ep);function zF(n,e,t){let r=oC/n.getZoomLevel(),s;for(const i of cC(n,0,t,0)){const o=y.Sub(e,i),a=o.len();a<r&&(r=a,s=o)}return s}function NF(n,e,t){const r=Zn(t,n);n.createShape({id:e,type:"note",x:r.x,y:r.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const s=n.getShape(e),i=n.getShapeGeometry(s).bounds;return n.updateShapes([{id:e,type:"note",x:s.x-i.width/2,y:s.y-i.height/2}]),n.getShape(e)}class Yp extends te{constructor(){super(...arguments);v(this,"shapeType","note")}static children(){return[AF,$F]}}v(Yp,"id","note"),v(Yp,"initial","idle");function BF(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}const $r=Ub(BF,32);var tp;let UF=(tp=class extends te{onPointerMove(e){switch(e.target){case"shape":case"canvas":$r(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){$r.cancel()}onKeyDown(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},v(tp,"id","idle"),tp);var np;let HF=(np=class extends te{constructor(){super(...arguments);v(this,"shape");v(this,"markId","");v(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(t){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:s}=r.inputs;if(!s)return;const{originPagePoint:i,currentPagePoint:o}=r.inputs,a=Math.abs(i.x-o.x),l=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(a>l){const u=ze();this.markId=r.markHistoryStoppingPoint(`creating_text:${u}`);const h=this.createTextShape(u,i,!1,a);if(!h){this.cancel();return}this.shape=r.getShape(h),r.select(u),r.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(h.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const t=ze(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(t,r,!0,20)&&(this.editor.select(t),this.editor.setEditingShape(t))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,r,s,i){this.editor.createShape({id:t,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:s,w:i,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const o=this.editor.getShape(t);if(!o){this.cancel();return}const a=this.editor.getShapePageBounds(o),c=new y;if(s)switch(o.props.textAlign){case"start":{c.x=0;break}case"middle":{c.x=-a.width/2;break}case"end":{c.x=-a.width;break}}else c.x=0;if(c.y=-a.height/2,en(o.parentId)){const h=this.editor.getShapeParentTransform(o);c.rot(-h.rotation())}const l=o.x+c.x,u=o.y+c.y;if(this.editor.getInstanceState().isGridMode){const h=new y(l,u),p=Zn(h,this.editor),f=y.Sub(h,p);this.editor.updateShape({...o,x:l-f.x,y:u-f.y})}else this.editor.updateShape({...o,x:l,y:u});return o}},v(np,"id","pointing"),np);class Vp extends te{constructor(){super(...arguments);v(this,"shapeType","text")}static children(){return[UF,HF]}}v(Vp,"id","text"),v(Vp,"initial","idle");const KF=[Vp,Ja,Gp,Yp,Wp,qp,Kp,Qa];function $n(){return Yr({isDarkMode:ia()})}function Ll(n){return{key:`${gr.id}:${n}`,async getElement(){const e=qF(n);if(!e)return null;const t=e.$$_url,r=e.$$_fontface;if(!t||!r)return null;const s=await(await fr(t)).blob(),i=await Kn.blobToDataUrl(s),o=r.replace(t,i);return d.jsx("style",{children:o})}}}function qF(n){const e=i0[n];for(const t of document.fonts)if(e.includes(t.family))return t;return null}function Rg(n){return{key:`${gr.id}:${n}`,async getElement(){return n!=="pattern"?null:d.jsx(GF,{})}}}function GF(){const n=Fg(),e=Li(),t=$n(),r=8/12;return d.jsxs(d.Fragment,{children:[d.jsxs("mask",{id:e,children:[d.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),d.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[d.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),d.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),d.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),d.jsx("pattern",{id:n(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:d.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function Lg(){return{key:`${gr.id}:pattern`,component:XF}}const bo=8,sb=(n,e,t)=>new Promise((r,s)=>{const i=bo*e*n,o=document.createElement("canvas");o.width=i,o.height=i;const a=o.getContext("2d");if(!a)return;a.fillStyle=t?kc.darkMode.solid:kc.lightMode.solid,a.fillRect(0,0,i,i),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const c=8/12,l=u=>u*e*n;a.beginPath(),a.moveTo(l(c*1),l(c*3)),a.lineTo(l(c*3),l(c*1)),a.moveTo(l(c*5),l(c*7)),a.lineTo(l(c*7),l(c*5)),a.moveTo(l(c*9),l(c*11)),a.lineTo(l(c*11),l(c*9)),a.stroke(),o.toBlob(u=>{!u||ct.throwToBlob.get()?s():r(u)})}),ib=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""};let Oh=null;function WF(){return Oh||(Oh={white:ib([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:ib([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),Oh}function dC(n){return Math.ceil(Math.log2(Math.max(1,n)))}function Fg(){const n=Yn("hash_pattern");return _.useCallback((e,t)=>{const r=dC(e);return Qf(n,`${t}_${r}`)},[n])}function uC(n){const e=[],r=dC(n);for(let s=0;s<=r;s++)e.push(Math.pow(2,s));return e}function YF(n){const e=WF();return uC(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function VF(){const n=z(),e=N("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=N("maxZoom",()=>Math.ceil(Pt(n.getCameraOptions().zoomSteps)),[n]),[r,s]=_.useState(!1),[i,o]=_.useState(()=>YF(t)),a=Fg();return _.useEffect(()=>{const l=Promise.all(uC(t).flatMap(h=>[sb(e,h,!1).then(p=>({zoom:h,theme:"light",url:URL.createObjectURL(p)})),sb(e,h,!0).then(p=>({zoom:h,theme:"dark",url:URL.createObjectURL(p)}))]));let u=!1;return l.then(h=>{u||(o(h),s(!0))}),()=>{u=!0,s(!1),l.then(h=>{for(const{url:p}of h)URL.revokeObjectURL(p)})}},[e,t]),{defs:d.jsx(d.Fragment,{children:i.map(l=>{const u=a(l.zoom,l.theme);return d.jsx("pattern",{id:u,width:bo,height:bo,patternUnits:"userSpaceOnUse",children:d.jsx("image",{href:l.url,width:bo,height:bo})},u)})}),isReady:r}}function XF(){const n=z(),e=_.useRef(null),{defs:t,isReady:r}=VF();return _.useEffect(()=>{if(r&&Be.isSafari){const s=hC(e.current);s&&n.timers.requestAnimationFrame(()=>{s.style.display="none",n.timers.requestAnimationFrame(()=>{s.style.display=""})})}},[n,r]),d.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:t})}function hC(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?hC(n.parentElement):null}const Dt=Qe.memo(function({theme:e,d:t,color:r,fill:s,scale:i}){switch(s){case"none":return null;case"solid":return d.jsx("path",{fill:e[r].semi,d:t});case"semi":return d.jsx("path",{fill:e.solid,d:t});case"fill":return d.jsx("path",{fill:e[r].fill,d:t});case"pattern":return d.jsx(ZF,{theme:e,color:r,fill:s,d:t,scale:i})}});function ZF({d:n,color:e,theme:t}){const r=z(),s=ta(),i=N("zoomLevel",()=>r.getZoomLevel(),[r]),o=Fg(),a=r.getZoomLevel()<=.18;return d.jsxs(d.Fragment,{children:[d.jsx("path",{fill:t[e].pattern,d:n}),d.jsx("path",{fill:s?`url(#${o(1,t.id)})`:a?t[e].semi:`url(#${o(i,t.id)})`,d:n})]})}function JF(n){return n.replace(/\s/g," ")}function Xp(n,e,t){const{padding:r=0}=t;if(e.length===0)return null;const s=V.From(e[0].box);for(const{box:l}of e)s.union(l);const i=r+(t.offsetX??0),o=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-s.height:(Math.ceil(t.height)-s.height)/2);let a=null;const c=[];for(const{text:l,box:u}of e)a!==null&&u.y>a&&c.push(d.jsx("tspan",{alignmentBaseline:"mathematical",x:i,y:u.y+o,children:`
`},c.length)),c.push(d.jsx("tspan",{alignmentBaseline:"mathematical",x:u.x+i,y:u.y+o,unicodeBidi:"plaintext",children:JF(l)},c.length)),a=u.y;return d.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:c})}function QF(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const s=V.From(t[0].box);for(const{box:i}of t)s.union(i);if(n==="start-legacy")return(r-2*e-s.width)/2;if(n==="end-legacy")return-(r-2*e-s.width)/2}}function e4(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Fl({fontSize:n,font:e,align:t,verticalAlign:r,text:s,labelColor:i,bounds:o,padding:a=16,stroke:c=!0}){const l=z(),u=$n(),h={fontSize:n,fontFamily:i0[e],textAlign:t,verticalTextAlign:r,width:Math.ceil(o.width),height:Math.ceil(o.height),padding:a,lineHeight:zt.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:i,stroke:void 0,strokeWidth:void 0},p=l.textMeasure.measureTextSpans(s,h),f=QF(t,a,p,o.width);f&&(h.offsetX=f),h.offsetX+=o.x,h.offsetY+=o.y;const g=Xp(l,p,h);let m=null;return c&&(h.fill=u.background,h.stroke=u.background,h.strokeWidth=2,m=Xp(l,p,h)),d.jsxs(d.Fragment,{children:[m,g]})}const t4=_.forwardRef(function({isEditing:e,text:t,handleFocus:r,handleChange:s,handleKeyDown:i,handleBlur:o,handleInputPointerDown:a,handleDoubleClick:c},l){return d.jsx("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:r,onChange:s,onKeyDown:i,onBlur:o,onTouchEnd:ut,onContextMenu:e?ut:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:xe})});function n4(n,e,t){const r=z(),s=_.useRef(null),i=N("isEditing",()=>r.getEditingShapeId()===n,[r]),o=N("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);_.useEffect(()=>{function u(h){var p;h.shapeId===n&&((p=s.current)==null||p.select())}return r.on("select-all-text",u),()=>{r.off("select-all-text",u)}},[r,n,i]),_.useEffect(()=>{var u,h,p,f;i&&(document.activeElement!==s.current&&((u=s.current)==null||u.focus()),r.getInstanceState().isCoarsePointer&&((h=s.current)==null||h.select()),Be.isSafari&&((p=s.current)==null||p.blur(),(f=s.current)==null||f.focus()))},[r,i]);const a=_.useCallback(u=>{if(r.getEditingShapeId()===n)switch(u.key){case"Enter":{(u.ctrlKey||u.metaKey)&&r.complete();break}}},[r,n]),c=_.useCallback(u=>{if(r.getEditingShapeId()!==n)return;let h=Ci.normalizeText(u.currentTarget.value);const p=h.replace(/\t/g,mi);if(p!==h){const f=u.currentTarget.selectionStart;u.currentTarget.value=p,u.currentTarget.selectionStart=f+(p.length-h.length),u.currentTarget.selectionEnd=f+(p.length-h.length),h=p}r.updateShape({id:n,type:e,props:{text:h}})},[r,n,e]),l=_.useCallback(u=>{r.dispatch({...Sn(u),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),ut(u)},[r,n]);return{rInput:s,handleFocus:Oo,handleBlur:Oo,handleKeyDown:a,handleChange:c,handleInputPointerDown:l,handleDoubleClick:ut,isEmpty:t.trim().length===0,isEditing:i,isEditingAnything:o}}const $l=Qe.memo(function({shapeId:e,type:t,text:r,labelColor:s,font:i,fontSize:o,lineHeight:a,align:c,verticalAlign:l,wrap:u,isSelected:h,padding:p=0,onKeyDown:f,classNamePrefix:g,style:m,textWidth:x,textHeight:b}){const{rInput:S,isEmpty:P,isEditing:w,isEditingAnything:I,...E}=n4(e,t,r),[T,C]=_.useState(r);_.useEffect(()=>{w||C(r)},[w,r]);const j=Ci.normalizeTextForDom(r),k=j.length>0,R=e4(c);if(!w&&!k)return null;const A=g||"tl-text";return d.jsx("div",{className:`${A}-label tl-text-wrapper`,"data-font":i,"data-align":c,"data-hastext":!P,"data-isediting":w,"data-iseditinganything":I,"data-textwrap":!!u,"data-isselected":h,style:{justifyContent:c==="middle"||R?"center":c,alignItems:l==="middle"?"center":l,padding:p,...m},children:d.jsxs("div",{className:`${A}-label__inner tl-text-content__wrapper`,style:{fontSize:o,lineHeight:Math.floor(o*a)+"px",minHeight:Math.floor(o*a)+"px",minWidth:Math.ceil(x||0),color:s,width:x?Math.ceil(x):void 0,height:b?Math.ceil(b):void 0},children:[d.jsx("div",{className:`${A} tl-text tl-text-content`,dir:"auto",children:j.split(`
`).map((D,O)=>d.jsx("div",{dir:"auto",children:D},O))}),(I||h)&&d.jsx(t4,{ref:S,text:r,isEditing:w,...E,handleKeyDown:f??E.handleKeyDown},T)]})})}),r4=new pr;function s4(n){return r4.get(n,()=>n.store.createComputedCache("arrowLabelSize",e=>{const t=lr(n,e);let r=0,s=0;const i=t.isStraight?new Fr({start:y.From(t.start.point),end:y.From(t.end.point)}):new hi({center:y.Cast(t.handleArc.center),start:y.Cast(t.start.point),end:y.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});if(e.props.text.trim()){const o=i.bounds,a=Zp(e),{w:c,h:l}=n.textMeasure.measureText(e.props.text,{...zt,fontFamily:Hr[e.props.font],fontSize:a,maxWidth:null});r=c,s=l;let u=!1;if(o.width>o.height?(r=Math.max(Math.min(c,64),Math.min(o.width-64,c)),u=!0):r>16*a&&(r=16*a,u=!0),u){const{w:h,h:p}=n.textMeasure.measureText(e.props.text,{...zt,fontFamily:Hr[e.props.font],fontSize:a,maxWidth:r});r=h,s=p}}return new y(r,s).addScalar(Gc*2*e.props.scale)}))}function $g(n,e){return e.props.text.trim()===""?new y(0,0).addScalar(Gc*2*e.props.scale):s4(n).get(e.id)??new y(0,0)}function pC(n){const e=$t[n.props.size];return(fF+(e-$t.s)*2+(e===$t.xl?20:0))*n.props.scale}function i4(n,e,t){const r=$g(n,e),s=pC(e),i=y.Nudge(t.start.point,t.end.point,s),o=y.Nudge(t.end.point,t.start.point,s),a=dg(i,o,V.FromCenter(t.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,l]=a;y.Dist2(c,i)>y.Dist2(l,i)&&([l,c]=a);const u=i.add(y.Sub(t.middle,c)),h=o.add(y.Sub(t.middle,l)),p=y.Dist(t.start.point,u)/t.length,f=y.Dist(t.start.point,h)/t.length;return{start:p,end:f}}function o4(n,e,t){const r=$g(n,e),s=pC(e),i=Math.sign(e.props.bend),o=s/t.handleArc.radius*i,a=y.Angle(t.bodyArc.center,t.start.point)-o,c=y.Angle(t.bodyArc.center,t.end.point)+o,l=Us(t.bodyArc.center,t.bodyArc.radius,a),u=Us(t.bodyArc.center,t.bodyArc.radius,c),h=[],p=ab(t.bodyArc.center,t.bodyArc.radius,a,c,i,V.FromCenter(l,r).corners);h.push(new at({points:V.FromCenter(l,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const f=ab(t.bodyArc.center,t.bodyArc.radius,a,c,i,V.FromCenter(u,r).corners);h.push(new at({points:V.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const T of[...p??[],...f??[],l,u])h.push(new Cg({x:T.x-3,y:T.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const g=(p&&cb(t.start.point,p))??t.middle,m=(f&&cb(t.end.point,f))??t.middle,x=y.Angle(t.bodyArc.center,t.start.point),b=y.Angle(t.bodyArc.center,t.end.point),S=y.Angle(t.bodyArc.center,g),P=y.Angle(t.bodyArc.center,m);if(as(x,S,i)>as(x,P,i))return{start:.5,end:.5,dbg:h};const w=as(x,b,i),I=as(x,S,i)/w,E=as(x,P,i)/w;return{start:I,end:E,dbg:h}}function ec(n,e){let t;const r=[],s=lr(n,e),i={hasStartBinding:!!s.bindings.start,hasEndBinding:!!s.bindings.end,hasStartArrowhead:s.start.arrowhead!=="none",hasEndArrowhead:s.end.arrowhead!=="none"};if(s.isStraight){const a=i4(n,e,s),c=ob(n,e,a,i);t=y.Lrp(s.start.point,s.end.point,c)}else{const a=o4(n,e,s);a.dbg&&r.push(...a.dbg);const c=ob(n,e,a,i),l=a4(y.Angle(s.bodyArc.center,s.start.point),y.Angle(s.bodyArc.center,s.end.point),Math.sign(e.props.bend),c);t=Us(s.bodyArc.center,s.bodyArc.radius,l)}const o=$g(n,e);return{box:V.FromCenter(t,o),debugGeom:r}}function ob(n,e,t,r){const{hasEndArrowhead:s,hasEndBinding:i,hasStartBinding:o,hasStartArrowhead:a}=r,c=yC(n,e);let l=wt(e.props.labelPosition,a||o?t.start:0,s||i?t.end:1);const u=Math.min(.02,500/c*.02);return l=l>=.5-u&&l<=.5+u?.5:l,l}function ab(n,e,t,r,s,i){const o=Ep(n,e,i),a=as(t,r,s);return o==null?void 0:o.filter(c=>{const l=as(t,y.Angle(n,c),s);return l>=0&&l<=a})}function cb(n,e){let t=null,r=-1/0;for(const s of e){const i=y.Dist2(n,s);i>r&&(t=s,r=i)}return t}function a4(n,e,t,r){const s=as(n,e,t);return n+s*r*t*-1}function Zp(n){return pF[n.props.size]*n.props.scale}function c4(n,e,t){const r=e==="end"?n.end.point:n.start.point,s=e==="end"?n.start.point:n.end.point,i=n.isStraight?y.Dist(s,r):Math.abs(n.bodyArc.length),o=Math.max(Math.min(i/5,t*3),t);let a;if(n.isStraight)a=y.Nudge(r,s,o);else{const c=ID(r,o,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?c[0]:c[1]:n.handleArc.sweepFlag?c[1]:c[0]}return y.IsNaN(a)&&(a=n.start.point),{point:r,int:a}}function l4({point:n,int:e}){const t=y.RotWith(e,n,je/6),r=y.RotWith(e,n,-je/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function d4({point:n,int:e}){const t=y.RotWith(e,n,je/6),r=y.RotWith(e,n,-je/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function u4({point:n,int:e}){const t=y.Sub(e,n).div(2),r=y.Add(n,y.Rot(t,Ke)),s=y.Sub(n,y.Rot(t,Ke));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${s.x} ${s.y} Z`}function h4({point:n,int:e}){const t=y.Lrp(n,e,.45),r=y.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function p4({point:n,int:e}){const t=y.Lrp(n,e,.75),r=y.RotWith(t,n,je/4),s=y.RotWith(t,n,-je/4),i=y.Lrp(r,s,.5);return i.add(y.Sub(i,n)),`M ${i.x} ${i.y} L ${s.x} ${s.y} ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function f4({int:n,point:e}){const t=y.Lrp(e,n,.85),r=y.Sub(t,e).div(2),s=y.Add(e,y.Rot(r,Ke)),i=y.Sub(e,y.Rot(r,Ke)),o=y.Add(t,y.Rot(r,Ke)),a=y.Sub(t,y.Rot(r,Ke));return`M ${s.x} ${s.y} L ${o.x} ${o.y} L ${a.x} ${a.y} L ${i.x} ${i.y} Z`}function g4({int:n,point:e}){const t=y.Sub(n,e).div(2),r=y.Add(e,y.Rot(t,Ke)),s=y.Sub(e,y.Rot(t,Ke));return`M ${r.x} ${r.y} L ${s.x} ${s.y}`}function Wc(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const s=c4(n,e,t);if(s){switch(r){case"bar":return g4(s);case"square":return f4(s);case"diamond":return p4(s);case"dot":return h4(s);case"inverted":return u4(s);case"arrow":return l4(s);case"triangle":return d4(s)}return""}}function m4(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:s,sweepFlag:i}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${s} ${i} ${t.handle.x},${t.handle.y}`}function fC(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:s,sweepFlag:i}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${s} ${i} ${t.point.x},${t.point.y}`}function gC(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function y4(n){return gC(n.start.handle,n.end.handle)}function mC(n){return gC(n.start.point,n.end.point)}class tc extends Vn{constructor(){super(...arguments);v(this,"_resizeInitialBindings",new pr)}canEdit(){return!0}canBind({toShapeType:t}){return t!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(t){const r=rn(this.editor,t);return!r.start&&!r.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const r=lr(this.editor,t),s=[],i=r.isStraight?new Fr({start:y.From(r.start.point),end:y.From(r.end.point)}):new hi({center:y.Cast(r.handleArc.center),start:y.Cast(r.start.point),end:y.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let o;if(t.props.text.trim()){const a=ec(this.editor,t);s.push(...a.debugGeom),o=new yr({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new Rn({children:[...o?[i,o]:[i],...s]})}getHandles(t){const r=lr(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}getText(t){return t.props.text}onHandleDrag(t,{handle:r,isPrecise:s}){const i=r.id,o=rn(this.editor,t);if(i==="middle"){const{start:E,end:T}=fi(this.editor,t,o),C=y.Sub(T,E),j=y.Per(C),k=y.Med(T,E),R=y.Sub(k,j),A=y.Add(k,j),D=y.NearestPointOnLineSegment(R,A,r,!1);let O=y.Dist(D,k);return y.Clockwise(D,T,k)&&(O*=-1),{id:t.id,type:t.type,props:{bend:O}}}const a={id:t.id,type:"arrow",props:{}},c=o[i],u=o[i==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Xa(this.editor,t,i),a.props[i]={x:r.x,y:r.y},a;const h=this.editor.getShapePageTransform(t.id).applyToPoint(r),p=this.editor.getShapeAtPoint(h,{hitInside:!0,hitFrameInside:!0,margin:0,filter:E=>!E.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:E,binding:"arrow"})});if(!p){Xa(this.editor,t,i);const E=Zn(new y(r.x,r.y),this.editor);return a.props[i]={x:E.x,y:E.y},a}const f=this.editor.getShapeGeometry(p),g=V.ZeroFix(f.bounds),x=this.editor.getShapePageTransform(a.id).applyToPoint(r),b=this.editor.getPointInShapeSpace(p,x);let S=s;S||(!c||c&&p.id!==c.toId)&&(S=this.editor.inputs.pointerVelocity.len()<.5),s||(f.isClosed||(S=!0),u&&p.id===u.toId&&u.props.isPrecise&&(S=!0));const P={x:(b.x-g.minX)/g.width,y:(b.y-g.minY)/g.height};S&&y.Dist(b,g.center)<Math.max(4,Math.min(Math.min(g.width,g.height)*.15,16))/this.editor.getZoomLevel()&&(P.x=.5,P.y=.5);const w={terminal:i,normalizedAnchor:P,isPrecise:S,isExact:this.editor.inputs.altKey};co(this.editor,t,p.id,w),this.editor.setHintingShapes([p.id]);const I=rn(this.editor,t);return I.start&&I.end&&I.start.toId===I.end.toId&&y.Equals(I.start.props.normalizedAnchor,I.end.props.normalizedAnchor)&&co(this.editor,t,I.end.toId,{...I.end.props,normalizedAnchor:{x:I.end.props.normalizedAnchor.x+.05,y:I.end.props.normalizedAnchor.y}}),a}onTranslateStart(t){const r=rn(this.editor,t),s=fi(this.editor,t,r),i=this.editor.getShapePageTransform(t.id),o=this.editor.getSelectedShapeIds();if(!(r.start&&(o.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(o.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){db.set(t,{pagePosition:i.applyToPoint(t),terminalBindings:Go(s,(a,c)=>{const l=r[a];return l?{binding:l,shapePosition:c,pagePosition:i.applyToPoint(c)}:null})}),r.start&&(qc({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),r.end&&qc({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=r[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}}onTranslate(t,r){const s=db.get(t);if(!s)return;const i=this.editor.getShapePageTransform(r.id),o=y.Sub(i.applyToPoint(r),s.pagePosition);for(const a of Object.values(s.terminalBindings)){if(!a)continue;const c=y.Add(a.pagePosition,y.Mul(o,.5)),l=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:u=>!u.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:u,binding:"arrow"})});if((l==null?void 0:l.id)===a.binding.toId){const u=V.ZeroFix(this.editor.getShapeGeometry(l).bounds),h=this.editor.getPointInShapeSpace(l,c),p={x:(h.x-u.minX)/u.width,y:(h.y-u.minY)/u.height};co(this.editor,r,l.id,{...a.binding.props,normalizedAnchor:p,isPrecise:!0})}else Xa(this.editor,r,a.binding.props.terminal)}}onResize(t,r){const{scaleX:s,scaleY:i}=r,o=this._resizeInitialBindings.get(t,()=>rn(this.editor,t)),a=fi(this.editor,t,o),{start:c,end:l}=Ve(t.props);let{bend:u}=t.props;o.start||(c.x=a.start.x*s,c.y=a.start.y*i),o.end||(l.x=a.end.x*s,l.y=a.end.y*i);const h=Math.abs(s),p=Math.abs(i),f=o!=null&&o.start?y.From(o.start.props.normalizedAnchor):null,g=o!=null&&o.end?y.From(o.end.props.normalizedAnchor):null;return s<0&&i>=0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.x=1-f.x),g&&(g.x=1-g.x)):s>=0&&i<0?(u!==0&&(u*=-1,u*=Math.max(h,p)),f&&(f.y=1-f.y),g&&(g.y=1-g.y)):s>=0&&i>=0?u!==0&&(u*=Math.max(h,p)):s<0&&i<0&&(u!==0&&(u*=Math.max(h,p)),f&&(f.x=1-f.x,f.y=1-f.y),g&&(g.x=1-g.x,g.y=1-g.y)),o.start&&f&&co(this.editor,t,o.start.toId,{...o.start.props,normalizedAnchor:f.toJson()}),o.end&&g&&co(this.editor,t,o.end.toId,{...o.end.props,normalizedAnchor:g.toJson()}),{props:{start:c,end:l,bend:u}}}onDoubleClickHandle(t,r){switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(t){const r=$n(),s=this.editor.getOnlySelectedShape(),i=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),o=lr(this.editor,t);if(!(o!=null&&o.isValid))return null;const a=ec(this.editor,t),c=t.id===this.editor.getOnlySelectedShapeId(),u=this.editor.getEditingShapeId()===t.id||t.props.text;return d.jsxs(d.Fragment,{children:[d.jsx(ys,{style:{minWidth:50,minHeight:50},children:d.jsx(lb,{shape:t,shouldDisplayHandles:i&&(s==null?void 0:s.id)===t.id})}),u&&d.jsx($l,{shapeId:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:Zp(t),lineHeight:zt.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:r[t.props.labelColor].solid,textWidth:a.box.w-Gc*2*t.props.scale,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(t){const r=_l(t.id),s=Yn(t.id+"_clip"),i=lr(this.editor,t);if(!i)return null;const{start:o,end:a}=fi(this.editor,t,i==null?void 0:i.bindings),c=this.editor.getShapeGeometry(t),l=c.bounds,u=t.props.text.trim()?c.children[1]:null;if(y.Equals(o,a))return null;const h=$t[t.props.size]*t.props.scale,p=i.start.arrowhead&&Wc(i,"start",h),f=i.end.arrowhead&&Wc(i,"end",h),g=i.isStraight?mC(i):fC(i),m=p&&i.start.arrowhead!=="arrow"||f&&i.end.arrowhead!=="arrow"||!!u;if(r&&u)return d.jsx("rect",{x:F(u.x),y:F(u.y),width:u.w,height:u.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale});const x=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),b=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow");return d.jsxs("g",{children:[m&&d.jsx("defs",{children:d.jsx(SC,{hasText:t.props.text.trim().length>0,bounds:l,labelBounds:u?u.getBounds():new V(0,0,0,0),as:x&&p?p:"",ae:b&&f?f:""})}),d.jsxs("g",{style:{clipPath:m?`url(#${s})`:void 0,WebkitClipPath:m?`url(#${s})`:void 0},children:[m&&d.jsx("rect",{x:l.minX-100,y:l.minY-100,width:l.width+200,height:l.height+200,opacity:0}),d.jsx("path",{d:g})]}),p&&d.jsx("path",{d:p}),f&&d.jsx("path",{d:f}),u&&d.jsx("rect",{x:F(u.x),y:F(u.y),width:u.w,height:u.h,rx:3.5,ry:3.5})]})}onEditEnd(t){const{id:r,type:s,props:{text:i}}=t;i.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:s,props:{text:i.trimEnd()}}])}toSvg(t,r){r.addExportDef(Rg(t.props.fill)),t.props.text&&r.addExportDef(Ll(t.props.font));const s=Yr(r),i=1/t.props.scale;return d.jsxs("g",{transform:`scale(${i})`,children:[d.jsx(lb,{shape:t,shouldDisplayHandles:!1}),d.jsx(Fl,{fontSize:Zp(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:s[t.props.labelColor].solid,bounds:ec(this.editor,t).box.clone().expandBy(-Gc*t.props.scale),padding:0})]})}getCanvasSvgDefs(){return[Lg(),{key:"arrow:dot",component:S4},{key:"arrow:cross",component:x4}]}getInterpolatedProps(t,r,s){return{...s>.5?r.props:t.props,scale:_e(t.props.scale,r.props.scale,s),start:{x:_e(t.props.start.x,r.props.start.x,s),y:_e(t.props.start.y,r.props.start.y,s)},end:{x:_e(t.props.end.x,r.props.end.x,s),y:_e(t.props.end.y,r.props.end.y,s)},bend:_e(t.props.bend,r.props.bend,s),labelPosition:_e(t.props.labelPosition,r.props.labelPosition,s)}}}v(tc,"type","arrow"),v(tc,"props",a0),v(tc,"migrations",c0);function yC(n,e){const t=lr(n,e);return t.isStraight?y.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const lb=Et(function({shape:e,shouldDisplayHandles:t}){const r=z(),s=$n(),i=lr(r,e),o=V.ZeroFix(r.getShapeGeometry(e).bounds),a=rn(r,e),c=N("force solid",()=>r.getZoomLevel()<.2,[r]),l=Yn(e.id+"_clip"),u=Yn("arrowhead-dot"),h=Yn("arrowhead-cross");if(!(i!=null&&i.isValid))return null;const p=$t[e.props.size]*e.props.scale,f=i.start.arrowhead&&Wc(i,"start",p),g=i.end.arrowhead&&Wc(i,"end",p),m=i.isStraight?mC(i):fC(i);let x=null;if(t){const E=2/r.getZoomLevel(),{strokeDasharray:T,strokeDashoffset:C}=Hn(yC(r,e),E,{end:"skip",start:"skip",lengthRatio:2.5});x=a.start||a.end?d.jsx("path",{className:"tl-arrow-hint",d:i.isStraight?y4(i):m4(i),strokeDasharray:T,strokeDashoffset:C,strokeWidth:E,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?`url(#${h})`:`url(#${u})`:"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?`url(#${h})`:`url(#${u})`:"",opacity:.16}):null}const{strokeDasharray:b,strokeDashoffset:S}=Hn(i.isStraight?i.length:Math.abs(i.bodyArc.length),p,{style:e.props.dash,forceSolid:c}),P=ec(r,e),w=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),I=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow");return d.jsxs(d.Fragment,{children:[d.jsx("defs",{children:d.jsx("clipPath",{id:l,children:d.jsx(SC,{hasText:e.props.text.trim().length>0,bounds:o,labelBounds:P.box,as:w&&f?f:"",ae:I&&g?g:""})})}),d.jsxs("g",{fill:"none",stroke:s[e.props.color].solid,strokeWidth:p,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[x,d.jsxs("g",{style:{clipPath:`url(#${l})`,WebkitClipPath:`url(#${l})`},children:[d.jsx("rect",{x:F(o.minX-100),y:F(o.minY-100),width:F(o.width+200),height:F(o.height+200),opacity:0}),d.jsx("path",{d:m,strokeDasharray:b,strokeDashoffset:S})]}),f&&w&&e.props.fill!=="none"&&d.jsx(Dt,{theme:s,d:f,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),g&&I&&e.props.fill!=="none"&&d.jsx(Dt,{theme:s,d:g,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),f&&d.jsx("path",{d:f}),g&&d.jsx("path",{d:g})]})]})});function SC({hasText:n,bounds:e,labelBounds:t,as:r,ae:s}){const i=`M${F(e.minX-100)},${F(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,o=`M${F(t.minX)},${F(t.minY)} v${t.height} h${t.width} v-${t.height} Z`;return d.jsx("path",{d:`${i}${n?o:""}${r}${s}`})}const db=new WeakMap;function S4(){const n=Yn("arrowhead-dot");return d.jsx("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:d.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function x4(){const n=Yn("arrowhead-cross");return d.jsxs("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[d.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),d.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const ub="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function _i({url:n}){const e=z(),t=N("zoomLevel",()=>e.getZoomLevel()<.32,[e]);return d.jsx("a",{className:se("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:ut,onPointerUp:ut,title:n,draggable:!1,children:d.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${ub}") center 100% / 100% no-repeat`,WebkitMask:`url("${ub}") center 100% / 100% no-repeat`}})})}const hb="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",b4=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Yc(n){return b4.map(t=>{const{offsetX:r,offsetY:s,blur:i,spread:o,color:a}=t,c=new y(r,s),{x:l,y:u}=c.rot(-n);return`${l}px ${u}px ${i}px ${o}px ${a}`}).join(", ")}const w4=300,xC=320,v4=46,P4=101;class nc extends Ui{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:w4,h:xC,assetId:null}}component(e){return d.jsx(I4,{shape:e,util:this})}indicator(e){return d.jsx("rect",{width:F(e.props.w),height:F(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return pb(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(vn.isValid(t.props.url))_4(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return pb(this.editor,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:_e(e.props.w,t.props.w,r),h:_e(e.props.h,t.props.h,r)}}}v(nc,"type","bookmark"),v(nc,"props",f0),v(nc,"migrations",g0);function I4({shape:n,util:e}){const t=n.props.assetId?e.editor.getAsset(n.props.assetId):null,r=!!ta()&&Be.isSafari,s=e.editor.getShapePageTransform(n).rotation(),i=C4(n),[o,a]=_.useState(!0),c=()=>a(!1);return d.jsx(gs,{children:d.jsxs("div",{className:se("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:Yc(s),maxHeight:n.props.h},children:[(!t||t.props.image)&&d.jsxs("div",{className:"tl-bookmark__image_container",children:[t?d.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t==null?void 0:t.props.image,alt:(t==null?void 0:t.props.title)||""}):d.jsx("div",{className:"tl-bookmark__placeholder"}),(t==null?void 0:t.props.image)&&d.jsx(_i,{url:n.props.url})]}),d.jsxs("div",{className:"tl-bookmark__copy_container",children:[t!=null&&t.props.title?d.jsx("h2",{className:"tl-bookmark__heading",children:bF(t.props.title)}):null,t!=null&&t.props.description&&(t!=null&&t.props.image)?d.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,d.jsxs("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:ut,onPointerUp:ut,onClick:ut,children:[o&&(t!=null&&t.props.favicon)?d.jsx("img",{className:"tl-bookmark__favicon",src:t==null?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:c,alt:`favicon of ${i}`}):d.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${hb}") center 100% / 100% no-repeat`,WebkitMask:`url("${hb}") center 100% / 100% no-repeat`}}),d.jsx("span",{children:i})]})]})]})})}function pb(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let r=xC;return t&&(t.props.image||(t.props.title?r=P4:r=v4)),{...e,props:{...e.props,h:r}}}const C4=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function _4(n,e){const{url:t}=e.props,r=os.createId(hp(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),E4(n,e))}const E4=Zc(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.run(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function Gs(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,s=n[1].point;if(t===2)return`M${ke(r)}L${ke(s)}`;let i="";for(let o=2,a=t-1;o<a;o++)r=n[o].point,s=n[o+1].point,i+=nn(r,s);return e?`M${nn(n[0].point,n[1].point)}Q${ke(n[1].point)}${nn(n[1].point,n[2].point)}T${i}${nn(n[t-1].point,n[0].point)}${nn(n[0].point,n[1].point)}Z`:`M${ke(n[0].point)}Q${ke(n[1].point)}${nn(n[1].point,n[2].point)}${n.length>3?"T":""}${i}L${ke(n[t-1].point)}`}function T4(n,e={}){const{start:t={},end:r={}}=e,{cap:s=!0}=t,{cap:i=!0}=r;De(!t.taper&&!r.taper,"cap taper not supported here"),De(!t.easing&&!r.easing,"cap easing not supported here"),De(s&&i,"cap must be true");const o=xr(n,e);Ol(o,e);const a=k4(o);let c="";for(const l of a)c+=M4(l,e);return c}function k4(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],r=y.Sub(n[1].point,n[0].point).uni(),s,i,o,a,c;for(let l=1,u=n.length;l<u-1;l++){if(o=n[l-1],a=n[l],c=n[l+1],s=y.Sub(c.point,a.point).uni(),i=y.Dpr(r,s),r=s,i<-.8){const h={...a,point:a.input};t.push(h),e.push(Rh(t)),t=[h];continue}if(t.push(a),!(i>.7)&&(y.Dist2(o.point,a.point)+y.Dist2(a.point,c.point))/((o.radius+a.radius+c.radius)/3)**2<1.5){t.push(a),e.push(Rh(t)),t=[a];continue}}return t.push(n[n.length-1]),e.push(Rh(t)),e}function Rh(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],y.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const r=n[n.length-1];let s;for(;n.length>2&&(s=n[n.length-2],y.Dist2(r.point,s.point)<((r.radius+s.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:y.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:y.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function j4(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function M4(n,e={}){if(n.length===0)return"";if(n.length===1)return j4(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=QI(n,e);r.reverse();let s=`M${ke(t[0])}T`;for(let i=1;i<t.length;i++)s+=nn(t[i-1],t[i]);{const i=n[n.length-1],o=i.radius,a=i.vector.clone().per().neg(),c=y.Add(i.point,y.Mul(a,o)),l=y.Add(i.point,y.Mul(a,-o));s+=`${ke(c)}A${F(o)},${F(o)} 0 0 1 ${ke(l)}T`}for(let i=1;i<r.length;i++)s+=nn(r[i-1],r[i]);{const i=n[0],o=i.radius,a=i.vector.clone().per(),c=y.Add(i.point,y.Mul(a,o)),l=y.Add(i.point,y.Mul(a,-o));s+=`${ke(c)}A${F(o)},${F(o)} 0 0 1 ${ke(l)}Z`}return s}const bC=(n,e,t)=>{const r=[],s=[];n.forEach(l=>r.push(...l.points)),e.forEach(l=>s.push(...l.points));const i=Math.max(r.length,s.length),o=[],a=[];for(let l=0;l<i;l++)o.push(r[l]||r[r.length-1]),a.push(s[l]||s[s.length-1]);return[{type:"free",points:o.map((l,u)=>{let h=.5;return a[u].z!==void 0&&l.z!==void 0&&(h=_e(l.z,a[u].z,t)),{x:_e(l.x,a[u].x,t),y:_e(l.y,a[u].y,t),z:h}})}]},A4=n=>n*.65+KM(n*je/2)*.35,D4=n=>({size:n,thinning:.5,streamline:vi(n,[9,16],[.64,.74],!0),smoothing:.62,easing:yt.easeOutSine,simulatePressure:!0}),O4=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:A4}),fb=n=>({size:n,thinning:0,streamline:vi(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:yt.linear}),R4=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:yt.linear});function zg({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:yt.easeOutSine,last:e}}function Jp(n,e,t,r){const s=n.isComplete||t;return r?n.isPen?{...R4(e),last:s}:{...fb(e),last:s}:n.dash==="draw"?n.isPen?{...O4(e),last:s}:{...D4(e),last:s}:{...fb(e),last:s}}function Ei(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(y.Cast));else{const r=Math.max(4,Math.floor(y.Dist(t.points[0],t.points[1])/16));e.push(...y.PointsBetween(t.points[0],t.points[1],r))}return e}function L4(n,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class rc extends Vn{hideResizeHandles(e){return Lh(e)}hideRotateHandle(e){return Lh(e)}hideSelectionBoundsFg(e){return Lh(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=Ei(e.props.segments),r=($t[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const i=V.FromPoints(t);if(i.width<r*2&&i.height<r*2)return new Cg({x:-r,y:-r,radius:r,isFilled:!0})}const s=xr(t,Jp(e.props,r,e.props.isPen,!0)).map(i=>i.point);return e.props.isClosed?new at({points:s,isFilled:e.props.fill!=="none"}):new zi({points:s})}component(e){return d.jsx(ys,{children:d.jsx(gb,{shape:e})})}indicator(e){var u;const t=Ei(e.props.segments);let r=($t[e.props.size]+1)*e.props.scale;const s=this.editor.getZoomLevel();!(s<.5&&s<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&t.length===1&&(r+=Jn(e.id)()*(r/6));const o=e.props.isComplete||((u=Pt(e.props.segments))==null?void 0:u.type)==="straight",a=Jp(e.props,r,o,!0),c=xr(t,a),l=c.length>1?Gs(c,e.props.isClosed):wC(t[0],r);return d.jsx("path",{d:l})}toSvg(e,t){t.addExportDef(Rg(e.props.fill));const r=1/e.props.scale;return d.jsx("g",{transform:`scale(${r})`,children:d.jsx(gb,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[Lg()]}onResize(e,t){const{scaleX:r,scaleY:s}=t,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map(({x:a,y:c,z:l})=>({x:Lr(r*a),y:Lr(s*c),z:l}))});return{props:{segments:i}}}expandSelectionOutlinePx(e){const t=e.props.dash==="draw"?1.6:1;return $t[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,segments:bC(e.props.segments,t.props.segments,r),scale:_e(e.props.scale,t.props.scale,r)}}}v(rc,"type","draw"),v(rc,"props",y0),v(rc,"migrations",S0);function wC(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Lh(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function gb({shape:n,zoomOverride:e}){var f;const t=$n(),r=z(),s=Ei(n.props.segments),i=n.props.isComplete||((f=Pt(n.props.segments))==null?void 0:f.type)==="straight";let o=($t[n.props.size]+1)*n.props.scale;const a=N("force solid",()=>{const g=e??r.getZoomLevel();return g<.5&&g<1.5/o},[r,o,e]),c=N("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!n.props.isPen&&n.props.dash==="draw"&&s.length===1&&(o+=Jn(n.id)()*(o/6));const l=Jp(n.props,o,i,a);if(!a&&n.props.dash==="draw")return d.jsxs(d.Fragment,{children:[n.props.isClosed&&n.props.fill&&s.length>1?d.jsx(Dt,{d:Gs(xr(s,l),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,d.jsx("path",{d:T4(s,l),strokeLinecap:"round",fill:t[n.props.color].solid})]});const u=xr(s,l),h=u.length<2,p=h?wC(s[0],0):Gs(u,n.props.isClosed);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{d:p,theme:t,color:n.props.color,fill:h||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),d.jsx("path",{d:p,strokeLinecap:"round",fill:h?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:o,strokeDasharray:h?"none":L4(n,o,c),strokeDashoffset:"0"})]})}function F4(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function $4(n,e){const t=pe(e);if(!t)return;const r=t.host.replace("www.","");for(const s of n)if(vC(s.hostnames,r)){const i=s.fromEmbedUrl(e);if(i)return{definition:s,url:i,embedUrl:e}}}const z4=n=>n.split("*").map(e=>F4(e)).join(".+"),vC=(n,e)=>!!n.find(t=>{const r=new RegExp(z4(t));return e.match(r)});function N4(n,e){const t=pe(e);if(!t)return;const r=t.host.replace("www.","");for(const s of n)if(vC(s.hostnames,r)){const i=s.toEmbedUrl(e);if(i)return{definition:s,embedUrl:i,url:e}}}function B4(n,e){try{return N4(n,e)??$4(n,e)}catch{return}}const U4=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" ");class sc extends Ui{constructor(){super(...arguments);v(this,"embedDefinitions",Tg)}setEmbedDefinitions(t){this.embedDefinitions=t}getEmbedDefinitions(){return this.embedDefinitions}getEmbedDefinition(t){return B4(this.embedDefinitions,t)}getText(t){return t.props.url}hideSelectionBoundsFg(t){return!this.canResize(t)}canEdit(){return!0}canResize(t){var r,s;return!!((s=(r=this.getEmbedDefinition(t.props.url))==null?void 0:r.definition)!=null&&s.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(t){const r=this.getEmbedDefinition(t.props.url);return(r==null?void 0:r.definition.isAspectRatioLocked)??!1}onResize(t,r){const s=this.isAspectRatioLocked(t),i=this.getEmbedDefinition(t.props.url);let o=(i==null?void 0:i.definition.minWidth)??200,a=(i==null?void 0:i.definition.minHeight)??200;if(s){const c=t.props.w/t.props.h;c>1?o*=c:a/=c}return Cl(t,r,{minWidth:o,minHeight:a})}component(t){const r=ta(),{w:s,h:i,url:o}=t.props,a=_l(t.id),c=this.getEmbedDefinition(o),l=N("is hovering",()=>{const{editingShapeId:g,hoveredShapeId:m}=this.editor.getCurrentPageState();if(g&&m!==g){const x=this.editor.getShape(g);if(x&&this.editor.isShapeOfType(x,"embed"))return!0}return!1},[]),u=this.editor.getShapePageTransform(t).rotation();if(r)return d.jsx(gs,{className:"tl-embed-container",id:t.id,children:d.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:Yc(u),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:(c==null?void 0:c.definition.backgroundColor)??"var(--color-background)",width:s,height:i}})});const h=a||l;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(c==null?void 0:c.definition.type)==="tldraw")return null;if((c==null?void 0:c.definition.type)==="github_gist"){const g=c.url.split("/").pop();if(!g)throw Error("No gist id!");return d.jsx(gs,{className:"tl-embed-container",id:t.id,children:d.jsx(H4,{id:g,width:F(s),height:F(i),isInteractive:h,pageRotation:u})})}const f=U4({...bR,...(c==null?void 0:c.definition.overridePermissions)??{}});return d.jsx(gs,{className:"tl-embed-container",id:t.id,children:c!=null&&c.definition?d.jsx("iframe",{className:"tl-embed",sandbox:f,src:c.embedUrl,width:F(s),height:F(i),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:h?"auto":"none",zIndex:h?"":"-1",boxShadow:Yc(u),borderRadius:(c==null?void 0:c.definition.overrideOutlineRadius)??8,background:c==null?void 0:c.definition.backgroundColor}}):null})}indicator(t){const r=this.getEmbedDefinition(t.props.url);return d.jsx("rect",{width:F(t.props.w),height:F(t.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}getInterpolatedProps(t,r,s){return{...s>.5?r.props:t.props,w:_e(t.props.w,r.props.w,s),h:_e(t.props.h,r.props.h,s)}}}v(sc,"type","embed"),v(sc,"props",x0),v(sc,"migrations",b0);function H4({id:n,file:e,isInteractive:t,width:r,height:s,style:i,pageRotation:o}){return d.jsx("iframe",{className:"tl-embed",draggable:!1,width:F(r),height:F(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...i,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:Yc(o)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function Qp(n,e){const s=((Ls(n.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(s)}function mb(n,e,t){const r=n.textMeasure.measureTextSpans(IC(e.props.name,"Frame")+"​",t),s=r[0],i=Pt(r),o=i.box.w+i.box.x-s.box.x;return{box:new V(0,-t.height,o,t.height),spans:r}}function yb(n,e){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:e,offsetY:-34,offsetX:2}}function PC(n,e,t){const r=t?"":"px",s=t?"":"deg";let i;switch(e){case 0:i="";break;case 3:i=`translate(${F(n.props.w)}${r}, 0${r}) rotate(90${s})`;break;case 2:i=`translate(${F(n.props.w)}${r}, ${F(n.props.h)}${r}) rotate(180${s})`;break;case 1:i=`translate(0${r}, ${F(n.props.h)}${r}) rotate(270${s})`;break;default:throw Error("labelSide out of bounds")}return i}const K4=_.forwardRef(({id:n,name:e,isEditing:t},r)=>{const s=z(),i=_.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(ut(c),c.currentTarget.blur(),s.setEditingShape(null))},[s]),o=_.useCallback(c=>{const l=s.getShape(n);if(!l)return;const u=l.props.name,h=c.currentTarget.value.trim();u!==h&&s.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,s]),a=_.useCallback(c=>{const l=s.getShape(n);if(!l)return;const u=l.props.name,h=c.currentTarget.value;u!==h&&s.updateShapes([{id:n,type:"frame",props:{name:h}}])},[n,s]);return d.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[d.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:i,onBlur:o,onChange:a}),IC(e,"Frame")+"​"]})});function q4({id:n,name:e,width:t,height:r}){const s=z(),{side:i,translation:o}=N("shape rotation",()=>{const l=s.getShape(n);if(!l)return{side:0,translation:"translate(0, 0)"};const u=Qp(s,l);return{side:u,translation:PC(l,u,!1)}},[s,n]),a=_.useRef(null),c=_l(n);return _.useEffect(()=>{const l=a.current;l&&c&&(l.focus(),l.select())},[a,c]),d.jsx("div",{className:"tl-frame-heading",style:{overflow:c?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(i===0||i===2?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${o} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},children:d.jsx("div",{className:"tl-frame-heading-hit-area",children:d.jsx(K4,{ref:a,id:n,name:e,isEditing:c})})})}function IC(n,e){return n.match(/^\s*$/)?e:n}class ic extends Ui{canEdit(){return!0}getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){const{editor:t}=this,r=t.getZoomLevel(),s=yb(e,"black"),i=mb(t,e,s),o=Qp(t,e);let a,c,l,u;const{w:h,h:p}=i.box,f=Math.min(h,e.props.w*r),g=Math.min(p,e.props.h*r);switch(o){case 0:{a=-8/r,c=(-p-4)/r,l=(f+16)/r,u=p/r;break}case 1:{a=(-p-4)/r,u=(g+16)/r,c=e.props.h-u+8/r,l=p/r;break}case 2:{a=e.props.w-(f+8)/r,c=e.props.h+4/r,l=(g+16)/r,u=p/r;break}case 3:{a=e.props.w+4/r,u=(g+16)/r,c=-8/r,l=p/r;break}}return new Rn({children:[new yr({width:e.props.w,height:e.props.h,isFilled:!1}),new yr({x:a,y:c,width:l,height:u,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=this.editor.getShapeGeometry(e).bounds,r=$n(),s=N("is creating this shape",()=>{const i=this.editor.getStateDescendant("select.resizing");if(!i||!i.getIsActive())return!1;const o=i==null?void 0:i.info;return o?o.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return d.jsxs(d.Fragment,{children:[d.jsx(ys,{children:d.jsx("rect",{className:se("tl-frame__body",{"tl-frame__creating":s}),width:t.width,height:t.height,fill:r.solid,stroke:r.text})}),s?null:d.jsx(q4,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const r=Yr({isDarkMode:t.isDarkMode}),s=Qp(this.editor,e),i=PC(e,s,!0),o=yb(e,r.text),{box:a,spans:c}=mb(this.editor,e,o),l=Xp(this.editor,c,o);return d.jsxs(d.Fragment,{children:[d.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),d.jsxs("g",{transform:i,children:[d.jsx("rect",{x:a.x-8,y:a.y-4,width:a.width+20,height:a.height,fill:r.background,rx:4,ry:4}),l]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return d.jsx("rect",{width:F(t.width),height:F(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every(r=>r.parentId===e.id)||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(t,r.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return Cl(e,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:_e(e.props.w,t.props.w,r),h:_e(e.props.h,t.props.h,r)}}}v(ic,"type","frame"),v(ic,"props",w0),v(ic,"migrations",v0);function Sb(n,e){return n>e?(je*(e/2)+(n-e))*2:(je*(n/2)+(e-n))*2}function CC(n,e){return Ng(n,e).map((t,r)=>t.getSvgPathData(r===0)).join(" ")+" Z"}function G4(n,e,t,r){const s=n/4,i=e/4,o=Jn(r),a=t*.75,c=S=>S.addXY(o()*a,o()*a),l=new y(n/2,e),u=new y(0,i*1.2),h=new y(n/2,i*.9),p=new y(n,i*1.2),f=c(new y(n/2,e)),g=c(new y(0,i*1.2)),m=c(new y(n/2,i*.9)),x=c(new y(n,i*1.2));return[new Ot({start:l,cp1:new y(s*1.5,i*3),cp2:new y(0,i*2.5),end:u}),new Ot({start:u,cp1:new y(0,-i*.32),cp2:new y(s*1.85,-i*.32),end:h}),new Ot({start:h,cp1:new y(s*2.15,-i*.32),cp2:new y(n,-i*.32),end:p}),new Ot({start:p,cp1:new y(n,i*2.5),cp2:new y(s*2.5,i*3),end:f}),new Ot({start:f,cp1:new y(s*1.5,i*3),cp2:new y(0,i*2.5),end:g}),new Ot({start:g,cp1:new y(0,-i*.32),cp2:new y(s*1.85,-i*.32),end:m}),new Ot({start:m,cp1:new y(s*2.15,-i*.32),cp2:new y(n,-i*.32),end:x}),new Ot({start:x,cp1:new y(n,i*2.5),cp2:new y(s*2.5,i*3),end:l})].map((S,P)=>S.getSvgPathData(P===0)).join(" ")+" Z"}function Ng(n,e){const t=n/4,r=e/4;return[new Ot({start:new y(n/2,e),cp1:new y(t*1.5,r*3),cp2:new y(0,r*2.5),end:new y(0,r*1.2)}),new Ot({start:new y(0,r*1.2),cp1:new y(0,-r*.32),cp2:new y(t*1.85,-r*.32),end:new y(n/2,r*.9)}),new Ot({start:new y(n/2,r*.9),cp1:new y(t*2.15,-r*.32),cp2:new y(n,-r*.32),end:new y(n,r*1.2)}),new Ot({start:new y(n,r*1.2),cp1:new y(n,r*2.5),cp2:new y(t*2.5,r*3),end:new y(n/2,e)})]}function W4(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function Y4(n,e,t,r){const s=Jn(n),i=e/2,o=t/2,a=B0(i,o),c=[],l=Le*s(),u=Le+Ke/2+Math.abs(s())*Ke,h=Math.max(16,a/10);for(let p=0;p<h;p++){const f=p/(h-1),g=l+f*u,m=Math.cos(g),x=Math.sin(g);c.push(new y(i*m+e*.5+.05*s(),o*x+t/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?yt.easeInOutSine(f):yt.easeInExpo(f)))/2)))}return xr(c,W4(r))}function V4(n,e,t,r){return Gs(Y4(n,e,t,r))}function ef(n){let e="M";const t=n.length;let r,s,i;for(let o=0,a=t;o<a;o+=3)r=n[o],s=n[o+1],i=n[o+2],e+=`${ke(r)}L${ke(s)}Q${ke(i)}`;return e+=`${ke(n[0])}`,e}function tf(n,e,t,r,s){const i=[],o=Jn(n);let a=e[0],c;const l=e.length;for(let u=0,h=l*s;u<h;u++){c=y.AddXY(e[(u+1)%l],o()*t,o()*t);const p=y.Sub(c,a),f=y.Len(p),g=y.Div(p,f).mul(Math.min(f/4,r));i.push(y.Add(a,g),y.Add(c,g.neg()),c),a=c}return i}function X4(n,e,t){const r=Math.min(n,e)/2,s=Math.max(n,e)-r*2,o=(Math.PI*(r*2)+2*s)/t,a=n>e?[{type:"straight",start:new y(r,0),delta:new y(1,0)},{type:"arc",center:new y(n-r,r),startAngle:-je/2},{type:"straight",start:new y(n-r,e),delta:new y(-1,0)},{type:"arc",center:new y(r,r),startAngle:je/2}]:[{type:"straight",start:new y(n,r),delta:new y(0,1)},{type:"arc",center:new y(r,e-r),startAngle:0},{type:"straight",start:new y(0,e-r),delta:new y(0,-1)},{type:"arc",center:new y(r,r),startAngle:je}];let c=0;const l=[];for(let u=0;u<t;u++){const h=a[0];h.type==="straight"?l.push(y.Add(h.start,y.Mul(h.delta,c))):l.push(Us(h.center,r,h.startAngle+c/r)),c+=o;let p=h.type==="straight"?s:je*r;for(;c>p;)c-=p,a.push(a.shift()),p=a[0].type==="straight"?s:je*r}return l}const Z4={s:50,m:70,l:100,xl:130},J4=.2;function zl(n,e,t,r,s){const i=Jn(t),o=Sb(n,e),a=Math.max(Math.ceil(o/Z4[r]),6,Math.ceil(o/Math.min(n,e))),c=o/a*J4,l=Math.max(n-c*2,1),u=Math.max(e-c*2,1),p=Sb(l,u)/a,f=(n-l)/2,g=(e-u)/2,m=X4(l,u,a).map(w=>w.addXY(f,g)),x=n<20?0:c*.3,b=e<20?0:c*.3,S=m.slice(0);for(let w=0;w<Math.floor(a/2);w++)S[w]=y.AddXY(S[w],i()*x*s,i()*b*s),S[a-w-1]=y.AddXY(S[a-w-1],i()*x*s,i()*b*s);const P=[];for(let w=0;w<S.length;w++){const I=w===S.length-1?0:w+1,E=S[w],T=S[I],C=m[w],j=m[I],k=y.Dist(C,j),R=p-k,D=y.Dist(E,T)/k,O=(Math.max(f,g)+R)*D,$=y.Lrp(C,j,.5).add(y.Sub(j,C).uni().per().mul(O));$.x<0?$.x=0:$.x>n&&($.x=n),$.y<0?$.y=0:$.y>e&&($.y=e);const B=ng(E,T,$),G=y.Dist(B||y.Average([E,T]),E);P.push({leftPoint:E,rightPoint:T,arcPoint:$,center:B,radius:G})}return P}function Q4(n,e,t,r,s){const i=[],o=zl(n,e,t,r,s);for(const{center:a,radius:c,leftPoint:l,rightPoint:u}of o)i.push(...YM(l,u,a,c,10));return i}function nf(n,e,t,r,s){const i=zl(n,e,t,r,s);let o=`M${i[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:c,radius:l,center:u}of i){if(u===null){o+=` L${c.toFixed()}`;continue}const h=y.Clockwise(a,c,u)?"0":"1";o+=` A${F(l)},${F(l)} 0 ${h},1 ${c.toFixed()}`}return o+=" Z",o}const e6={s:.5,m:.7,l:.9,xl:1.6};function t6(n,e,t,r,s){const i=Jn(t),o=e6[r]*s,a=zl(n,e,t,r,s),u=a.reduce((g,m)=>g+y.Dist2(m.leftPoint,m.rightPoint),0)/a.length>(o*15)**2?g=>y.AddXY(g,i()*o*2,i()*o*2):g=>g;let h=`M${a[0].leftPoint.toFixed()}`,p=u(a[0].leftPoint),f=`M${p.toFixed()}`;for(const{leftPoint:g,center:m,rightPoint:x,radius:b,arcPoint:S}of a){if(m===null){h+=` L${x.toFixed()}`;const C=u(x);f+=` L${C.toFixed()}`,p=C;continue}const P=y.Clockwise(g,x,m)?"0":"1";h+=` A${F(b)},${F(b)} 0 ${P},1 ${x.toFixed()}`;const w=u(x),I=u(S),E=ng(p,w,I);if(!E){f+=` L${w.toFixed()}`,p=w;continue}const T=Math.abs(y.Dist(E,p));f+=` A${F(T)},${F(T)} 0 ${P},1 ${w.toFixed()}`,p=w}return h+f+" Z"}function rf(n,e){switch(n.geo){case"x-box":return n6(n.w,n.h,e,n.dash);case"check-box":return r6(n.w,n.h);default:return}}function n6(n,e,t,r){const s=r==="draw"?.62:0;if(r==="dashed")return[[new y(0,0),new y(n/2,e/2)],[new y(n,e),new y(n/2,e/2)],[new y(0,e),new y(n/2,e/2)],[new y(n,0),new y(n/2,e/2)]];const i=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new y(i(t*s),o(t*s)),new y(i(n-t*s),o(e-t*s))],[new y(i(t*s),o(e-t*s)),new y(i(n-t*s),o(t*s))]]}function r6(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,s=(e-t)/2,i=a=>Math.max(0,Math.min(n,a)),o=a=>Math.max(0,Math.min(e,a));return[[new y(i(r+t*.25),o(s+t*.52)),new y(i(r+t*.45),o(s+t*.82))],[new y(i(r+t*.45),o(s+t*.82)),new y(i(r+t*.82),o(s+t*.22))]]}function xb({shape:n,shouldScale:e,forceSolid:t}){const r=e?n.props.scale:1,s=z(),i=$n(),{id:o,props:a}=n,{w:c,color:l,fill:u,dash:h,growY:p,size:f,scale:g}=a,m=$t[f]*r,x=a.h+p;switch(a.geo){case"cloud":if(h==="solid"){const b=nf(c,x,o,f,g);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:b,color:l,fill:u,scale:r}),d.jsx("path",{d:b,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else if(h==="draw"){const b=t6(c,x,o,f,g);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:b,color:l,fill:u,scale:r}),d.jsx("path",{d:b,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else{const b=nf(c,x,o,f,g),S=zl(c,x,o,f,g);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:b,color:l,fill:u,scale:r}),d.jsx("g",{strokeWidth:m,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:S.map(({leftPoint:P,rightPoint:w,center:I,radius:E},T)=>{const C=I?E*Ls(Ls(y.Angle(I,w))-Ls(y.Angle(I,P))):y.Dist(P,w),{strokeDasharray:j,strokeDashoffset:k}=Hn(C,m,{style:h,start:"outset",end:"outset",forceSolid:t});return d.jsx("path",{d:I?`M${P.x},${P.y}A${E},${E},0,0,1,${w.x},${w.y}`:`M${P.x},${P.y}L${w.x},${w.y}`,strokeDasharray:j,strokeDashoffset:k},T)})})]})}case"ellipse":{const b=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),S=b.getSvgPathData(!0);if(h==="dashed"||h==="dotted"){const P=b.length,{strokeDasharray:w,strokeDashoffset:I}=Hn(P<64?P*2:P,m,{style:h,snap:4,closed:!0,forceSolid:t});return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:S,color:l,fill:u,scale:r}),d.jsx("path",{d:S,strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:w,strokeDashoffset:I})]})}else{const w=(e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:w,color:l,fill:u,scale:r}),d.jsx("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}}case"oval":{const b=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),S=b.getSvgPathData(!0);if(h==="dashed"||h==="dotted"){const P=b.getLength(),{strokeDasharray:w,strokeDashoffset:I}=Hn(P<64?P*2:P,m,{style:h,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:t});return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:S,color:l,fill:u,scale:r}),d.jsx("path",{d:S,strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:w,strokeDashoffset:I})]})}else return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:S,color:l,fill:u,scale:r}),d.jsx("path",{d:S,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}case"heart":if(h==="dashed"||h==="dotted"||h==="solid"){const b=CC(c,x),S=Ng(c,x);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:b,color:l,fill:u,scale:r}),S.map((P,w)=>{const{strokeDasharray:I,strokeDashoffset:E}=Hn(P.length,m,{style:h,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:t});return d.jsx("path",{d:P.getSvgPathData(),strokeWidth:m,fill:"none",stroke:i[l].solid,strokeDasharray:I,strokeDashoffset:E,pointerEvents:"all"},`curve_${w}`)})]})}else{const b=G4(c,x,m,n.id);return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:b,color:l,fill:u,scale:r}),d.jsx("path",{d:b,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}default:{const b=e?s.getShapeGeometry(n):s.getShapeUtil(n).getGeometry(n),S=b instanceof Rn?b.children[0].vertices:b.vertices,P=rf(n.props,m);if(h==="solid"){let w="M"+S[0]+"L"+S.slice(1)+"Z";if(P)for(const[I,E]of P)w+=`M${I.x},${I.y}L${E.x},${E.y}`;return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:w,color:l,fill:u,scale:r}),d.jsx("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}else if(h==="dashed"||h==="dotted"){const w="M"+S[0]+"L"+S.slice(1)+"Z";return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:w,color:l,fill:u,scale:r}),d.jsxs("g",{strokeWidth:m,stroke:i[l].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(S.length)).map((I,E)=>{const T=y.ToFixed(S[E]),C=y.ToFixed(S[(E+1)%S.length]),j=y.Dist(T,C),{strokeDasharray:k,strokeDashoffset:R}=Hn(j,m,{style:h,start:"outset",end:"outset",forceSolid:t});return d.jsx("line",{x1:T.x,y1:T.y,x2:C.x,y2:C.y,strokeDasharray:k,strokeDashoffset:R},E)}),P&&P.map(([I,E],T)=>{const C=y.Dist(I,E),{strokeDasharray:j,strokeDashoffset:k}=Hn(C,m,{style:h,start:"skip",end:"skip",snap:h==="dotted"?4:void 0,forceSolid:t});return d.jsx("path",{d:`M${I.x},${I.y}L${E.x},${E.y}`,stroke:i[l].solid,strokeWidth:m,fill:"none",strokeDasharray:j,strokeDashoffset:k},`line_fg_${T}`)})]})]})}else if(h==="draw"){let w=ef(tf(o,S,m/3,m*2,2));if(P)for(const[E,T]of P)w+=`M${E.toFixed()}L${T.toFixed()}`;const I=ef(tf(o,S,0,m*2,1));return d.jsxs(d.Fragment,{children:[d.jsx(Dt,{theme:i,d:I,color:l,fill:u,scale:r}),d.jsx("path",{d:w,stroke:i[l].solid,strokeWidth:m,fill:"none"})]})}}}}const bb=51;class oc extends Ui{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),s=t/2,i=r/2,o=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new at({points:Q4(t,r,e.id,e.props.size,e.props.scale),isFilled:o});break}case"triangle":{a=new at({points:[new y(s,0),new y(t,r),new y(0,r)],isFilled:o});break}case"diamond":{a=new at({points:[new y(s,0),new y(t,i),new y(s,r),new y(0,i)],isFilled:o});break}case"pentagon":{a=new at({points:oh(t,r,5),isFilled:o});break}case"hexagon":{a=new at({points:oh(t,r,6),isFilled:o});break}case"octagon":{a=new at({points:oh(t,r,8),isFilled:o});break}case"ellipse":{a=new iR({width:t,height:r,isFilled:o});break}case"oval":{a=new oR({width:t,height:r,isFilled:o});break}case"star":{const S=Le/5/2,P=Math.floor(5/4)*2,w=10-P,I=0,E=Math.floor(5/2)*2,T=Math.cos(-Ke+P*S)*t/2,C=Math.cos(-Ke+w*S)*t/2,j=Math.sin(-Ke+I*S)*r/2,k=Math.sin(-Ke+E*S)*r/2,R=t-Math.abs(T-C),A=r-Math.abs(k-j),D=t/2+C-(t/2-T),O=r/2+j-(r/2-k),$=1,B=(t-D)/2,G=(r-O)/2,Y=(t+R)/2,ne=(r+A)/2,de=Y*$/2,ae=ne*$/2;a=new at({points:Array.from(Array(10)).map((Oe,ce)=>{const Ne=-Ke+ce*S;return new y(B+(ce%2?de:Y)*Math.cos(Ne),G+(ce%2?ae:ne)*Math.sin(Ne))}),isFilled:o});break}case"rhombus":{const b=Math.min(t*.38,r*.38);a=new at({points:[new y(b,0),new y(t,0),new y(t-b,r),new y(0,r)],isFilled:o});break}case"rhombus-2":{const b=Math.min(t*.38,r*.38);a=new at({points:[new y(0,0),new y(t-b,0),new y(t,r),new y(b,r)],isFilled:o});break}case"trapezoid":{const b=Math.min(t*.38,r*.38);a=new at({points:[new y(b,0),new y(t-b,0),new y(t,r),new y(0,r)],isFilled:o});break}case"arrow-right":{const b=Math.min(t,r)*.38,S=r*.16;a=new at({points:[new y(0,S),new y(t-b,S),new y(t-b,0),new y(t,r/2),new y(t-b,r),new y(t-b,r-S),new y(0,r-S)],isFilled:o});break}case"arrow-left":{const b=Math.min(t,r)*.38,S=r*.16;a=new at({points:[new y(b,0),new y(b,S),new y(t,S),new y(t,r-S),new y(b,r-S),new y(b,r),new y(0,r/2)],isFilled:o});break}case"arrow-up":{const b=t*.16,S=Math.min(t,r)*.38;a=new at({points:[new y(t/2,0),new y(t,S),new y(t-b,S),new y(t-b,r),new y(b,r),new y(b,S),new y(0,S)],isFilled:o});break}case"arrow-down":{const b=t*.16,S=Math.min(t,r)*.38;a=new at({points:[new y(b,0),new y(t-b,0),new y(t-b,r-S),new y(t,r-S),new y(t/2,r),new y(0,r-S),new y(b,r-S)],isFilled:o});break}case"check-box":case"x-box":case"rectangle":{a=new yr({width:t,height:r,isFilled:o});break}case"heart":{const S=Ng(t,r).reduce((P,w)=>(P.push(...w.vertices),P),[]);a=new at({points:S,isFilled:o});break}default:mt(e.props.geo)}const c=La(this.editor,e),l=t/e.props.scale,u=r/e.props.scale,h=Math.min(100,l/2),p=Math.min(Ur[e.props.size]*zt.lineHeight+Dn*2,u/2),f=Math.min(l,Math.max(c.w,Math.min(h,Math.max(1,l-8)))),g=Math.min(u,Math.max(c.h,Math.min(p,Math.max(1,u-8)))),m=rf(e.props,$t[e.props.size]*e.props.scale),x=m?m.map(b=>new zi({points:b})):[];return new Rn({children:[a,new yr({x:e.props.align==="start"?0:e.props.align==="end"?(l-f)*e.props.scale:(l-f)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(u-g)*e.props.scale:(u-g)/2*e.props.scale,width:f*e.props.scale,height:g*e.props.scale,isFilled:!0,isLabel:!0}),...x]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),r=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[t.bounds.center]};default:mt(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:r,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:s.trimEnd()}}])}component(e){const{id:t,type:r,props:s}=e,{fill:i,font:o,align:a,verticalAlign:c,size:l,text:u}=s,h=$n(),{editor:p}=this,f=N("isGeoOnlySelected",()=>e.id===p.getOnlySelectedShapeId(),[]),m=p.getEditingShapeId()!==null||e.props.text,x=N("force solid",()=>p.getZoomLevel()<.2,[p]);return d.jsxs(d.Fragment,{children:[d.jsx(ys,{children:d.jsx(xb,{shape:e,shouldScale:!0,forceSolid:x})}),m&&d.jsx(gs,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+s.growY},children:d.jsx($l,{shapeId:t,type:r,font:o,fontSize:Ur[l]*e.props.scale,lineHeight:zt.lineHeight,padding:Dn*e.props.scale,fill:i,align:a,verticalAlign:c,text:u,isSelected:f,labelColor:h[s.labelColor].solid,wrap:!0})}),e.props.url&&d.jsx(_i,{url:e.props.url})]})}indicator(e){const{id:t,props:r}=e,{w:s,size:i}=r,o=r.h+r.growY,a=$t[i],c=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?d.jsx("path",{d:V4(t,s,o,a)}):d.jsx("path",{d:c.getSvgPathData(!0)});case"heart":return d.jsx("path",{d:CC(s,o)});case"oval":return d.jsx("path",{d:c.getSvgPathData(!0)});case"cloud":return d.jsx("path",{d:nf(s,o,t,i,e.props.scale)});default:{const l=this.editor.getShapeGeometry(e),u=l instanceof Rn?l.children[0].vertices:l.vertices;let h;if(r.dash==="draw"){const f=tf(t,u,0,a*2*e.props.scale,1);h=ef(f)}else h="M"+u[0]+"L"+u.slice(1)+"Z";const p=rf(e.props,a);if(p)for(const[f,g]of p)h+=`M${f.x},${f.y}L${g.x},${g.y}`;return d.jsx("path",{d:h})}}}toSvg(e,t){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},s=r.props;t.addExportDef(Rg(s.fill));let i;if(s.text){t.addExportDef(Ll(s.font));const o=Yr(t),a=new V(0,0,s.w,s.h+s.growY);i=d.jsx(Fl,{fontSize:Ur[s.size],font:s.font,align:s.align,verticalAlign:s.verticalAlign,text:s.text,labelColor:o[s.labelColor].solid,bounds:a,padding:16})}return d.jsxs(d.Fragment,{children:[d.jsx(xb,{shouldScale:!1,shape:r,forceSolid:!1}),i]})}getCanvasSvgDefs(){return[Lg()]}onResize(e,{handle:t,newPoint:r,scaleX:s,scaleY:i,initialShape:o}){const a=o.props.w/o.props.scale,c=o.props.h/o.props.scale,l=o.props.growY/o.props.scale;let u=a*s,h=(c+l)*i,p=0,f=0;const g=bb;if(e.props.text.trim()){let w=Math.max(Math.abs(u),g),I=Math.max(Math.abs(h),g);w<g&&I===g&&(w=g),w===g&&I<g&&(I=g);const E=La(this.editor,{...e,props:{...e.props,w:w*e.props.scale,h:I*e.props.scale}}),T=Math.max(Math.abs(u),E.w)*Math.sign(u),C=Math.max(Math.abs(h),E.h)*Math.sign(h);p=Math.abs(T)-Math.abs(u),f=Math.abs(C)-Math.abs(h),u=T,h=C}const m=u*e.props.scale,x=h*e.props.scale,b=new y(0,0);s<0&&(b.x+=m),(t==="left"||t==="top_left"||t==="bottom_left")&&(b.x+=s<0?p:-p),i<0&&(b.y+=x),(t==="top"||t==="top_left"||t==="top_right")&&(b.y+=i<0?f:-f);const{x:S,y:P}=b.rot(e.rotation).add(r);return{x:S,y:P,props:{w:Math.max(Math.abs(m),1),h:Math.max(Math.abs(x),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,r=La(this.editor,e).h;let s=null;if(r>t?s=r-t:e.props.growY&&(s=0),s!==null)return{...e,props:{...e.props,growY:s*e.props.scale}}}onBeforeUpdate(e,t){const r=e.props.text,s=t.props.text;if(r===s&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(r&&!s)return{...t,props:{...t.props,growY:0}};const i=e.props.w/e.props.scale,o=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,c=La(this.editor,t);if(!r&&s&&s.length===1){let u=Math.max(i,c.w),h=Math.max(o,c.h);const p=bb;return i<p&&o<p&&(u=Math.max(u,p),h=Math.max(h,p),u=Math.max(u,h),h=Math.max(u,h)),{...t,props:{...t.props,w:u*t.props.scale,h:h*t.props.scale,growY:0}}}let l=null;if(c.h>o?l=c.h-o:a&&(l=0),l!==null){const u=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:l*t.props.scale,w:Math.max(u,c.w)*t.props.scale}}}if(c.w>i)return{...t,props:{...t.props,w:c.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:_e(e.props.w,t.props.w,r),h:_e(e.props.h,t.props.h,r),scale:_e(e.props.scale,t.props.scale,r)}}}v(oc,"type","geo"),v(oc,"props",P0),v(oc,"migrations",I0);function La(n,e){const{text:t,font:r,size:s,w:i}=e.props;if(!t)return{w:0,h:0};const o=n.textMeasure.measureText("w",{...zt,fontFamily:Hr[r],fontSize:Ur[s],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},c=n.textMeasure.measureText(t,{...zt,fontFamily:Hr[r],fontSize:Ur[s],minWidth:o.w,maxWidth:Math.max(0,Math.ceil(o.w+a[s]),Math.ceil(i/e.props.scale-Dn*2))});return{w:c.w+Dn*2,h:c.h+Dn*2}}function s6(){const[n,e]=_.useState(!1);return _.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");e(r&&s.matches);const i=()=>e(r&&s.matches);return s.addEventListener("change",i),()=>s.removeEventListener("change",i)},[]),N(ct.forceSrgb)||!n?"srgb":"p3"}const wb=.35,vb=.82;class ac extends Vn{hideResizeHandles(e){return Fa(e)}hideRotateHandle(e){return Fa(e)}hideSelectionBoundsFg(e){return Fa(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=As(e);if(Fa(e))return new Cg({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:r,sw:s}=Pb(e,t,!0),i=zg({strokeWidth:s,showAsComplete:!0});return Ol(r,i),new at({points:Ag(r,i),isFilled:!0})}component(e){const t=Fh(this.editor,e),r=As(e);return d.jsx(ys,{children:d.jsx($a,{shape:e,forceSolid:t,strokeWidth:r,opacity:wb})})}backgroundComponent(e){const t=Fh(this.editor,e),r=As(e);return d.jsx(ys,{children:d.jsx($a,{shape:e,forceSolid:t,strokeWidth:r,opacity:vb})})}indicator(e){const t=Fh(this.editor,e),r=As(e),{strokePoints:s,sw:i}=Pb(e,r,t),o=Ei(e.props.segments);let a;return s.length<2?a=o6(o[0],i):a=Gs(s,!1),d.jsx("path",{d:a})}toSvg(e){const t=As(e),r=t<1.5,s=1/e.props.scale;return d.jsx("g",{transform:`scale(${s})`,children:d.jsx($a,{forceSolid:r,strokeWidth:t,shape:e,opacity:wb})})}toBackgroundSvg(e){const t=As(e),r=t<1.5,s=1/e.props.scale;return d.jsx("g",{transform:`scale(${s})`,children:d.jsx($a,{forceSolid:r,strokeWidth:t,shape:e,opacity:vb})})}onResize(e,t){const{scaleX:r,scaleY:s}=t,i=[];for(const o of e.props.segments)i.push({...o,points:o.points.map(({x:a,y:c,z:l})=>({x:r*a,y:s*c,z:l}))});return{props:{segments:i}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,...t.props,segments:bC(e.props.segments,t.props.segments,r),scale:_e(e.props.scale,t.props.scale,r)}}}v(ac,"type","highlight"),v(ac,"props",E0),v(ac,"migrations",T0);function i6(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function o6(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function Pb(n,e,t){var c;const r=Ei(n.props.segments),s=n.props.isComplete||((c=Pt(n.props.segments))==null?void 0:c.type)==="straight";let i=e;!t&&!n.props.isPen&&r.length===1&&(i+=Jn(n.id)()*(e/6));const o=zg({strokeWidth:i,showAsComplete:s});return{strokePoints:xr(r,o),sw:i}}function As(n){return Ii[n.props.size]*1.12*n.props.scale}function Fa(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function $a({strokeWidth:n,forceSolid:e,shape:t,opacity:r}){var p;const s=$n(),i=Ei(t.props.segments);let o=n;!e&&!t.props.isPen&&i.length===1&&(o+=Jn(t.id)()*(o/6));const a=zg({strokeWidth:o,showAsComplete:t.props.isComplete||((p=Pt(t.props.segments))==null?void 0:p.type)==="straight"}),c=xr(i,a),l=c.length>1?Gs(c,!1):i6(t.props.segments[0].points[0]),u=s6(),h=s[t.props.color].highlight[u];return d.jsx("path",{d:l,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:h,strokeWidth:o,opacity:r})}function Fh(n,e){return N("forceSolid",()=>{const t=As(e),r=n.getZoomLevel();return t/r<1.5},[n])}function _C(){return d.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[d.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),d.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),d.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function EC({shapeId:n,assetId:e}){const t=z(),r=!!ta(),s=iO(),[i,o]=_.useState(()=>({asset:e?t.getAsset(e)??null:null,url:null})),a=_.useRef(!1),c=_.useRef(null);return _.useEffect(()=>{if(!e)return;let l=!1,u;const h=ur("update state",()=>{if(!r&&t.getCulledShapes().has(n))return;const p=t.getAsset(e);if(!p)return;const f=t.getShape(n);if(!f)return;if(!p.props.src){const m=t.getTemporaryAssetPreview(p.id);if(m){c.current!==m&&(c.current=m,o(x=>({...x,isPlaceholder:!0,url:m})),s());return}}const g=t.getZoomLevel()*(f.props.w/p.props.w);a.current?(Ib(t,e,g,r,m=>{l||c.current!==m&&(c.current=m,o(()=>({asset:p,url:m})))}),u=Ib.cancel):TC(t,e,g,r,m=>{l||(a.current=!0,c.current=m,o(()=>({asset:p,url:m})))})});return()=>{h(),u==null||u(),l=!0}},[t,e,r,s,n]),i}function TC(n,e,t,r,s){n.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:r}).then(i=>{s(i)})}const Ib=Zc(TC,500);function kC(){const[n,e]=_.useState(!1);return _.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}async function a6(n){const t=await(await fr(n)).blob();return Kn.blobToDataUrl(t)}class cc extends Ui{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let r=Cl(e,t);const{flipX:s,flipY:i}=t.initialShape.props,{scaleX:o,scaleY:a,mode:c}=t;if(r={...r,props:{...r.props,flipX:o<0!==s,flipY:a<0!==i}},!e.props.crop)return r;const l=c==="scale_shape"&&o===-1||c==="resize_bounds"&&s!==r.props.flipX,u=c==="scale_shape"&&a===-1||c==="resize_bounds"&&i!==r.props.flipY,{topLeft:h,bottomRight:p}=e.props.crop;return r.props.crop={topLeft:{x:l?1-p.x:h.x,y:u?1-p.y:h.y},bottomRight:{x:l?1-h.x:p.x,y:u?1-h.y:p.y}},r}component(e){return d.jsx(c6,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:d.jsx("rect",{width:F(e.props.w),height:F(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});return r?((r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await a6(r)||""),d.jsx(d6,{shape:e,src:r})):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const r=Ve(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},s=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,o=new y(r.topLeft.x*s,r.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:s,h:i}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,r){function s(i,o){var h,p,f,g;if(i.props.crop===null&&o.props.crop===null)return null;const a=((h=i.props.crop)==null?void 0:h.topLeft)||{x:0,y:0},c=((p=i.props.crop)==null?void 0:p.bottomRight)||{x:1,y:1},l=((f=o.props.crop)==null?void 0:f.topLeft)||{x:0,y:0},u=((g=o.props.crop)==null?void 0:g.bottomRight)||{x:1,y:1};return{topLeft:{x:_e(a.x,l.x,r),y:_e(a.y,l.y,r)},bottomRight:{x:_e(c.x,u.x,r),y:_e(c.y,u.y,r)}}}return{...r>.5?t.props:e.props,w:_e(e.props.w,t.props.w,r),h:_e(e.props.h,t.props.h,r),crop:s(e,t)}}}v(cc,"type","image"),v(cc,"props",k0),v(cc,"migrations",j0);const c6=_.memo(function({shape:e}){var b;const t=z(),{asset:r,url:s}=EC({shapeId:e.id,assetId:e.props.assetId}),i=kC(),[o,a]=_.useState(""),[c,l]=_.useState(null),u=l6(t,e);_.useEffect(()=>{if(s&&u){let S=!1;const P=Ro();return P.onload=()=>{if(S)return;const w=document.createElement("canvas");w.width=P.width,w.height=P.height;const I=w.getContext("2d");I&&(I.drawImage(P,0,0),a(w.toDataURL()),l(s))},P.crossOrigin="anonymous",P.src=s,()=>{S=!0}}},[t,u,i,s]);const h=N("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),p=i&&(((b=r==null?void 0:r.props.mimeType)==null?void 0:b.includes("video"))||u),f=jC(e),g=s===c?null:s,m=p?o:c;if(!s&&!(r!=null&&r.props.src))return d.jsxs(gs,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[d.jsx("div",{className:se("tl-image-container",r&&"tl-image-container-loading"),style:f,children:r?null:d.jsx(_C,{})}),"url"in e.props&&e.props.url&&d.jsx(_i,{url:e.props.url})]});const x=u?"anonymous":void 0;return d.jsxs(d.Fragment,{children:[h&&m&&d.jsx("div",{style:f,children:d.jsx("img",{className:"tl-image",style:{...Mo(e),opacity:.1},crossOrigin:x,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),d.jsxs(gs,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[d.jsxs("div",{className:se("tl-image-container"),style:f,children:[m&&d.jsx("img",{className:"tl-image",style:Mo(e),crossOrigin:x,src:m,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},m),g&&d.jsx("img",{className:"tl-image",style:Mo(e),crossOrigin:x,src:g,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>l(g)},g)]}),e.props.url&&d.jsx(_i,{url:e.props.url})]})]})});function l6(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):void 0;return t?"mimeType"in t.props&&yn.isAnimatedImageType(t==null?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function jC(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,s=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,i=-t.x*r,o=-t.y*s;return{transform:`translate(${i}px, ${o}px)`,width:r,height:s}}function Mo(n,e){const{flipX:t,flipY:r}=n.props;if(!t&&!r)return;const s=`scale(${t?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${t?e.width:0}px, ${r?e.height:0}px)`:""} ${s}`,transformOrigin:e?"0 0":"center center"}}function d6({shape:n,src:e}){const t=Li(),r=jC(n),s=n.props.crop;if(r.transform&&s){const{transform:i,width:o,height:a}=r,c=(s.bottomRight.x-s.topLeft.x)*o,l=(s.bottomRight.y-s.topLeft.y)*a,u=[new y(0,0),new y(c,0),new y(c,l),new y(0,l)],h=Mo(n,{width:o,height:a});return d.jsxs(d.Fragment,{children:[d.jsx("defs",{children:d.jsx("clipPath",{id:t,children:d.jsx("polygon",{points:u.map(p=>`${p.x},${p.y}`).join(" ")})})}),d.jsx("g",{clipPath:`url(#${t})`,children:d.jsx("image",{href:e,width:o,height:a,style:h?{...h,transform:`${i} ${h.transform}`}:{transform:i}})})]})}else return d.jsx("image",{href:e,width:n.props.w,height:n.props.h,style:Mo(n,{width:n.props.w,height:n.props.h})})}function MC(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function AC(n,e,t){const r=e.vertices,s=MC(t);return xr(r,s)}function u6(n,e,t){const r=MC(t);return Ag(Ol(AC(n,e,t),r),r)}function h6(n,e,t){const r=u6(n,e,t);return ig(r)}function p6(n,e,t){if(n.props.dash==="draw"){const r=AC(n,e,t);return Gs(r)}return e.getSvgPathData()}function DC(n,e,t){let r=`M ${ke(e[0])}L`,s=`M ${ke(e[0])}L`;const i=t/3,o=t*2,a=Jn(n);let c=e[0],l,u=e[0],h;const p=e.length;for(let f=0,g=p-1;f<g;f++){l=e[f+1],h=y.AddXY(e[f+1],a()*i,a()*i);const m=y.Sub(l,c),x=y.Len(m),b=y.Div(m,x).mul(Math.min(x/4,o)),S=y.Add(c,b),P=y.Add(l,b.neg()),w=y.Sub(h,u),I=y.Len(w),E=y.Div(w,I).mul(Math.min(I/4,o)),T=y.Add(u,E),C=y.Add(h,E.neg());f===g-1?(r+=`${ke(S)}L ${ke(l)}`,s+=`${ke(T)}L ${ke(h)}`):(r+=`${ke(S)}L ${ke(P)}Q ${ke(l)}`,s+=`${ke(T)}L ${ke(C)}Q ${ke(h)}`,c=l,u=h)}return[r,r+s]}const f6=new pr;class lc extends Vn{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=Fo(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return vo(e)}getHandles(e){return f6.get(e.props,()=>{const t=vo(e),r=wo(e),s=r.map(i=>({...i,id:i.index,type:"vertex",canSnap:!0}));for(let i=0;i<r.length-1;i++){const o=Lo(r[i].index,r[i+1].index),c=t.segments[i].midPoint();s.push({id:o,type:"create",index:o,x:c.x,y:c.y,canSnap:!0})}return s.sort(Rt)})}onResize(e,t){const{scaleX:r,scaleY:s}=t;return{props:{points:Go(e.props.points,(i,{id:o,index:a,x:c,y:l})=>({id:o,index:a,x:c*r,y:l*s}))}}}onBeforeCreate(e){const{props:{points:t}}=e,r=Object.keys(t);if(r.length<2)return;const s=t[r[0]];if(r.every(o=>{const a=t[o];return a.x===s.x&&a.y===s.y})){const o=r[r.length-1];return t[o]={...t[o],x:t[o].x+.1,y:t[o].y+.1},e}}onHandleDrag(e,{handle:t}){if(t.type!=="vertex")return;const r=Zn(new y(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:r.x,y:r.y}}}}}component(e){return d.jsx(ys,{children:d.jsx(Cb,{shape:e})})}indicator(e){const t=dr[e.props.size]*e.props.scale,r=vo(e),{dash:s}=e.props;let i;if(e.props.spline==="line"){const o=r.points;if(s==="solid"||s==="dotted"||s==="dashed")i="M"+o[0]+"L"+o.slice(1);else{const[a]=DC(e.id,o,t);i=a}}else i=p6(e,r,t);return d.jsx("path",{d:i})}toSvg(e){return d.jsx(Cb,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=wo(e);return{points:t,getSelfSnapPoints:r=>{const s=this.getHandles(e).filter(i=>i.type==="vertex").findIndex(i=>i.id===r.id);return t.filter((i,o)=>Math.abs(o-s)>1).map(y.From)},getSelfSnapOutline:r=>{const s=this.getHandles(e).filter(o=>o.type==="vertex").findIndex(o=>o.id===r.id),i=vo(e).segments.filter((o,a)=>a!==s-1&&a!==s);return i.length?new Rn({children:i}):null}}}getInterpolatedProps(e,t,r){const s=wo(e),i=wo(t),o=[],a=[];let c=ow;if(s.length>i.length)for(let l=0;l<s.length;l++)o[l]={...s[l]},i[l]===void 0?a[l]={...i[i.length-1],id:c}:a[l]={...i[l],id:c},c=ar(c);else if(i.length>s.length)for(let l=0;l<i.length;l++)a[l]={...i[l]},s[l]===void 0?o[l]={...s[s.length-1],id:c}:o[l]={...s[l],id:c},c=ar(c);else for(let l=0;l<i.length;l++)o[l]=s[l],a[l]=i[l];return{...r>.5?t.props:e.props,points:Object.fromEntries(o.map((l,u)=>{const h=a[u];return[l.id,{...l,x:_e(l.x,h.x,r),y:_e(l.y,h.y,r)}]})),scale:_e(e.props.scale,t.props.scale,r)}}}v(lc,"type","line"),v(lc,"props",M0),v(lc,"migrations",A0);function wo(n){return Object.values(n.props.points).sort(Rt)}function vo(n){const e=wo(n).map(y.From);switch(n.props.spline){case"cubic":return new sR({points:e});case"line":return new zi({points:e})}}function Cb({shape:n,shouldScale:e=!1,forceSolid:t=!1}){const r=$n(),s=vo(n),{dash:i,color:o,size:a}=n.props,c=1/n.props.scale,l=e?c:1,u=dr[a]*n.props.scale;if(n.props.spline==="line"){if(i==="solid"){const h=s.points,p="M"+h[0]+"L"+h.slice(1);return d.jsx("path",{d:p,stroke:r[o].solid,strokeWidth:u,fill:"none",transform:`scale(${l})`})}if(i==="dashed"||i==="dotted")return d.jsx("g",{stroke:r[o].solid,strokeWidth:u,transform:`scale(${l})`,children:s.segments.map((h,p)=>{const{strokeDasharray:f,strokeDashoffset:g}=t?{strokeDasharray:"none",strokeDashoffset:"none"}:Hn(h.length,u,{style:i,start:p>0?"outset":"none",end:p<s.segments.length-1?"outset":"none"});return d.jsx("path",{strokeDasharray:f,strokeDashoffset:g,d:h.getSvgPathData(!0),fill:"none"},p)})});if(i==="draw"){const h=s.points,[p,f]=DC(n.id,h,u);return d.jsx("path",{d:f,stroke:r[o].solid,strokeWidth:u,fill:"none",transform:`scale(${l})`})}}if(n.props.spline==="cubic"){const h=s.getSvgPathData();if(i==="solid")return d.jsx("path",{strokeWidth:u,stroke:r[o].solid,fill:"none",d:h,transform:`scale(${l})`});if(i==="dashed"||i==="dotted")return d.jsx("g",{stroke:r[o].solid,strokeWidth:u,transform:`scale(${l})`,children:s.segments.map((p,f)=>{const{strokeDasharray:g,strokeDashoffset:m}=Hn(p.length,u,{style:i,start:f>0?"outset":"none",end:f<s.segments.length-1?"outset":"none",forceSolid:t});return d.jsx("path",{strokeDasharray:g,strokeDashoffset:m,d:p.getSvgPathData(),fill:"none"},f)})});if(i==="draw")return d.jsx("path",{d:h6(n,s,u),strokeWidth:1,stroke:r[o].solid,fill:r[o].solid,transform:`scale(${l})`})}}class dc extends Vn{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:r}=OC(this.editor,e),{scale:s}=e.props,i=t*s,o=r*s,a=$e*s,c=za(e);return new Rn({children:[new yr({width:a,height:c,isFilled:!0}),new yr({x:e.props.align==="start"?0:e.props.align==="end"?a-o:(a-o)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?c-i:(c-i)/2,width:o,height:i,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const s=this.editor.getZoomLevel();if(s*t<.25)return[];const i=za(e),o=$e*t,a=DF/s*t;return s*t<.5?[{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a}]:[{id:"top",index:"a1",type:"clone",x:o/2,y:-a},{id:"right",index:"a2",type:"clone",x:o+a,y:i/2},{id:"bottom",index:"a3",type:"clone",x:o/2,y:i+a},{id:"left",index:"a4",type:"clone",x:-a,y:i/2}]}getText(e){return e.props.text}component(e){const{id:t,type:r,props:{labelColor:s,scale:i,color:o,font:a,size:c,align:l,text:u,verticalAlign:h,fontSizeAdjustment:p}}=e,f=y6(t),g=$n(),m=$e*i,x=za(e),b=N("shape rotation",()=>{var I;return((I=this.editor.getShapePageTransform(t))==null?void 0:I.rotation())??0},[this.editor]),S=N("zoom",()=>this.editor.getZoomLevel()<.35/i,[i,this.editor]),P=N("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),w=e.id===this.editor.getOnlySelectedShapeId();return d.jsxs(d.Fragment,{children:[d.jsx("div",{id:t,className:"tl-note__container",style:{width:m,height:x,backgroundColor:g[o].note.fill,borderBottom:S?P?`${2*i}px solid rgb(20, 20, 20)`:`${2*i}px solid rgb(144, 144, 144)`:"none",boxShadow:S?"none":S6(e.id,b,i)},children:d.jsx($l,{shapeId:t,type:r,font:a,fontSize:(p||Ur[c])*i,lineHeight:zt.lineHeight,align:l,verticalAlign:h,text:u,isNote:!0,isSelected:w,labelColor:s==="black"?g[o].note.text:g[s].fill,wrap:!0,padding:16*i,onKeyDown:f})}),"url"in e.props&&e.props.url&&d.jsx(_i,{url:e.props.url})]})}indicator(e){const{scale:t}=e.props;return d.jsx("rect",{rx:t,width:F($e*t),height:F(za(e))})}toSvg(e,t){e.props.text&&t.addExportDef(Ll(e.props.font));const r=Yr({isDarkMode:t.isDarkMode}),s=x6(e);return d.jsxs(d.Fragment,{children:[d.jsx("rect",{x:5,y:5,rx:1,width:$e-10,height:s.h,fill:"rgba(0,0,0,.1)"}),d.jsx("rect",{rx:1,width:$e,height:s.h,fill:r[e.props.color].note.fill}),d.jsx(Fl,{fontSize:e.props.fontSizeAdjustment||Ur[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:s,stroke:!1})]})}onBeforeCreate(e){return _b(this.editor,e)}onBeforeUpdate(e,t){if(!(e.props.text===t.props.text&&e.props.font===t.props.font&&e.props.size===t.props.size))return _b(this.editor,t)}onEditEnd(e){const{id:t,type:r,props:{text:s}}=e;s.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:s.trimEnd()}}])}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,scale:_e(e.props.scale,t.props.scale,r)}}}v(dc,"type","note"),v(dc,"props",D0),v(dc,"migrations",O0);function _b(n,e){const{labelHeight:t,fontSizeAdjustment:r}=OC(n,e),s=Math.max(0,t-$e);if(s!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:s,fontSizeAdjustment:r}}}function g6(n,e){const{text:t}=e.props;if(!t)return{labelHeight:Ur[e.props.size]*zt.lineHeight+Dn*2,labelWidth:100,fontSizeAdjustment:0};const r=Ur[e.props.size];let s=0,i=0,o=$e,a=$e;const c=1;do{s=Math.min(r,r-i);const l=n.textMeasure.measureText(t,{...zt,fontFamily:Hr[e.props.font],fontSize:s,maxWidth:$e-Dn*2-c,disableOverflowWrapBreaking:!0});if(o=l.h+Dn*2,a=l.w+Dn*2,s<=14){const u=n.textMeasure.measureText(t,{...zt,fontFamily:Hr[e.props.font],fontSize:s,maxWidth:$e-Dn*2-c});o=u.h+Dn*2,a=u.w+Dn*2;break}if(l.scrollWidth.toFixed(0)===l.w.toFixed(0))break}while(i++<50);return{labelHeight:o,labelWidth:a,fontSizeAdjustment:s}}const m6=new pr;function OC(n,e){return m6.get(e,()=>g6(n,e))}function y6(n){const e=z(),t=OI();return _.useCallback(r=>{const s=e.getShape(n);if(!s)return;const i=r.key==="Tab",o=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(i||o){r.preventDefault();const a=e.getShapePageTransform(n),c=a.rotation(),l=!!(t.dir==="rtl"||nC(s.props.text)),u=($e+e.options.adjacentShapeMargin+(o&&!r.shiftKey?s.props.growY:0))*s.props.scale,h=new y(i?r.shiftKey!=l?-1:1:0,o?r.shiftKey?-1:1:0).mul(u).add(Rl.clone().mul(s.props.scale)).rot(c).add(a.point()),p=lC(e,s,h,c);p&&(e.markHistoryStoppingPoint("editing adjacent shape"),Bc(e,p,!0))}},[n,e,t.dir])}function za(n){return($e+n.props.growY)*n.props.scale}function S6(n,e,t){const r=Jn(n),s=Math.abs(r())+.5,i=Math.cos(e),o=5*t,a=4*t,c=6*t,l=7*t;return`0px ${o-s}px ${o}px -${o}px rgba(15, 23, 31, .6),
	0px ${(a+s*l)*Math.max(0,i)}px ${c+s*l}px -${a+s*c}px rgba(15, 23, 31, ${(.3+s*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+i)/2)).toFixed(2)})`}function x6(n){return new V(0,0,$e,$e+n.props.growY)}function b6(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:s}){const i=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),o=new y(0,0);t<0&&(o.x=-(e.width*i)),r<0&&(o.y=-(e.height*i));const{x:a,y:c}=y.Add(s,o.rot(n.rotation));return{x:a,y:c,props:{scale:i*n.props.scale}}}const w6=new pr;class uc extends Vn{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return w6.get(e.props,t=>Eb(this.editor,t))}getGeometry(e){const{scale:t}=e.props,{width:r,height:s}=this.getMinDimensions(e);return new yr({width:r*t,height:s*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:r,size:s,text:i,color:o,scale:a,textAlign:c}}=e,{width:l,height:u}=this.getMinDimensions(e),h=e.id===this.editor.getOnlySelectedShapeId(),p=$n(),f=v6(t);return d.jsx($l,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:Ii[s],lineHeight:zt.lineHeight,align:c,verticalAlign:"middle",text:i,labelColor:p[o].solid,isSelected:h,textWidth:l,textHeight:u,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:f})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,r=z();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:d.jsx("rect",{width:F(t.width),height:F(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(Ll(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,s=r.width/(e.props.scale??1),i=r.height/(e.props.scale??1),o=Yr(t);return d.jsx(Fl,{fontSize:Ii[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:o[e.props.color].solid,bounds:new V(0,0,s,i),padding:0})}onResize(e,t){const{newPoint:r,initialBounds:s,initialShape:i,scaleX:o,handle:a}=t;if(t.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...b6(e,t)};{const c=Math.max(1,Math.abs(s.width*o)),{x:l,y:u}=o<0?y.Sub(r,y.FromAngle(e.rotation).mul(c)):r;return{id:e.id,type:e.type,x:l,y:u,props:{w:c/i.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:r,props:{text:s}}=e,i=e.props.text.trimEnd();i.length===0?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:s.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,s=e.props.text!==t.props.text;if(!r&&!s)return;const i=this.getMinDimensions(e),o=Eb(this.editor,t.props),a=i.width*e.props.scale,c=i.height*e.props.scale,l=o.width*t.props.scale,u=o.height*t.props.scale;let h;switch(t.props.textAlign){case"middle":{h=new y((l-a)/2,s?0:(u-c)/2);break}case"end":{h=new y(l-a,s?0:(u-c)/2);break}default:{if(s)break;h=new y(0,(u-c)/2);break}}if(h){h.rot(t.rotation);const{x:p,y:f}=t;return{...t,x:p-h.x,y:f-h.y,props:{...t.props,w:l}}}else return{...t,props:{...t.props,w:l}}}}v(uc,"type","text"),v(uc,"props",R0),v(uc,"migrations",L0);function Eb(n,e){const{font:t,text:r,autoSize:s,size:i,w:o}=e,a=s?16:Math.max(16,o),c=Ii[i],l=s?null:Math.floor(Math.max(a,o)),u=n.textMeasure.measureText(r,{...zt,fontFamily:Hr[t],fontSize:c,maxWidth:l});return s&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(c,u.h)}}function v6(n){const e=z();return _.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{xe(t),t.shiftKey?Ci.unindent(t.currentTarget):Ci.indent(t.currentTarget);break}}},[e,n])}class hc extends Ui{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){const{asset:t,url:r}=EC({shapeId:e.id,assetId:e.props.assetId});return d.jsx(P6,{editor:this.editor,shape:e,asset:t,url:r})}indicator(e){return d.jsx("rect",{width:F(e.props.w),height:F(e.props.h)})}async toSvg(e){const t=await I6(this.editor,e);return t?d.jsx("image",{href:t,width:e.props.w,height:e.props.h}):null}}v(hc,"type","video"),v(hc,"props",F0),v(hc,"migrations",$0);const P6=_.memo(function({editor:e,shape:t,asset:r,url:s}){const i=e.getShapeGeometry(t).bounds.w*e.getZoomLevel()>=110,o=_l(t.id),a=kC(),{Spinner:c}=Xe(),l=_.useRef(null),[u,h]=_.useState(!1),[p,f]=_.useState(!1);_.useEffect(()=>{const m=()=>f(document.fullscreenElement===l.current);return document.addEventListener("fullscreenchange",m),()=>document.removeEventListener("fullscreenchange",m)});const g=_.useCallback(m=>{m.currentTarget&&h(!0)},[]);return _.useEffect(()=>{const m=l.current;m&&o&&document.activeElement!==m&&m.focus()},[o,u]),_.useEffect(()=>{if(a){const m=l.current;if(!m)return;m.pause(),m.currentTime=0}},[l,a]),d.jsxs(d.Fragment,{children:[d.jsx(gs,{id:t.id,style:{color:"var(--color-text-3)",backgroundColor:r?"transparent":"var(--color-low)",border:r?"none":"1px solid var(--color-low-border)"},children:d.jsx("div",{className:"tl-counter-scaled",children:d.jsx("div",{className:"tl-video-container",children:r?c&&!r.props.src?d.jsx(c,{}):s?d.jsxs(d.Fragment,{children:[d.jsx("video",{ref:l,style:o?{pointerEvents:"all"}:u?void 0:{display:"none"},className:se("tl-video",`tl-video-shape-${t.id.split(":")[1]}`,{"tl-video-is-fullscreen":p}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:o&&i,onLoadedData:g,hidden:!u,children:d.jsx("source",{src:s})}),!u&&c&&d.jsx(c,{})]}):null:d.jsx(_C,{})})})}),"url"in t.props&&t.props.url&&d.jsx(_i,{url:t.props.url})]})});async function I6(n,e){const t=await n.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!t)return null;const r=await yn.loadVideo(t);return yn.getVideoFrameAsDataUrl(r,0)}const RC=[uc,nc,rc,oc,dc,lc,ic,tc,ac,sc,cc,hc];function C6(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!n.isIn("select.editing_shape")){const r=n.getEditingShape();r&&r.type==="text"&&n.isInAny("text.pointing","select.resizing")&&n.getInstanceState().isToolLocked?n.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):n.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle")}}})}class LC extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"scribbleId","id");v(this,"markId","");v(this,"excludedShapeIds",new Set)}onEnter(t){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>{if(this.editor.isShapeOrAncestorLocked(i))return!0;if(this.editor.isShapeOfType(i,"group")||this.editor.isShapeOfType(i,"frame")){const o=this.editor.getPointInShapeSpace(i,r);return this.editor.getShapeGeometry(i).bounds.containsPoint(o)}return!1}).map(i=>i.id));const s=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=s.id,this.update()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:t,excludedShapeIds:r}=this,s=t.getErasingShapeIds(),i=t.getZoomLevel(),o=t.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=t;this.pushPointToScribble();const l=new Set(s),u=this.editor.options.hitTestMargin/i;for(const h of o){if(t.isShapeOfType(h,"group"))continue;const p=t.getShapeMask(h.id);if(p&&!wn(a,p))continue;const f=t.getShapeGeometry(h),g=t.getShapePageTransform(h);if(!f||!g)continue;const m=g.clone().invert(),x=m.applyToPoint(c),b=m.applyToPoint(a),{bounds:S}=f;S.minX-u>Math.max(x.x,b.x)||S.minY-u>Math.max(x.y,b.y)||S.maxX+u<Math.min(x.x,b.x)||S.maxY+u<Math.min(x.y,b.y)||f.hitTestLineSegment(x,b,u)&&l.add(t.getOutermostSelectableShape(h).id)}this.editor.setErasingShapes([...l].filter(h=>!r.has(h)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}v(LC,"id","erasing");var rp;let _6=(rp=class extends te{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},v(rp,"id","idle"),rp);var sp;let E6=(sp=class extends te{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,s=new Set,i=s.size;for(let o=t.length,a=o-1;a>=0;a--){const c=t[a];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const l=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(l,"frame")&&s.size>i)break;s.add(l.id)}}this.editor.setErasingShapes([...s])}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},v(sp,"id","pointing"),sp);class pc extends te{static children(){return[_6,E6,LC]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}v(pc,"id","eraser"),v(pc,"initial","idle"),v(pc,"isLockable",!1);class FC extends te{constructor(){super(...arguments);v(this,"initialCamera",new y)}onEnter(){this.initialCamera=y.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:t,editor:r}=this,{currentScreenPoint:s,originScreenPoint:i}=r.inputs,o=y.Sub(s,i).div(r.getZoomLevel());o.len2()!==0&&r.setCamera(t.clone().add(o))}complete(){const{editor:t}=this,{pointerVelocity:r}=t.inputs,s=Math.min(r.len(),2);s>.1&&this.editor.slideCamera({speed:s,direction:r}),this.parent.transition("idle")}}v(FC,"id","dragging");var ip;let T6=(ip=class extends te{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},v(ip,"id","idle"),ip);var op;let k6=(op=class extends te{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},v(op,"id","pointing"),op);class fc extends te{static children(){return[T6,k6,FC]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:yt.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:yt.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:yt.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:yt.easeOutQuint}})}}}v(fc,"id","hand"),v(fc,"initial","idle"),v(fc,"isLockable",!1);var ap;let j6=(ap=class extends te{onPointerDown(e){this.parent.transition("lasering",e)}},v(ap,"id","idle"),ap);class $C extends te{constructor(){super(...arguments);v(this,"scribbleId","id")}onEnter(){const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}v($C,"id","lasering");class gc extends te{static children(){return[j6,$C]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}v(gc,"id","laser"),v(gc,"initial","idle"),v(gc,"isLockable",!1);class zC extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"initialSelectedShapeIds",[]);v(this,"excludedShapeIds",new Set);v(this,"isWrapMode",!1);v(this,"initialStartShape",null)}onEnter(t){const{altKey:r,currentPagePoint:s}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(i=>this.editor.isShapeOfType(i,"group")||this.editor.isShapeOrAncestorLocked(i)).map(i=>i.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(s)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(t){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)}onKeyDown(t){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:r,isWrapMode:s}=this,{inputs:{originPagePoint:i,currentPagePoint:o,shiftKey:a,ctrlKey:c}}=t,l=new Set(a?this.initialSelectedShapeIds:[]),u=s?!c:c,h=V.FromPoints([i,o]),{corners:p}=h;let f,g,m,x,b,S;const P=t.getCurrentPageRenderingShapesSorted(),w=t.getCurrentPageId();e:for(let T=0,C=P.length;T<C;T++){if(m=P[T],r.has(m.id)||l.has(m.id)||(x=t.getShapePageBounds(m),!x))continue e;if(h.contains(x)){this.handleHit(m,o,w,l,p);continue e}if(u||t.isShapeOfType(m,"frame"))continue e;if(h.collides(x)){if(b=t.getShapePageTransform(m),!b)continue e;S=b.clone().invert().applyToPoints(p);const j=t.getShapeGeometry(m);t:for(let k=0;k<4;k++)if(f=S[k],g=S[(k+1)%4],j.hitTestLineSegment(f,g,0)){this.handleHit(m,o,w,l,p);break t}}}const I=t.getInstanceState().brush;(!I||!h.equals(I))&&t.updateInstanceState({brush:{...h.toJson()}});const E=t.getSelectedShapeIds();(E.length!==l.size||E.some(T=>!l.has(T)))&&t.setSelectedShapes(Array.from(l))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(t,r,s,i,o){if(t.parentId===s){i.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),c=this.editor.getShapeMask(a.id);c&&!hg(c,o)&&!wn(r,c)||i.add(a.id)}}v(zC,"id","brushing");const Ti={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class NC extends te{constructor(){super(...arguments);v(this,"info",{})}updateCursor(){const t=this.editor.getSelectedShapes(),r=Ti[this.info.handle];this.editor.setCursor({type:r,rotation:t.length===1?this.editor.getSelectionRotation():0})}onEnter(t){this.info=t,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(NC,"id","pointing_resize_handle");const Mn=8;class Bg extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"snapshot",{})}onEnter(t){this.info=t,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=Ti[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const i=t.props,o=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=o.clone().sub(a).rot(-t.rotation),l=i.crop??this.getDefaultCrop(),u=Ve(l),h=new y(t.x,t.y),p=new y(0,0),f=1/(l.bottomRight.x-l.topLeft.x)*i.w,g=1/(l.bottomRight.y-l.topLeft.y)*i.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(g<Mn)break;m=!0,u.topLeft.y=u.topLeft.y+c.y/g,g*(u.bottomRight.y-u.topLeft.y)<Mn?(u.topLeft.y=u.bottomRight.y-Mn/g,p.y=(u.topLeft.y-l.topLeft.y)*g):u.topLeft.y<=0?(u.topLeft.y=0,p.y=(u.topLeft.y-l.topLeft.y)*g):p.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(g<Mn)break;m=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+c.y/g),g*(u.bottomRight.y-u.topLeft.y)<Mn&&(u.bottomRight.y=u.topLeft.y+Mn/g);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<Mn)break;m=!0,u.topLeft.x=u.topLeft.x+c.x/f,f*(u.bottomRight.x-u.topLeft.x)<Mn?(u.topLeft.x=u.bottomRight.x-Mn/f,p.x=(u.topLeft.x-l.topLeft.x)*f):u.topLeft.x<=0?(u.topLeft.x=0,p.x=(u.topLeft.x-l.topLeft.x)*f):p.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<Mn)break;m=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+c.x/f),f*(u.bottomRight.x-u.topLeft.x)<Mn&&(u.bottomRight.x=u.topLeft.x+Mn/f);break}}if(!m)return;h.add(p.rot(t.rotation));const x={id:t.id,type:t.type,x:h.x,y:h.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*f,h:(u.bottomRight.y-u.topLeft.y)*g}};this.editor.updateShapes([x]),this.updateCursor()}complete(){this.updateShapes(),He(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,s=this.editor.getOnlySelectedShape(),i=this.editor.getSelectionRotatedPageBounds(),o=y.RotWith(i.getHandlePoint(this.info.handle),i.point,t),a=y.Sub(r,o);return{shape:s,cursorHandleOffset:a}}}v(Bg,"id","cropping");function BC(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:r}}=n;return n.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(r)}function UC(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const s=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;s==="x"?t.x=0:s==="y"&&(t.y=0),t.rot(-e.rotation);const i=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,o=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,l=Ve(r);return l.topLeft.x=Math.min(1-c,Math.max(0,l.topLeft.x-t.x/i)),l.topLeft.y=Math.min(1-a,Math.max(0,l.topLeft.y-t.y/o)),l.bottomRight.x=l.topLeft.x+c,l.bottomRight.y=l.topLeft.y+a,{id:e.id,type:e.type,props:{crop:l}}}var cp;let M6=(cp=class extends te{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var t;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=BC(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var i;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const s=this.editor.getShapeUtil(r);if(s){if(e.target==="selection"){(i=s.onDoubleClickEdge)==null||i.call(s,r);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),s=new y(0,0);if(t.has("ArrowLeft")&&(s.x+=1),t.has("ArrowRight")&&(s.x-=1),t.has("ArrowUp")&&(s.y+=1),t.has("ArrowDown")&&(s.y-=1),s.equals(new y(0,0)))return;r&&s.mul(10);const i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;const o=UC(this.editor,i,s);o&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([o]))}},v(cp,"id","idle"),cp);class HC extends te{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}v(HC,"id","pointing_crop");class Ug extends te{constructor(){super(...arguments);v(this,"info",{})}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const s=Ti[this.info.handle];this.editor.setCursor({type:s,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}v(Ug,"id","pointing_crop_handle");class KC extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"snapshot",{})}onEnter(t){this.info=t,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(t){switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(t){switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:s}=this.editor.inputs,i=s.clone().sub(r),o=UC(this.editor,t,i);o&&this.editor.updateShapes([o])}}v(KC,"id","translating_crop");class sf extends te{constructor(){super(...arguments);v(this,"markId","");v(this,"didExit",!1)}static children(){return[M6,KC,HC,Ug,Bg]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}v(sf,"id","crop"),v(sf,"initial","idle");class qC extends te{constructor(){super(...arguments);v(this,"shapeId","");v(this,"initialHandle",{});v(this,"initialAdjacentHandle",null);v(this,"initialPagePoint",{});v(this,"markId","");v(this,"initialPageTransform");v(this,"initialPageRotation");v(this,"info",{});v(this,"isPrecise",!1);v(this,"isPreciseId",null);v(this,"pointingId",null);v(this,"exactTimeout",-1)}onEnter(t){const{shape:r,isCreating:s,creatingMarkId:i,handle:o}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId="",s)if(i)this.markId=i;else{const l=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);l&&(this.markId=l)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=Ve(o),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[o.index]:{id:o.index,index:o.index,x:o.x,y:o.y}}}});const u=this.editor.getShapeHandles(r).find(h=>h.index===o.index);this.initialHandle=Ve(u)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:s?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(r).sort(Rt),c=a.findIndex(l=>l.id===t.handle.id);this.initialAdjacentHandle=null;for(let l=c+1;l<a.length;l++){const u=a[l];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}if(!this.initialAdjacentHandle)for(let l=a.length-1;l>=0;l--){const u=a[l];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==t.handle.id){this.initialAdjacentHandle=u;break}}if(this.editor.isShapeOfType(r,"arrow")){const l=rn(this.editor,r)[t.handle.id];this.isPrecise=!1,l?(this.editor.setHintingShapes([l.toId]),this.isPrecise=l.props.isPrecise,this.isPrecise?this.isPreciseId=l.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),He(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var T;const{editor:t,shapeId:r,initialPagePoint:s}=this,{initialHandle:i,initialPageRotation:o,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:u,inputs:{currentPagePoint:h,shiftKey:p,ctrlKey:f,altKey:g,pointerVelocity:m}}=t,x=this.info.shape,b=t.getShape(r);if(!b)return;const S=t.getShapeUtil(b);let P=h.clone().sub(s).rot(-o).add(i);if(p&&a&&i.id!=="middle"){const C=y.Angle(a,P),k=Lc(C,24)-C;P=y.RotWith(P,a,k)}t.snaps.clearIndicators();let w={...i,x:P.x,y:P.y};if(i.canSnap&&(l?!f:f)){if(!t.getShapePageTransform(b.id))throw Error("Expected a page transform");const j=u.handles.snapHandle({currentShapeId:r,handle:w});j&&(j.nudge.rot(-t.getShapeParentTransform(b).rotation()),P.add(j.nudge),w={...i,x:P.x,y:P.y})}const I=(T=S.onHandleDrag)==null?void 0:T.call(S,b,{handle:w,isPrecise:this.isPrecise||g,initial:x}),E={id:b.id,type:b.type,...I};if(i.type==="vertex"&&this.editor.isShapeOfType(b,"arrow")){const C=rn(t,b)[i.id];C?c[0]!==C.toId&&(t.setHintingShapes([C.toId]),this.pointingId=C.toId,this.isPrecise=m.len()<.5||g,this.isPreciseId=this.isPrecise?C.toId:null,this.resetExactTimeout()):c.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}I&&t.updateShapes([E])}}v(qC,"id","dragging_handle");function GC(n){return n.isLabel?[n]:n instanceof Rn?n.children.filter(e=>e.isLabel):[]}class WC extends te{constructor(){super(...arguments);v(this,"hitShapeForPointerUp",null);v(this,"info",{})}onEnter(t){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=t,t.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),$r(this.editor),this.editor.select(r)}onExit(){var i;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),$r.cancel();const r=this.editor.getShape(t),s=this.editor.getShapeUtil(r);(i=s.onEditEnd)==null||i.call(s,r),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(t){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{$r(this.editor);return}}}onPointerDown(t){switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:r}=t,s=this.editor.getEditingShape();if(!s)throw Error("Expected an editing shape!");const i=this.editor.getShapeUtil(r).getGeometry(r),o=GC(i),a=o.length===1?o[0]:void 0,c=this.editor.isShapeOfType(s,"text")&&s.props.text.trim()==="";if(a&&!c){const l=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(l,0)&&a.hitTestPoint(l)){if(r.id===s.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===s.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)}onPointerUp(t){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const s=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getIsReadonly()&&!s.canEditInReadOnly(r)){this.parent.transition("pointing_shape",t);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),$r(this.editor)}}onComplete(t){this.parent.transition("idle",t)}onCancel(t){this.parent.transition("idle",t)}}v(WC,"id","editing_shape");function Tb(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function Vc(n,e){const t=n.getSelectedShapeIds(),{currentPagePoint:r}=n.inputs,{shiftKey:s,altKey:i,accelKey:o}=e,a=s||o,c=n.getShapeAtPoint(r,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:l=>!l.isLocked});if(c){const l=n.getOutermostSelectableShape(c);if(a&&!i)n.cancelDoubleClick(),t.includes(l.id)?(n.markHistoryStoppingPoint("deselecting shape"),n.deselect(l)):(n.markHistoryStoppingPoint("shift selecting shape"),n.setSelectedShapes([...t,l.id]));else{let u;l===c||l.id===n.getFocusedGroupId()||t.includes(l.id)?u=c:u=l,u&&!t.includes(u.id)&&(n.markHistoryStoppingPoint("selecting shape"),n.select(u.id))}}else{if(a)return;{t.length>0&&(n.markHistoryStoppingPoint("selecting none"),n.selectNone());const l=n.getFocusedGroupId();if(en(l)){const u=n.getShape(l);n.isPointInShape(u,r,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const A6=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var lp;let D6=(lp=class extends te{onEnter(){this.parent.setCurrentToolIdMask(void 0),$r(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){$r.cancel()}onPointerMove(){$r(this.editor)}onPointerDown(e){const t=e.ctrlKey&&Tb(this.editor);switch(e.target){case"canvas":{const r=BC(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((s.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&kb(this.editor,o)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e)}break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var t,r,s,i;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const o=this.editor.getHoveredShape(),a=o&&!this.editor.isShapeOfType(o,"group")?o:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(a){if(this.editor.isShapeOfType(a,"group")){Vc(this.editor,e);return}else{const l=this.editor.getShape(a.parentId);if(l&&this.editor.isShapeOfType(l,"group")&&!(c&&l.id===c)){Vc(this.editor,e);return}}this.onDoubleClick({...e,shape:a,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const o=this.editor.getOnlySelectedShape();if(o){const a=this.editor.getShapeUtil(o);if(!this.canInteractWithShapeInReadOnly(o))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=a.onDoubleClickEdge)==null?void 0:t.call(a,o);if(c){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([c]),He(this.editor,[o.id]);return}}if(a.canCrop(o)&&!this.editor.isShapeOrAncestorLocked(o)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(o)&&this.startEditingShape(o,e,!0)}break}case"shape":{const{shape:o}=e,a=this.editor.getShapeUtil(o);if(o.type!=="video"&&o.type!=="embed"&&this.editor.getIsReadonly())break;if(a.onDoubleClick){const c=(r=a.onDoubleClick)==null?void 0:r.call(a,o);if(c){this.editor.updateShapes([c]);return}}if(a.canCrop(o)&&!this.editor.isShapeOrAncestorLocked(o)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((s=e.shape)==null?void 0:s.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(o)?this.startEditingShape(o,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:o,handle:a}=e,c=this.editor.getShapeUtil(o),l=(i=c.onDoubleClickHandle)==null?void 0:i.call(c,o,a);l?this.editor.updateShapes([l]):this.shouldStartEditingShape(o)&&this.startEditingShape(o,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const s=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((s.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&kb(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,s=this.editor.getOutermostSelectableShape(r,i=>!t.includes(i.id));!t.includes(s.id)&&!this.editor.findShapeAncestor(s,i=>t.includes(i.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([s.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(ct.editOnType.get()&&!A6.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(s=>this.editor.isShapeOfType(s,"group"))){this.editor.setSelectedShapes(t.flatMap(s=>this.editor.getSortedChildIdsForParent(s.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}Tb(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),Bc(this.editor,e,r),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&wn(t,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=ze(),{x:r,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:s,props:{text:"",autoSize:!0}}]);const i=this.editor.getShape(t);if(!i)return;const o=this.editor.getShapeUtil(i);this.editor.getIsReadonly()&&!o.canEditInReadOnly(i)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),s=new y(0,0);if(t.has("ArrowLeft")&&(s.x-=1),t.has("ArrowRight")&&(s.x+=1),t.has("ArrowUp")&&(s.y-=1),t.has("ArrowDown")&&(s.y+=1),s.equals(new y(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?r?i*L6:i:r?O6:R6,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,s.mul(o)),He(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},v(lp,"id","idle"),lp);const O6=10,R6=1,L6=5;function kb(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?wn(e,t.corners.map(s=>y.RotWith(s,t.point,r))):t.containsPoint(e)}class YC extends te{constructor(){super(...arguments);v(this,"shapeId","");v(this,"markId","");v(this,"wasAlreadySelected",!1);v(this,"didDrag",!1);v(this,"didCtrlOnEnter",!1);v(this,"info",{});v(this,"_labelDragOffset",new y(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(t){const{shape:r}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=t.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const i=this.editor.getShapeGeometry(r).children[1];if(!i)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:o}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,o);this._labelDragOffset=y.Sub(i.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:t}=this.editor.inputs;if(!t)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const s=lr(this.editor,r),i=this.editor.getShapeGeometry(r),o=i.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),c=o.nearestPoint(y.Add(a,this._labelDragOffset));let l;if(s.isStraight){const u=y.Dist(s.start.point,s.end.point);l=1-y.Dist(s.end.point,c)/u}else{const{_center:u,measure:h,angleEnd:p,angleStart:f}=i.children[0];l=Ip(h,f,p,u.angle(c))}isNaN(l)&&(l=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:l}})}onPointerUp(){const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(YC,"id","pointing_arrow_label");class VC extends te{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){Vc(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}v(VC,"id","pointing_canvas");class XC extends te{constructor(){super(...arguments);v(this,"didCtrlOnEnter",!1);v(this,"info",{})}onEnter(t){this.info=t,this.didCtrlOnEnter=t.accelKey;const{shape:r}=t;if(this.editor.isShapeOfType(r,"arrow")){const s=rn(this.editor,r)[t.handle.id];s&&this.editor.setHintingShapes([s.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:t,handle:r}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:s}=this,i=jb(s,t,r,!1);if(i){Bc(s,i,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(t){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:t}=this;if(t.getIsReadonly())return;const{shape:r,handle:s}=this.info;if(t.isShapeOfType(r,"note")){const i=jb(t,r,s,!0);if(i){const o=t.getPointInParentSpace(i,t.inputs.originPagePoint).sub(y.Rot(Rl.clone().mul(r.props.scale),i.rotation));t.updateShape({...i,x:o.x,y:o.y}),t.setHoveredShape(i.id).select(i.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(i),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{Bc(t,i,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}v(XC,"id","pointing_handle");function jb(n,e,t,r){const s=n.getShapePageTransform(e.id),i=s.point(),o=s.rotation(),c=aC(n,i,o,e.props.growY,0,e.props.scale)[t.index];if(c)return lC(n,e,c,o,r)}class ZC extends te{constructor(){super(...arguments);v(this,"info",{})}updateCursor(){this.editor.setCursor({type:Ti[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(t){this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}v(ZC,"id","pointing_rotate_handle");class JC extends te{constructor(){super(...arguments);v(this,"info",{})}onEnter(t){this.info=t}onPointerUp(t){Vc(this.editor,t),this.parent.transition("idle",t)}onPointerMove(t){this.editor.inputs.isDragging&&this.startTranslating(t)}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||this.parent.transition("translating",t)}onDoubleClick(t){var i,o;const r=this.editor.getHoveredShape(),s=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(s){this.parent.transition("idle"),(o=(i=this.parent).onDoubleClick)==null||o.call(i,{...t,target:"shape",shape:this.editor.getShape(s)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}v(JC,"id","pointing_selection");class QC extends te{constructor(){super(...arguments);v(this,"hitShape",{});v(this,"hitShapeForPointerUp",{});v(this,"isDoubleClick",!1);v(this,"didCtrlOnEnter",!1);v(this,"didSelectOnEnter",!1)}onEnter(t){const r=this.editor.getSelectedShapeIds(),s=this.editor.getSelectionRotatedPageBounds(),i=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:o}}=this.editor,{shiftKey:a,altKey:c,accelKey:l}=t;this.hitShape=t.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=l;const u=this.editor.getOutermostSelectableShape(t.shape),h=this.editor.findShapeAncestor(u,p=>r.includes(p.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(t.shape).onClick||u.id===i||r.includes(u.id)||h||r.length>1&&(s!=null&&s.containsPoint(o))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=u;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(u.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,u.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([u.id]))}onPointerUp(t){var u;const r=this.editor.getSelectedShapeIds(),s=this.editor.getFocusedGroupId(),i=this.editor.getZoomLevel(),{inputs:{currentPagePoint:o}}=this.editor,a=t.shiftKey||t.accelKey,c=this.editor.getShapeAtPoint(o,{margin:this.editor.options.hitTestMargin/i,hitInside:!0,renderingOnly:!0})??this.hitShape,l=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(l){const h=this.editor.getShapeUtil(l);if(h.onClick){const p=(u=h.onClick)==null?void 0:u.call(h,l);if(p){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([p]),this.parent.transition("idle",t);return}}if(l.id===s){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const h=this.editor.getOutermostSelectableShape(c,p=>!r.includes(p.id));if(r.includes(h.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(l);else if(r.includes(l.id)){if(r.length===1){const p=this.editor.getShapeUtil(l).getGeometry(l),f=GC(p),g=f.length===1?f[0]:void 0;if(g){const m=this.editor.getPointInShapeSpace(l,o);if(g.bounds.containsPoint(m,0)&&g.hitTestPoint(m)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(l.id);const x=this.editor.getShapeUtil(l);this.editor.getIsReadonly()&&!x.canEditInReadOnly(l)||(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:l.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(l);else if(a){const p=this.editor.getShapeAncestors(h);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(f=>!p.find(g=>g.id===f)),h.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([h.id])}this.parent.transition("idle",t)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(t){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startTranslating(t))}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",t))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}v(QC,"id","pointing_shape");class e_ extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"markId","");v(this,"didHoldCommand",!1);v(this,"creationCursorOffset",{x:0,y:0});v(this,"snapshot",{})}onEnter(t){const{isCreating:r=!1,creatingMarkId:s,creationCursorOffset:i={x:0,y:0}}=t;if(this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=i,this.snapshot=this._createSnapshot(),this.markId="",r)if(s)this.markId=s;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(He(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:s})=>{var a;const i=this.editor.getShapeUtil(s),o=(a=i.onResizeStart)==null?void 0:a.call(i,s);o&&r.push(o)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:s})=>{var c;const i=this.editor.getShape(s.id),o=this.editor.getShapeUtil(s),a=(c=o.onResizeEnd)==null?void 0:c.call(o,s,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:s,shapeSnapshots:i,selectionBounds:o,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:l,canShapesDeform:u}=this.snapshot;let h=r||!u;if(i.size===1){const C=[...i.values()][0];this.editor.isShapeOfType(C.shape,"text")&&(h=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:p}=this.editor.inputs,f=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),g=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!p){const{gridSize:C}=this.editor.getDocumentSettings();f.snapToGrid(C)}const m=this.info.handle,x=Mb(m,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!p:p)&&l%Ke===0){const{nudge:C}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:y.Sub(f,g),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:Mb(m,l),isAspectRatioLocked:h,isResizingFromCenter:t});f.add(C)}const S=y.RotWith(t?o.center:o.getHandlePoint(x),o.point,l),P=y.Sub(f,S).rot(-l),w=y.Sub(g,S).rot(-l),I=y.DivV(P,w);Number.isFinite(I.x)||(I.x=1),Number.isFinite(I.y)||(I.y=1);const E=m==="top"||m==="bottom",T=m==="left"||m==="right";h?T?I.y=Math.abs(I.x):E?I.x=Math.abs(I.y):Math.abs(I.x)>Math.abs(I.y)?I.y=Math.abs(I.x)*(I.y<0?-1:1):I.x=Math.abs(I.y)*(I.x<0?-1:1):(E&&(I.x=1),T&&(I.y=1)),this.info.isCreating||this.updateCursor({dragHandle:m,isFlippedX:I.x<0,isFlippedY:I.y<0,rotation:l});for(const C of i.keys()){const j=i.get(C);this.editor.resizeShape(C,I,{initialShape:j.shape,initialBounds:j.bounds,initialPageTransform:j.pageTransform,dragHandle:m,mode:c.length===1&&C===c[0]?"resize_bounds":"scale_shape",scaleOrigin:S,isAspectRatioLocked:h,scaleAxisRotation:l,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:C,children:j}of s){if(!j.length)continue;const k=i.get(C).shape,R=this.editor.getShape(C);if(!(k&&R))continue;const A=R.x-k.x,D=R.y-k.y,O=new y(A,D).rot(-k.rotation);if(O.x!==0||O.y!==0)for(const $ of j)this.editor.updateShape({id:$.id,type:$.type,x:$.x-O.x,y:$.y-O.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:C}of s)if(C.length)for(const j of C)this.editor.updateShape({id:j.id,type:j.type,x:j.x,y:j.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:s,rotation:i}){const o={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{o.type="nwse-resize",r!==s&&(o.type="nesw-resize");break}case"top_right":case"bottom_left":{o.type="nesw-resize",r!==s&&(o.type="nwse-resize");break}}o.rotation=i,this.editor.setCursor(o)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:s}}=this.editor,i=this.editor.getSelectionRotatedPageBounds(),o=y.RotWith(i.getHandlePoint(this.info.handle),i.point,r),a=y.Sub(s,o),c=new Map,l=[];t.forEach(h=>{const p=this.editor.getShape(h);if(p){if(p.type==="frame"&&l.push({id:h,children:fe(this.editor.getSortedChildIdsForParent(p).map(f=>this.editor.getShape(f)))}),c.set(p.id,this._createShapeSnapshot(p)),this.editor.isShapeOfType(p,"frame")&&t.length===1)return;this.editor.visitDescendants(p.id,f=>{const g=this.editor.getShape(f);if(g&&(c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")))return!1})}});const u=![...c.values()].some(h=>!H0(h.pageRotation,r)||h.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:i,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:u,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:l}}_createShapeSnapshot(t){const r=this.editor.getShapePageTransform(t),s=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:W.Decompose(r).rotation,isAspectRatioLocked:s.isAspectRatioLocked(t)}}}v(e_,"id","resizing");const $h=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function Mb(n,e){e=e%Le;const t=Math.round(e/(je/4)),r=$h.indexOf(n);return $h[(r+t)%$h.length]}const Ab=Math.PI/180;class t_ extends te{constructor(){super(...arguments);v(this,"snapshot",{});v(this,"info",{});v(this,"markId","")}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=Hv({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const s=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Ya({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Ti[this.info.handle],rotation:s+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Ya({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Ti[this.info.handle],rotation:t+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){Ya({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),He(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),s=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:i,currentPagePoint:o}}=this.editor,{initialCursorAngle:a,initialShapesRotation:c}=this.snapshot;if(!s)return c;const u=s.center.clone().rotWith(s.point,r).angle(o)-a;let h=c+u;if(i)h=Lc(h,24);else if(t&&(h=Math.round(h/Ab)*Ab,this.editor.getInstanceState().isCoarsePointer)){const p=Lc(h,4),f=Ga(h,p);Math.abs(f)<qM(5)&&(h=p)}return h-c}}v(t_,"id","rotating");class n_ extends te{constructor(){super(...arguments);v(this,"hits",new Set);v(this,"size",0);v(this,"scribbleId","id");v(this,"initialSelectedShapeIds",new Set);v(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}updateScribbleSelection(t){const{editor:r}=this,s=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:i,originPagePoint:o,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:u}=this;t&&this.pushPointToScribble();const h=s;let p,f,g,m;const x=0;for(let P=0,w=h.length;P<w;P++){if(p=h[P],r.isShapeOfType(p,"group")||l.has(p.id)||r.isShapeOrAncestorLocked(p)||(f=r.getShapeGeometry(p),r.isShapeOfType(p,"frame")&&f.bounds.containsPoint(r.getPointInShapeSpace(p,o))))continue;const I=r.getShapePageTransform(p);if(!f||!I)continue;const E=I.clone().invert();g=E.applyToPoint(a),m=E.applyToPoint(c);const{bounds:T}=f;if(!(T.minX-x>Math.max(g.x,m.x)||T.minY-x>Math.max(g.y,m.y)||T.maxX+x<Math.min(g.x,m.x)||T.maxY+x<Math.min(g.y,m.y))&&f.hitTestLineSegment(g,m,x)){const C=this.editor.getOutermostSelectableShape(p),j=this.editor.getShapeMask(C.id);if(j&&dg(a,c,j)!==null&&!wn(c,j))continue;l.add(C.id)}}const b=r.getSelectedShapeIds(),S=new Set(i?[...l,...u]:[...l]);(b.length!==S.size||b.some(P=>!S.has(P)))&&this.editor.setSelectedShapes(Array.from(S))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}v(n_,"id","scribble_brushing");var F6=Object.create,r_=Object.defineProperty,$6=Object.getOwnPropertyDescriptor,z6=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),s_=n=>{throw TypeError(n)},i_=(n,e,t)=>e in n?r_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,N6=n=>[,,,F6(null)],o_=["class","method","getter","setter","accessor","field","value","get","set"],a_=n=>n!==void 0&&typeof n!="function"?s_("Function expected"):n,B6=(n,e,t,r,s)=>({kind:o_[n],name:e,metadata:r,addInitializer:i=>t._?s_("Already initialized"):s.push(a_(i||null))}),U6=(n,e)=>i_(e,z6("metadata"),n[3]),H6=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},K6=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=o_[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,$6(s,t)),b=r.length-1;b>=0;b--)c=B6(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,a_(o)&&(x[g]=o);return x&&r_(s,t,x),s},zh=(n,e,t)=>i_(n,typeof e!="symbol"?e+"":e,t),c_,Nl;const q6=20,G6=100;c_=[on];class Hg{constructor(e){this.editor=e,H6(Nl,5,this),zh(this,"prevDroppingShapeId",null),zh(this,"droppingNodeTimer",null),zh(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.editor.setHintingShapes(e.map(s=>this.editor.findShapeAncestor(s,i=>i.type!=="group")).filter(s=>s)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,q6,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,G6,t))}setDragTimer(e,t,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var c,l,u,h,p;t=fe(t.map(f=>this.editor.getShape(f.id)));const s=((c=this.editor.getDroppingOverShape(e,t))==null?void 0:c.id)??null;if(s===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),a=s&&this.editor.getShape(s);o&&((u=(l=this.editor.getShapeUtil(o)).onDragShapesOut)==null||u.call(l,o,t)),a&&((p=(h=this.editor.getShapeUtil(a)).onDragShapesOver)==null||p.call(h,a,t)),this.hintParents(t),r==null||r(),this.prevDroppingShapeId=s}hintParents(e){const t=new Map;for(const s of e){const i=this.editor.findShapeAncestor(s,o=>o.type!=="group");i&&(t.has(i.id)||t.set(i.id,[]),t.get(i.id).push(s.id))}const r=[];for(const[s,i]of t){const o=this.editor.getShape(s);o&&MI(this.editor,o).length<i.length&&r.push(o.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,s;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const i=this.editor.getShape(t);if(!i)return;(s=(r=this.editor.getShapeUtil(i)).onDropShapesOver)==null||s.call(r,i,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}Nl=N6();K6(Nl,1,"dispose",c_,Hg);U6(Nl,Hg);var W6=Object.create,l_=Object.defineProperty,Y6=Object.getOwnPropertyDescriptor,d_=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),u_=n=>{throw TypeError(n)},h_=(n,e,t)=>e in n?l_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,V6=n=>[,,,W6((n==null?void 0:n[d_("metadata")])??null)],p_=["class","method","getter","setter","accessor","field","value","get","set"],f_=n=>n!==void 0&&typeof n!="function"?u_("Function expected"):n,X6=(n,e,t,r,s)=>({kind:p_[n],name:e,metadata:r,addInitializer:i=>t._?u_("Already initialized"):s.push(f_(i||null))}),Z6=(n,e)=>h_(e,d_("metadata"),n[3]),J6=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},Q6=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=p_[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,Y6(s,t)),b=r.length-1;b>=0;b--)c=X6(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,f_(o)&&(x[g]=o);return x&&l_(s,t,x),s},is=(n,e,t)=>h_(n,typeof e!="symbol"?e+"":e,t),g_,of,Bl;class Ul extends(of=te,g_=[on],of){constructor(){super(...arguments),J6(Bl,5,this),is(this,"info",{}),is(this,"selectionSnapshot",{}),is(this,"snapshot",{}),is(this,"markId",""),is(this,"isCloning",!1),is(this,"isCreating",!1),is(this,"dragAndDropManager",new Hg(this.editor))}onCreate(e){}onEnter(e){var i;const{isCreating:t=!1,creatingMarkId:r,onCreate:s=()=>{}}=e;if(!((i=this.editor.getSelectedShapeIds())!=null&&i.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(r)this.markId=r;else{const o=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);o&&(this.markId=o)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=s,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=Db(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=Db(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),He(this.editor,this.snapshot.movingShapes.map(t=>t.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(r=>{var o;const s=this.editor.getShapeUtil(r),i=(o=s.onTranslateStart)==null?void 0:o.call(s,r);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=y.Average(e.map(i=>this.editor.getShapePageTransform(i.id).point())),s=y.Sub(r,this.selectionSnapshot.averagePagePoint);y.IsNaN(s)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(i=>i.id),offset:{x:s.x,y:s.y}}})}const t=[];e.forEach(r=>{var a;const s=this.editor.getShape(r.id),i=this.editor.getShapeUtil(r),o=(a=i.onTranslateEnd)==null?void 0:a.call(i,r,s);o&&t.push(o)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),e$({editor:this.editor,snapshot:e});const{movingShapes:t}=e,r=[];t.forEach(s=>{var c;const i=this.editor.getShape(s.id),o=this.editor.getShapeUtil(s),a=(c=o.onTranslate)==null?void 0:c.call(o,s,i);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(r=>{const s=e.getShape(r.shape.id);if(!s)return null;const i=Zt(s.parentId)?null:W.Inverse(e.getShapePageTransform(s.parentId));r.parentTransform=i})}}Bl=V6(of);Q6(Bl,1,"updateParentTransforms",g_,Ul);Z6(Bl,Ul);is(Ul,"id","translating");function Db(n){var h;const e=[],t=[],r=n.getSelectedShapeIds(),s=fe(r.map(p=>{const f=n.getShape(p);if(!f)return null;e.push(f);const g=n.getShapePageTransform(p),m=g.point(),x=g.rotation();t.push(m);const b=In.isId(f.parentId)?null:W.Inverse(n.getShapePageTransform(f.parentId));return{shape:f,pagePoint:m,pageRotation:x,parentTransform:b}})),i=n.getOnlySelectedShape();let o=[];if(i)o=n.snaps.shapeBounds.getSnapPoints(i.id);else{const p=n.getSelectionPageBounds();p&&(o=p.cornersAndCenter.map((f,g)=>({id:"selection:"+g,x:f.x,y:f.y})))}let a,c;const{originPagePoint:l}=n.inputs,u=s.filter(p=>n.isShapeOfType(p.shape,"note")&&n.isPointInShape(p.shape,l));if(u.length!==0)if(u.length===1)c=u[0];else{const p=n.getCurrentPageShapesSorted();c=(h=u.map(f=>({snapshot:f,index:p.findIndex(g=>g.id===f.shape.id)})).sort((f,g)=>g.index-f.index)[0])==null?void 0:h.snapshot}return c&&(a=cC(n,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:y.Average(t),movingShapes:e,shapeSnapshots:s,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:o,noteAdjacentPositions:a,noteSnapshot:c}}function e$({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:r,noteAdjacentPositions:s,initialPageBounds:i,initialSnapPoints:o,shapeSnapshots:a,averagePagePoint:c}=e,l=n.getInstanceState().isGridMode,u=n.getDocumentSettings().gridSize,h=y.Sub(t.currentPagePoint,t.originPagePoint),p=n.inputs.shiftKey?Math.abs(h.x)<Math.abs(h.y)?"x":"y":null;p==="x"?h.x=0:p==="y"&&(h.y=0),n.snaps.clearIndicators();const f=n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let g=!1;if(f&&n.inputs.pointerVelocity.len()<.5){const{nudge:S}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:h,initialSelectionPageBounds:i,lockedAxis:p,initialSelectionSnapPoints:o});h.add(S)}else if(r&&s){const{scale:S}=r.shape.props,P=r.pagePoint.clone().add(h).add(Rl.clone().mul(S).rot(r.pageRotation));let w=oC/n.getZoomLevel(),I=new y(0,0);for(const E of s){const T=y.Sub(P,E),C=T.len();C<w&&(g=!0,w=C,I=T)}h.sub(I)}const m=y.Add(c,h),x=n.snaps.getIndicators();l&&!t.ctrlKey&&!g&&x.length===0&&m.snapToGrid(u);const b=y.Sub(m,c);n.updateShapes(fe(a.map(({shape:S,pagePoint:P,parentTransform:w})=>{const I=y.Add(P,b),E=w?W.applyToPoint(w,I):I;return{id:S.id,type:S.type,x:E.x,y:E.y}})))}class mc extends te{constructor(){super(...arguments);v(this,"reactor")}static children(){return[sf,Bg,D6,VC,QC,Ul,zC,n_,Ug,JC,NC,WC,e_,t_,ZC,YC,XC,qC]}cleanUpDuplicateProps(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const s=new Set(r.duplicateProps.shapeIds);t.length===s.size&&t.every(i=>s.has(i))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=ur("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){console.error(t)}})}onExit(){var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}v(mc,"id","select"),v(mc,"initial","idle"),v(mc,"isLockable",!1);class m_ extends te{constructor(){super(...arguments);v(this,"info",{})}onEnter(t){this.info=t}onPointerDown(){this.parent.transition("pointing",this.info)}}v(m_,"id","idle");class y_ extends te{constructor(){super(...arguments);v(this,"info",{})}onEnter(t){this.info=t}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}v(y_,"id","pointing");class S_ extends te{constructor(){super(...arguments);v(this,"info",{});v(this,"zoomBrush",new V)}onEnter(t){this.info=t,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(V.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const s=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(s,{animation:{duration:220}}):this.editor.zoomIn(s,{animation:{duration:220}})}else{const s=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:s,animation:{duration:220}})}this.parent.transition("idle",this.info)}}v(S_,"id","zoom_brushing");class yc extends te{constructor(){super(...arguments);v(this,"info",{})}static children(){return[m_,S_,y_]}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(t){this.updateCursor(),t.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}v(yc,"id","zoom"),v(yc,"initial","idle"),v(yc,"isLockable",!1);const t$=[pc,fc,gc,yc,mc];function n$(){const n=z(),e=N("follow",()=>n.getInstanceState().followingUserId,[n]);return e?d.jsx(r$,{userId:e}):null}function r$({userId:n}){const e=ul(n);return e?d.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let af={fonts:{draw:`${us()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${us()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${us()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${us()}/fonts/IBMPlexMono-Medium.woff2`}};function x_(n){return _.useMemo(()=>n?{fonts:{...af.fonts,...n==null?void 0:n.fonts}}:af,[n])}const s$=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let lo={...af,icons:Object.fromEntries(s$.map(n=>[n,`${us()}/icons/icon/0_merged.svg#${n}`])),translations:Object.fromEntries(zo.map(n=>[n.locale,`${us()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(Tg.map(n=>[n.type,`${us()}/embed-icons/${n.type}.png`]))};function i$(n){return n?{fonts:Object.assign({...lo.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...lo.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...lo.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...lo.translations},{...n==null?void 0:n.translations})}:lo}function o$(){const{addToast:n,removeToast:e,clearToasts:t}=vr(),{addDialog:r,clearDialogs:s,removeDialog:i}=Xs(),a=Yt()<ot.TABLET_SM,c=Pe();return _.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,removeDialog:i,clearDialogs:s,msg:c,isMobile:a}),[r,n,s,t,c,i,e,a])}function a$(n,e){const t={};for(const r of n)if(r.translations)for(const[s,i]of cn(r.translations)){let o=t[s];o||(o=t[s]={}),Object.assign(o,i)}return{actions:(r,s)=>{for(const i of n)i.actions&&(s=i.actions(r,s,e));return s},tools:(r,s,i)=>{for(const o of n)o.tools&&(s=o.tools(r,s,{...e,...i}));return s},translations:t}}function b_(n){return _.useMemo(()=>n,n)}function c$(n){const e=b_(n==null?[]:Array.isArray(n)?n:[n]);return _.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[s,i]of cn(r.translations)){let o=t[s];o||(o=t[s]={}),Object.assign(o,i)}return t},[e])}function l$(n){const e=o$(),t=b_(n==null?[]:Array.isArray(n)?n:[n]);return _.useMemo(()=>a$(t,e),[t,e])}function Kg({id:n,children:e,onOpenChange:t,open:r}){const[s,i]=Vr(n,t);return d.jsx(pf,{onOpenChange:i,open:r||s,children:d.jsx("div",{className:"tlui-popover",children:e})})}function qg({children:n}){return d.jsx(ff,{asChild:!0,dir:"ltr",children:n})}function Gg({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:s=0,disableEscapeKeyDown:i=!1}){const o=ft();return d.jsx(gf,{container:o,children:d.jsx(mf,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:s,dir:"ltr",onEscapeKeyDown:a=>i&&a.preventDefault(),children:e})})}function d$(n){return n.getSelectedShapeIds().map(r=>n.getShape(r)).filter(r=>{if(!r)return!1;if(n.isShapeOfType(r,"arrow")){const s=rn(n,r);if(s.start||s.end)return!1}return!0})}const w_=()=>{const n=z();return N("threeStackableItems",()=>d$(n).length>2,[n])},Xr=()=>{const n=z();return N("isInSelectState",()=>n.isIn("select"),[n])},v_=()=>{const n=z();return N("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const r=rn(n,t);if(r.start&&!e.some(s=>s.id===r.start.toId)||r.end&&!e.some(s=>s.id===r.end.toId))return!1}return!0},[n])},P_=()=>{const n=z();return N("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},u$=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function I_(n,e){const t=z();return N("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function Vt(n,e){const t=z();return N("selectedShapes",()=>{const r=t.getSelectedShapes().filter(s=>!t.isShapeOrAncestorLocked(s)).length;return n===void 0?r:r>=n},[t])}function h$(){const n=z();return N("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function C_(){const n=z();return N("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function p$(){const n=z();return N("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function __(){const n=z();return N("useCanRedo",()=>n.getCanRedo(),[n])}function E_(){const n=z();return N("useCanUndo",()=>n.getCanUndo(),[n])}function f$(){return d.jsxs(d.Fragment,{children:[d.jsx(g$,{}),d.jsx(m$,{}),d.jsx(y$,{}),d.jsx(S$,{}),d.jsx(x$,{}),d.jsx(v$,{}),d.jsx(P$,{}),d.jsx(I$,{})]})}function g$(){const n=Vt(2),e=Xr(),t=n&&e;return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"align-left",disabled:!t}),d.jsx(H,{actionId:"align-center-horizontal",disabled:!t}),d.jsx(H,{actionId:"align-right",disabled:!t}),d.jsx(H,{actionId:"stretch-horizontal",disabled:!t}),d.jsx(H,{actionId:"align-top",disabled:!t}),d.jsx(H,{actionId:"align-center-vertical",disabled:!t}),d.jsx(H,{actionId:"align-bottom",disabled:!t}),d.jsx(H,{actionId:"stretch-vertical",disabled:!t})]})}function m$(){const n=Vt(3),e=Xr(),t=n&&e;return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"distribute-horizontal",disabled:!t}),d.jsx(H,{actionId:"distribute-vertical",disabled:!t})]})}function y$(){const n=w_(),e=Xr(),t=n&&e;return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"stack-horizontal",disabled:!t}),d.jsx(H,{actionId:"stack-vertical",disabled:!t})]})}function S$(){const n=Vt(1),e=Xr(),t=n&&e;return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"send-to-back",disabled:!t}),d.jsx(H,{actionId:"send-backward",disabled:!t}),d.jsx(H,{actionId:"bring-forward",disabled:!t}),d.jsx(H,{actionId:"bring-to-front",disabled:!t})]})}function x$(){return Yt()<ot.TABLET_SM?d.jsx(b$,{}):d.jsx(w$,{})}function b$(){const n=z(),e=N("zoom is 1",()=>n.getZoomLevel()===1,[n]);return d.jsx(H,{actionId:"zoom-to-100",disabled:e})}function w$(){const n=Vt(1),e=Xr(),t=n&&e;return d.jsx(H,{actionId:"rotate-ccw",disabled:!t})}function v$(){const n=Vt(1),e=Xr(),t=n&&e;return d.jsx(H,{actionId:"rotate-cw",disabled:!t})}function P$(){const n=C_(),e=Xr(),t=n&&e;return d.jsx(H,{actionId:"edit-link",disabled:!t})}function I$(){const n=v_(),e=P_();return n?d.jsx(Ob,{}):e?d.jsx(C$,{}):d.jsx(Ob,{})}function Ob(){const n=Vt(2),e=Xr(),t=n&&e;return d.jsx(H,{actionId:"group",disabled:!t})}function C$(){return d.jsx(H,{actionId:"ungroup"})}const _$=_.memo(function({children:e}){const t=Pe(),r=Yt(),s=_n(),i=_.useRef(null);Ps(i);const o=z(),a=N("should display quick actions when in readonly",()=>o.isInAny("hand","zoom"),[o]),c=e??d.jsx(f$,{});if(!(s&&!a))return d.jsxs(Kg,{id:"actions-menu",children:[d.jsx(qg,{children:d.jsx(ie,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:d.jsx(we,{icon:"dots-vertical",small:!0})})}),d.jsx(Gg,{side:r>=ot.TABLET?"bottom":"top",sideOffset:6,children:d.jsx("div",{ref:i,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:d.jsx(Ln,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function T_(){return h$()?d.jsx(H,{actionId:"toggle-auto-size"}):null}function k_(){return C_()?d.jsx(H,{actionId:"edit-link"}):null}function E$(){return Vt(1)?d.jsx(H,{actionId:"duplicate"}):null}function j_(){const n=z();return N("should display flatten option",()=>{if(n.getSelectedShapeIds().length===0)return!1;const r=n.getOnlySelectedShape();return!(r&&n.isShapeOfType(r,"image"))},[n])?d.jsx(H,{actionId:"flatten-to-image"}):null}function M_(){return v_()?d.jsx(H,{actionId:"group"}):null}function A_(){return P_()?d.jsx(H,{actionId:"ungroup"}):null}function D_(){const n=z();return N("allow unframe",()=>{const t=n.getSelectedShapes();return t.length===0?!1:t.every(r=>n.isShapeOfType(r,"frame"))},[n])?d.jsx(H,{actionId:"remove-frame"}):null}function O_(){const n=z();return N("allow fit frame to content",()=>{const t=n.getOnlySelectedShape();return t?n.isShapeOfType(t,"frame")&&n.getSortedChildIdsForParent(t).length>0:!1},[n])?d.jsx(H,{actionId:"fit-frame-to-content"}):null}function R_(){const n=z();return N("selected shapes",()=>n.getSelectedShapes().length>0,[n])?d.jsx(H,{actionId:"toggle-lock"}):null}function Wg(){const n=z(),e=N("isTransparentBg",()=>!n.getInstanceState().exportBackground,[n]);return d.jsx(er,{actionId:"toggle-transparent",checked:e,toggle:!0})}function T$(){const n=z(),e=N("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return d.jsx(H,{actionId:"unlock-all",disabled:!e})}function L_(){const n=z(),e=N("zoomed to 100",()=>n.getZoomLevel()===1,[n]);return d.jsx(H,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function F_(){const n=z(),e=N("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return d.jsx(H,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function $_(){const n=z(),e=N("has shapes",()=>n.getSelectedShapeIds().length>0,[n]);return d.jsx(H,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function z_(){return d.jsxs(Se,{id:"clipboard",children:[d.jsx(j$,{}),d.jsx(M$,{}),d.jsx(A$,{}),d.jsx(E$,{}),d.jsx(D$,{})]})}function k$(){var t;const n=z(),e=N("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return d.jsxs(hn,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[d.jsxs(Se,{id:"copy-as-group",children:[d.jsx(H,{actionId:"copy-as-svg"}),!!((t=window.navigator.clipboard)!=null&&t.write)&&d.jsx(H,{actionId:"copy-as-png"}),d.jsx(H,{actionId:"copy-as-json"})]}),d.jsx(Se,{id:"copy-as-bg",children:d.jsx(Wg,{})})]})}function j$(){const n=Vt(1);return d.jsx(H,{actionId:"cut",disabled:!n})}function M$(){const n=I_(1);return d.jsx(H,{actionId:"copy",disabled:!n})}function A$(){const n=u$;return d.jsx(H,{actionId:"paste",disabled:!n})}function N_(){const n=z();return N("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?d.jsxs(Se,{id:"conversions",children:[d.jsx(k$,{}),d.jsxs(hn,{id:"export-as",label:"context-menu.export-as",size:"small",children:[d.jsxs(Se,{id:"export-as-group",children:[d.jsx(H,{actionId:"export-as-svg"}),d.jsx(H,{actionId:"export-as-png"}),d.jsx(H,{actionId:"export-as-json"})]}),d.jsx(Se,{id:"export-as-bg",children:d.jsx(Wg,{})})]})]}):null}function B_(){const n=z(),e=N("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return d.jsx(H,{actionId:"select-all",disabled:!e})}function D$(){const n=Vt(1);return d.jsx(H,{actionId:"delete",disabled:!n})}function O$(){const n=_n();return!I_(1)||n?null:d.jsxs(hn,{id:"edit",label:"context-menu.edit",size:"small",children:[d.jsx(M_,{}),d.jsx(A_,{}),d.jsx(j_,{}),d.jsx(k_,{}),d.jsx(O_,{}),d.jsx(D_,{}),d.jsx(H_,{}),d.jsx(U_,{}),d.jsx(T_,{}),d.jsx(R_,{})]})}function R$(){const n=Vt(2),e=p$();return _n()||!(n||e)?null:d.jsxs(hn,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&d.jsxs(Se,{id:"align",children:[d.jsx(H,{actionId:"align-left"}),d.jsx(H,{actionId:"align-center-horizontal"}),d.jsx(H,{actionId:"align-right"}),d.jsx(H,{actionId:"align-top"}),d.jsx(H,{actionId:"align-center-vertical"}),d.jsx(H,{actionId:"align-bottom"})]}),d.jsx(L$,{}),n&&d.jsxs(Se,{id:"stretch",children:[d.jsx(H,{actionId:"stretch-horizontal"}),d.jsx(H,{actionId:"stretch-vertical"})]}),(n||e)&&d.jsxs(Se,{id:"flip",children:[d.jsx(H,{actionId:"flip-horizontal"}),d.jsx(H,{actionId:"flip-vertical"})]}),d.jsx(F$,{})]})}function L$(){return Vt(3)?d.jsxs(Se,{id:"distribute",children:[d.jsx(H,{actionId:"distribute-horizontal"}),d.jsx(H,{actionId:"distribute-vertical"})]}):null}function F$(){const n=Vt(2),e=w_();return n?d.jsxs(Se,{id:"order",children:[d.jsx(H,{actionId:"pack"}),e&&d.jsx(H,{actionId:"stack-horizontal"}),e&&d.jsx(H,{actionId:"stack-vertical"})]}):null}function $$(){const n=_n(),e=Vt(1);return n||!e?null:d.jsx(hn,{id:"reorder",label:"context-menu.reorder",size:"small",children:d.jsxs(Se,{id:"reorder",children:[d.jsx(H,{actionId:"bring-to-front"}),d.jsx(H,{actionId:"bring-forward"}),d.jsx(H,{actionId:"send-backward"}),d.jsx(H,{actionId:"send-to-back"})]})})}function z$(){const n=z(),e=N("pages",()=>n.getPages(),[n]),t=N("current page id",()=>n.getCurrentPageId(),[n]),{addToast:r}=vr(),s=kt(),i=_n();return!Vt(1)||i?null:d.jsxs(hn,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[d.jsx(Se,{id:"pages",children:e.map(a=>d.jsx(It,{id:a.id,disabled:t===a.id,label:a.name.length>30?`${a.name.slice(0,30)}…`:a.name,onSelect:()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),a.id);const c=n.getPage(a.id);c&&r({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.markHistoryStoppingPoint("change-page"),n.setCurrentPage(t)}}]}),s("move-to-page",{source:"context-menu"})}},a.id))}),d.jsx(Se,{id:"new-page",children:d.jsx(H,{actionId:"move-to-new-page"})})]})}function U_(){const n=z();return N("oneEmbedSelected",()=>{const t=n.getOnlySelectedShape();return t?!!(n.isShapeOfType(t,"embed")&&t.props.url&&!n.isShapeOrAncestorLocked(t)):!1},[n])?d.jsx(H,{actionId:"convert-to-bookmark"}):null}function H_(){const n=z(),e=kg();return N("oneEmbeddableBookmarkSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!n.isShapeOrAncestorLocked(r)):!1},[n])?d.jsx(H,{actionId:"convert-to-embed"}):null}function N$(){const n=z(),e=N("isSnapMode",()=>n.user.getIsSnapMode(),[n]);return d.jsx(er,{actionId:"toggle-snap-mode",checked:e})}function B$(){const n=z(),e=N("isToolLock",()=>n.getInstanceState().isToolLocked,[n]);return d.jsx(er,{actionId:"toggle-tool-lock",checked:e})}function U$(){const n=z(),e=N("isGridMode",()=>n.getInstanceState().isGridMode,[n]);return d.jsx(er,{actionId:"toggle-grid",checked:e})}function H$(){const n=z(),e=N("isWrapMode",()=>n.user.getIsWrapMode(),[n]);return d.jsx(er,{actionId:"toggle-wrap-mode",checked:e})}function K$(){const n=z(),e=N("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]);return d.jsx(er,{actionId:"toggle-focus-mode",checked:e})}function q$(){const n=z(),e=N("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]);return d.jsx(er,{actionId:"toggle-edge-scrolling",checked:e===1})}function G$(){const n=z(),e=N("animationSpeed",()=>n.user.getAnimationSpeed(),[n]);return d.jsx(er,{actionId:"toggle-reduce-motion",checked:e===0})}function W$(){const n=z(),e=N("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]);return d.jsx(er,{actionId:"toggle-debug-mode",checked:e})}function Y$(){const n=z(),e=N("dynamic resize",()=>n.user.getIsDynamicResizeMode(),[n]);return d.jsx(er,{actionId:"toggle-dynamic-size-mode",checked:e})}function V$(){const n=z(),e=N("paste at cursor",()=>n.user.getIsPasteAtCursorMode(),[n]);return d.jsx(er,{actionId:"toggle-paste-at-cursor",checked:e})}function X$(){const n=z();return N("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?d.jsx(H,{actionId:"open-cursor-chat"}):null}function Z$(){const n=z(),e=Ml(),t=N("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]),r=N("isSinglePageMode",()=>n.options.maxPages<=1,[n]);return t?d.jsxs(d.Fragment,{children:[e&&d.jsx(X$,{}),d.jsxs(Se,{id:"modify",children:[d.jsx(O$,{}),d.jsx(R$,{}),d.jsx($$,{}),!r&&d.jsx(z$,{})]}),d.jsx(z_,{}),d.jsx(N_,{}),d.jsx(Se,{id:"select-all",children:d.jsx(B_,{})})]}):null}const J$=_.memo(function({children:e,disabled:t=!1}){const r=z(),{Canvas:s}=Xe(),i=_.useCallback(u=>{if(u){if(r.getInstanceState().isCoarsePointer){const h=r.getSelectedShapes(),{inputs:{currentPagePoint:p}}=r,f=r.getShapesAtPoint(p);if(!r.getSelectedShapes().length||!f.some(g=>h.includes(g))){const g=f.filter(m=>r.isShapeOrAncestorLocked(m));g.length&&r.select(...g.map(m=>m.id))}}}else{const h=r.getOnlySelectedShape();h&&r.isShapeOrAncestorLocked(h)&&r.setSelectedShapes([])}},[r]),o=ft(),[a,c]=Vr("context menu",i),l=e??d.jsx(Z$,{});return d.jsxs(HE,{dir:"ltr",onOpenChange:c,modal:!1,children:[d.jsx(KE,{onContextMenu:void 0,dir:"ltr",disabled:t,children:s?d.jsx(s,{}):null}),a&&d.jsx(qE,{container:o,children:d.jsx(GE,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:xe,children:d.jsx(Ln,{type:"context-menu",sourceId:"context-menu",children:l})})})]})}),Q$=2e3,e8=5e3,t8=Et(function(){const e=z(),{isChatting:t,chatMessage:r}=e.getInstanceState(),s=_.useRef(-1),[i,o]=_.useState("");return _.useEffect(()=>{if(!t&&r||t){const c=t?e8:Q$;s.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),o(""),e.focus()},c)}return()=>{clearTimeout(s.current)}},[e,r,t]),t?d.jsx(r8,{value:i,setValue:o,chatMessage:r}):r.trim()?d.jsx(n8,{chatMessage:r}):null});function K_(n){const e=z();_.useLayoutEffect(()=>{var o;if(!n.current)return;const{x:r,y:s}=e.inputs.currentScreenPoint;(o=n.current)==null||o.style.setProperty("transform",`translate(${r}px, ${s}px)`);function i(a){var u;const{minX:c,minY:l}=e.getViewportScreenBounds();(u=n.current)==null||u.style.setProperty("transform",`translate(${a.clientX-c}px, ${a.clientY-l}px)`)}return window.addEventListener("pointermove",i),()=>{window.removeEventListener("pointermove",i)}},[n,e])}const n8=({chatMessage:n})=>{const e=z(),t=_.useRef(null);return K_(t),d.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},r8=Et(function({chatMessage:e,value:t,setValue:r}){const s=z(),i=Pe(),o=_.useRef(null),a=e||i("cursor-chat.type-to-chat");K_(o),_.useLayoutEffect(()=>{const p=o.current;if(!p)return;const f=s.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});p.style.setProperty("width",f.w+"px")},[s,t,a]),_.useLayoutEffect(()=>{const p=s.timers.requestAnimationFrame(()=>{var f;(f=o.current)==null||f.focus()});return()=>{cancelAnimationFrame(p)}},[s]);const c=_.useCallback(()=>{s.updateInstanceState({isChatting:!1}),s.focus()},[s]),l=_.useCallback(p=>{const{value:f}=p.target;r(f.slice(0,64)),s.updateInstanceState({chatMessage:f})},[s,r]),u=_.useCallback(p=>{const f=o.current;if(!f)return;const{value:g}=f;switch(p.key){case"Enter":{if(xe(p),p.stopPropagation(),!g){c();return}r("");break}case"Escape":{xe(p),p.stopPropagation(),c();break}}},[c,r]),h=_.useCallback(p=>{p.stopPropagation()},[]);return d.jsx("input",{ref:o,className:"tl-cursor-chat",style:{backgroundColor:s.user.getColor()},onBlur:c,onChange:l,onKeyDown:u,onPaste:h,value:t,placeholder:a,spellCheck:!1})});function cf({checked:n}){return d.jsx(Sr,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function s8(){const n=z(),{addToast:e}=vr(),{addDialog:t}=Xs(),[r,s]=Qe.useState(!1);return d.jsxs(d.Fragment,{children:[d.jsxs(Se,{id:"items",children:[d.jsx(It,{id:"add-toast",onSelect:()=>{e({id:Fe(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:Fe(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Fe(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:Fe(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),d.jsx(It,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:i})=>d.jsx(a8,{displayDontShowAgain:!0,onCancel:()=>i(),onContinue:()=>i()}),onClose:()=>{}})}}),d.jsx(It,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>c8(n,100)}),d.jsx(It,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const i=n.getSelectedShapes(),o=i.length===0?n.getRenderingShapes():i;window.alert(`Shapes ${o.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),d.jsx(It,{id:"throw-error",onSelect:()=>s(!0),label:"Throw error"}),d.jsx(It,{id:"hard-reset",onSelect:sv,label:"Hard reset"})]}),d.jsxs(Se,{id:"flags",children:[d.jsx(i8,{}),d.jsx(o8,{})]})]})}function i8(){const n=Object.values(ct);return n.length?d.jsx(hn,{id:"debug flags",label:"Debug Flags",children:d.jsx(Se,{id:"debug flags",children:n.map(e=>d.jsx(q_,{flag:e},e.name))})}):null}function o8(){const n=Object.values(ZM);return n.length?d.jsx(hn,{id:"feature flags",label:"Feature Flags",children:d.jsx(Se,{id:"feature flags",children:n.map(e=>d.jsx(q_,{flag:e},e.name))})}):null}function a8({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:s=!1,onCancel:i,onContinue:o}){const[a,c]=Qe.useState(!1);return d.jsxs(d.Fragment,{children:[d.jsxs(El,{children:[d.jsx(Tl,{children:n}),d.jsx(kl,{})]}),d.jsx(Bo,{style:{maxWidth:350},children:e}),d.jsxs(Eg,{className:"tlui-dialog__footer__actions",children:[s&&d.jsxs(ie,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[d.jsx(cf,{checked:a}),d.jsx(lt,{children:"Don’t show again"})]}),d.jsx(ie,{type:"normal",onClick:i,children:d.jsx(lt,{children:t})}),d.jsx(ie,{type:"primary",onClick:async()=>o(),children:d.jsx(lt,{children:r})})]})]})}const q_=Et(function({flag:e,onChange:t}){const r=e.get();return d.jsx(Dl,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,s=>`${s[0]} ${s[1].toLowerCase()}`).replace(/^[a-z]/,s=>s.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),t==null||t(!r)}})});let Rb=0;function c8(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)Rb++,t[s]={id:ze("box"+Rb),type:"geo",x:s%r*132,y:Math.floor(s/r)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(s=>s.id))})}function l8({children:n}){const e=n??d.jsx(s8,{});return d.jsxs(Hs,{id:"debug",children:[d.jsx(Ks,{children:d.jsx(ie,{type:"icon",title:"Debug menu",children:d.jsx(we,{icon:"dots-horizontal"})})}),d.jsx(qs,{side:"top",align:"end",alignOffset:0,children:d.jsx(Ln,{type:"menu",sourceId:"debug-panel",children:e})})]})}const d8=_.memo(function(){const{DebugMenu:e}=Is(),t=_.useRef(null);return Ps(t),d.jsxs("div",{ref:t,className:"tlui-debug-panel",children:[d.jsx(h8,{}),d.jsx(p8,{}),e&&d.jsx(e,{})]})});function u8(n=!0){const[e,t]=_.useState(0),r=z();_.useEffect(()=>{if(!n)return;const s=()=>t(i=>i+1);return r.on("tick",s),()=>{r.off("tick",s)}},[r,n])}const h8=Et(function(){u8();const e=z(),t=e.getPath(),r=e.getHoveredShape(),s=e.getOnlySelectedShape(),i=t==="select.idle"||!t.includes("select.")?r:s,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${y.ToInt(e.getPointInShapeSpace(i,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${y.ToInt(e.inputs.originPagePoint)}] → [${y.ToInt(e.inputs.currentPagePoint)}] = ${y.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return d.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function p8(){const n=z(),e=N("show_fps",()=>ct.showFps.get(),[ct]),t=_.useRef(null);return _.useEffect(()=>{if(!e)return;const r=250;let s=0,i=-1,o=performance.now(),a=0,c=0,l=!1;function u(){if(c++,a=performance.now()-o,a>r){const h=Math.round(c*(r/a)*(1e3/r));h>s&&(s=h);const p=s*.75;(h<p&&!l||h>=p&&l)&&(l=!l),t.current.innerHTML=`FPS ${h.toString()}`,t.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),a-=r,c=0,o=performance.now()}i=n.timers.requestAnimationFrame(u)}return u(),()=>{cancelAnimationFrame(i)}},[e,n]),e?d.jsx("div",{ref:t}):null}const f8=_.memo(function(){const e=Yt(),t=_.useRef(null);Ps(t);const{MainMenu:r,QuickActions:s,ActionsMenu:i,PageMenu:o}=Is(),a=z(),c=N("isSinglePageMode",()=>a.options.maxPages<=1,[a]),l=a.options.actionShortcutsLocation==="menu"?!0:a.options.actionShortcutsLocation==="toolbar"?!1:e>=ot.TABLET;return!r&&!o&&!l?null:d.jsx("div",{ref:t,className:"tlui-menu-zone",children:d.jsxs("div",{className:"tlui-buttons__horizontal",children:[r&&d.jsx(r,{}),o&&!c&&d.jsx(o,{}),l?d.jsxs(d.Fragment,{children:[s&&d.jsx(s,{}),i&&d.jsx(i,{})]}):null]})})});function g8(){const n=z(),e=Zs(),[t,r]=_.useState(!1),s=_.useRef(!1);return ps("toggle showback to content",()=>{const i=s.current,o=n.getCurrentPageShapeIds();let a=!1;o.size&&(a=o.size===n.getCulledShapes().size),i!==a&&(r(a),s.current=a)},[n]),t?d.jsx(H,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function m8(){const n=z();return N("is pen mode",()=>n.getInstanceState().isPenMode,[n])?d.jsx(H,{actionId:"exit-pen-mode"}):null}function y8(){const n=z(),e=Zs();return N("is following user",()=>!!n.getInstanceState().followingUserId,[n])?d.jsx(It,{...e["stop-following"]}):null}function S8(){return d.jsxs(d.Fragment,{children:[d.jsx(m8,{}),d.jsx(g8,{}),d.jsx(y8,{})]})}function x8({children:n}){const e=n??d.jsx(S8,{});return d.jsx("div",{className:"tlui-helper-buttons",children:d.jsx(Ln,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function b8(){const n=Ml();return d.jsxs(d.Fragment,{children:[d.jsxs(Se,{label:"shortcuts-dialog.tools",id:"tools",children:[d.jsx(H,{actionId:"toggle-tool-lock"}),d.jsx(H,{actionId:"insert-media"}),d.jsx(Jt,{toolId:"select"}),d.jsx(Jt,{toolId:"draw"}),d.jsx(Jt,{toolId:"eraser"}),d.jsx(Jt,{toolId:"hand"}),d.jsx(Jt,{toolId:"rectangle"}),d.jsx(Jt,{toolId:"ellipse"}),d.jsx(Jt,{toolId:"arrow"}),d.jsx(Jt,{toolId:"line"}),d.jsx(Jt,{toolId:"text"}),d.jsx(Jt,{toolId:"frame"}),d.jsx(Jt,{toolId:"note"}),d.jsx(Jt,{toolId:"laser"}),d.jsx(It,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),d.jsxs(Se,{label:"shortcuts-dialog.preferences",id:"preferences",children:[d.jsx(H,{actionId:"toggle-dark-mode"}),d.jsx(H,{actionId:"toggle-focus-mode"}),d.jsx(H,{actionId:"toggle-grid"})]}),d.jsxs(Se,{label:"shortcuts-dialog.edit",id:"edit",children:[d.jsx(H,{actionId:"undo"}),d.jsx(H,{actionId:"redo"}),d.jsx(H,{actionId:"cut"}),d.jsx(H,{actionId:"copy"}),d.jsx(H,{actionId:"paste"}),d.jsx(H,{actionId:"select-all"}),d.jsx(H,{actionId:"delete"}),d.jsx(H,{actionId:"duplicate"})]}),d.jsxs(Se,{label:"shortcuts-dialog.view",id:"view",children:[d.jsx(H,{actionId:"zoom-in"}),d.jsx(H,{actionId:"zoom-out"}),d.jsx(H,{actionId:"zoom-to-100"}),d.jsx(H,{actionId:"zoom-to-fit"}),d.jsx(H,{actionId:"zoom-to-selection"})]}),d.jsxs(Se,{label:"shortcuts-dialog.transform",id:"transform",children:[d.jsx(H,{actionId:"bring-to-front"}),d.jsx(H,{actionId:"bring-forward"}),d.jsx(H,{actionId:"send-backward"}),d.jsx(H,{actionId:"send-to-back"}),d.jsx(H,{actionId:"group"}),d.jsx(H,{actionId:"ungroup"}),d.jsx(H,{actionId:"flip-horizontal"}),d.jsx(H,{actionId:"flip-vertical"}),d.jsx(H,{actionId:"align-top"}),d.jsx(H,{actionId:"align-center-vertical"}),d.jsx(H,{actionId:"align-bottom"}),d.jsx(H,{actionId:"align-left"}),d.jsx(H,{actionId:"align-center-horizontal"}),d.jsx(H,{actionId:"align-right"})]}),n&&d.jsx(Se,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:d.jsx(H,{actionId:"open-cursor-chat"})})]})}const w8=_.memo(function({children:e}){const t=Pe(),r=Yt(),s=e??d.jsx(b8,{});return d.jsxs(d.Fragment,{children:[d.jsxs(El,{className:"tlui-shortcuts-dialog__header",children:[d.jsx(Tl,{children:t("shortcuts-dialog.title")}),d.jsx(kl,{})]}),d.jsx(Bo,{className:se("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=ot.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=ot.TABLET}),children:d.jsx(Ln,{type:"keyboard-shortcuts",sourceId:"kbd",children:s})}),d.jsx("div",{className:"tlui-dialog__scrim"})]})});function G_(){const n=ws(),e=kt(),t=N("locale",()=>n==null?void 0:n.user.getLocale(),[n]);return n?d.jsx(hn,{id:"help menu language",label:"menu.language",children:d.jsx(Se,{id:"languages",children:zo.map(({locale:r,label:s})=>d.jsx(Dl,{id:`language-${r}`,title:r,label:s,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function v8(){return d.jsxs(d.Fragment,{children:[d.jsx(G_,{}),d.jsx(W_,{})]})}function W_(){const{KeyboardShortcutsDialog:n}=Is(),{addDialog:e}=Xs(),t=_.useCallback(()=>{n&&e({component:n})},[e,n]);return n?d.jsx(It,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}function P8(){return d.jsxs(d.Fragment,{children:[d.jsx(C8,{}),d.jsx(k8,{}),d.jsx(I8,{}),d.jsx(j8,{}),d.jsx(M8,{})]})}function I8(){return d.jsxs(hn,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[d.jsxs(Se,{id:"export-all-as-group",children:[d.jsx(H,{actionId:"export-all-as-svg"}),d.jsx(H,{actionId:"export-all-as-png"}),d.jsx(H,{actionId:"export-all-as-json"})]}),d.jsx(Se,{id:"export-all-as-bg",children:d.jsx(Wg,{})})]})}function C8(){const n=z(),e=N("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return d.jsxs(hn,{id:"edit",label:"menu.edit",disabled:!e,children:[d.jsx(T8,{}),d.jsx(z_,{}),d.jsx(N_,{}),d.jsx(_8,{}),d.jsx(E8,{}),d.jsx(Se,{id:"select-all",children:d.jsx(B_,{})})]})}function _8(){return d.jsxs(Se,{id:"misc",children:[d.jsx(M_,{}),d.jsx(A_,{}),d.jsx(k_,{}),d.jsx(T_,{}),d.jsx(D_,{}),d.jsx(O_,{}),d.jsx(H_,{}),d.jsx(U_,{}),d.jsx(j_,{})]})}function E8(){return d.jsxs(Se,{id:"lock",children:[d.jsx(R_,{}),d.jsx(T$,{})]})}function T8(){const n=E_(),e=__();return d.jsxs(Se,{id:"undo-redo",children:[d.jsx(H,{actionId:"undo",disabled:!n}),d.jsx(H,{actionId:"redo",disabled:!e})]})}function k8(){return d.jsx(hn,{id:"view",label:"menu.view",children:d.jsxs(Se,{id:"view-actions",children:[d.jsx(H,{actionId:"zoom-in"}),d.jsx(H,{actionId:"zoom-out"}),d.jsx(L_,{}),d.jsx(F_,{}),d.jsx($_,{})]})})}function j8(){return d.jsxs(Se,{id:"extras",children:[d.jsx(H,{actionId:"insert-embed"}),d.jsx(H,{actionId:"insert-media"})]})}function M8(){return d.jsxs(Se,{id:"preferences",children:[d.jsxs(hn,{id:"preferences",label:"menu.preferences",children:[d.jsxs(Se,{id:"preferences-actions",children:[d.jsx(N$,{}),d.jsx(B$,{}),d.jsx(U$,{}),d.jsx(H$,{}),d.jsx(K$,{}),d.jsx(q$,{}),d.jsx(G$,{}),d.jsx(Y$,{}),d.jsx(V$,{}),d.jsx(W$,{})]}),d.jsx(Se,{id:"color-scheme",children:d.jsx(UL,{})})]}),d.jsx(G_,{}),d.jsx(W_,{})]})}const A8=_.memo(function({children:e}){const t=ft(),[r,s]=Vr("main menu"),i=Pe(),o=e??d.jsx(P8,{});return d.jsxs(df,{dir:"ltr",open:r,onOpenChange:s,modal:!1,children:[d.jsx(uf,{asChild:!0,dir:"ltr",children:d.jsx(ie,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:d.jsx(we,{icon:"menu",small:!0})})}),d.jsx(Xc,{container:t,children:d.jsx(hf,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:d.jsx(Ln,{type:"menu",sourceId:"main-menu",children:o})})})]})}),Nh={};function uo(n){if(Nh[n])return Nh[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[r,s,i,o]=t.getImageData(0,0,1,1).data,a=new Float32Array([r/255,s/255,i/255,o/255]);return Nh[n]=a,a}const Sc=10,Y_=24*Sc+12+48;function ai(n,{center:e,radius:t,numArcSegments:r=20,startAngle:s=0,endAngle:i=Le,offset:o=0}){const a=(i-s)/r;let c=o;for(let l=s;l<i;l+=a)n[c++]=e.x,n[c++]=e.y,n[c++]=e.x+Math.cos(l)*t,n[c++]=e.y+Math.sin(l)*t,n[c++]=e.x+Math.cos(l+a)*t,n[c++]=e.y+Math.sin(l+a)*t;return n}function ci(n,e,t,r,s,i){n[e++]=t,n[e++]=r,n[e++]=t,n[e++]=r+i,n[e++]=t+s,n[e++]=r,n[e++]=t+s,n[e++]=r,n[e++]=t,n[e++]=r+i,n[e++]=t+s,n[e++]=r+i}function D8(n,e,t){const r=Sc;t=Math.min(t,Math.min(e.w,e.h)/2);const s=V.ExpandBy(e,-t);if(s.w<=0||s.h<=0)return ai(n,{center:e.center,radius:t,numArcSegments:Sc*4}),Sc*4*6;let i=0;return ci(n,i,s.minX,s.minY,s.w,s.h),i+=12,ci(n,i,s.minX,e.minY,s.w,t),i+=12,ci(n,i,s.maxX,s.minY,t,s.h),i+=12,ci(n,i,s.minX,s.maxY,s.w,t),i+=12,ci(n,i,e.minX,s.minY,t,s.h),i+=12,ai(n,{numArcSegments:r,offset:i,center:s.point,radius:t,startAngle:je,endAngle:je*1.5}),i+=r*6,ai(n,{numArcSegments:r,offset:i,center:y.Add(s.point,new y(s.w,0)),radius:t,startAngle:je*1.5,endAngle:Le}),i+=r*6,ai(n,{numArcSegments:r,offset:i,center:y.Add(s.point,s.size),radius:t,startAngle:0,endAngle:Ke}),i+=r*6,ai(n,{numArcSegments:r,offset:i,center:y.Add(s.point,new y(0,s.h)),radius:t,startAngle:Ke,endAngle:je}),Y_}function O8(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const s=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,i=e.createShader(e.FRAGMENT_SHADER);if(!i)throw new Error("Failed to create fragment shader");if(e.shaderSource(i,s),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const o=e.createProgram();if(!o)throw new Error("Failed to create program");if(e.attachShader(o,r),e.attachShader(o,i),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(o);const a=e.getAttribLocation(o,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const c=e.getUniformLocation(o,"canvasPageBounds"),l=e.getUniformLocation(o,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:Na(e,1024),unselectedShapes:Na(e,4096),viewport:Na(e,Y_),collaborators:Na(e,1024),prepareTriangles(p,f){e.bindBuffer(e.ARRAY_BUFFER,p.buffer),e.bufferData(e.ARRAY_BUFFER,p.vertices,e.STATIC_DRAW,0,f),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(p){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,p/2),e.disable(e.BLEND)},drawTriangles(p){e.drawArrays(e.TRIANGLES,0,p/2)},setFillColor(p){e.uniform4fv(l,p)},setCanvasPageBounds(p){e.uniform4fv(c,p)}}}function Na(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function Lb(n,e,t){let r=n.vertices.length;for(;r<e+t.length;)r*=2;if(r!=n.vertices.length){const s=new Float32Array(r);s.set(n.vertices),n.vertices=s}n.vertices.set(t,e)}var R8=Object.create,V_=Object.defineProperty,L8=Object.getOwnPropertyDescriptor,F8=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),X_=n=>{throw TypeError(n)},Z_=(n,e,t)=>e in n?V_(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,$8=n=>[,,,R8(null)],J_=["class","method","getter","setter","accessor","field","value","get","set"],Q_=n=>n!==void 0&&typeof n!="function"?X_("Function expected"):n,z8=(n,e,t,r,s)=>({kind:J_[n],name:e,metadata:r,addInitializer:i=>t._?X_("Already initialized"):s.push(Q_(i||null))}),N8=(n,e)=>Z_(e,F8("metadata"),n[3]),B8=(n,e,t,r)=>{for(var s=0,i=n[e>>1],o=i&&i.length;s<o;s++)i[s].call(t);return r},Pr=(n,e,t,r,s,i)=>{for(var o,a,c,l,u=e&7,h=!1,p=!1,f=2,g=J_[u+5],m=n[f]||(n[f]=[]),x=(s=s.prototype,L8(s,t)),b=r.length-1;b>=0;b--)c=z8(u,t,a={},n[3],m),c.static=h,c.private=p,l=c.access={has:S=>t in S},l.get=S=>S[t],o=(0,r[b])(x[g],c),a._=1,Q_(o)&&(x[g]=o);return x&&V_(s,t,x),s},Ar=(n,e,t)=>Z_(n,typeof e!="symbol"?e+"":e,t),e2,t2,n2,r2,s2,i2,o2,a2,c2,l2,En;l2=[on],c2=[K],a2=[K],o2=[K],i2=[K],s2=[K],r2=[K],n2=[K],t2=[K],e2=[on];class zn{constructor(e,t,r){this.editor=e,this.elem=t,this.container=r,B8(En,5,this),Ar(this,"disposables",[]),Ar(this,"gl"),Ar(this,"shapeGeometryCache"),Ar(this,"colors"),Ar(this,"id",Fe()),Ar(this,"canvasBoundingClientRect",ht("canvasBoundingClientRect",new V)),Ar(this,"originPagePoint",new y),Ar(this,"originPageCenter",new y),Ar(this,"isInViewport",!1),this.gl=O8(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",s=>{const i=e.getShapeMaskedPageBounds(s.id);if(!i)return null;const o=new Float32Array(12);return ci(o,0,i.x,i.y,i.w,i.h),o}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),ur("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:uo(e.getPropertyValue("--color-text-3").trim()),selectFill:uo(e.getPropertyValue("--color-selected").trim()),viewportFill:uo(e.getPropertyValue("--color-muted-1").trim()),background:uo(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?V.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new y(e.maxX,e.maxY));return new V(t.x,t.y,r.x-t.x,r.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:r,height:s}=this.elem.getBoundingClientRect();return new V(e,t,r,s)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new y(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),r=e.width/e.height;let s=t.width,i=s/r;i<t.height&&(i=t.height,s=i*r);const o=new V(0,0,s,i);return o.center=t.center,o}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:r,h:s}=this.getCanvasPageBounds();return new Float32Array([e,t,r,s])}getMinimapPagePoint(e,t){const r=this.getCanvasPageBounds(),s=this.getCanvasScreenBounds();let i=e-s.x,o=t-s.y;return i*=r.width/s.width,o*=r.height/s.height,i+=r.minX,o+=r.minY,new y(i,o,1)}minimapScreenPointToPagePoint(e,t,r=!1,s=!1){const{editor:i}=this,o=i.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(e,t);if(s){const l=this.editor.getCurrentPageBounds()??new V,u=l.minX-o.width/2,h=l.maxX+o.width/2,p=l.minY-o.height/2,f=l.maxY+o.height/2,g=Math.max(0,u+o.width-a),m=Math.max(0,-(h-o.width-a)),x=Math.max(0,p+o.height-c),b=Math.max(0,-(f-o.height-c));a+=(g-m)/2,c+=(x-b)/2,a=wt(a,u,h),c=wt(c,p,f)}if(r){const{originPagePoint:l}=this,u=Math.abs(a-l.x),h=Math.abs(c-l.y);u>h?c=l.y:a=l.x}return new y(a,c)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),s=this.colors;let i=0,o=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,l=a.length;c<l;c++){const u=a[c],h=this.shapeGeometryCache.get(u);if(!h)continue;const p=h.length;r.has(u)?(Lb(this.gl.selectedShapes,i,h),i+=p):(Lb(this.gl.unselectedShapes,o,h),o+=p)}this.drawShapes(this.gl.unselectedShapes,o,s.shapeFill),this.drawShapes(this.gl.selectedShapes,i,s.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,r){this.gl.prepareTriangles(e,t),this.gl.setFillColor(r),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=D8(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),Be.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,r=t*6,s=r*e.length;this.gl.collaborators.vertices.length<s&&(this.gl.collaborators.vertices=new Float32Array(s));const i=this.gl.collaborators.vertices;let o=0;const a=this.getZoom();for(const{cursor:c}of e)ai(i,{center:y.From(c),radius:3*a,offset:o,numArcSegments:t}),o+=r;this.gl.prepareTriangles(this.gl.collaborators,s),o=0;for(const{color:c}of e)this.gl.setFillColor(uo(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,o/2,r/2),o+=r}}En=$8();Pr(En,1,"close",l2,zn);Pr(En,1,"getDpr",c2,zn);Pr(En,1,"getContentPageBounds",a2,zn);Pr(En,1,"getContentScreenBounds",o2,zn);Pr(En,1,"getCanvasSize",i2,zn);Pr(En,1,"getCanvasClientPosition",s2,zn);Pr(En,1,"getCanvasPageBounds",r2,zn);Pr(En,1,"getZoom",n2,zn);Pr(En,1,"getCanvasPageBoundsArray",t2,zn);Pr(En,1,"render",e2,zn);N8(En,zn);function U8(){const n=z(),e=ft(),t=_.useRef(null),r=_.useRef(!1),s=_.useRef();_.useEffect(()=>{try{const u=new zn(n,t.current,e);return s.current=u,s.current.close}catch(u){n.annotateError(u,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw u})}},[n,e]);const i=_.useCallback(u=>{if(!n.getCurrentPageShapeIds().size||!s.current)return;const h=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),p=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);s.current.originPagePoint.setTo(p),s.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(h,{animation:{duration:n.options.animationMediumMs}})},[n]),o=_.useCallback(u=>{if(!s.current)return;const h=u.currentTarget;if(Jo(h,u),!n.getCurrentPageShapeIds().size)return;r.current=!0,s.current.isInViewport=!1;const p=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!1),f=n.getViewportPageBounds(),g=s.current.getContentPageBounds();if(new V(g.x-f.width/2,g.y-f.height/2,g.width+f.width,g.height+f.height).containsPoint(p)&&!f.containsPoint(p)){s.current.isInViewport=f.containsPoint(p);const b=y.Sub(f.center,f.point),S=y.Add(p,b);s.current.originPagePoint.setTo(S),s.current.originPageCenter.setTo(p),n.centerOnPoint(p,{animation:{duration:n.options.animationMediumMs}})}else{const b=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,!1,!0);s.current.isInViewport=f.containsPoint(b),s.current.originPagePoint.setTo(b),s.current.originPageCenter.setTo(f.center)}function x(b){h&&Qo(h,b),r.current=!1,document.body.removeEventListener("pointerup",x)}document.body.addEventListener("pointerup",x)},[n]),a=_.useCallback(u=>{if(!s.current)return;const h=s.current.minimapScreenPointToPagePoint(u.clientX,u.clientY,u.shiftKey,!0);if(r.current){if(s.current.isInViewport){const m=s.current.originPagePoint.clone().sub(s.current.originPageCenter);n.centerOnPoint(y.Sub(h,m));return}n.centerOnPoint(h)}const p=s.current.getMinimapPagePoint(u.clientX,u.clientY),f=n.pageToScreen(p),g={type:"pointer",target:"canvas",name:"pointer_move",...Sn(u),point:f,isPen:n.getInstanceState().isPenMode};n.dispatch(g)},[n]),c=_.useCallback(u=>{const h=W0(u);n.dispatch({type:"wheel",name:"wheel",delta:h,point:new y(u.clientX,u.clientY),shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey,metaKey:u.metaKey,accelKey:Lt(u)})},[n]),l=ia();return _.useEffect(()=>{n.timers.setTimeout(()=>{var u,h;(u=s.current)==null||u.updateColors(),(h=s.current)==null||h.render()})},[l,n]),d.jsx("div",{className:"tlui-minimap",children:d.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:i,onPointerMove:a,onPointerDown:o,onWheelCapture:c})})}function H8(n,e){const[t,r]=Qe.useState(e);Qe.useLayoutEffect(()=>{const i=Cf(n);if(i)try{r(JSON.parse(i))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const s=Qe.useCallback(i=>{r(o=>{const a=typeof i=="function"?i(o):i;return _f(n,JSON.stringify(a)),a})},[n]);return[t,s]}const K8=_.memo(function(){const e=Zs(),t=Pe(),r=Yt(),s=_.useRef(null);Ps(s);const[i,o]=H8("minimap",!0),a=_.useCallback(()=>{o(u=>!u)},[o]),{ZoomMenu:c,Minimap:l}=Is();return r<ot.MOBILE?null:d.jsxs("div",{ref:s,className:"tlui-navigation-panel",children:[d.jsx("div",{className:"tlui-buttons__horizontal",children:c&&r<ot.TABLET?d.jsx(c,{}):i?d.jsxs(d.Fragment,{children:[c&&d.jsx(c,{}),l&&d.jsx(ie,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:d.jsx(we,{icon:i?"chevrons-ne":"chevrons-sw"})})]}):d.jsxs(d.Fragment,{children:[d.jsx(ie,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(Uo(e["zoom-out"].label))} ${Up(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:d.jsx(we,{icon:"minus"})}),c&&d.jsx(c,{}),d.jsx(ie,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(Uo(e["zoom-in"].label))} ${Up(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:d.jsx(we,{icon:"plus"})}),l&&d.jsx(ie,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:d.jsx(we,{icon:i?"chevrons-ne":"chevrons-sw"})})]})}),l&&r>=ot.TABLET&&!i&&d.jsx(l,{})]})}),q8=function({name:e,id:t,isCurrentPage:r,onCancel:s}){const i=z(),o=kt(),a=_.useRef(null),c=_.useRef(null),l=_.useCallback(()=>{c.current=i.markHistoryStoppingPoint("rename page")},[i]),u=_.useCallback(p=>{i.renamePage(t,p||"New Page"),o("rename-page",{source:"page-menu"})},[i,t,o]),h=_.useCallback(()=>{c.current&&i.bailToMark(c.current),s()},[i,s]);return d.jsx(jl,{className:"tlui-page-menu__item__input",ref:p=>a.current=p,defaultValue:e,onValueChange:u,onCancel:h,onFocus:l,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},lf=(n,e,t,r,s)=>{let i;const o=n.getPages(),a=t>r?o[r-1]:o[r],c=t>r?o[r]:o[r+1];a&&!c?i=ar(a.index):!a&&c?i=LT(o[0].index):i=Lo(a.index,c.index),i!==o[t].index&&(n.markHistoryStoppingPoint("moving page"),n.updatePage({id:e,index:i}),s("move-page",{source:"page-menu"}))},Fb=Et(function({index:e,listSize:t,item:r,onRename:s}){const i=z(),o=Pe(),a=i.getPages(),c=kt(),l=_.useCallback(()=>{i.markHistoryStoppingPoint("creating page");const f=In.createId();i.duplicatePage(r.id,f),c("duplicate-page",{source:"page-menu"})},[i,r,c]),u=_.useCallback(()=>{lf(i,r.id,e,e-1,c)},[i,r,e,c]),h=_.useCallback(()=>{lf(i,r.id,e,e+1,c)},[i,r,e,c]),p=_.useCallback(()=>{i.markHistoryStoppingPoint("deleting page"),i.deletePage(r.id),c("delete-page",{source:"page-menu"})},[i,r,c]);return d.jsxs(Hs,{id:`page item submenu ${e}`,children:[d.jsx(Ks,{children:d.jsx(ie,{type:"icon",title:o("page-menu.submenu.title"),children:d.jsx(we,{icon:"dots-vertical",small:!0})})}),d.jsx(qs,{alignOffset:0,side:"right",sideOffset:-4,children:d.jsxs(Ln,{type:"menu",sourceId:"page-menu",children:[d.jsxs(Se,{id:"modify",children:[s&&d.jsx(It,{id:"rename",label:"page-menu.submenu.rename",onSelect:s}),d.jsx(It,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:l,disabled:a.length>=i.options.maxPages}),e>0&&d.jsx(It,{id:"move-up",onSelect:u,label:"page-menu.submenu.move-up"}),e<t-1&&d.jsx(It,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:h})]}),t>1&&d.jsx(Se,{id:"delete",children:d.jsx(It,{id:"delete",onSelect:p,label:"page-menu.submenu.delete"})})]})})]})}),G8=_.memo(function(){const e=z(),t=kt(),r=Pe(),s=Yt(),i=_.useCallback(()=>b(!1),[]),[o,a]=Vr("page-menu",i),c=36,l=_.useRef(null),u=N("pages",()=>e.getPages(),[e]),h=N("currentPage",()=>e.getCurrentPage(),[e]),p=N("currentPageId",()=>e.getCurrentPageId(),[e]),f=_n(),g=N("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),m=N("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[x,b]=_.useState(!1),S=_.useCallback(()=>{f||b(D=>!D)},[f]),P=_.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,I]=_.useState(Object.fromEntries(u.map((D,O)=>[D.id,{y:O*c,offsetY:0,isSelected:!1}])));_.useLayoutEffect(()=>{I(Object.fromEntries(u.map((D,O)=>[D.id,{y:O*c,offsetY:0,isSelected:!1}])))},[c,u]),_.useEffect(()=>{o&&e.timers.requestAnimationFrame(()=>{const D=document.querySelector(`[data-testid="page-menu-item-${p}"]`);if(D){const O=l.current;if(!O)return;const $=D.offsetTop,B=O.scrollTop;$<B&&O.scrollTo({top:$});const G=$+c,Y=O.scrollTop+O.offsetHeight;G>Y&&O.scrollTo({top:G-O.offsetHeight})}})},[c,p,o,e]);const E=_.useCallback(D=>{const{clientY:O,currentTarget:$}=D,{dataset:{id:B,index:G}}=$;if(!B||!G)return;const Y=P.current;Jo(D.currentTarget,D),Y.status="pointing",Y.pointing={id:B,index:+G};const de=w[B].y;Y.startY=O,Y.startIndex=Math.max(0,Math.min(Math.round(de/c),u.length-1))},[c,u.length,w]),T=_.useCallback(D=>{const O=P.current;if(O.status==="pointing"){const{clientY:$}=D,B=$-O.startY;Math.abs(B)>5&&(O.status="dragging")}if(O.status==="dragging"){const{clientY:$}=D,B=$-O.startY,G=w[O.pointing.id],{startIndex:Y,pointing:ne}=O,de=G.y+B,ae=Math.max(0,Math.min(Math.round(de/c),u.length-1)),Oe={...w};if(Oe[ne.id]={y:G.y,offsetY:B,isSelected:!0},ae!==O.dragIndex){O.dragIndex=ae;for(let ce=0;ce<u.length;ce++){const Ne=u[ce];if(Ne.id===O.pointing.id)continue;let{y:re}=Oe[Ne.id];ae===Y?re=ce*c:ae<Y?ae<=ce&&ce<Y?re=(ce+1)*c:re=ce*c:ae>Y&&(ae>=ce&&ce>Y?re=(ce-1)*c:re=ce*c),re!==Oe[Ne.id].y&&(Oe[Ne.id]={y:re,offsetY:0,isSelected:!0})}}I(Oe)}},[c,u,w]),C=_.useCallback(D=>{const O=P.current;if(O.status==="dragging"){const{id:$,index:B}=O.pointing;lf(e,$,B,O.dragIndex,t)}Qo(D.currentTarget,D),O.status="idle"},[e,t]),j=_.useCallback(D=>{const O=P.current;D.key==="Escape"&&(O.status==="dragging"&&I(Object.fromEntries(u.map(($,B)=>[$.id,{y:B*c,offsetY:0,isSelected:!1}]))),O.status="idle")},[c,u]),k=_.useCallback(()=>{f||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const D=In.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:D}),e.setCurrentPage(D),b(!0)}),t("new-page",{source:"page-menu"}))},[e,r,f,t]),R=_.useCallback(D=>{e.setCurrentPage(D),t("change-page",{source:"page-menu"})},[e,t]),A=_.useCallback((D,O)=>{e.renamePage(D,O),t("rename-page",{source:"page-menu"})},[e,t]);return d.jsxs(Kg,{id:"pages",onOpenChange:a,open:o,children:[d.jsx(qg,{"data-testid":"main.page-menu",children:d.jsxs(ie,{type:"menu",title:h.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[d.jsx("div",{className:"tlui-page-menu__name",children:h.name}),d.jsx(we,{icon:"chevron-down",small:!0})]})}),d.jsx(Gg,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:x,children:d.jsxs("div",{className:"tlui-page-menu__wrapper",children:[d.jsxs("div",{className:"tlui-page-menu__header",children:[d.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!f&&d.jsxs("div",{className:"tlui-buttons__horizontal",children:[d.jsx(ie,{type:"icon","data-testid":"page-menu.edit",title:r(x?"page-menu.edit-done":"page-menu.edit-start"),onClick:S,children:d.jsx(we,{icon:x?"check":"edit"})}),d.jsx(ie,{type:"icon","data-testid":"page-menu.create",title:r(g?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:g,onClick:k,children:d.jsx(we,{icon:"plus"})})]})]}),d.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*u.length+4},ref:l,children:u.map((D,O)=>{const $=w[D.id]??{offsetY:0};return x?d.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:D.id===h.id?888:O,transform:`translate(0px, ${$.y+$.offsetY}px)`},children:[d.jsx(ie,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:E,onPointerUp:C,onPointerMove:T,onKeyDown:j,"data-id":D.id,"data-index":O,children:d.jsx(we,{icon:"drag-handle-dots"})}),s<ot.TABLET_SM&&m?d.jsxs(ie,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const B=window.prompt("Rename page",D.name);B&&B!==D.name&&A(D.id,B)},onDoubleClick:S,children:[d.jsx(cf,{checked:D.id===h.id}),d.jsx(lt,{children:D.name})]}):d.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:d.jsx(q8,{id:D.id,name:D.name,isCurrentPage:D.id===h.id,onCancel:()=>{b(!1),e.menus.clearOpenMenus()}})}),!f&&d.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":x,children:d.jsx(Fb,{index:O,item:D,listSize:u.length})})]},D.id+"_editing"):d.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[d.jsxs(ie,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>R(D.id),onDoubleClick:S,title:r("page-menu.go-to-page"),children:[d.jsx(cf,{checked:D.id===h.id}),d.jsx(lt,{children:D.name})]}),!f&&d.jsx("div",{className:"tlui-page_menu__item__submenu",children:d.jsx(Fb,{index:O,item:D,listSize:u.length,onRename:()=>{if(Be.isIos){const B=window.prompt("Rename page",D.name);B&&B!==D.name&&A(D.id,B)}else b(!0),p!==D.id&&R(D.id)}})})]},D.id)})})]})})]})});function W8(){const n=z(),e=E_(),t=__(),r=Vt(1),s=_n(),i=N("should display quick actions",()=>n.isInAny("select","hand","zoom"),[n]),o=Xr(),a=r&&o;if(!(s&&!i))return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"undo",disabled:!e}),d.jsx(H,{actionId:"redo",disabled:!t}),d.jsx(H,{actionId:"delete",disabled:!a}),d.jsx(H,{actionId:"duplicate",disabled:!a})]})}const Y8=_.memo(function({children:e}){const t=e??d.jsx(W8,{});return d.jsx(Ln,{type:"small-icons",sourceId:"quick-actions",children:t})});function V8({userId:n}){const e=ul(n);return e?d.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const X8=Et(function({userId:e}){const t=z(),r=Pe(),s=kt(),i=ul(e),o=_.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),s("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),s("start-following",{source:"people-menu"}))},[t,e,s]),a=(i==null?void 0:i.followingUserId)===t.user.getId(),c=t.getInstanceState().followingUserId===e;return i?d.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[d.jsxs(ie,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:o,children:[d.jsx(Sr,{icon:"color",color:i.color}),d.jsx("div",{className:"tlui-people-menu__name",children:i.userName??"New User"})]}),d.jsx(ie,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:o,disabled:a,"data-active":c||a,children:d.jsx(we,{icon:a?"leading":c?"following":"follow"})})]}):null});function Z8({count:n}){return d.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const J8=Et(function(){const e=z(),t=ft(),r=Pe(),s=kt(),i=_.useRef(!1),[o,a]=_.useState(!1),c=_.useCallback(m=>{a(m)},[]),l=e.user.getColor(),u=_.useCallback(m=>{e.user.updateUserPreferences({color:m}),s("set-color",{source:"people-menu"})},[e,s]),{handleButtonClick:h,handleButtonPointerDown:p,handleButtonPointerEnter:f,handleButtonPointerUp:g}=Qe.useMemo(()=>{const m=()=>{i.current=!1,window.removeEventListener("pointerup",m)};return{handleButtonClick:w=>{const{id:I}=w.currentTarget.dataset;I&&l!==I&&u(I)},handleButtonPointerDown:w=>{const{id:I}=w.currentTarget.dataset;I&&(u(I),i.current=!0,window.addEventListener("pointerup",m))},handleButtonPointerEnter:w=>{if(!i.current)return;const{id:I}=w.currentTarget.dataset;I&&u(I)},handleButtonPointerUp:w=>{const{id:I}=w.currentTarget.dataset;I&&u(I)}}},[l,u]);return d.jsxs(pf,{onOpenChange:c,open:o,children:[d.jsx(ff,{dir:"ltr",asChild:!0,children:d.jsx(ie,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:d.jsx(we,{icon:"color"})})}),d.jsx(gf,{container:t,children:d.jsx(mf,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:d.jsx("div",{className:"tlui-buttons__grid",children:Cp.map(m=>d.jsx(ie,{type:"icon","data-id":m,"data-testid":m,"aria-label":m,"data-state":l===m?"hinted":void 0,title:m,className:"tlui-button-grid__button",style:{color:m},onPointerEnter:f,onPointerDown:p,onPointerUp:g,onClick:h,children:d.jsx(we,{icon:"color"})},m))})})})]})});function Q8(){const n=z(),e=kt(),t=N("userName",()=>n.user.getName(),[]),r=Pe(),s=_.useRef(t),i=_.useRef(t),[o,a]=_.useState(!1),c=_.useCallback(()=>{a(p=>!p)},[]),l=_.useCallback(p=>{i.current=p,n.user.updateUserPreferences({name:p})},[n]),u=_.useCallback(()=>{s.current!==i.current&&(e("change-user-name",{source:"people-menu"}),s.current=i.current)},[e]),h=_.useCallback(()=>{a(!1),n.user.updateUserPreferences({name:s.current}),n.menus.clearOpenMenus()},[n]);return d.jsxs("div",{className:"tlui-people-menu__user",children:[d.jsx(J8,{}),o?d.jsx(jl,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:l,onComplete:c,onCancel:h,onBlur:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{o||a(!0)},children:t}),t==="New User"?d.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),d.jsx(ie,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:d.jsx(we,{icon:o?"check":"edit"})})]})}function ez({displayUserWhenAlone:n,children:e}){const t=Pe(),r=ft(),s=z(),i=X0(),o=N("user",()=>s.user.getColor(),[s]),a=N("user",()=>s.user.getName(),[s]),[c,l]=Vr("people menu");return d.jsxs(pf,{onOpenChange:l,open:c,children:[d.jsx(ff,{dir:"ltr",asChild:!0,children:d.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[i.length>5&&d.jsx(Z8,{count:i.length-5}),d.jsxs("div",{className:"tlui-people-menu__avatars",children:[i.slice(-5).map(u=>d.jsx(V8,{userId:u},u)),(n||i.length>0)&&d.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:o},children:a==="New User"?"":a[0]??""})]})]})}),d.jsx(gf,{container:r,children:d.jsx(mf,{dir:"ltr",className:"tlui-menu",align:"end",side:"bottom",sideOffset:2,alignOffset:-5,onEscapeKeyDown:xe,children:d.jsxs("div",{className:"tlui-people-menu__wrapper",children:[d.jsx("div",{className:"tlui-people-menu__section",children:d.jsx(Q8,{})}),i.length>0&&d.jsx("div",{className:"tlui-people-menu__section",children:i.map(u=>d.jsx(X8,{userId:u},u+"_presence"))}),e]})})})]})}function tz(){return d.jsx("div",{className:"tlui-share-zone",draggable:!1,children:d.jsx(ez,{displayUserWhenAlone:!0})})}const nz=Object.freeze([Pn,Ns,Bs,mr]);function d2(n=nz){const e=z();return N("getRelevantStyles",()=>{var i;const t=new Mp(e.getSharedStyles()),r=!!((i=e.root.getCurrent())!=null&&i.shapeType),s=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const o of n)t.applyValue(o,e.getStyleForNextShape(o));return r||s||t.size>0?t:null},[e])}const On={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},Ds=_.memo(function(e){const{uiType:t,items:r,title:s,style:i,value:o,onValueChange:a,onHistoryMark:c,theme:l}=e,u=Pe(),h=_.useRef(!1),p=_.useRef(null),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:m,handleButtonPointerUp:x}=_.useMemo(()=>{const b=()=>{h.current=!1,window.removeEventListener("pointerup",b);const E=p.current;E&&["TEXTAREA","INPUT"].includes(E.nodeName)&&E.focus(),p.current=null};return{handleButtonClick:E=>{const{id:T}=E.currentTarget.dataset;o.type==="shared"&&o.value===T||(c==null||c("point picker item"),a(i,T))},handleButtonPointerDown:E=>{const{id:T}=E.currentTarget.dataset;c==null||c("point picker item"),a(i,T),h.current=!0,p.current=document.activeElement,window.addEventListener("pointerup",b)},handleButtonPointerEnter:E=>{if(!h.current)return;const{id:T}=E.currentTarget.dataset;a(i,T)},handleButtonPointerUp:E=>{const{id:T}=E.currentTarget.dataset;o.type==="shared"&&o.value===T||a(i,T)}}},[o,c,a,i]);return d.jsx("div",{"data-testid":`style.${t}`,className:se("tlui-buttons__grid"),children:r.map(b=>d.jsx(ie,{type:"icon","data-id":b.value,"data-testid":`style.${t}.${b.value}`,"aria-label":b.value,"data-state":o.type==="shared"&&o.value===b.value?"hinted":void 0,title:s+" — "+u(`${t}-style.${b.value}`),className:se("tlui-button-grid__button"),style:i===Pn?{color:l[b.value].solid}:void 0,onPointerEnter:m,onPointerDown:g,onPointerUp:x,onClick:f,children:d.jsx(we,{icon:b.icon})},b.value))})}),rz=_.memo(function({onHistoryMark:e,title:t,steps:r,value:s,label:i,onValueChange:o,["data-testid"]:a}){const c=Pe(),l=_.useCallback(p=>{o(p[0])},[o]),u=_.useCallback(()=>{e("click slider")},[e]),h=_.useCallback(()=>{s&&o(s)},[s,o]);return d.jsx("div",{className:"tlui-slider__container",children:d.jsxs(WE,{"data-testid":a,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:s?[s]:void 0,onPointerDown:u,onValueChange:l,onPointerUp:h,title:t+" — "+c(i),children:[d.jsx(YE,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&d.jsx(VE,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&d.jsx(XE,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function sz({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:s,itemsA:i,itemsB:o,styleA:a,styleB:c,valueA:l,valueB:u,onValueChange:h}){const p=Pe(),f=_.useMemo(()=>{var m;return((m=i.find(x=>l.type==="shared"&&l.value===x.value))==null?void 0:m.icon)??"mixed"},[i,l]),g=_.useMemo(()=>{var m;return((m=o.find(x=>u.type==="shared"&&u.value===x.value))==null?void 0:m.icon)??"mixed"},[o,u]);return l===void 0&&u===void 0?null:d.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[d.jsx("div",{title:p(n),className:"tlui-style-panel__double-select-picker-label",children:p(n)}),d.jsxs("div",{className:"tlui-buttons__horizontal",children:[d.jsxs(Hs,{id:`style panel ${e} A`,children:[d.jsx(Ks,{children:d.jsx(ie,{type:"icon","data-testid":`style.${e}`,title:p(r)+" — "+(l===null||l.type==="mixed"?p("style-panel.mixed"):p(`${e}-style.${l.value}`)),children:d.jsx(we,{icon:f,small:!0,invertIcon:!0})})}),d.jsx(qs,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:d.jsx("div",{className:"tlui-buttons__grid",children:i.map((m,x)=>d.jsx(Ho,{"data-testid":`style.${e}.${m.value}`,children:d.jsx(ie,{type:"icon",onClick:()=>h(a,m.value),title:`${p(r)} — ${p(`${e}-style.${m.value}`)}`,children:d.jsx(we,{icon:m.icon,invertIcon:!0})},m.value)},x))})})]}),d.jsxs(Hs,{id:`style panel ${t}`,children:[d.jsx(Ks,{children:d.jsx(ie,{type:"icon","data-testid":`style.${t}`,title:p(s)+" — "+(u===null||u.type==="mixed"?p("style-panel.mixed"):p(`${t}-style.${u.value}`)),children:d.jsx(we,{icon:g,small:!0})})}),d.jsx(qs,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:d.jsx("div",{className:"tlui-buttons__grid",children:o.map(m=>d.jsx(Ho,{children:d.jsx(ie,{type:"icon",title:`${p(s)} — ${p(`${t}-style.${m.value}`)}`,"data-testid":`style.${t}.${m.value}`,onClick:()=>h(c,m.value),children:d.jsx(we,{icon:m.icon})})},m.value))})})]})]})]})}const iz=_.memo(sz);function oz({id:n,label:e,uiType:t,stylePanelType:r,style:s,items:i,type:o,value:a,onValueChange:c}){const l=Pe(),u=z(),h=_.useMemo(()=>{var m;return(m=i.find(x=>a.type==="shared"&&x.value===a.value))==null?void 0:m.icon},[i,a]),p=l(`style-panel.${r}`),f=a.type==="mixed"?l("style-panel.mixed"):p+" — "+l(`${t}-style.${a.value}`),g=e?l(e):"";return d.jsxs(Hs,{id:`style panel ${n}`,children:[d.jsx(Ks,{children:d.jsxs(ie,{type:o,"data-testid":`style.${t}`,title:f,children:[g&&d.jsx(lt,{children:g}),d.jsx(we,{icon:h??"mixed"})]})}),d.jsx(qs,{side:"left",align:"center",alignOffset:0,children:d.jsx("div",{className:"tlui-buttons__grid",children:i.map(m=>d.jsx(Ho,{children:d.jsx(ie,{type:"icon","data-testid":`style.${t}.${m.value}`,title:p+" — "+l(`${t}-style.${m.value}`),onClick:()=>{u.markHistoryStoppingPoint("select style dropdown item"),c(s,m.value)},children:d.jsx(we,{icon:m.icon})})},m.value))})})]})}const Yg=_.memo(oz);function az({styles:n}){const e=ia();if(!n)return null;const t=n.get(Gn),r=n.get(Mc),s=n.get(jc),i=n.get(Rc),o=n.get(gr),a=t===void 0,c=r===void 0&&s===void 0,l=i===void 0,u=o===void 0,h=Yr({isDarkMode:e});return d.jsxs(d.Fragment,{children:[d.jsx(cz,{theme:h,styles:n}),!u&&d.jsx(lz,{theme:h,styles:n}),!(a&&c&&l)&&d.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[d.jsx(dz,{styles:n}),d.jsx(hz,{styles:n}),d.jsx(uz,{styles:n})]})]})}function oa(){const n=z(),e=kt();return Qe.useMemo(()=>(function(r,s){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(r,s),n.setStyleForNextShapes(r,s),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:s})}),[n,e])}function cz({styles:n,theme:e}){const t=Pe(),r=z(),s=_.useCallback(h=>r.markHistoryStoppingPoint(h),[r]),i=oa(),o=n.get(Pn),a=n.get(Bs),c=n.get(Ns),l=n.get(mr),u=a!==void 0||c!==void 0||l!==void 0;return d.jsxs(d.Fragment,{children:[d.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[o===void 0?null:d.jsx(Ds,{title:t("style-panel.color"),uiType:"color",style:Pn,items:On.color,value:o,onValueChange:i,theme:e,onHistoryMark:s}),d.jsx(pz,{})]}),u&&d.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:d.jsx(Ds,{title:t("style-panel.fill"),uiType:"fill",style:Bs,items:On.fill,value:a,onValueChange:i,theme:e,onHistoryMark:s}),c===void 0?null:d.jsx(Ds,{title:t("style-panel.dash"),uiType:"dash",style:Ns,items:On.dash,value:c,onValueChange:i,theme:e,onHistoryMark:s}),l===void 0?null:d.jsx(Ds,{title:t("style-panel.size"),uiType:"size",style:mr,items:On.size,value:l,onValueChange:(h,p)=>{i(h,p);const f=r.getSelectedShapeIds();f.length>0&&He(r,f)},theme:e,onHistoryMark:s})]})]})}function lz({theme:n,styles:e}){const t=Pe(),r=oa(),s=z(),i=_.useCallback(u=>s.markHistoryStoppingPoint(u),[s]),o=e.get(gr),a=e.get(vp),c=e.get(Dc),l=e.get(Oc);return o===void 0&&c===void 0?null:d.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[o===void 0?null:d.jsx(Ds,{title:t("style-panel.font"),uiType:"font",style:gr,items:On.font,value:o,onValueChange:r,theme:n,onHistoryMark:i}),a===void 0?null:d.jsxs("div",{className:"tlui-style-panel__row",children:[d.jsx(Ds,{title:t("style-panel.align"),uiType:"align",style:vp,items:On.textAlign,value:a,onValueChange:r,theme:n,onHistoryMark:i}),d.jsx("div",{className:"tlui-style-panel__row__extra-button",children:d.jsx(ie,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:d.jsx(we,{icon:"vertical-align-middle"})})})]}),c===void 0?null:d.jsxs("div",{className:"tlui-style-panel__row",children:[d.jsx(Ds,{title:t("style-panel.label-align"),uiType:"align",style:Dc,items:On.horizontalAlign,value:c,onValueChange:r,theme:n,onHistoryMark:i}),d.jsx("div",{className:"tlui-style-panel__row__extra-button",children:l===void 0?d.jsx(ie,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:d.jsx(we,{icon:"vertical-align-middle"})}):d.jsx(Yg,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:Oc,items:On.verticalAlign,value:l,onValueChange:r})})]})]})}function dz({styles:n}){const e=oa(),t=n.get(Gn);return t===void 0?null:d.jsx(Yg,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:Gn,items:On.geo,value:t,onValueChange:e})}function uz({styles:n}){const e=oa(),t=n.get(Rc);return t===void 0?null:d.jsx(Yg,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:Rc,items:On.spline,value:t,onValueChange:e})}function hz({styles:n}){const e=oa(),t=n.get(Mc),r=n.get(jc);return!t||!r?null:d.jsx(iz,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:jc,itemsA:On.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:Mc,itemsB:On.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const ho=[.1,.25,.5,.75,1];function pz(){const n=z(),e=_.useCallback(a=>n.markHistoryStoppingPoint(a),[n]),t=N("opacity",()=>n.getSharedOpacity(),[n]),r=kt(),s=Pe(),i=Qe.useCallback(a=>{const c=ho[a];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(c),n.setOpacityForNextShapes(c),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[n,r]);if(t===void 0)return null;const o=t.type==="mixed"?-1:ho.indexOf(iT(ho,a=>Math.abs(a-t.value)));return d.jsx(rz,{"data-testid":"style.opacity",value:o>=0?o:ho.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:i,steps:ho.length-1,title:s("style-panel.opacity"),onHistoryMark:e})}const fz=_.memo(function({isMobile:e,children:t}){const r=z(),s=_.useRef(null);Ps(s);const i=d2(),o=_.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),a=t??d.jsx(az,{styles:i});return d.jsx("div",{ref:s,className:se("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:o,children:a})});function gz(){const n=z(),e=Pe(),t=d2(),r=t==null?void 0:t.get(Pn),s=Yr({isDarkMode:n.user.getIsDarkMode()}),i=((r==null?void 0:r.type)==="shared"?s[r.value]:s.black).solid,o=N("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),a=_.useCallback(l=>{l||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:c}=Is();return c?d.jsxs(Kg,{id:"mobile style menu",onOpenChange:a,children:[d.jsx(qg,{children:d.jsx(ie,{type:"tool","data-testid":"mobile-styles.button",style:{color:o?"var(--color-muted-1)":i},title:e("style-panel.title"),disabled:o,children:d.jsx(we,{icon:o?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),d.jsx(Gg,{side:"top",align:"end",children:c&&d.jsx(c,{isMobile:!0})})]}):null}function mz(){return d.jsxs(d.Fragment,{children:[d.jsx(Sz,{}),d.jsx(xz,{}),d.jsx(bz,{}),d.jsx(wz,{}),d.jsx(vz,{}),d.jsx(Pz,{}),d.jsx(Iz,{}),d.jsx(Cz,{}),d.jsx(_z,{}),d.jsx(Ez,{}),d.jsx(kz,{}),d.jsx(Tz,{}),d.jsx(Az,{}),d.jsx(Rz,{}),d.jsx(jz,{}),d.jsx(Oz,{}),d.jsx(Dz,{}),d.jsx(Mz,{}),d.jsx(Lz,{}),d.jsx(Fz,{}),d.jsx($z,{}),d.jsx(zz,{}),d.jsx(Nz,{}),d.jsx(Bz,{}),d.jsx(Uz,{}),d.jsx(Hz,{}),d.jsx(qz,{}),d.jsx(Kz,{})]})}function yz(n){var r;const e=z(),t=(r=n.meta)==null?void 0:r.geo;return N("is tool selected",()=>{const s=e.getCurrentToolId(),i=e.getSharedStyles().getAsKnownValue(Gn);return t?s==="geo"&&i===t:s===n.id},[e,n.id,t])}function Ue({tool:n}){const e=Mg(),t=yz(e[n]);return d.jsx(Jt,{toolId:n,isSelected:t})}function Sz(){return d.jsx(Ue,{tool:"select"})}function xz(){return d.jsx(Ue,{tool:"hand"})}function bz(){return d.jsx(Ue,{tool:"draw"})}function wz(){return d.jsx(Ue,{tool:"eraser"})}function vz(){return d.jsx(Ue,{tool:"arrow"})}function Pz(){return d.jsx(Ue,{tool:"text"})}function Iz(){return d.jsx(Ue,{tool:"note"})}function Cz(){return d.jsx(Jt,{toolId:"asset"})}function _z(){return d.jsx(Ue,{tool:"rectangle"})}function Ez(){return d.jsx(Ue,{tool:"ellipse"})}function Tz(){return d.jsx(Ue,{tool:"diamond"})}function kz(){return d.jsx(Ue,{tool:"triangle"})}function jz(){return d.jsx(Ue,{tool:"rhombus"})}function Mz(){return d.jsx(Ue,{tool:"heart"})}function Az(){return d.jsx(Ue,{tool:"hexagon"})}function Dz(){return d.jsx(Ue,{tool:"cloud"})}function Oz(){return d.jsx(Ue,{tool:"star"})}function Rz(){return d.jsx(Ue,{tool:"oval"})}function Lz(){return d.jsx(Ue,{tool:"x-box"})}function Fz(){return d.jsx(Ue,{tool:"check-box"})}function $z(){return d.jsx(Ue,{tool:"arrow-left"})}function zz(){return d.jsx(Ue,{tool:"arrow-up"})}function Nz(){return d.jsx(Ue,{tool:"arrow-down"})}function Bz(){return d.jsx(Ue,{tool:"arrow-right"})}function Uz(){return d.jsx(Ue,{tool:"line"})}function Hz(){return d.jsx(Ue,{tool:"highlight"})}function Kz(){return d.jsx(Ue,{tool:"frame"})}function qz(){return d.jsx(Ue,{tool:"laser"})}const Bh=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function Uh(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function po(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function u2(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function h2(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Gz(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let s=!0;for(let i=0;i<t.length;i++)r.indexOf(t[i])===-1&&(s=!1);return s}const Ko={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,arrowup:38,arrowdown:40,arrowleft:37,arrowright:39,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Bh?173:189,"=":Bh?61:187,";":Bh?59:186,"'":222,"{":219,"}":221,"[":219,"]":221,"\\":220},Xn={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,meta:91,command:91},Po={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},vt={16:!1,18:!1,17:!1,91:!1},rt={};for(let n=1;n<20;n++)Ko["f".concat(n)]=111+n;let Je=[],Ao=null,p2="all";const Rr=new Map,Hi=n=>Ko[n.toLowerCase()]||Xn[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Wz=n=>Object.keys(Ko).find(e=>Ko[e]===n),Yz=n=>Object.keys(Xn).find(e=>Xn[e]===n);function f2(n){p2=n||"all"}function qo(){return p2||"all"}function Vz(){return Je.slice(0)}function Xz(){return Je.map(n=>Wz(n)||Yz(n)||String.fromCharCode(n))}function Zz(){const n=[];return Object.keys(rt).forEach(e=>{rt[e].forEach(t=>{let{key:r,scope:s,mods:i,shortcut:o}=t;n.push({scope:s,shortcut:o,mods:i,keys:r.split("+").map(a=>Hi(a))})})}),n}function Jz(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const s=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(s||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function Qz(n){return typeof n=="string"&&(n=Hi(n)),Je.indexOf(n)!==-1}function e9(n,e){let t,r;n||(n=qo());for(const s in rt)if(Object.prototype.hasOwnProperty.call(rt,s))for(t=rt[s],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(o=>{let{element:a}=o;return Vg(a)}):r++;qo()===n&&f2(e||"all")}function t9(n){let e=n.keyCode||n.which||n.charCode;n.key&&n.key.toLowerCase()==="capslock"&&(e=Hi(n.key));const t=Je.indexOf(e);if(t>=0&&Je.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&Je.splice(0,Je.length),(e===93||e===224)&&(e=91),e in vt){vt[e]=!1;for(const r in Xn)Xn[r]===e&&(an[r]=!1)}}function g2(n){if(typeof n>"u")Object.keys(rt).forEach(s=>{Array.isArray(rt[s])&&rt[s].forEach(i=>Ba(i)),delete rt[s]}),Vg(null);else if(Array.isArray(n))n.forEach(s=>{s.key&&Ba(s)});else if(typeof n=="object")n.key&&Ba(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[s,i]=t;typeof s=="function"&&(i=s,s=""),Ba({key:n,scope:s,method:i,splitKey:"+"})}}const Ba=n=>{let{key:e,scope:t,method:r,splitKey:s="+"}=n;h2(e).forEach(o=>{const a=o.split(s),c=a.length,l=a[c-1],u=l==="*"?"*":Hi(l);if(!rt[u])return;t||(t=qo());const h=c>1?u2(Xn,a):[],p=[];rt[u]=rt[u].filter(f=>{const m=(r?f.method===r:!0)&&f.scope===t&&Gz(f.mods,h);return m&&p.push(f.element),!m}),p.forEach(f=>Vg(f))})};function $b(n,e,t,r){if(e.element!==r)return;let s;if(e.scope===t||e.scope==="all"){s=e.mods.length>0;for(const i in vt)Object.prototype.hasOwnProperty.call(vt,i)&&(!vt[i]&&e.mods.indexOf(+i)>-1||vt[i]&&e.mods.indexOf(+i)===-1)&&(s=!1);(e.mods.length===0&&!vt[16]&&!vt[18]&&!vt[17]&&!vt[91]||s||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Je),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function zb(n,e){const t=rt["*"];let r=n.keyCode||n.which||n.charCode;if(n.key&&n.key.toLowerCase()==="capslock"||!an.filter.call(this,n))return;if((r===93||r===224)&&(r=91),Je.indexOf(r)===-1&&r!==229&&Je.push(r),["metaKey","ctrlKey","altKey","shiftKey"].forEach(a=>{const c=Po[a];n[a]&&Je.indexOf(c)===-1?Je.push(c):!n[a]&&Je.indexOf(c)>-1?Je.splice(Je.indexOf(c),1):a==="metaKey"&&n[a]&&(Je=Je.filter(l=>l in Po||l===r))}),r in vt){vt[r]=!0;for(const a in Xn)if(Object.prototype.hasOwnProperty.call(Xn,a)){const c=Po[Xn[a]];an[a]=n[c]}if(!t)return}for(const a in vt)Object.prototype.hasOwnProperty.call(vt,a)&&(vt[a]=n[Po[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(Je.indexOf(17)===-1&&Je.push(17),Je.indexOf(18)===-1&&Je.push(18),vt[17]=!0,vt[18]=!0);const s=qo();if(t)for(let a=0;a<t.length;a++)t[a].scope===s&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&$b(n,t[a],s,e);if(!(r in rt))return;const i=rt[r],o=i.length;for(let a=0;a<o;a++)if((n.type==="keydown"&&i[a].keydown||n.type==="keyup"&&i[a].keyup)&&i[a].key){const c=i[a],{splitKey:l}=c,u=c.key.split(l),h=[];for(let p=0;p<u.length;p++)h.push(Hi(u[p]));h.sort().join("")===Je.sort().join("")&&$b(n,c,s,e)}}function an(n,e,t){Je=[];const r=h2(n);let s=[],i="all",o=document,a=0,c=!1,l=!0,u="+",h=!1,p=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(i=e.scope),e.element&&(o=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(h=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey),e.single===!0&&(p=!0)),typeof e=="string"&&(i=e),p&&g2(n,i);a<r.length;a++)n=r[a].split(u),s=[],n.length>1&&(s=u2(Xn,n)),n=n[n.length-1],n=n==="*"?"*":Hi(n),n in rt||(rt[n]=[]),rt[n].push({keyup:c,keydown:l,scope:i,mods:s,shortcut:r[a],method:t,key:r[a],splitKey:u,element:o});if(typeof o<"u"&&window){if(!Rr.has(o)){const f=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return zb(m,o)},g=function(){let m=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;zb(m,o),t9(m)};Rr.set(o,{keydownListener:f,keyupListenr:g,capture:h}),Uh(o,"keydown",f,h),Uh(o,"keyup",g,h)}if(!Ao){const f=()=>{Je=[]};Ao={listener:f,capture:h},Uh(window,"focus",f,h)}}}function n9(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(rt).forEach(t=>{rt[t].filter(s=>s.scope===e&&s.shortcut===n).forEach(s=>{s&&s.method&&s.method()})})}function Vg(n){const e=Object.values(rt).flat();if(e.findIndex(r=>{let{element:s}=r;return s===n})<0){const{keydownListener:r,keyupListenr:s,capture:i}=Rr.get(n)||{};r&&s&&(po(n,"keyup",s,i),po(n,"keydown",r,i),Rr.delete(n))}if((e.length<=0||Rr.size<=0)&&(Object.keys(Rr).forEach(s=>{const{keydownListener:i,keyupListenr:o,capture:a}=Rr.get(s)||{};i&&o&&(po(s,"keyup",o,a),po(s,"keydown",i,a),Rr.delete(s))}),Rr.clear(),Object.keys(rt).forEach(s=>delete rt[s]),Ao)){const{listener:s,capture:i}=Ao;po(window,"focus",s,i),Ao=null}}const Hh={getPressedKeyString:Xz,setScope:f2,getScope:qo,deleteScope:e9,getPressedKeyCodes:Vz,getAllKeyCodes:Zz,isPressed:Qz,filter:Jz,trigger:n9,unbind:g2,keyMap:Ko,modifier:Xn,modifierMap:Po};for(const n in Hh)Object.prototype.hasOwnProperty.call(Hh,n)&&(an[n]=Hh[n]);if(typeof window<"u"){const n=window.hotkeys;an.noConflict=e=>(e&&window.hotkeys===an&&(window.hotkeys=n),an),window.hotkeys=an}const Nb=["copy","cut","paste","asset"];function r9(){const n=z(),e=_n(),t=Zs(),r=Mg(),s=N("is focused",()=>n.getInstanceState().isFocused,[n]);_.useEffect(()=>{if(!s)return;const i=new Array,o=(c,l)=>{an(c,{element:document.body},l),i.push(()=>{an.unbind(c,l)})},a=(c,l)=>{an(c,{element:document.body,keyup:!0,keydown:!1},l),i.push(()=>{an.unbind(c,l)})};for(const c of Object.values(t))c.kbd&&(e&&!c.readonlyOk||Nb.includes(c.id)||o(Bb(c.kbd),l=>{Io(n)||(xe(l),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&n.getIsReadonly()||Nb.includes(c.id)||o(Bb(c.kbd),l=>{Io(n)||(xe(l),c.onSelect("kbd"))});return o(",",c=>{if(Io(n)||n.inputs.keys.has("Comma"))return;xe(c),n.focus(),n.inputs.keys.add("Comma");const{x:l,y:u,z:h}=n.inputs.currentPagePoint,p=n.pageToScreen({x:l,y:u}),f={type:"pointer",name:"pointer_down",point:{x:p.x,y:p.y,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Lt(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(f)}),a(",",c=>{if(Io(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:l,y:u,z:h}=n.inputs.currentScreenPoint,p={type:"pointer",name:"pointer_up",point:{x:l,y:u,z:h},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:Lt(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(p)}),()=>{i.forEach(c=>c())}},[t,r,e,n,s])}function Bb(n){return s9(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd+⌥+${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function s9(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Io(n){return n.menus.hasAnyOpenMenus()||n.getEditingShapeId()!==null||n.getCrashingError()}const i9=_.createContext(!1);function o9({children:n}){const e=z(),t=Li(),r=Yt(),s=Pe(),i=Math.min(8,5+r),[o,a]=_.useState(0),c=_.useRef(null),[l,u]=_.useState(null),h=_.useMemo(()=>{const f=l?`:not([data-value="${l}"])`:"";return`
			#${t}_main > *:nth-child(n + ${i+(l?1:2)})${f} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${i}) {
				display: none;
			}
        `},[l,t,i]),p=Sl(()=>{if(!c.current)return;const f=Array.from(c.current.children);a(f.length),f.findIndex(x=>x.getAttribute("data-value")===l)<=i&&u(null);const m=Array.from(c.current.children).findIndex(x=>x.getAttribute("aria-checked")==="true");m!==-1&&m>=i&&u(f[m].getAttribute("data-value"))});return _.useLayoutEffect(()=>{p()}),_.useLayoutEffect(()=>{if(!c.current)return;const f=new MutationObserver(p);return f.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{f.disconnect()}},[p]),_.useEffect(()=>{const f=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[g,m]of f)an(g,x=>{var P;if(Io(e))return;xe(x);const S=Array.from(((P=c.current)==null?void 0:P.children)??[]).filter(w=>!(w instanceof HTMLElement)||w.tagName.toLowerCase()!=="button"?!1:!!(w.offsetWidth||w.offsetHeight))[m];S&&S.click()});return()=>{an.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),d.jsxs(d.Fragment,{children:[d.jsx("style",{children:h}),d.jsxs("div",{className:se("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<ot.TABLET_SM}),role:"radiogroup",children:[d.jsx("div",{id:`${t}_main`,ref:c,className:"tlui-toolbar__tools__list",children:d.jsx(Ln,{type:"toolbar",sourceId:"toolbar",children:n})}),o>i+1&&d.jsx(i9.Provider,{value:!0,children:d.jsxs(Hs,{id:"toolbar overflow",modal:!1,children:[d.jsx(Ks,{children:d.jsx(ie,{title:s("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:d.jsx(we,{icon:"chevron-up"})})}),d.jsx(qs,{side:"top",align:"center",children:d.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:d.jsx(Ln,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function a9({activeToolId:n}){const e=z(),t=Yt(),r=Pe(),s=N("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),i=N("current tool",()=>e.getCurrentTool(),[e]);return!n||!i.isLockable?null:d.jsx(ie,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:se("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<ot.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!s}),children:d.jsx(we,{icon:s?"lock":"unlock",small:!0})})}const c9=_.memo(function({children:e}){const t=z(),r=Yt(),s=_n(),i=N("current tool id",()=>t.getCurrentToolId(),[t]),o=_.useRef(null);Ps(o);const{ActionsMenu:a,QuickActions:c}=Is(),l=t.options.actionShortcutsLocation==="menu"?!1:t.options.actionShortcutsLocation==="toolbar"?!0:r<ot.TABLET;return d.jsx("div",{ref:o,className:"tlui-toolbar",children:d.jsxs("div",{className:"tlui-toolbar__inner",children:[d.jsxs("div",{className:"tlui-toolbar__left",children:[!s&&d.jsxs("div",{className:"tlui-toolbar__extras",children:[l&&d.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&d.jsx(c,{}),a&&d.jsx(a,{})]}),d.jsx(a9,{activeToolId:i})]}),d.jsx(o9,{children:e??d.jsx(mz,{})})]}),r<ot.TABLET_SM&&!s&&d.jsx("div",{className:"tlui-toolbar__tools",children:d.jsx(gz,{})})]})})});function l9(){const n=Pe();return d.jsxs("div",{className:se("tlui-offline-indicator"),children:[n("status.offline"),d.jsx(Sr,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function d9({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:r=12,squeezeAmount:s=52,children:i}){const o=_.useRef(null),a=Yt(),c=_.useCallback(()=>{const l=o.current;if(!l)return;const u=l.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=u.offsetWidth,g=h.offsetWidth,m=p.offsetWidth,x=l.offsetWidth-e;let b=(f-x)/2;f%2!==0&&(b-=.5);const S=g+r,P=l.offsetLeft,w=Math.min(f-m-g-2*r,n),I=Math.max(b,S)-P;p.offsetWidth>t&&a<=6?l.style.setProperty("max-width",w-s+"px"):l.style.setProperty("max-width",w+"px"),l.style.setProperty("transform",`translate(${I}px, 0px)`)},[a,e,r,n,s,t]);return _.useLayoutEffect(()=>{const l=o.current;if(!l)return;const u=l.parentElement.parentElement,h=u.querySelector(".tlui-layout__top__left"),p=u.querySelector(".tlui-layout__top__right"),f=new ResizeObserver(c);return f.observe(h),f.observe(p),f.observe(u),f.observe(l),c(),()=>{f.disconnect()}},[c]),_.useLayoutEffect(()=>{c()}),d.jsx("div",{ref:o,className:"tlui-top-panel__container",children:i})}function u9(){const n=TL()==="offline";return d.jsx(d9,{children:n&&d.jsx(l9,{})})}function h9(){return d.jsxs(d.Fragment,{children:[d.jsx(H,{actionId:"zoom-in",noClose:!0}),d.jsx(H,{actionId:"zoom-out",noClose:!0}),d.jsx(L_,{}),d.jsx(F_,{}),d.jsx($_,{})]})}const p9=_.memo(function({children:e}){const t=ft(),[r,s]=Vr("zoom menu"),i=e??d.jsx(h9,{});return d.jsxs(df,{dir:"ltr",open:r,onOpenChange:s,modal:!1,children:[d.jsx(uf,{asChild:!0,dir:"ltr",children:d.jsx(f9,{})}),d.jsx(Xc,{container:t,children:d.jsx(hf,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:d.jsx(Ln,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),f9=_.forwardRef(function(e,t){const r=z(),s=Yt(),i=N("zoom",()=>r.getZoomLevel(),[r]),o=Pe(),a=_.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return d.jsx(ie,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:s<ot.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:s<ot.MOBILE?null:d.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(i*100),"%"]})})}),m2=_.createContext(null);function g9({overrides:n={},children:e}){const t=$i(n),r=Ml();return d.jsx(m2.Provider,{value:_.useMemo(()=>({ContextMenu:J$,ActionsMenu:_$,HelpMenu:null,ZoomMenu:p9,MainMenu:A8,Minimap:U8,StylePanel:fz,PageMenu:G8,NavigationPanel:K8,Toolbar:c9,KeyboardShortcutsDialog:w8,QuickActions:Y8,HelperButtons:x8,DebugPanel:d8,DebugMenu:l8,MenuPanel:f8,SharePanel:r?tz:null,CursorChatBubble:r?t8:null,TopPanel:r?u9:null,...t}),[t,r]),children:e})}function Is(){const n=_.useContext(m2);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}const m9=Et(function({overrides:e,components:t,assetUrls:r,onUiEvent:s,forceMobile:i,mediaMimeTypes:o,children:a}){const c=ws();return d.jsx(qI.Provider,{value:o,children:d.jsx(pR,{assetUrls:i$(r),children:d.jsx(mR,{overrides:c$(e),locale:(c==null?void 0:c.user.getLocale())??sr.locale,children:d.jsx(lR,{onEvent:s,children:d.jsx(vL,{children:d.jsx(jL,{context:c==null?void 0:c.contextId,children:d.jsx(DL,{forceMobile:i,children:d.jsx(g9,{overrides:t,children:c?d.jsx(y9,{overrides:e,children:a}):a})})})})})})})})});function y9({overrides:n,children:e}){const t=l$(n);return d.jsx(AL,{overrides:t.actions,children:d.jsx(VL,{overrides:t.tools,children:e})})}function S9(){const n=z(),{addToast:e}=vr();_.useEffect(()=>{function t({name:r,count:s}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${s}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const x9=Qe.memo(function({renderDebugMenuItems:e,children:t,hideUi:r,components:s,...i}){return d.jsx(m9,{...i,components:s,children:d.jsx(b9,{hideUi:r,renderDebugMenuItems:e,children:t})})}),b9=Qe.memo(function({children:e,hideUi:t,...r}){return d.jsxs(d.Fragment,{children:[e,t?null:d.jsx(w9,{...r})]})}),w9=Qe.memo(function(){const e=z(),t=Pe(),r=Yt(),s=_n(),i=N("focus",()=>e.getInstanceState().isFocusMode,[e]),o=N("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:c,MenuPanel:l,StylePanel:u,Toolbar:h,HelpMenu:p,NavigationPanel:f,HelperButtons:g,DebugPanel:m,CursorChatBubble:x}=Is();r9(),tL(),S9();const{"toggle-focus-mode":b}=Zs();return d.jsxs("div",{className:se("tlui-layout",{"tlui-layout__mobile":r<ot.TABLET_SM}),"data-breakpoint":r,children:[i?d.jsx("div",{className:"tlui-layout__top",children:d.jsx(ie,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>b.onSelect("menu"),children:d.jsx(we,{icon:"dot"})})}):d.jsxs(d.Fragment,{children:[d.jsxs("div",{className:"tlui-layout__top",children:[d.jsxs("div",{className:"tlui-layout__top__left",children:[l&&d.jsx(l,{}),g&&d.jsx(g,{})]}),d.jsx("div",{className:"tlui-layout__top__center",children:c&&d.jsx(c,{})}),d.jsxs("div",{className:"tlui-layout__top__right",children:[a&&d.jsx(a,{}),u&&r>=ot.TABLET_SM&&!s&&d.jsx(u,{})]})]}),d.jsxs("div",{className:"tlui-layout__bottom",children:[d.jsxs("div",{className:"tlui-layout__bottom__main",children:[f&&d.jsx(f,{}),h&&d.jsx(h,{}),p&&d.jsx(p,{})]}),o&&m&&d.jsx(m,{})]})]}),d.jsx(YL,{}),d.jsx(KL,{}),d.jsx(n$,{}),x&&d.jsx(x,{})]})});async function v9(n,e){const{url:t,style:r="normal",weight:s="500",display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l,format:u}=e,h={style:r,weight:s,display:i,featureSettings:o,stretch:a,unicodeRange:c,variant:l},p=new FontFace(n,`url(${t})`,h);return await p.load(),document.fonts.add(p),p.$$_url=t,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${t}") format("${u}")
}`,p}const Ua=(n,e)=>{const[t,r]=_.useState(2);return _.useEffect(()=>{let s=!1;return r(2),v9(n,e).then(()=>{s||r(0)}).catch(i=>{s||(console.error(i),r(1))}),()=>{s=!0}},[n,e]),t};function P9(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function y2(n){const e=_.useMemo(()=>P9(n),[n]),t=[Ua("tldraw_draw",e.draw),Ua("tldraw_serif",e.serif),Ua("tldraw_sans",e.sansSerif),Ua("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function X9(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:s,acceptedVideoMimeTypes:i,onMount:o,components:a={},shapeUtils:c=[],bindingUtils:l=[],tools:u=[],embeds:h,...p}=n,f=$i(a),g=_.useMemo(()=>({Scribble:Zx,ShapeIndicators:oF,CollaboratorScribble:Zx,SelectionForeground:rF,SelectionBackground:tF,Handles:XL,...f}),[f]),m=cs(c),x=_.useMemo(()=>[...RC,...m],[m]),b=cs(l),S=_.useMemo(()=>[...tC,...b],[b]),P=cs(u),w=_.useMemo(()=>[...t$,...KF,...P],[P]),I=cs(s??Jc),E=cs(i??bf),T=_.useMemo(()=>[...I,...E],[I,E]),C=x_(p.assetUrls),{done:j,error:k}=y2(C);return k?d.jsx(EI,{children:"Could not load assets. Please refresh the page."}):j?d.jsx(Y5,{initialState:"select",...p,components:g,shapeUtils:x,bindingUtils:S,tools:w,children:d.jsxs(x9,{...p,components:g,mediaMimeTypes:T,children:[d.jsx(I9,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:I,acceptedVideoMimeTypes:E,onMount:o,embeds:h}),e]})}):d.jsx(Pg,{children:d.jsx(og,{})})}function I9({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=Jc,acceptedVideoMimeTypes:r=bf,onMount:s,embeds:i}){const o=z(),a=vr(),c=Pe();TI(()=>{const h=o.getShapeUtil("embed");h&&i&&h.setEmbedDefinitions(i);const p=[];return p.push(C6(o)),PF(o,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r},{toasts:a,msg:c}),p.push(o.store.props.onMount(o)),p.push(s==null?void 0:s(o)),()=>{p.forEach(f=>f==null?void 0:f())}});const{Canvas:l}=Xe(),{ContextMenu:u}=Is();return u?d.jsx(u,{}):l?d.jsx(l,{}):null}_.memo(function(e){const[t,r]=_.useState(null),[s,i]=_.useState(null),o=cs(e.shapeUtils??[]),a=_.useMemo(()=>[...RC,...o],[o]),c=cs(e.bindingUtils??[]),l=_.useMemo(()=>[...tC,...c],[c]),u=tR({snapshot:e.snapshot,shapeUtils:a}),h=x_(e.assetUrls),{done:p,error:f}=y2(h),{pageId:g,bounds:m,scale:x,pixelRatio:b,background:S,padding:P,darkMode:w,preserveAspectRatio:I,format:E="svg",licenseKey:T}=e;return _.useLayoutEffect(()=>{if(!s||!u||!p)return;let C=!1;const j=document.createElement("div");s.appendChild(j),s.classList.add("tl-container","tl-theme__light");const k=new Z({store:u,shapeUtils:a,bindingUtils:l,tools:[],getContainer:()=>j,licenseKey:T});g&&k.setCurrentPage(g);const R=k.getCurrentPageShapeIds();async function A(){const D=await k.getSvgString([...R],{bounds:m,scale:x,background:S,padding:P,darkMode:w,preserveAspectRatio:I});if(D&&!C){if(E==="svg"){if(!C){const O=new Blob([D.svg],{type:"image/svg+xml"}),$=URL.createObjectURL(O);r($)}}else if(E==="png"){const O=await BI(k,D.svg,{type:E,width:D.width,height:D.height,pixelRatio:b});if(O&&!C){const $=URL.createObjectURL(O);r($)}}}k.dispose()}return A(),()=>{C=!0}},[E,s,u,a,l,g,m,x,S,P,w,I,p,f,T,b]),f?d.jsx(EI,{children:"Could not load assets."}):p?d.jsx("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:t&&d.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):d.jsx(Pg,{children:d.jsx(og,{})})});_.memo(function({children:e}){const t=Pe(),r=Yt(),s=_.useRef(null);Ps(s);const i=e??d.jsx(v8,{});return r<ot.MOBILE?null:d.jsx("div",{ref:s,className:"tlui-help-menu",children:d.jsxs(Hs,{id:"help menu",children:[d.jsx(Ks,{children:d.jsx(ie,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:d.jsx(we,{icon:"question-mark",small:!0})})}),d.jsx(qs,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:d.jsx(Ln,{type:"menu",sourceId:"help-menu",children:i})})]})})});const C9=ve({schemaVersion:Nt(1),storeVersion:qa,recordVersions:Tc(ge,ve({version:qa,subTypeVersions:Tc(ge,qa).optional(),subTypeKey:ge.optional()}))}),_9=ve({schemaVersion:Nt(2),sequences:Tc(ge,qa)});ve({tldrawFileFormatVersion:jj,schema:Mj("schemaVersion",{1:C9,2:_9}),records:Ct(ve({id:ge,typeName:ge}).allowUnknownProperties())});Ss("tldraw","3.5.0","esm");export{os as A,Pn as D,gs as H,yr as R,Vn as S,X9 as T,N as a,Bs as b,ze as c,Dc as d,Ns as e,mr as f,gr as g,Et as t,z as u};
